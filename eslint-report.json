[{"filePath":"C:\\Personal\\QuorumFlow\\eslint.config.mjs","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign array to a variable before exporting as module default","line":3,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":13,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import nextCoreWebVitals from \"eslint-config-next/core-web-vitals\";\n\nexport default [\n  {\n    ignores: [\n      \"**/node_modules/**\",\n      \"**/.next/**\",\n      \"functions/lib/**\",\n      \"public/**\",\n    ],\n  },\n  ...nextCoreWebVitals,\n];\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\functions\\src\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\functions\\src\\modules\\modern-image-module.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-var-requires').","line":4,"column":1,"severity":1,"nodeType":null,"fix":{"range":[79,141],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import type PizZip from \"pizzip\";\nimport { DOMParser } from \"@xmldom/xmldom\";\n\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst docxtemplaterNamespace = require(\"docxtemplater\");\nconst { DocUtils } = docxtemplaterNamespace;\n\nconst MODULE_NAME = \"quorumflow/docxtemplater-modern-image-module\";\nconst DEFAULT_IMAGE_EXTENSION = \"png\";\n\ninterface ModernImageModuleOptions {\n    centered?: boolean;\n    getImage: (tagValue: unknown, tagName: string) => Buffer | Promise<Buffer>;\n    getSize: (\n        image: Buffer,\n        tagValue: unknown,\n        tagName: string\n    ) => [number, number] | Promise<[number, number]>;\n}\n\ninterface ModulePart {\n    module: string;\n    type: string;\n    value: string;\n    centered?: boolean;\n}\n\ninterface ScopeManager {\n    getValue: (key: string, context: { part: ModulePart }) => unknown;\n}\n\ninterface RenderOptions {\n    scopeManager: ScopeManager;\n    filePath: string;\n}\n\ninterface ResolverOptions extends RenderOptions {}\n\nclass RelationshipManager {\n    private readonly relsPath: string;\n    private readonly relationshipsDocument: any;\n\n    constructor(\n        private readonly zip: PizZip,\n        filePath: string,\n        private readonly xmlDocuments: Record<string, any>\n    ) {\n        this.relsPath = this.computeRelsPath(filePath);\n        this.relationshipsDocument = this.ensureRelationshipsDocument();\n    }\n\n    addImage(name: string, data: Buffer): number {\n        const uniqueName = this.ensureUniqueName(name);\n        const mediaPath = `word/media/${uniqueName}`;\n\n        this.zip.file(mediaPath, data, { binary: true });\n\n        const extension = this.getExtension(uniqueName);\n        this.ensureContentType(extension);\n\n        const nextRid = this.getNextRelationshipId();\n        this.appendRelationshipNode(nextRid, uniqueName);\n\n        return nextRid;\n    }\n\n    private ensureRelationshipsDocument(): any {\n        const existing = this.xmlDocuments[this.relsPath];\n        if (existing) {\n            return existing;\n        }\n\n        const templatePath = \"word/_rels/document.xml.rels\";\n        const template = this.xmlDocuments[templatePath];\n        if (!template) {\n            throw new Error(\n                `Unable to bootstrap relationships XML. Missing template at ${templatePath}.`\n            );\n        }\n\n        const cloned = new DOMParser().parseFromString(\n            DocUtils.xml2str(template),\n            \"application/xml\"\n        );\n        const relationships = cloned.getElementsByTagName(\"Relationships\")[0];\n        const relationshipNodes = relationships.getElementsByTagName(\"Relationship\");\n\n        for (let index = relationshipNodes.length - 1; index >= 0; index -= 1) {\n            const node = relationshipNodes.item(index);\n            if (node) {\n                relationships.removeChild(node);\n            }\n        }\n\n        this.xmlDocuments[this.relsPath] = cloned;\n        return cloned;\n    }\n\n    private computeRelsPath(filePath: string): string {\n        const lastSlash = filePath.lastIndexOf(\"/\");\n        const directory = lastSlash >= 0 ? filePath.slice(0, lastSlash) : \"\";\n        const fileName = lastSlash >= 0 ? filePath.slice(lastSlash + 1) : filePath;\n        return `${directory}/_rels/${fileName}.rels`;\n    }\n\n    private ensureUniqueName(original: string): string {\n        let attempt = original;\n        let counter = 1;\n        while (this.zip.file(`word/media/${attempt}`)) {\n            const suffix = `(${counter})`;\n            const dotIndex = original.lastIndexOf(\".\");\n            if (dotIndex === -1) {\n                attempt = `${original}${suffix}`;\n            } else {\n                attempt = `${original.slice(0, dotIndex)}${suffix}${original.slice(dotIndex)}`;\n            }\n            counter += 1;\n        }\n        return attempt;\n    }\n\n    private ensureContentType(extension: string): void {\n        const normalizedExtension = extension.toLowerCase();\n        const contentTypesDocument = this.xmlDocuments[\"[Content_Types].xml\"];\n        if (!contentTypesDocument) {\n            throw new Error(\"Unable to resolve [Content_Types].xml document.\");\n        }\n\n        const defaults = contentTypesDocument.getElementsByTagName(\"Default\");\n        const isRegistered = Array.from({ length: defaults.length }).some((_, index) => {\n            const node = defaults.item(index);\n            return node?.getAttribute(\"Extension\")?.toLowerCase() === normalizedExtension;\n        });\n\n        if (isRegistered) {\n            return;\n        }\n\n        const typesNode = contentTypesDocument.getElementsByTagName(\"Types\")[0];\n        const newDefault = contentTypesDocument.createElement(\"Default\");\n        newDefault.setAttribute(\"Extension\", normalizedExtension);\n        newDefault.setAttribute(\"ContentType\", `image/${normalizedExtension}`);\n        typesNode.appendChild(newDefault);\n    }\n\n    private getNextRelationshipId(): number {\n        const relationships = this.relationshipsDocument.getElementsByTagName(\"Relationship\");\n        let highest = 0;\n        for (let index = 0; index < relationships.length; index += 1) {\n            const node = relationships.item(index);\n            const idValue = node?.getAttribute(\"Id\");\n            if (idValue && /^rId\\d+$/.test(idValue)) {\n                const numeric = Number.parseInt(idValue.slice(3), 10);\n                highest = Math.max(highest, numeric);\n            }\n        }\n        return highest + 1;\n    }\n\n    private appendRelationshipNode(rId: number, imageName: string): void {\n        const relationshipsNode = this.relationshipsDocument.getElementsByTagName(\"Relationships\")[0];\n        const relationshipNode = this.relationshipsDocument.createElement(\"Relationship\");\n        relationshipNode.setAttribute(\"Id\", `rId${rId}`);\n        relationshipNode.setAttribute(\n            \"Type\",\n            \"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\"\n        );\n        relationshipNode.setAttribute(\"Target\", `media/${imageName}`);\n        relationshipsNode.appendChild(relationshipNode);\n    }\n\n    private getExtension(fileName: string): string {\n        const match = /\\.([a-zA-Z0-9]{2,5})(?:$|[?#])/.exec(fileName);\n        return match ? match[1].toLowerCase() : DEFAULT_IMAGE_EXTENSION;\n    }\n}\n\nexport default class ModernImageModule {\n    name = \"ModernImageModule\";\n\n    private readonly options: Required<ModernImageModuleOptions>;\n    private imageNumber = 1;\n    private zip: PizZip | null = null;\n    private xmlDocuments: Record<string, any> | null = null;\n    private fileTypeConfig: { tagTextXml: string } | null = null;\n\n    constructor(options: ModernImageModuleOptions) {\n        if (!options.getImage) {\n            throw new Error(\"ModernImageModule requires a getImage implementation.\");\n        }\n        if (!options.getSize) {\n            throw new Error(\"ModernImageModule requires a getSize implementation.\");\n        }\n\n        this.options = {\n            centered: options.centered ?? false,\n            getImage: options.getImage,\n            getSize: options.getSize,\n        };\n    }\n\n    optionsTransformer(options: any, docxtemplater?: any) {\n        if (!docxtemplater) {\n            return options;\n        }\n\n        const rels = docxtemplater.zip\n            .file(/\\.xml\\.rels/)\n            .map((file: { name: string }) => file.name);\n        const contentTypes = docxtemplater.zip\n            .file(/\\[Content_Types\\].xml/)\n            .map((file: { name: string }) => file.name);\n\n        const existingNames: string[] = Array.isArray(options.xmlFileNames)\n            ? options.xmlFileNames\n            : [];\n        const names = new Set<string>(existingNames);\n        rels.concat(contentTypes).forEach((name: string) => names.add(name));\n\n        this.zip = docxtemplater.zip;\n        this.fileTypeConfig = docxtemplater.fileTypeConfig;\n        options.xmlFileNames = Array.from(names);\n        return options;\n    }\n\n    set(options: { zip?: PizZip; xmlDocuments?: Record<string, any> }) {\n        if (options.zip) {\n            this.zip = options.zip;\n        }\n        if (options.xmlDocuments) {\n            this.xmlDocuments = options.xmlDocuments;\n        }\n    }\n\n    parse(placeHolderContent: string): ModulePart | null {\n        if (placeHolderContent.startsWith(\"%%\")) {\n            return {\n                module: MODULE_NAME,\n                type: \"placeholder\",\n                value: placeHolderContent.slice(2),\n                centered: true,\n            };\n        }\n        if (placeHolderContent.startsWith(\"%\")) {\n            return {\n                module: MODULE_NAME,\n                type: \"placeholder\",\n                value: placeHolderContent.slice(1),\n                centered: false,\n            };\n        }\n        return null;\n    }\n\n    postparse(parsed: unknown) {\n        return DocUtils.traits.expandToOne(parsed, {\n            moduleName: MODULE_NAME,\n            expandTo: this.options.centered ? \"w:p\" : \"w:t\",\n            getInner: ({ part }: { part: unknown }) => part,\n        });\n    }\n\n    render(part: ModulePart, options?: RenderOptions) {\n        if (part.module !== MODULE_NAME) {\n            return null;\n        }\n\n        if (!options) {\n            throw new Error(\"ModernImageModule requires render options to resolve scope and file information.\");\n        }\n\n        const value = options.scopeManager.getValue(part.value, { part });\n        if (!value) {\n            return this.toRendered(this.getFallbackTag());\n        }\n\n        const buffer = this.resolveBufferSync(this.options.getImage(value, part.value));\n        if (buffer.length === 0) {\n            return this.toRendered(this.getFallbackTag());\n        }\n\n        const size = this.resolveSizeSync(this.options.getSize(buffer, value, part.value));\n        const manager = this.createRelationshipManager(options.filePath);\n        const rId = manager.addImage(this.createImageName(value), buffer);\n        const xml = this.renderImageXml(part.centered ?? this.options.centered, rId, size);\n        return this.toRendered(xml);\n    }\n\n    resolve(part: ModulePart, options?: ResolverOptions) {\n        if (part.module !== MODULE_NAME) {\n            return null;\n        }\n\n        if (!options) {\n            throw new Error(\"ModernImageModule requires resolver options to access scope data.\");\n        }\n\n        const value = options.scopeManager.getValue(part.value, { part });\n        if (!value) {\n            return Promise.resolve(this.toRendered(this.getFallbackTag()));\n        }\n\n        const manager = this.createRelationshipManager(options.filePath);\n        return Promise.resolve(this.options.getImage(value, part.value))\n            .then((image) => this.ensureBuffer(image))\n            .then((buffer) => {\n                if (buffer.length === 0) {\n                    return this.toRendered(this.getFallbackTag());\n                }\n                return Promise.resolve(this.options.getSize(buffer, value, part.value)).then((size) => {\n                    const rId = manager.addImage(this.createImageName(value), buffer);\n                    const xml = this.renderImageXml(\n                        part.centered ?? this.options.centered,\n                        rId,\n                        this.normalizeSize(size)\n                    );\n                    return this.toRendered(xml);\n                });\n            });\n    }\n\n    private createRelationshipManager(filePath: string): RelationshipManager {\n        if (!this.zip || !this.xmlDocuments) {\n            throw new Error(\"ModernImageModule has not been initialised with document context.\");\n        }\n        return new RelationshipManager(this.zip, filePath, this.xmlDocuments);\n    }\n\n    private resolveBufferSync(result: Buffer | Promise<Buffer>): Buffer {\n        if (result instanceof Promise) {\n            throw new Error(\n                \"Asynchronous image sources are not supported in synchronous render path. Use async templates instead.\"\n            );\n        }\n        return this.ensureBuffer(result);\n    }\n\n    private resolveSizeSync(result: [number, number] | Promise<[number, number]>): [number, number] {\n        if (result instanceof Promise) {\n            throw new Error(\n                \"Asynchronous size resolvers are not supported in synchronous render path. Use async templates instead.\"\n            );\n        }\n        return this.normalizeSize(result);\n    }\n\n    private ensureBuffer(value: Buffer): Buffer {\n        if (!Buffer.isBuffer(value)) {\n            throw new Error(\"ModernImageModule expected getImage to resolve to a Buffer instance.\");\n        }\n        return value;\n    }\n\n    private normalizeSize(value: [number, number]): [number, number] {\n        const [width, height] = value;\n        if (!Number.isFinite(width) || !Number.isFinite(height) || width <= 0 || height <= 0) {\n            throw new Error(\"ModernImageModule expected getSize to resolve to positive numeric dimensions.\");\n        }\n        return [width, height];\n    }\n\n    private renderImageXml(centered: boolean, rId: number, sizeInPixels: [number, number]): string {\n        const [width, height] = sizeInPixels.map((dimension) =>\n            DocUtils.convertPixelsToEmus(dimension)\n        ) as [string, string];\n        if (centered) {\n            return this.getCenteredXml(rId, width, height);\n        }\n        return this.getInlineXml(rId, width, height);\n    }\n\n    private getInlineXml(rId: number, width: string, height: string): string {\n        return `\n            <w:drawing>\n                <wp:inline distT=\"0\" distB=\"0\" distL=\"0\" distR=\"0\">\n                    <wp:extent cx=\"${width}\" cy=\"${height}\"/>\n                    <wp:effectExtent l=\"0\" t=\"0\" r=\"0\" b=\"0\"/>\n                    <wp:docPr id=\"${rId}\" name=\"Generated Image\" descr=\"embedded image\"/>\n                    <wp:cNvGraphicFramePr>\n                        <a:graphicFrameLocks xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\" noChangeAspect=\"1\"/>\n                    </wp:cNvGraphicFramePr>\n                    <a:graphic xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\">\n                        <a:graphicData uri=\"http://schemas.openxmlformats.org/drawingml/2006/picture\">\n                            <pic:pic xmlns:pic=\"http://schemas.openxmlformats.org/drawingml/2006/picture\">\n                                <pic:nvPicPr>\n                                    <pic:cNvPr id=\"${rId}\" name=\"Generated Image\"/>\n                                    <pic:cNvPicPr>\n                                        <a:picLocks noChangeAspect=\"1\" noChangeArrowheads=\"1\"/>\n                                    </pic:cNvPicPr>\n                                </pic:nvPicPr>\n                                <pic:blipFill>\n                                    <a:blip r:embed=\"rId${rId}\"/>\n                                    <a:stretch>\n                                        <a:fillRect/>\n                                    </a:stretch>\n                                </pic:blipFill>\n                                <pic:spPr bwMode=\"auto\">\n                                    <a:xfrm>\n                                        <a:off x=\"0\" y=\"0\"/>\n                                        <a:ext cx=\"${width}\" cy=\"${height}\"/>\n                                    </a:xfrm>\n                                    <a:prstGeom prst=\"rect\">\n                                        <a:avLst/>\n                                    </a:prstGeom>\n                                </pic:spPr>\n                            </pic:pic>\n                        </a:graphicData>\n                    </a:graphic>\n                </wp:inline>\n            </w:drawing>\n        `.replace(/\\s{2,}/g, \"\");\n    }\n\n    private getCenteredXml(rId: number, width: string, height: string): string {\n        return `\n            <w:p>\n                <w:pPr>\n                    <w:jc w:val=\"center\"/>\n                </w:pPr>\n                <w:r>\n                    <w:rPr/>\n                    ${this.getInlineXml(rId, width, height)}\n                </w:r>\n            </w:p>\n        `.replace(/\\s{2,}/g, \"\");\n    }\n\n    private createImageName(tagValue: unknown): string {\n        const extension = this.resolveExtension(tagValue);\n        const name = `report-image-${this.imageNumber}.${extension}`;\n        this.imageNumber += 1;\n        return name;\n    }\n\n    private resolveExtension(tagValue: unknown): string {\n        if (typeof tagValue === \"string\") {\n            const match = /\\.([a-zA-Z0-9]{2,5})(?:$|[?#])/.exec(tagValue);\n            if (match) {\n                return match[1].toLowerCase();\n            }\n        }\n        return DEFAULT_IMAGE_EXTENSION;\n    }\n\n    private toRendered(value: string) {\n        return { value, errors: [] as any[] };\n    }\n\n    private getFallbackTag(): string {\n        if (!this.fileTypeConfig) {\n            throw new Error(\"ModernImageModule does not have access to file type configuration.\");\n        }\n        return this.fileTypeConfig.tagTextXml;\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\functions\\src\\modules\\notification-dispatcher.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\functions\\src\\types\\docxtemplater-image-module-free.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\global.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\instrumentation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\sentry.client.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\sentry.edge.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\ai\\dev.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\ai\\flows\\analyze-image-flow.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\ai\\flows\\generate-dashboard-summary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\ai\\flows\\suggest-activities-flow.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\ai\\genkit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(auth)\\forgot-password\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(auth)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(auth)\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(auth)\\register\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\birthdays\\BirthdayForm.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 't'. Either include it or remove the dependency array.","line":123,"column":6,"nodeType":"ArrayExpression","endLine":123,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, isEditMode, toast, t]","fix":{"range":[4027,4054],"text":"[isOpen, isEditMode, toast, t]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { Users, X, Upload, Loader2 } from 'lucide-react';\nimport { addDoc, doc, Timestamp, updateDoc, getDocs, query, orderBy } from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage';\nimport { birthdaysCollection, storage, membersCollection } from '@/lib/collections';\nimport type { Member } from '@/lib/types';\nimport logger from '@/lib/logger';\n\nimport { Button } from '@/components/ui/button';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport React from 'react';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport type { Birthday } from '@/lib/types';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useI18n } from '@/contexts/i18n-context';\n\nconst birthdaySchema = z.object({\n  name: z.string().min(2, { message: 'birthdayForm.nameRequired' }),\n  birthDate: z.date({\n    required_error: 'birthdayForm.birthDateRequired',\n  }),\n  entryMode: z.enum(['manual', 'automatic']).default('manual'),\n  selectedMemberId: z.string().optional(),\n});\n\ntype FormValues = z.infer<typeof birthdaySchema>;\n\ninterface BirthdayFormProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  onFormSubmit: () => void;\n  birthday?: Birthday;\n}\n\nconst MAX_FILE_SIZE = 20 * 1024 * 1024; // 20MB\n\nexport function BirthdayForm({ isOpen, onOpenChange, onFormSubmit, birthday }: BirthdayFormProps) {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { t } = useI18n();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const isEditMode = !!birthday;\n\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [members, setMembers] = useState<Member[]>([]);\n  const [loadingMembers, setLoadingMembers] = useState(false);\n  const [entryMode, setEntryMode] = useState<'manual' | 'automatic'>('manual');\n\n  const form = useForm<FormValues>({\n    resolver: zodResolver(birthdaySchema),\n    defaultValues: { \n      name: '',\n      entryMode: 'manual',\n      selectedMemberId: undefined\n    },\n  });\n\n  // Fetch members when dialog opens\n  useEffect(() => {\n    if (isOpen && !isEditMode) {\n      setLoadingMembers(true);\n      getDocs(query(membersCollection, orderBy('firstName')))\n        .then(snapshot => {\n          const membersData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Member));\n          setMembers(membersData);\n        })\n        .catch(error => {\n          logger.error({ error, message: 'Failed to fetch members for birthday form' });\n          let errorMessage = t('birthdayForm.loadMembersError');\n\n          if (error.message?.includes('permission-denied')) {\n            errorMessage = t('birthdayForm.permissionDenied');\n          } else if (error.message?.includes('network')) {\n            errorMessage = t('birthdayForm.networkError');\n          }\n\n          toast({\n            title: t('birthdays.error'),\n            description: errorMessage,\n            variant: 'destructive'\n          });\n        })\n        .finally(() => setLoadingMembers(false));\n    }\n  }, [isOpen, isEditMode, toast]);\n\n  useEffect(() => {\n    if (isOpen) {\n      if (isEditMode && birthday) {\n        form.reset({\n          name: birthday.name,\n          birthDate: birthday.birthDate.toDate(),\n          entryMode: 'manual', // Always manual in edit mode\n          selectedMemberId: undefined\n        });\n        setPreviewUrl(birthday.photoURL || null);\n        setEntryMode('manual');\n      } else {\n        form.reset({ \n          name: '', \n          birthDate: undefined,\n          entryMode: 'manual',\n          selectedMemberId: undefined\n        });\n        setPreviewUrl(null);\n        setEntryMode('manual');\n      }\n      setSelectedFile(null);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  }, [isOpen, birthday, isEditMode, form]);\n\n  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > MAX_FILE_SIZE) {\n      toast({\n        title: t('birthdayForm.fileTooLarge'),\n        description: t('birthdayForm.maxFileSize'),\n        variant: \"destructive\",\n      });\n      if (fileInputRef.current) fileInputRef.current.value = '';\n      return;\n    }\n\n    setSelectedFile(file);\n    setPreviewUrl(URL.createObjectURL(file));\n  };\n  \n  const removeImage = () => {\n    setSelectedFile(null);\n    setPreviewUrl(isEditMode ? null : null); // Keep existing image in edit mode until save\n    if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n    }\n  };\n\n  // Handle entry mode change\n  const handleEntryModeChange = (mode: 'manual' | 'automatic') => {\n    setEntryMode(mode);\n    form.setValue('entryMode', mode);\n    \n    if (mode === 'manual') {\n      // Clear automatic mode fields\n      form.setValue('selectedMemberId', undefined);\n      form.setValue('name', '');\n      setPreviewUrl(null);\n      setSelectedFile(null);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    } else {\n      // Clear manual mode fields\n      form.setValue('name', '');\n      setPreviewUrl(null);\n      setSelectedFile(null);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  // Handle member selection in automatic mode\n  const handleMemberSelect = (memberId: string) => {\n    const selectedMember = members.find(m => m.id === memberId);\n    if (selectedMember) {\n      form.setValue('selectedMemberId', memberId);\n      form.setValue('name', `${selectedMember.firstName} ${selectedMember.lastName}`);\n      setPreviewUrl(selectedMember.photoURL || null);\n      setSelectedFile(null);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n\n  const onSubmit = async (values: FormValues) => {\n    if (!user) {\n      toast({ title: t('birthdays.error'), description: t('birthdayForm.loginRequired'), variant: \"destructive\" });\n      return;\n    }\n    \n    setIsSubmitting(true);\n    let finalPhotoURL = birthday?.photoURL || null;\n\n    try {\n        // Handle image upload if a new file is selected\n        if (selectedFile) {\n            const storageRef = ref(storage, `profile_pictures/birthdays/${user.uid}/${Date.now()}_${selectedFile.name}`);\n            await uploadBytes(storageRef, selectedFile);\n            finalPhotoURL = await getDownloadURL(storageRef);\n\n            // If it's edit mode and there was an old photo, delete it\n            if (isEditMode && birthday?.photoURL && birthday.photoURL.startsWith('https://firebasestorage.googleapis.com')) {\n                 const oldImageRef = ref(storage, birthday.photoURL);\n                 await deleteObject(oldImageRef).catch(err => logger.warn({err, message: \"Old image could not be deleted\"}));\n            }\n        } else if (isEditMode && !previewUrl && birthday?.photoURL) {\n            // Handle image removal\n            if (birthday.photoURL.startsWith('https://firebasestorage.googleapis.com')) {\n                const oldImageRef = ref(storage, birthday.photoURL);\n                await deleteObject(oldImageRef).catch(err => logger.warn({err, message: \"Image to be removed could not be deleted\"}));\n            }\n            finalPhotoURL = null;\n        }\n\n      const dataToSave = {\n        name: values.name,\n        birthDate: Timestamp.fromDate(values.birthDate),\n        photoURL: finalPhotoURL,\n        // Store metadata about entry mode and source\n        entryMode: values.entryMode,\n        ...(values.entryMode === 'automatic' && values.selectedMemberId && {\n          linkedMemberId: values.selectedMemberId,\n          sourceType: 'member_selection'\n        })\n      };\n\n      if (isEditMode && birthday) {\n        const docRef = doc(birthdaysCollection, birthday.id);\n        await updateDoc(docRef, dataToSave);\n        toast({\n          title: t('birthdayForm.updatedTitle'),\n          description: t('birthdayForm.updatedDescription'),\n        });\n      } else {\n        await addDoc(birthdaysCollection, dataToSave);\n        toast({\n          title: t('birthdayForm.addedTitle'),\n          description: t('birthdayForm.addedDescription'),\n        });\n      }\n      \n      onFormSubmit();\n      onOpenChange(false);\n    } catch (e) {\n      logger.error({ error: e, message: `Error ${isEditMode ? 'updating' : 'adding'} birthday`, data: values });\n      toast({\n        title: t('birthdays.error'),\n        description: t('birthdayForm.saveError'),\n        variant: 'destructive',\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\n      <DialogContent>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <DialogHeader>\n              <DialogTitle>{isEditMode ? t('birthdayForm.editTitle') : t('birthdayForm.addTitle')}</DialogTitle>\n              <DialogDescription>\n                {isEditMode ? t('birthdayForm.editDescription') : t('birthdayForm.addDescription')}\n                <br />\n                <span className=\"text-sm text-muted-foreground\">{t('birthdayForm.requiredFields')}</span>\n              </DialogDescription>\n            </DialogHeader>\n            \n            {/* Entry Mode Selection - Only show in add mode */}\n            {!isEditMode && (\n              <div className=\"space-y-3 pb-4 border-b\">\n                <Label className=\"text-sm font-medium\">{t('birthdayForm.entryMode')}</Label>\n                <RadioGroup\n                  value={entryMode}\n                  onValueChange={(value: 'manual' | 'automatic') => handleEntryModeChange(value)}\n                  className=\"flex space-x-6\"\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"manual\" id=\"manual\" />\n                    <Label htmlFor=\"manual\" className=\"text-sm\">{t('birthdayForm.manual')}</Label>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"automatic\" id=\"automatic\" />\n                    <Label htmlFor=\"automatic\" className=\"text-sm\">{t('birthdayForm.selectMember')}</Label>\n                  </div>\n                </RadioGroup>\n                <p className=\"text-xs text-muted-foreground\">\n                  {entryMode === 'manual'\n                    ? t('birthdayForm.manualDescription')\n                    : t('birthdayForm.automaticDescription')\n                  }\n                </p>\n              </div>\n            )}\n            <div className=\"space-y-4 py-4\">\n                {/* Member Selection - Only show in automatic mode */}\n                {!isEditMode && entryMode === 'automatic' && (\n                  <FormField\n                    control={form.control}\n                    name=\"selectedMemberId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t('birthdayForm.selectMemberLabel')}</FormLabel>\n                        <Select onValueChange={handleMemberSelect} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger className={cn(\n                              \"w-full\",\n                              !field.value && \"text-muted-foreground\"\n                            )}>\n                              <SelectValue placeholder={t('birthdayForm.searchMember')} />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {loadingMembers ? (\n                              <SelectItem value=\"loading\" disabled>\n                                <div className=\"flex items-center gap-2\">\n                                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                                  <span>{t('birthdayForm.loadingMembers')}</span>\n                                </div>\n                              </SelectItem>\n                            ) : members.length === 0 ? (\n                              <SelectItem value=\"no-members\" disabled>\n                                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                                  <Users className=\"h-4 w-4\" />\n                                  <span>{t('birthdayForm.noMembers')}</span>\n                                </div>\n                              </SelectItem>\n                            ) : (\n                              members.map((member) => (\n                                <SelectItem key={member.id} value={member.id}>\n                                  <div className=\"flex items-center gap-3\">\n                                    <Avatar className=\"h-6 w-6\">\n                                      <AvatarImage src={member.photoURL} data-ai-hint=\"member avatar\" />\n                                      <AvatarFallback className=\"text-xs\">\n                                        {member.firstName.charAt(0)}\n                                      </AvatarFallback>\n                                    </Avatar>\n                                    <span>{member.firstName} {member.lastName}</span>\n                                  </div>\n                                </SelectItem>\n                              ))\n                            )}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                )}\n                \n                <FormItem className=\"flex flex-col items-center\">\n                <FormLabel>{t('birthdayForm.profilePicture')}</FormLabel>\n                <FormControl>\n                    <div className=\"relative\">\n                    <Avatar className=\"h-24 w-24\">\n                        <AvatarImage src={previewUrl ?? undefined} alt={t('birthdayForm.preview')} data-ai-hint=\"profile picture\" />\n                        <AvatarFallback>\n                           {isSubmitting ? <Loader2 className=\"animate-spin\" /> : <Users className=\"h-10 w-10 text-muted-foreground\" />}\n                        </AvatarFallback>\n                    </Avatar>\n                    {previewUrl && !isSubmitting && entryMode === 'manual' && (\n                        <Button\n                          type=\"button\"\n                          variant=\"destructive\"\n                          size=\"icon\"\n                          className=\"absolute top-0 right-0 h-6 w-6 rounded-full\"\n                          onClick={removeImage}\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                    )}\n                    </div>\n                </FormControl>\n                {entryMode === 'manual' && (\n                  <Button type=\"button\" variant=\"outline\" size=\"sm\" className=\"mt-2\" onClick={() => fileInputRef.current?.click()} disabled={isSubmitting}>\n                      <Upload className=\"mr-2 h-4 w-4\" />\n                      {previewUrl ? t('birthdayForm.changeImage') : t('birthdayForm.uploadImage')}\n                  </Button>\n                )}\n                {entryMode === 'automatic' && (\n                  <p className=\"text-xs text-muted-foreground mt-2\">\n                    {t('birthdayForm.memberPhoto')}\n                  </p>\n                )}\n                <Input \n                    type=\"file\" \n                    className=\"hidden\" \n                    ref={fileInputRef}\n                    accept=\"image/*\"\n                    onChange={handleImageChange}\n                    disabled={isSubmitting || entryMode === 'automatic'}\n                />\n                <FormMessage />\n                </FormItem>\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('birthdayForm.fullName')}</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder={t('birthdayForm.namePlaceholder')}\n                        {...field}\n                        disabled={entryMode === 'automatic' || isSubmitting}\n                        className={cn(\n                          entryMode === 'automatic' && \"bg-muted cursor-not-allowed\"\n                        )}\n                      />\n                    </FormControl>\n                    {entryMode === 'automatic' && (\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t('birthdayForm.memberName')}\n                      </p>\n                    )}\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"birthDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('birthdayForm.birthDate')}</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder={t('birthdayForm.datePlaceholder')}\n                        value={field.value ? format(field.value, 'dd/MM/yyyy') : ''}\n                        onChange={(e) => {\n                          const value = e.target.value.trim();\n\n                          if (!value) {\n                            field.onChange(undefined);\n                            return;\n                          }\n\n                          // Parse date from DD/MM/YYYY format\n                          const dateRegex = /^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/;\n                          const match = value.match(dateRegex);\n\n                          if (match) {\n                            const [, dayStr, monthStr, yearStr] = match;\n                            const day = parseInt(dayStr, 10);\n                            const month = parseInt(monthStr, 10) - 1; // JavaScript months are 0-indexed\n                            const year = parseInt(yearStr, 10);\n                            const currentYear = new Date().getFullYear();\n\n                            // Validate ranges\n                            if (day >= 1 && day <= 31 &&\n                                month >= 0 && month <= 11 &&\n                                year >= 1900 && year <= currentYear) {\n\n                              const date = new Date(year, month, day);\n\n                              // Check if date is valid (e.g., not Feb 30)\n                              if (date.getDate() === day &&\n                                  date.getMonth() === month &&\n                                  date.getFullYear() === year) {\n                                field.onChange(date);\n                                return;\n                              }\n                            }\n                          }\n\n                          // If invalid format or date, set to undefined\n                          field.onChange(undefined);\n                        }}\n                        disabled={entryMode === 'automatic' || isSubmitting}\n                        className={cn(\n                          entryMode === 'automatic' && \"bg-muted cursor-not-allowed\"\n                        )}\n                      />\n                    </FormControl>\n                    <FormDescription>\n                      {t('birthdayForm.dateFormat')}\n                    </FormDescription>\n                    {entryMode === 'automatic' && (\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t('birthdayForm.memberBirthDate')}\n                      </p>\n                    )}\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n            <DialogFooter>\n              <Button type=\"submit\" disabled={isSubmitting}>\n                {isSubmitting ? t('birthdayForm.saving') : t('birthdayForm.save')}\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n    ","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\birthdays\\[id]\\edit\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 't'. Either include it or remove the dependency array.","line":54,"column":6,"nodeType":"ArrayExpression","endLine":54,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [birthdayId, user, router, toast, t]","fix":{"range":[1961,1994],"text":"[birthdayId, user, router, toast, t]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport { doc, getDoc } from 'firebase/firestore';\nimport { birthdaysCollection } from '@/lib/collections';\nimport type { Birthday } from '@/lib/types';\nimport { BirthdayForm } from '../../BirthdayForm';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useToast } from '@/hooks/use-toast';\nimport { useI18n } from '@/contexts/i18n-context';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\n\nexport default function EditBirthdayPage() {\n  const params = useParams();\n  const router = useRouter();\n  const { toast } = useToast();\n  const { user, loading: authLoading } = useAuth();\n  const { t } = useI18n();\n  const { id } = params;\n  const [birthday, setBirthday] = useState<Birthday | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n\n  const birthdayId = Array.isArray(id) ? id[0] : id;\n\n  useEffect(() => {\n    if (!birthdayId || !user) return;\n\n    const fetchBirthday = async () => {\n      setLoading(true);\n      try {\n        const docRef = doc(birthdaysCollection, birthdayId);\n        const docSnap = await getDoc(docRef);\n        if (docSnap.exists()) {\n          setBirthday({ id: docSnap.id, ...docSnap.data() } as Birthday);\n          setIsFormOpen(true); // Open the dialog once data is fetched\n        } else {\n          toast({ title: t('birthdays.error'), description: t('birthdayEdit.notFound'), variant: \"destructive\"});\n          router.push('/birthdays');\n        }\n      } catch (err) {\n        toast({ title: t('birthdays.error'), description: t('birthdayEdit.loadError'), variant: \"destructive\"});\n        router.push('/birthdays');\n        console.error(err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchBirthday();\n  }, [birthdayId, user, router, toast]);\n\n  const handleFormClose = () => {\n    setIsFormOpen(false);\n    // Use a timeout to allow the dialog to close before navigating\n    setTimeout(() => router.push('/birthdays'), 150);\n  }\n\n  if (loading || authLoading) {\n    return (\n        <Dialog open={true}>\n            <DialogContent>\n                <DialogHeader>\n                    <DialogTitle className=\"sr-only\">{t('birthdayEdit.loading')}</DialogTitle>\n                </DialogHeader>\n                <div className=\"max-w-md w-full mx-auto space-y-4\">\n                    <Skeleton className=\"h-10 w-1/3\" />\n                    <Skeleton className=\"h-8 w-1/2\" />\n                    <div className=\"space-y-6 p-6 border rounded-lg bg-background\">\n                    <Skeleton className=\"h-24 w-24 rounded-full mx-auto\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <div className=\"flex justify-end gap-2\">\n                        <Skeleton className=\"h-10 w-24\" />\n                    </div>\n                    </div>\n                </div>\n            </DialogContent>\n      </Dialog>\n    );\n  }\n\n  return (\n    <BirthdayForm\n        isOpen={isFormOpen}\n        onOpenChange={handleFormClose}\n        onFormSubmit={() => router.push('/birthdays')}\n        birthday={birthday ?? undefined}\n    />\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\birthdays\\page.tsx","messages":[{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `t`, but the source dependencies were [toast]. Inferred different dependency than source.\n\nC:\\Personal\\QuorumFlow\\src\\app\\(main)\\birthdays\\page.tsx:121:38\n  119 |   const { t } = useI18n();\n  120 |\n> 121 |   const fetchBirthdays = useCallback(() => {\n      |                                      ^^^^^^^\n> 122 |     setLoading(true);\n      | ^^^^^^^^^^^^^^^^^^^^^\n> 123 |     getBirthdays()\n      \n      | ^^^^^^^^^^^^^^^^^^^^^\n> 131 |       .finally(() => setLoading(false));\n      | ^^^^^^^^^^^^^^^^^^^^^\n> 132 |   }, [toast]);\n      | ^^^^ Could not preserve existing manual memoization\n  133 |\n  134 |   useEffect(() => {\n  135 |     if (authLoading || !user) return;","line":121,"column":38,"nodeType":null,"endLine":132,"endColumn":4},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 't'. Either include it or remove the dependency array.","line":132,"column":6,"nodeType":"ArrayExpression","endLine":132,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [t, toast]","fix":{"range":[4436,4443],"text":"[t, toast]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\app\\(main)\\birthdays\\page.tsx:136:5\n  134 |   useEffect(() => {\n  135 |     if (authLoading || !user) return;\n> 136 |     fetchBirthdays();\n      |     ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  137 |   }, [authLoading, user, fetchBirthdays]);\n  138 |   \n  139 |   const handleDelete = async (birthday: Birthday) => {","line":136,"column":5,"nodeType":null,"endLine":136,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useEffect, useState, useTransition, useRef, useCallback } from 'react';\nimport Link from 'next/link';\nimport { getDocs, Timestamp, deleteDoc, doc, query, orderBy, collection, where } from 'firebase/firestore';\nimport { birthdaysCollection, membersCollection, storage } from '@/lib/collections';\nimport type { Birthday, Member } from '@/lib/types';\nimport { deleteObject, ref } from 'firebase/storage';\n\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { PlusCircle, Trash2, Pencil } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { useToast } from '@/hooks/use-toast';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport logger from '@/lib/logger';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useI18n } from '@/contexts/i18n-context';\n\nasync function getBirthdays(): Promise<Birthday[]> {\n  try {\n    // Obtener cumpleaos de la coleccin de cumpleaos\n    const birthdaysSnapshot = await getDocs(query(birthdaysCollection, orderBy('name')));\n    const birthdays = birthdaysSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Birthday));\n\n    // Obtener miembros con fecha de nacimiento\n    const membersSnapshot = await getDocs(\n      query(\n        membersCollection,\n        where('birthDate', '!=', null),\n        orderBy('birthDate', 'asc')\n      )\n    );\n\n    // Convertir miembros a formato de cumpleaos\n    const memberBirthdays: Birthday[] = membersSnapshot.docs\n      .filter(doc => {\n        const member = doc.data() as Member;\n        return member.birthDate && member.firstName && member.lastName;\n      })\n      .map(doc => {\n        const member = doc.data() as Member;\n        return {\n          id: `member_${doc.id}`,\n          name: `${member.firstName} ${member.lastName}`,\n          birthDate: member.birthDate as Timestamp,\n          photoURL: member.photoURL,\n          isMember: true,\n          memberId: doc.id\n        } as Birthday;\n      });\n\n    // Combinar y ordenar por prxima fecha de cumpleaos\n    return [...birthdays, ...memberBirthdays];\n  } catch (error) {\n    console.error('Error fetching birthdays:', error);\n    // En caso de error, intentar obtener solo los cumpleaos sin miembros\n    try {\n      const birthdaysSnapshot = await getDocs(query(birthdaysCollection, orderBy('name')));\n      return birthdaysSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Birthday));\n    } catch (fallbackError) {\n      console.error('Error fetching fallback birthdays:', fallbackError);\n      return [];\n    }\n  }\n}\n\nfunction getUpcomingBirthdays(birthdays: Birthday[]): Birthday[] {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  \n  return birthdays\n    .map(b => {\n      const birthDate = b.birthDate.toDate();\n      let nextBirthday = new Date(today.getFullYear(), birthDate.getMonth(), birthDate.getDate());\n      if (nextBirthday < today) {\n        nextBirthday.setFullYear(today.getFullYear() + 1);\n      }\n      return { ...b, nextBirthday };\n    })\n    .sort((a, b) => a.nextBirthday.getTime() - b.nextBirthday.getTime());\n}\n\nexport default function BirthdaysPage() {\n  const { user, loading: authLoading } = useAuth();\n  const [birthdays, setBirthdays] = useState<Birthday[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const { toast } = useToast();\n  const { t } = useI18n();\n\n  const fetchBirthdays = useCallback(() => {\n    setLoading(true);\n    getBirthdays()\n      .then(data => {\n        setBirthdays(getUpcomingBirthdays(data));\n      })\n      .catch(error => {\n        logger.error({ error, message: 'Failed to fetch birthdays' });\n        toast({ title: t('birthdays.error'), description: t('birthdays.loadError'), variant: 'destructive' });\n      })\n      .finally(() => setLoading(false));\n  }, [toast]);\n\n  useEffect(() => {\n    if (authLoading || !user) return;\n    fetchBirthdays();\n  }, [authLoading, user, fetchBirthdays]);\n  \n  const handleDelete = async (birthday: Birthday) => {\n    try {\n      // No permitir eliminar cumpleaos de miembros\n      if (birthday.isMember) {\n        toast({\n          title: t('birthdays.cannotDelete'),\n          description: t('birthdays.belongsToMember'),\n          variant: 'destructive'\n        });\n        return;\n      }\n\n      // Delete photo from storage if it exists\n      if (birthday.photoURL) {\n        try {\n            const photoRef = ref(storage, birthday.photoURL);\n            await deleteObject(photoRef);\n        } catch (storageError) {\n             logger.warn({ error: storageError, message: 'Could not delete photo from storage, it might not exist.'});\n        }\n      }\n\n      await deleteDoc(doc(birthdaysCollection, birthday.id));\n      toast({\n        title: t('birthdays.deletedTitle'),\n        description: t('birthdays.deletedDescription'),\n      });\n      fetchBirthdays(); // Refresh the list\n    } catch (error) {\n      logger.error({ error, message: 'Error deleting birthday', birthdayId: birthday.id });\n      toast({\n        title: t('birthdays.error'),\n        description: t('birthdays.deleteError'),\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const upcomingIn14Days = birthdays.filter(b => {\n    const today = new Date();\n    const twoWeeksFromNow = new Date();\n    twoWeeksFromNow.setDate(today.getDate() + 14);\n    return (b as any).nextBirthday >= today && (b as any).nextBirthday <= twoWeeksFromNow;\n  });\n\n  return (\n    <section className=\"page-section\">\n      <header className=\"flex flex-col gap-2\">\n        <h1 className=\"text-balance text-fluid-title font-semibold\">{t('birthdays.pageTitle')}</h1>\n        <p className=\"text-balance text-fluid-subtitle text-muted-foreground\">\n          {t('birthdays.pageDescription')}\n        </p>\n      </header>\n      <Card>\n        <CardHeader>\n          <CardTitle>{t('birthdays.upcomingTitle')}</CardTitle>\n          <CardDescription>\n            {t('birthdays.upcomingDescription')}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {loading ? (\n            <div className=\"flex space-x-4\">\n                <Skeleton className=\"h-16 w-16 rounded-full\" />\n                <Skeleton className=\"h-16 w-16 rounded-full\" />\n                <Skeleton className=\"h-16 w-16 rounded-full\" />\n            </div>\n          ) : upcomingIn14Days.length > 0 ? (\n            <div className=\"flex flex-wrap gap-4\">\n              <TooltipProvider>\n                {upcomingIn14Days.map(b => (\n                  <Tooltip key={b.id}>\n                    <TooltipTrigger>\n                       <Avatar className=\"h-16 w-16\">\n                            <AvatarImage src={b.photoURL} data-ai-hint=\"person avatar\" />\n                            <AvatarFallback>{b.name.charAt(0)}</AvatarFallback>\n                        </Avatar>\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p className=\"font-semibold\">{b.name}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {format((b as any).nextBirthday, `'${t('birthdays.birthsOn')}' d 'de' LLLL`, { locale: es })}\n                      </p>\n                    </TooltipContent>\n                  </Tooltip>\n                ))}\n              </TooltipProvider>\n            </div>\n          ) : (\n            <p className=\"text-center text-sm text-muted-foreground py-4\">\n              {t('birthdays.noUpcoming')}\n            </p>\n          )}\n        </CardContent>\n      </Card>\n    \n      <Card>\n        <CardHeader>\n          <div className=\"flex justify-between items-start\">\n            <div>\n              <CardTitle>{t('birthdays.listTitle')}</CardTitle>\n              <CardDescription>\n                {t('birthdays.listDescription')}\n              </CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t('birthdays.name')}</TableHead>\n                <TableHead>{t('birthdays.nextBirthday')}</TableHead>\n                <TableHead className=\"text-right\">{t('birthdays.actions')}</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {loading ? (\n                Array.from({ length: 3 }).map((_, i) => (\n                  <TableRow key={i}>\n                    <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n                    <TableCell><Skeleton className=\"h-5 w-24\" /></TableCell>\n                    <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-8 inline-block\" /></TableCell>\n                  </TableRow>\n                ))\n              ) : birthdays.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={3} className=\"h-24 text-center\">\n                    {t('birthdays.noData')}\n                  </TableCell>\n                </TableRow>\n              ) : (\n                birthdays.map((item) => (\n                  <TableRow key={item.id}>\n                    <TableCell className=\"font-medium\">\n                        <div className=\"flex items-center gap-3\">\n                            <Avatar className=\"h-8 w-8\">\n                                <AvatarImage src={item.photoURL} data-ai-hint=\"person avatar\" />\n                                <AvatarFallback>{item.name.charAt(0)}</AvatarFallback>\n                            </Avatar>\n                            <span>{item.name}</span>\n                        </div>\n                    </TableCell>\n                    <TableCell>\n                      {format((item as any).nextBirthday, \"d 'de' LLLL\", { locale: es })}\n                    </TableCell>\n                    <TableCell className=\"text-right flex gap-2 justify-end\">\n                      {item.isMember ? (\n                        <Button variant=\"ghost\" size=\"icon\" asChild>\n                          <Link href={`/members?edit=${item.memberId}`} title={t('birthdays.editMember')}><Pencil className=\"h-4 w-4\" /></Link>\n                        </Button>\n                      ) : (\n                        <Button variant=\"ghost\" size=\"icon\" asChild>\n                          <Link href={`/birthdays/${item.id}/edit`}><Pencil className=\"h-4 w-4\" /></Link>\n                        </Button>\n                      )}\n                      {(item.isMember === false || item.isMember === undefined) && (\n                        <AlertDialog>\n                          <AlertDialogTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" aria-label=\"Eliminar cumpleaos\">\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                          </AlertDialogTrigger>\n                          <AlertDialogContent>\n                            <AlertDialogHeader>\n                              <AlertDialogTitle>{t('birthdays.deleteDialogTitle')}</AlertDialogTitle>\n                              <AlertDialogDescription>\n                                {t('birthdays.deleteDialogDescription').replace('{name}', item.name)}\n                              </AlertDialogDescription>\n                            </AlertDialogHeader>\n                            <AlertDialogFooter>\n                              <AlertDialogCancel>{t('birthdays.cancel')}</AlertDialogCancel>\n                              <AlertDialogAction onClick={() => handleDelete(item)} className=\"bg-destructive hover:bg-destructive/90\">\n                                {t('birthdays.delete')}\n                              </AlertDialogAction>\n                            </AlertDialogFooter>\n                          </AlertDialogContent>\n                        </AlertDialog>\n                      )}\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n    </section>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\consejo\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":222,"column":19,"nodeType":"JSXOpeningElement","endLine":226,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport React, { useState, useEffect } from 'react';\nimport { getDocs, query, orderBy, where, Timestamp, addDoc, deleteDoc, doc, serverTimestamp, updateDoc, getDoc } from 'firebase/firestore';\nimport { convertsCollection, membersCollection, annotationsCollection } from '@/lib/collections';\nimport { Convert, Annotation } from '@/lib/types';\nimport { subMonths } from 'date-fns';\nimport { AnnotationManager } from '@/components/shared/annotation-manager';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useToast } from '@/hooks/use-toast';\n\nconst ConsejoPage: React.FC = () => {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [annotations, setAnnotations] = useState<Annotation[]>([]);\n  const [newConverts, setNewConverts] = useState<Convert[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [annotationsLoading, setAnnotationsLoading] = useState(true);\n\n  const fetchAnnotations = async () => {\n    try {\n      setAnnotationsLoading(true);\n      const q = query(\n        annotationsCollection,\n        where('source', '==', 'council'),\n        orderBy('createdAt', 'desc')\n      );\n      const snapshot = await getDocs(q);\n      const annotationsData = snapshot.docs.map(\n        (doc) => ({ id: doc.id, ...doc.data() } as Annotation)\n      );\n      setAnnotations(annotationsData);\n    } catch (error) {\n      console.error('Error fetching annotations:', error);\n    } finally {\n      setAnnotationsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const fetchNewConverts = async () => {\n      try {\n        const twentyFourMonthsAgo = subMonths(new Date(), 24);\n        const twentyFourMonthsAgoTimestamp = Timestamp.fromDate(twentyFourMonthsAgo);\n\n        // Obtener conversos de la coleccin c_conversos\n        const convertsSnapshot = await getDocs(query(convertsCollection, orderBy('baptismDate', 'desc')));\n        let convertsFromCollection = convertsSnapshot.docs\n          .map(doc => ({ id: doc.id, ...doc.data() } as Convert))\n          .filter(convert =>\n              convert.baptismDate &&\n              convert.baptismDate.toDate &&\n              convert.baptismDate.toDate() > twentyFourMonthsAgo\n          );\n\n        // Obtener fotos de miembros para conversos que tienen memberId\n        const memberIds = convertsFromCollection\n          .map(convert => convert.memberId)\n          .filter(id => id) as string[];\n        const membersMap = new Map<string, any>();\n        if (memberIds.length > 0) {\n          // Dividir memberIds en chunks de 10 para evitar lmite de Firestore\n          const chunks = [];\n          for (let i = 0; i < memberIds.length; i += 10) {\n            chunks.push(memberIds.slice(i, i + 10));\n          }\n          for (const chunk of chunks) {\n            const membersSnapshot = await getDocs(query(membersCollection, where('__name__', 'in', chunk)));\n            membersSnapshot.docs.forEach(doc => {\n              membersMap.set(doc.id, doc.data());\n            });\n          }\n          convertsFromCollection = convertsFromCollection.map(convert => {\n            if (convert.memberId && membersMap.has(convert.memberId)) {\n              const memberData = membersMap.get(convert.memberId);\n              return {\n                ...convert,\n                name: convert.name || `${memberData.firstName || ''} ${memberData.lastName || ''}`.trim(),\n                photoURL: convert.photoURL || memberData.photoURL\n              };\n            }\n            return convert;\n          });\n        }\n\n        // Obtener miembros bautizados hace menos de 2 aos\n        const membersSnapshot = await getDocs(query(membersCollection, orderBy('baptismDate', 'desc')));\n        const membersAsConverts = membersSnapshot.docs\n          .map(doc => {\n            const memberData = doc.data();\n            if (memberData.baptismDate && memberData.baptismDate.toDate) {\n              const baptismDate = memberData.baptismDate.toDate();\n              if (baptismDate > twentyFourMonthsAgo) {\n                return {\n                  id: `member_${doc.id}`,\n                  name: `${memberData.firstName || ''} ${memberData.lastName || ''}`.trim(),\n                  baptismDate: memberData.baptismDate,\n                  photoURL: memberData.photoURL,\n                  councilCompleted: memberData.councilCompleted || false,\n                  councilCompletedAt: memberData.councilCompletedAt || null,\n                  observation: 'Bautizado como miembro',\n                  missionaryReference: 'Registro de miembros'\n                } as Convert;\n              }\n            }\n            return null;\n          })\n          .filter(Boolean) as Convert[];\n\n        // Combinar y ordenar por fecha de bautismo (ms reciente primero)\n        const allConverts = [...convertsFromCollection, ...membersAsConverts]\n          .sort((a, b) => b.baptismDate.toDate().getTime() - a.baptismDate.toDate().getTime());\n\n        // Eliminar duplicados basados en nombre y fecha de bautismo, y filtrar nombres vacos\n        const uniqueConverts = allConverts\n          .filter(convert => convert.name && convert.name.trim() !== '')\n          .filter((convert, index, self) =>\n            index === self.findIndex(c =>\n              c.name === convert.name &&\n              c.baptismDate.toDate().getTime() === convert.baptismDate.toDate().getTime()\n            )\n          );\n\n        setNewConverts(uniqueConverts);\n      } catch (error) {\n        console.error('Error fetching new converts:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchNewConverts();\n    fetchAnnotations();\n  }, []);\n\n  const handleAddAnnotation = async (description: string) => {\n    if (!user) return;\n\n    await addDoc(annotationsCollection, {\n      text: description,\n      source: 'council',\n      isCouncilAction: false,\n      isResolved: false,\n      createdAt: serverTimestamp(),\n      userId: user.uid,\n    });\n    await fetchAnnotations();\n  };\n\n  const handleDeleteAnnotation = async (id: string) => {\n    await deleteDoc(doc(annotationsCollection, id));\n    await fetchAnnotations();\n  };\n\n  const handleResolveAnnotation = async (id: string) => {\n    try {\n      const annotationRef = doc(annotationsCollection, id);\n      const annotationSnap = await getDoc(annotationRef);\n\n      if (!annotationSnap.exists()) {\n        toast({ title: 'Error', description: 'Anotacin no encontrada.', variant: 'destructive' });\n        return;\n      }\n\n      const annotationData = annotationSnap.data() as Annotation;\n\n      // If the annotation was marked for council (isCouncilAction), we need to unmark it\n      // Then delete the annotation since it's resolved\n      if (annotationData.isCouncilAction) {\n        // First update to remove the council action flag (removes checkmark from dashboard)\n        await updateDoc(annotationRef, {\n          isCouncilAction: false,\n          isResolved: true,\n        });\n      }\n\n      // Delete the annotation (removes the note)\n      await deleteDoc(annotationRef);\n      \n      toast({ title: 'Anotacin Resuelta', description: 'La anotacin ha sido marcada como resuelta y eliminada.' });\n      await fetchAnnotations();\n    } catch (error) {\n      console.error('Error resolving annotation:', error);\n      toast({ title: 'Error', description: 'No se pudo resolver la anotacin.', variant: 'destructive' });\n    }\n  };\n\n  return (\n    <div className=\"p-5\">\n      <h1 className=\"text-2xl font-bold mb-6\">Consejo</h1>\n\n      <AnnotationManager\n        title=\"Anotaciones\"\n        description=\"Notas y recordatorios para el consejo del qurum.\"\n        buttonText=\"Anotacin\"\n        dialogTitle=\"Nueva Anotacin\"\n        placeholder=\"Ej: Revisar situacin de la familia Prez...\"\n        items={annotations.map(ann => ({\n          id: ann.id,\n          description: ann.text,\n          createdAt: ann.createdAt,\n          userId: ann.userId,\n          isCouncilAction: ann.isCouncilAction\n        }))}\n        loading={annotationsLoading}\n        onAdd={handleAddAnnotation}\n        onDelete={handleDeleteAnnotation}\n        onResolve={handleResolveAnnotation}\n        showResolveButton={true}\n        emptyMessage=\"No hay anotaciones.\"\n        currentUserId={user?.uid}\n      />\n\n      <section className=\"mt-10\">\n        <h2 className=\"text-xl font-semibold mb-4\">Seguimiento de Conversos</h2>\n        {loading ? (\n          <p className=\"text-muted-foreground\">Cargando...</p>\n        ) : newConverts.length > 0 ? (\n          <ul className=\"mt-5 bg-gray-50 border border-gray-300 rounded-md p-2.5 space-y-4\">\n            {newConverts.map((convert) => (\n              <li key={convert.id} className=\"flex items-start gap-2.5\">\n                {convert.photoURL && (\n                  <img\n                    src={convert.photoURL}\n                    alt={`Foto de ${convert.name}`}\n                    className=\"w-12 h-12 rounded-full object-cover\"\n                  />\n                )}\n                <div className=\"flex flex-col\">\n                  <span className=\"font-bold text-base mb-0.5\">\n                    {convert.name}\n                  </span>\n                  <span className=\"text-sm text-gray-600\">\n                    Bautismo: {convert.baptismDate?.toDate().toLocaleDateString('es-ES')}\n                  </span>\n                </div>\n              </li>\n            ))}\n          </ul>\n        ) : (\n          <p className=\"text-muted-foreground\">No hay conversos nuevos en los ltimos 2 aos.</p>\n        )}\n      </section>\n    </div>\n  );\n};\n\nexport default ConsejoPage;","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\converts\\ConvertForm.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMembers'. Either include it or remove the dependency array.","line":136,"column":6,"nodeType":"ArrayExpression","endLine":136,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [convert, isEditMode, form, loadMembers]","fix":{"range":[4178,4205],"text":"[convert, isEditMode, form, loadMembers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { CalendarIcon, User, X, Upload, Loader2, UserCheck, Edit3 } from 'lucide-react';\nimport { addDoc, doc, Timestamp, updateDoc, getDocs, query, orderBy } from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage';\nimport { convertsCollection, storage, membersCollection } from '@/lib/collections';\nimport logger from '@/lib/logger';\n\nimport { Button } from '@/components/ui/button';\nimport { Calendar } from '@/components/ui/calendar';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport React from 'react';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport type { Convert, Member } from '@/lib/types';\nimport { useAuth } from '@/contexts/auth-context';\n\nconst convertSchema = z.object({\n  name: z.string().min(2, { message: 'El nombre es requerido.' }),\n  baptismDate: z.date({\n    required_error: 'La fecha de bautismo es requerida.',\n  }),\n});\n\ntype FormValues = z.infer<typeof convertSchema>;\n\ninterface ConvertFormProps {\n  convert?: Convert;\n}\n\nconst MAX_FILE_SIZE = 20 * 1024 * 1024; // 20MB\n\nexport function ConvertForm({ convert }: ConvertFormProps) {\n  const router = useRouter();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const isEditMode = !!convert;\n\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  \n  // New state for entry mode and member selection\n  const [entryMode, setEntryMode] = useState<'manual' | 'automatic'>('manual');\n  const [members, setMembers] = useState<Member[]>([]);\n  const [selectedMember, setSelectedMember] = useState<Member | null>(null);\n  const [loadingMembers, setLoadingMembers] = useState(false);\n\n  const form = useForm<FormValues>({\n    resolver: zodResolver(convertSchema),\n    defaultValues: {\n      name: '',\n    },\n  });\n\n  // Load members for automatic mode\n  const loadMembers = async () => {\n    setLoadingMembers(true);\n    try {\n      const snapshot = await getDocs(query(membersCollection, orderBy('firstName', 'asc')));\n      const membersList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Member));\n      setMembers(membersList);\n    } catch (error) {\n      console.error(\"Error loading members:\", error);\n      toast({\n        title: \"Error\",\n        description: \"No se pudieron cargar los miembros.\",\n        variant: \"destructive\",\n      });\n    }\n    setLoadingMembers(false);\n  };\n\n  useEffect(() => {\n    if (isEditMode && convert) {\n      form.reset({\n        name: convert.name,\n        baptismDate: convert.baptismDate.toDate(),\n      });\n      setPreviewUrl(convert.photoURL || null);\n      setEntryMode('manual'); // Always manual for edit mode\n    } else {\n      form.reset({ name: '', baptismDate: undefined });\n      setPreviewUrl(null);\n      setSelectedMember(null);\n      // Load members when not in edit mode\n      if (!isEditMode) {\n        loadMembers();\n      }\n    }\n    setSelectedFile(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  }, [convert, isEditMode, form]);\n\n  // Handle member selection in automatic mode\n  const handleMemberSelect = (memberId: string) => {\n    const member = members.find(m => m.id === memberId);\n    if (member) {\n      setSelectedMember(member);\n      // Auto-fill form with member data\n      form.setValue('name', `${member.firstName} ${member.lastName}`);\n      if (member.photoURL) {\n        setPreviewUrl(member.photoURL);\n      }\n      // Clear any selected file since we're using member's photo\n      setSelectedFile(null);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  // Handle entry mode change\n  const handleEntryModeChange = (mode: 'manual' | 'automatic') => {\n    setEntryMode(mode);\n    if (mode === 'manual') {\n      setSelectedMember(null);\n      form.reset({ name: '', baptismDate: undefined });\n      setPreviewUrl(null);\n      setSelectedFile(null);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n\n  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > MAX_FILE_SIZE) {\n      toast({\n        title: \"Archivo demasiado grande\",\n        description: \"El tamao mximo de la imagen es de 20MB.\",\n        variant: \"destructive\",\n      });\n      if (fileInputRef.current) fileInputRef.current.value = '';\n      return;\n    }\n\n    setSelectedFile(file);\n    setPreviewUrl(URL.createObjectURL(file));\n  };\n\n  const removeImage = () => {\n    setSelectedFile(null);\n    setPreviewUrl(null);\n    if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n    }\n  };\n\n\n  const onSubmit = async (values: FormValues) => {\n    if (!user) {\n      toast({ title: \"Error\", description: \"Debes iniciar sesin para guardar.\", variant: \"destructive\" });\n      return;\n    }\n    setIsSubmitting(true);\n    let finalPhotoURL = convert?.photoURL || null;\n\n    try {\n      // Handle photo upload/update logic\n      if (selectedFile) {\n        const storageRef = ref(storage, `profile_pictures/converts/${user.uid}/${Date.now()}_${selectedFile.name}`);\n        await uploadBytes(storageRef, selectedFile);\n        finalPhotoURL = await getDownloadURL(storageRef);\n\n        if (isEditMode && convert?.photoURL && convert.photoURL.startsWith('https://firebasestorage.googleapis.com')) {\n          const oldImageRef = ref(storage, convert.photoURL);\n          await deleteObject(oldImageRef).catch(err => logger.warn({ err, message: 'Old image could not be deleted.' }));\n        }\n      } else if (entryMode === 'automatic' && selectedMember?.photoURL) {\n        // Use member's photo for automatic mode\n        finalPhotoURL = selectedMember.photoURL;\n      } else if (isEditMode && !previewUrl && convert?.photoURL) {\n        if (convert.photoURL.startsWith('https://firebasestorage.googleapis.com')) {\n          const oldImageRef = ref(storage, convert.photoURL);\n          await deleteObject(oldImageRef).catch(err => logger.warn({ err, message: 'Image to be removed could not be deleted' }));\n        }\n        finalPhotoURL = null;\n      }\n\n      const dataToSave = {\n        name: values.name,\n        baptismDate: Timestamp.fromDate(values.baptismDate),\n        photoURL: finalPhotoURL,\n        councilCompleted: convert?.councilCompleted || false,\n        councilCompletedAt: convert?.councilCompletedAt || null,\n        observation: convert?.observation || '',\n        // Add source information for tracking\n        source: entryMode === 'automatic' ? 'Automtico' : 'Manual',\n        ...(entryMode === 'automatic' && selectedMember && { \n          linkedMemberId: selectedMember.id,\n          memberReference: `${selectedMember.firstName} ${selectedMember.lastName}`\n        })\n      };\n\n      if (isEditMode && convert) {\n        const docRef = doc(convertsCollection, convert.id);\n        await updateDoc(docRef, dataToSave);\n        toast({\n          title: \"Converso Actualizado\",\n          description: \"Los datos del miembro han sido actualizados exitosamente.\",\n        });\n      } else {\n        await addDoc(convertsCollection, dataToSave);\n        toast({\n          title: \"Converso Agregado\",\n          description: `El nuevo miembro ha sido registrado exitosamente${entryMode === 'automatic' ? ' desde el registro de miembros' : ''}.`,\n        });\n      }\n      router.push('/converts');\n      router.refresh();\n    } catch (e) {\n      logger.error({ error: e, message: `Error ${isEditMode ? 'updating' : 'adding'} convert`, data: values });\n      toast({\n        title: \"Error\",\n        description: 'Hubo un error al guardar los datos.',\n        variant: 'destructive',\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-8\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardHeader>\n            <CardTitle>{isEditMode ? 'Editar Converso' : 'Agregar Nuevo Converso'}</CardTitle>\n            <CardDescription>\n              {isEditMode ? 'Actualiza los detalles del miembro.' : 'Ingresa los detalles del nuevo miembro bautizado.'}\n              <br />\n              <span className=\"text-sm text-muted-foreground\">Los campos marcados con <span className=\"text-red-600\">*</span> son obligatorios.</span>\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            {/* Entry Mode Selection - Only show in add mode */}\n            {!isEditMode && (\n              <div className=\"space-y-4\">\n                <div>\n                  <Label className=\"text-base font-medium\">Mtodo de Registro</Label>\n                  <p className=\"text-sm text-muted-foreground\">Selecciona cmo deseas registrar al converso</p>\n                </div>\n                <RadioGroup\n                  value={entryMode}\n                  onValueChange={(value) => handleEntryModeChange(value as 'manual' | 'automatic')}\n                  className=\"flex flex-col space-y-2\"\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"manual\" id=\"manual\" />\n                    <Label htmlFor=\"manual\" className=\"flex items-center gap-2 cursor-pointer\">\n                      <Edit3 className=\"h-4 w-4\" />\n                      Manual - Ingresar datos manualmente\n                    </Label>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <RadioGroupItem value=\"automatic\" id=\"automatic\" />\n                    <Label htmlFor=\"automatic\" className=\"flex items-center gap-2 cursor-pointer\">\n                      <UserCheck className=\"h-4 w-4\" />\n                      Automtico - Seleccionar miembro existente\n                    </Label>\n                  </div>\n                </RadioGroup>\n              </div>\n            )}\n\n            {/* Member Selection - Only show in automatic mode */}\n            {entryMode === 'automatic' && !isEditMode && (\n              <FormItem>\n                <FormLabel>Seleccionar Miembro <span className=\"text-red-600\">*</span></FormLabel>\n                <Select onValueChange={handleMemberSelect} disabled={loadingMembers}>\n                  <FormControl>\n                    <SelectTrigger>\n                      <SelectValue placeholder={loadingMembers ? \"Cargando miembros...\" : \"Selecciona un miembro\"} />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    {members.map((member) => (\n                      <SelectItem key={member.id} value={member.id}>\n                        <div className=\"flex items-center gap-2\">\n                          <Avatar className=\"h-6 w-6\">\n                            <AvatarImage src={member.photoURL} />\n                            <AvatarFallback className=\"text-xs\">\n                              {member.firstName.charAt(0)}{member.lastName.charAt(0)}\n                            </AvatarFallback>\n                          </Avatar>\n                          {member.firstName} {member.lastName}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n\n            {/* Photo Section */}\n            <FormItem className=\"flex flex-col items-center\">\n              <FormLabel>Foto de Perfil</FormLabel>\n              <FormControl>\n                <div className=\"relative\">\n                  <Avatar className=\"h-24 w-24\">\n                    <AvatarImage src={previewUrl ?? undefined} alt=\"Vista previa\" data-ai-hint=\"profile picture\" />\n                    <AvatarFallback>\n                      {isSubmitting ? <Loader2 className=\"animate-spin\" /> : <User className=\"h-10 w-10 text-muted-foreground\" />}\n                    </AvatarFallback>\n                  </Avatar>\n                  {previewUrl && !isSubmitting && entryMode === 'manual' && (\n                    <Button\n                      type=\"button\"\n                      variant=\"destructive\"\n                      size=\"icon\"\n                      className=\"absolute top-0 right-0 h-6 w-6 rounded-full\"\n                      onClick={removeImage}\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n              </FormControl>\n              {entryMode === 'manual' && (\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  size=\"sm\" \n                  className=\"mt-2\" \n                  onClick={() => fileInputRef.current?.click()} \n                  disabled={isSubmitting}\n                >\n                  <Upload className=\"mr-2 h-4 w-4\" />\n                  {previewUrl ? 'Cambiar Imagen' : 'Subir Imagen'}\n                </Button>\n              )}\n              {entryMode === 'automatic' && selectedMember && (\n                <p className=\"text-xs text-muted-foreground mt-2\">\n                  Foto del miembro seleccionado\n                </p>\n              )}\n              <Input\n                type=\"file\"\n                className=\"hidden\"\n                ref={fileInputRef}\n                accept=\"image/*\"\n                onChange={handleImageChange}\n                disabled={isSubmitting || entryMode === 'automatic'}\n              />\n              <FormMessage />\n            </FormItem>\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Nombre Completo <span className=\"text-red-600\">*</span></FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"Ej: Juan Prez\" \n                      {...field} \n                      disabled={entryMode === 'automatic' && !selectedMember}\n                      readOnly={entryMode === 'automatic' && !!selectedMember}\n                    />\n                  </FormControl>\n                  {entryMode === 'automatic' && selectedMember && (\n                    <p className=\"text-xs text-muted-foreground\">\n                      Nombre obtenido del miembro seleccionado\n                    </p>\n                  )}\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <FormField\n              control={form.control}\n              name=\"baptismDate\"\n              render={({ field }) => (\n                <FormItem className=\"flex flex-col\">\n                  <FormLabel>Fecha de Bautismo <span className=\"text-red-600\">*</span></FormLabel>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <FormControl>\n                        <Button\n                          variant={'outline'}\n                          className={cn(\n                            'w-full pl-3 text-left font-normal',\n                            !field.value && 'text-muted-foreground'\n                          )}\n                        >\n                          {field.value ? (\n                            format(field.value, 'd LLLL yyyy', { locale: es })\n                          ) : (\n                            <span>Selecciona una fecha</span>\n                          )}\n                          <CalendarIcon className=\"ml-auto h-4 w-4 opacity-50\" />\n                        </Button>\n                      </FormControl>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                      <Calendar\n                        mode=\"single\"\n                        selected={field.value}\n                        onSelect={field.onChange}\n                        disabled={(date) =>\n                          date > new Date() || date < new Date('1900-01-01')\n                        }\n                        initialFocus\n                        locale={es}\n                      />\n                    </PopoverContent>\n                  </Popover>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </CardContent>\n          <CardFooter className=\"flex justify-end gap-2\">\n            <Button variant=\"outline\" asChild>\n              <Link href=\"/converts\">Cancelar</Link>\n            </Button>\n            <Button type=\"submit\" disabled={isSubmitting}>\n              {isSubmitting ? 'Guardando...' : 'Guardar'}\n            </Button>\n          </CardFooter>\n        </Card>\n      </form>\n    </Form>\n  );\n}\n\n    ","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\converts\\[id]\\edit\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\converts\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\converts\\add\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\converts\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\app\\(main)\\converts\\page.tsx:105:5\n  103 |   useEffect(() => {\n  104 |     if (authLoading || !user) return;\n> 105 |     loadData();\n      |     ^^^^^^^^ Avoid calling setState() directly within an effect\n  106 |   }, [authLoading, user]);\n  107 |\n  108 |","line":105,"column":5,"nodeType":null,"endLine":105,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useEffect, useState } from 'react';\nimport Link from 'next/link';\nimport { getDocs, query, orderBy, Timestamp } from 'firebase/firestore';\nimport { convertsCollection, membersCollection } from '@/lib/collections';\nimport type { Convert } from '@/lib/types';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport { Pencil } from 'lucide-react';\nimport { format, subMonths } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useI18n } from '@/contexts/i18n-context';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\n\nasync function getConverts(): Promise<Convert[]> {\n  const twentyFourMonthsAgo = subMonths(new Date(), 24);\n  const twentyFourMonthsAgoTimestamp = Timestamp.fromDate(twentyFourMonthsAgo);\n\n  // Obtener conversos de la coleccin c_conversos\n  const convertsSnapshot = await getDocs(query(convertsCollection, orderBy('baptismDate', 'desc')));\n  const convertsFromCollection = convertsSnapshot.docs\n    .map(doc => ({ id: doc.id, ...doc.data() } as Convert))\n    .filter(convert => \n        convert.baptismDate && \n        convert.baptismDate.toDate &&\n        convert.baptismDate.toDate() > twentyFourMonthsAgo\n    );\n\n  // Obtener miembros bautizados hace 2 aos\n  const membersSnapshot = await getDocs(query(membersCollection, orderBy('baptismDate', 'desc')));\n  const membersAsConverts = membersSnapshot.docs\n    .map(doc => {\n      const memberData = doc.data();\n      if (memberData.baptismDate && memberData.baptismDate.toDate) {\n        const baptismDate = memberData.baptismDate.toDate();\n        if (baptismDate > twentyFourMonthsAgo) {\n          return {\n            id: `member_${doc.id}`,\n            name: `${memberData.firstName} ${memberData.lastName}`,\n            baptismDate: memberData.baptismDate,\n            photoURL: memberData.photoURL,\n            councilCompleted: memberData.councilCompleted || false,\n            councilCompletedAt: memberData.councilCompletedAt || null,\n            observation: 'Bautizado como miembro',\n            missionaryReference: 'Registro de miembros'\n          } as Convert;\n        }\n      }\n      return null;\n    })\n    .filter(Boolean) as Convert[];\n\n  // Combinar y ordenar por fecha de bautismo (ms reciente primero)\n  const allConverts = [...convertsFromCollection, ...membersAsConverts]\n    .sort((a, b) => b.baptismDate.toDate().getTime() - a.baptismDate.toDate().getTime());\n\n  // Eliminar duplicados basados en nombre y fecha de bautismo\n  const uniqueConverts = allConverts.filter((convert, index, self) => \n    index === self.findIndex(c => \n      c.name === convert.name && \n      c.baptismDate.toDate().getTime() === convert.baptismDate.toDate().getTime()\n    )\n  );\n\n  return uniqueConverts;\n}\n\nexport default function ConvertsPage() {\n  const { user, loading: authLoading } = useAuth();\n  const { t } = useI18n();\n  const [converts, setConverts] = useState<Convert[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const loadData = async () => {\n    setLoading(true);\n    try {\n      const data = await getConverts();\n      setConverts(data);\n    } catch (error) {\n      console.error(\"Failed to fetch converts:\", error);\n    }\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    if (authLoading || !user) return;\n    loadData();\n  }, [authLoading, user]);\n\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-start\">\n          <div>\n            <CardTitle>{t('converts.title')}</CardTitle>\n            <CardDescription>\n              {t('converts.description')}\n            </CardDescription>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>{t('converts.name')}</TableHead>\n              <TableHead>{t('converts.baptismDate')}</TableHead>\n              <TableHead className=\"text-right\">{t('converts.actions')}</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {loading ? (\n              Array.from({ length: 3 }).map((_, i) => (\n                <TableRow key={i}>\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                        <Skeleton className=\"h-10 w-10 rounded-full\" />\n                        <Skeleton className=\"h-5 w-32\" />\n                    </div>\n                  </TableCell>\n                  <TableCell><Skeleton className=\"h-5 w-24\" /></TableCell>\n                  <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-8 inline-block\" /></TableCell>\n                </TableRow>\n              ))\n            ) : converts.length === 0 ? (\n              <TableRow>\n                <TableCell colSpan={3} className=\"h-24 text-center\">\n                  {t('converts.noData')}\n                </TableCell>\n              </TableRow>\n            ) : (\n              converts.map((item) => (\n                <TableRow key={item.id}>\n                  <TableCell className=\"font-medium\">\n                    <div className=\"flex items-center gap-3\">\n                        <Avatar>\n                            <AvatarImage src={item.photoURL} data-ai-hint=\"profile picture\" />\n                            <AvatarFallback>{item.name.charAt(0)}</AvatarFallback>\n                        </Avatar>\n                        <span>{item.name}</span>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    {format(item.baptismDate.toDate(), 'd LLLL yyyy', { locale: es })}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <Button variant=\"ghost\" size=\"icon\" asChild>\n                      <Link href={item.id.startsWith('member_') ? `/members?edit=${item.id.substring(7)}` : item.memberId ? `/members?edit=${item.memberId}` : `/members?search=${encodeURIComponent(item.name)}`}>\n                        <Pencil className=\"h-4 w-4\" />\n                      </Link>\n                    </Button>\n                  </TableCell>\n                </TableRow>\n              ))\n            )}\n          </TableBody>\n        </Table>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\council\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAllData'. Either include it or remove the dependency array.","line":245,"column":6,"nodeType":"ArrayExpression","endLine":245,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [authLoading, fetchAllData, user]","fix":{"range":[9642,9661],"text":"[authLoading, fetchAllData, user]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":508,"column":27,"nodeType":"JSXOpeningElement","endLine":512,"endColumn":29},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":565,"column":28,"nodeType":"JSXOpeningElement","endLine":569,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client'\n\nexport const dynamic = 'force-dynamic';\n\nimport { getDocs, query, orderBy, where, Timestamp, doc, updateDoc, getDoc, deleteDoc, collection } from 'firebase/firestore';\nimport { membersCollection, futureMembersCollection, ministeringCollection, annotationsCollection, servicesCollection, activitiesCollection, convertsCollection } from '@/lib/collections';\nimport type { Member, FutureMember, Companionship, Family, Annotation, Service, Activity, Convert } from '@/lib/types';\nimport { getLessActiveMembers } from '@/lib/members-data';\nimport { useEffect, useState } from 'react';\nimport { firestore } from '@/lib/firebase';\n\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { format, subMonths, subYears, addDays, subHours, isAfter, isBefore } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { UserCheck, Users, CalendarClock, AlertTriangle, CheckCircle, NotebookPen, Trash2, Save, Wrench, BellRing, UserMinus, Calendar } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { VoiceAnnotations } from '@/components/shared/voice-annotations';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useToast } from '@/hooks/use-toast';\nimport logger from '@/lib/logger';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\n\n\nasync function getAnnotations(source: 'dashboard' | 'council', forCouncil: boolean = false): Promise<Annotation[]> {\n    try {\n        let q;\n        if (forCouncil) {\n             const fromDashboardQuery = query(annotationsCollection, where('isCouncilAction', '==', true), where('isResolved', '==', false));\n             const fromCouncilQuery = query(annotationsCollection, where('source', '==', 'council'), where('isResolved', '==', false));\n             \n             const [dashboardSnapshot, councilSnapshot] = await Promise.all([\n                 getDocs(fromDashboardQuery),\n                 getDocs(fromCouncilQuery)\n             ]);\n\n             const dashboardAnns = dashboardSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Annotation));\n             const councilAnns = councilSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Annotation));\n             \n             const allAnns = new Map([...dashboardAnns, ...councilAnns].map(ann => [ann.id, ann]));\n             return Array.from(allAnns.values());\n        } else {\n            q = query(annotationsCollection, where('source', '==', source), where('isResolved', '==', false), orderBy('createdAt', 'desc'));\n            const snapshot = await getDocs(q);\n            return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Annotation));\n        }\n\n    } catch (error) {\n        console.error(\"Error fetching annotations\", { error, source, forCouncil });\n        return [];\n    }\n}\n\nasync function getCouncilMembers(): Promise<Member[]> {\n  const twoYearsAgo = subYears(new Date(), 2);\n  const twentyFourHoursAgo = subHours(new Date(), 24);\n\n  const snapshot = await getDocs(query(membersCollection, orderBy('baptismDate', 'desc')));\n\n  const councilList = snapshot.docs\n    .map(doc => ({ id: doc.id, ...doc.data() } as Member))\n    .filter(member => {\n        const baptismDate = member.baptismDate?.toDate();\n        if (!baptismDate || baptismDate < twoYearsAgo) return false;\n\n        const isPending = !member.councilCompleted;\n        const wasCompletedRecently = member.councilCompleted && member.councilCompletedAt && member.councilCompletedAt.toDate() > twentyFourHoursAgo;\n\n        return isPending || wasCompletedRecently;\n    });\n\n  return councilList;\n}\n\nasync function getUpcomingBaptisms(): Promise<FutureMember[]> {\n  const now = new Date();\n  const sevenDaysFromNow = addDays(now, 7);\n\n  const q = query(\n    futureMembersCollection,\n    where('baptismDate', '>=', Timestamp.fromDate(now)),\n    where('baptismDate', '<=', Timestamp.fromDate(sevenDaysFromNow))\n  );\n\n  const snapshot = await getDocs(q);\n  const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as FutureMember));\n  \n  return data.sort((a,b) => a.baptismDate.toMillis() - b.baptismDate.toMillis());\n}\n\ntype UrgentFamily = Family & { companionshipId: string, companions: string[] };\n\nasync function getUrgentNeeds(): Promise<UrgentFamily[]> {\n    const snapshot = await getDocs(ministeringCollection);\n    const urgentNeeds: UrgentFamily[] = [];\n\n    snapshot.forEach(doc => {\n        const comp = { id: doc.id, ...doc.data() } as Companionship;\n        comp.families.forEach(family => {\n            if (family.isUrgent) {\n                urgentNeeds.push({\n                    ...family,\n                    companionshipId: comp.id,\n                    companions: comp.companions,\n                });\n            }\n        });\n    });\n\n    return urgentNeeds;\n}\n\nasync function getCouncilAnnotations(): Promise<Annotation[]> {\n    const councilAnns = await getAnnotations('council', true);\n    return councilAnns.sort((a, b) => b.createdAt.toMillis() - a.createdAt.toMillis());\n}\n\nasync function getUpcomingServices(): Promise<Service[]> {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n\n  // We need two queries because Firestore doesn't support 'OR' or '!=' in a way that works for this.\n  // One query for documents where councilNotified is false\n  const notifiedFalseQuery = query(\n    servicesCollection,\n    where('date', '>=', Timestamp.fromDate(today)),\n    where('councilNotified', '==', false)\n  );\n  \n  // A separate query to get documents that don't have the councilNotified field at all\n  const coll = collection(firestore, 'c_servicios');\n  const allServicesSnapshot = await getDocs(query(coll, where('date', '>=', Timestamp.fromDate(today))));\n  \n  const notNotifiedOrFieldMissing = allServicesSnapshot.docs\n    .map(doc => ({ id: doc.id, ...doc.data() } as Service))\n    .filter(service => service.councilNotified === false || service.councilNotified === undefined);\n\n  // Sort the combined results by date\n  return notNotifiedOrFieldMissing.sort((a, b) => a.date.toMillis() - b.date.toMillis());\n}\n\n// Function to get upcoming activities from Reports page data source (show 14 days before, hide after date passes)\nasync function getUpcomingActivities(): Promise<Activity[]> {\n  try {\n    const now = new Date();\n    const fourteenDaysFromNow = addDays(now, 14);\n    \n    // Get all activities using the same query as Reports page\n    const q = query(activitiesCollection, orderBy('date', 'desc'));\n    const snapshot = await getDocs(q);\n    \n    const activities = snapshot.docs\n      .map(doc => ({ id: doc.id, ...doc.data() } as Activity))\n      .filter(activity => {\n        const activityDate = activity.date.toDate();\n        \n        // Show activities that are:\n        // 1. Within 14 days from now (upcoming)\n        // 2. Not past their date (hide after date passes)\n        return isBefore(activityDate, fourteenDaysFromNow) && isAfter(activityDate, now);\n      })\n      .sort((a, b) => a.date.toMillis() - b.date.toMillis()); // Sort by date ascending for council view\n    \n    return activities;\n  } catch (error) {\n    logger.error({ error, message: 'Error fetching upcoming activities from Reports data source' });\n    return [];\n  }\n}\n\n\nexport default function CouncilPage() {\n  const { user, loading: authLoading } = useAuth();\n  const [councilConverts, setCouncilConverts] = useState<Member[]>([]);\n  const [upcomingBaptisms, setUpcomingBaptisms] = useState<FutureMember[]>([]);\n  const [urgentNeeds, setUrgentNeeds] = useState<UrgentFamily[]>([]);\n  const [annotations, setAnnotations] = useState<Annotation[]>([]);\n  const [services, setServices] = useState<Service[]>([]);\n  const [lessActiveMembers, setLessActiveMembers] = useState<Member[]>([]);\n  const [upcomingActivities, setUpcomingActivities] = useState<Activity[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  const [observationInputs, setObservationInputs] = useState<Record<string, string>>({});\n\n  const fetchAllData = async () => {\n    setLoading(true);\n    try {\n        const [converts, baptisms, needs, notes, upcomingServices, lessActive, activities] = await Promise.all([\n        getCouncilMembers(),\n        getUpcomingBaptisms(),\n        getUrgentNeeds(),\n        getCouncilAnnotations(),\n        getUpcomingServices(),\n        getLessActiveMembers(),\n        getUpcomingActivities(),\n        ]);\n        setCouncilConverts(converts);\n        setUpcomingBaptisms(baptisms);\n        setUrgentNeeds(needs);\n        setAnnotations(notes);\n        setServices(upcomingServices);\n        setLessActiveMembers(lessActive);\n        setUpcomingActivities(activities);\n\n        const initialObservations: Record<string, string> = {};\n        converts.forEach((c: Member) => {\n            initialObservations[c.id] = c.lessActiveObservation || '';\n        });\n        setObservationInputs(initialObservations);\n    } catch (error) {\n        logger.error({ error, message: 'Error fetching council data' });\n        toast({ title: \"Error\", description: \"No se pudieron cargar los datos del consejo.\", variant: \"destructive\" });\n    } finally {\n        setLoading(false);\n    }\n  };\n  \n  useEffect(() => {\n    if (authLoading || !user) return;\n    fetchAllData();\n  }, [authLoading, user]);\n\n  const handleResolveAnnotation = async (id: string) => {\n    try {\n        const annotationRef = doc(annotationsCollection, id);\n        const annotationSnap = await getDoc(annotationRef);\n\n        if (!annotationSnap.exists()) {\n             logger.warn({ annotationId: id, message: 'Attempted to resolve non-existent annotation' });\n             toast({ title: 'Error', description: 'Annotation not found.', variant: 'destructive' });\n             return;\n        }\n\n        const annotationData = annotationSnap.data() as Annotation;\n\n        if (annotationData.source === 'council') {\n            await deleteDoc(annotationRef);\n        } else {\n            await updateDoc(annotationRef, {\n                isResolved: true,\n                isCouncilAction: false,\n            });\n        }\n        toast({ title: 'Anotacin Resuelta', description: 'La anotacin ha sido marcada como resuelta.' });\n        fetchAllData();\n    } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : String(error);\n        logger.error({ error: errorMessage, message: 'Error resolving annotation', id });\n        toast({ title: 'Error al Resolver', description: `Failed to resolve annotation: ${errorMessage}`, variant: 'destructive' });\n    }\n  }\n\n  const handleDeleteAnnotation = async (id: string) => {\n    try {\n      await deleteDoc(doc(annotationsCollection, id));\n      toast({ title: 'Anotacin Eliminada', description: 'La anotacin ha sido eliminada permanentemente.' });\n      fetchAllData();\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error({ error: errorMessage, message: 'Error deleting annotation', id });\n      toast({ title: 'Error al Eliminar', description: `Failed to delete annotation: ${errorMessage}`, variant: 'destructive' });\n    }\n  }\n\n  const handleSaveObservation = async (memberId: string) => {\n    const observation = observationInputs[memberId];\n    try {\n        const memberRef = doc(membersCollection, memberId);\n        await updateDoc(memberRef, { lessActiveObservation: observation });\n        toast({ title: 'xito', description: 'Observacin guardada.' });\n        fetchAllData();\n    } catch (error) {\n        logger.error({ error, memberId, message: 'Error saving observation' });\n        toast({ title: 'Error', description: 'No se pudo guardar la observacin.', variant: 'destructive' });\n    }\n  };\n\n  const handleMarkCouncilCompleted = async (memberId: string) => {\n      try {\n        const memberRef = doc(membersCollection, memberId);\n        await updateDoc(memberRef, {\n            councilCompleted: true,\n            councilCompletedAt: Timestamp.now()\n        });\n        toast({ title: 'xito', description: 'Seguimiento de miembro marcado como completado.' });\n        fetchAllData();\n      } catch (error) {\n        logger.error({ error, memberId, message: 'Error marking council as completed' });\n        toast({ title: 'Error', description: 'No se pudo marcar como completado.', variant: 'destructive' });\n      }\n  }\n\n  const handleResolveUrgentNeed = async (companionshipId: string, familyName: string) => {\n    try {\n        const companionshipRef = doc(ministeringCollection, companionshipId);\n        const companionshipSnap = await getDoc(companionshipRef);\n\n        if (!companionshipSnap.exists()) throw new Error(\"Companionship not found\");\n        \n        const companionship = companionshipSnap.data() as Companionship;\n        const familyIndex = companionship.families.findIndex(f => f.name === familyName);\n        if (familyIndex === -1) throw new Error(\"Family not found\");\n\n        const updatedFamilies = [...companionship.families];\n        updatedFamilies[familyIndex] = { ...updatedFamilies[familyIndex], isUrgent: false, observation: '' };\n        await updateDoc(companionshipRef, { families: updatedFamilies });\n        toast({ title: 'xito', description: 'La necesidad urgente ha sido marcada como resuelta.' });\n        fetchAllData();\n    } catch (error) {\n        logger.error({ error, companionshipId, familyName, message: 'Error resolving urgent need' });\n        toast({ title: 'Error', description: 'No se pudo resolver la necesidad urgente.', variant: 'destructive' });\n    }\n  }\n\n  const handleMarkServiceNotified = async (serviceId: string) => {\n    try {\n      const serviceRef = doc(servicesCollection, serviceId);\n      await updateDoc(serviceRef, { councilNotified: true });\n      toast({ title: 'xito', description: 'El servicio ha sido marcado como avisado.' });\n      fetchAllData();\n    } catch (error) {\n      logger.error({ error, serviceId, message: 'Error marking service as notified' });\n      toast({ title: 'Error', description: 'No se pudo marcar el servicio como avisado.', variant: 'destructive' });\n    }\n  };\n\n  const handleMarkLessActiveMemberCompleted = async (memberId: string) => {\n    try {\n      const memberRef = doc(collection(firestore, 'c_miembros'), memberId);\n      await updateDoc(memberRef, { \n        councilCompleted: true,\n        councilCompletedAt: Timestamp.now()\n      });\n      toast({ title: 'xito', description: 'Seguimiento de miembro menos activo marcado como completado.' });\n      fetchAllData();\n    } catch (error) {\n      logger.error({ error, memberId, message: 'Error marking less active member as completed' });\n      toast({ title: 'Error', description: 'No se pudo marcar como completado.', variant: 'destructive' });\n    }\n  };\n\n  const today = new Date();\n  const sevenDaysFromNow = addDays(today, 7);\n  const servicesIn7Days = services.filter(s => s.date.toDate() <= sevenDaysFromNow);\n  const futureServices = services.filter(s => s.date.toDate() > sevenDaysFromNow);\n\n\n  return (\n    <div className=\"space-y-8\">\n      <Card>\n        <CardContent className=\"pt-6\">\n            <VoiceAnnotations\n                title=\"Anotaciones para el Consejo\"\n                description=\"Notas del qurum y puntos marcados para seguimiento en el consejo.\"\n                source=\"council\"\n                annotations={annotations}\n                isLoading={loading}\n                onAnnotationAdded={fetchAllData}\n                onAnnotationToggled={fetchAllData}\n                showCouncilView={true}\n                onResolveAnnotation={handleResolveAnnotation}\n                onDeleteAnnotation={handleDeleteAnnotation}\n                currentUserId={user?.uid}\n            />\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-start gap-3\">\n            <Wrench className=\"h-8 w-8 text-primary\" />\n            <div>\n              <CardTitle>Servicios Prximos</CardTitle>\n              <CardDescription>\n                Proyectos de servicio para coordinar en el consejo.\n              </CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div>\n            <h3 className=\"mb-2 font-semibold\">En los Prximos 7 Das</h3>\n            {loading ? <Skeleton className=\"h-24 w-full\" /> : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Servicio</TableHead>\n                    <TableHead>Fecha</TableHead>\n                    <TableHead className=\"text-right\">Accin</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {servicesIn7Days.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={3} className=\"h-24 text-center\">\n                        No hay servicios programados para esta semana.\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    servicesIn7Days.map((item) => (\n                      <TableRow key={item.id}>\n                        <TableCell className=\"font-medium\">{item.title}</TableCell>\n                        <TableCell>{format(item.date.toDate(), \"eeee, d 'de' LLLL\", { locale: es })}</TableCell>\n                        <TableCell className=\"text-right\">\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => handleMarkServiceNotified(item.id)}>\n                            <BellRing className=\"mr-2 h-4 w-4\" />\n                            Marcar como Avisado\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            )}\n          </div>\n          <div>\n            <h3 className=\"mb-2 font-semibold\">Servicios Futuros</h3>\n            {loading ? <Skeleton className=\"h-24 w-full\" /> : (\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Servicio</TableHead>\n                    <TableHead>Fecha</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {futureServices.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={2} className=\"h-24 text-center\">\n                        No hay ms servicios futuros programados.\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    futureServices.map((item) => (\n                      <TableRow key={item.id}>\n                        <TableCell className=\"font-medium\">{item.title}</TableCell>\n                        <TableCell>{format(item.date.toDate(), \"d 'de' LLLL, yyyy\", { locale: es })}</TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n      \n      <Card>\n        <CardHeader>\n          <div className=\"flex items-start gap-3\">\n             <Users className=\"h-8 w-8 text-primary\" />\n            <div>\n              <CardTitle>Seguimiento de Conversos</CardTitle>\n              <CardDescription>\n                Miembros recin bautizados para seguimiento en el consejo de barrio.\n              </CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {loading ? <Skeleton className=\"h-24 w-full\" /> : councilConverts.length === 0 ? (\n             <p className=\"text-sm text-center text-muted-foreground h-24 flex items-center justify-center\">\n               No hay conversos pendientes de seguimiento.\n            </p>\n          ) : (\n            <>\n            {/* Desktop Table */}\n            <div className=\"hidden md:block\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Foto</TableHead>\n                    <TableHead>Bautismo</TableHead>\n                    <TableHead className=\"w-[40%]\">Observacin</TableHead>\n                    <TableHead className=\"text-right\">Accin</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {councilConverts.map((item) => (\n                    <TableRow key={item.id} className={item.councilCompleted ? 'bg-green-500/10' : ''}>\n                      <TableCell>\n                        {item.photoURL ? (\n                          <img\n                            src={item.photoURL}\n                            alt={`Foto de ${item.firstName} ${item.lastName}`}\n                            className=\"w-10 h-10 rounded-full object-cover\"\n                          />\n                        ) : (\n                          <div className=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center\">\n                            <UserCheck className=\"w-6 h-6 text-gray-500\" />\n                          </div>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex flex-col items-start gap-1\">\n                          <span className=\"text-xs font-medium text-foreground\">{item.firstName} {item.lastName}</span>\n                          <span>{item.baptismDate ? format(item.baptismDate.toDate(), 'd LLLL yyyy', { locale: es }) : 'N/A'}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                              <Textarea\n                                  placeholder=\"Aadir observacin...\"\n                                  value={observationInputs[item.id] || ''}\n                                  onChange={(e) => setObservationInputs(prev => ({ ...prev, [item.id]: e.target.value }))}\n                                  rows={1}\n                                  disabled={item.councilCompleted}\n                              />\n                              {observationInputs[item.id] !== (item.lessActiveObservation || '') && (\n                                  <Button size=\"sm\" variant=\"outline\" onClick={() => handleSaveObservation(item.id)}>\n                                      <Save className=\"h-4 w-4\" />\n                                  </Button>\n                              )}\n                          </div>\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        {item.councilCompleted ? (\n                          <Badge variant=\"default\">Completado</Badge>\n                        ) : (\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => handleMarkCouncilCompleted(item.id)}>\n                            <UserCheck className=\"mr-2 h-4 w-4\" />\n                            Marcar Completado\n                          </Button>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n\n            {/* Mobile Cards */}\n            <div className=\"md:hidden space-y-4\">\n               {councilConverts.map((item) => (\n                 <Card key={item.id} className={item.councilCompleted ? 'bg-green-500/10' : ''}>\n                   <CardContent className=\"pt-4 space-y-4\">\n                     <div className=\"flex justify-between items-start\">\n                       <div className=\"flex items-center gap-3\">\n                         {item.photoURL ? (\n                           <img\n                             src={item.photoURL}\n                             alt={`Foto de ${item.firstName} ${item.lastName}`}\n                             className=\"w-12 h-12 rounded-full object-cover\"\n                           />\n                         ) : (\n                           <div className=\"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center\">\n                             <UserCheck className=\"w-6 h-6 text-gray-500\" />\n                           </div>\n                         )}\n                         <div>\n                           <p className=\"font-bold text-foreground\">{item.firstName} {item.lastName}</p>\n                           <p className=\"text-sm text-muted-foreground\">\n                             Bautismo: {item.baptismDate ? format(item.baptismDate.toDate(), 'd LLL yyyy', { locale: es }) : 'N/A'}\n                           </p>\n                         </div>\n                       </div>\n                       {item.councilCompleted ? (\n                          <Badge variant=\"default\">Completado</Badge>\n                        ) : (\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => handleMarkCouncilCompleted(item.id)}>\n                            <UserCheck className=\"mr-2 h-4 w-4\" />\n                            Completar\n                          </Button>\n                        )}\n                     </div>\n                     <div className=\"space-y-2\">\n                       <Label htmlFor={`obs-${item.id}`}>Observacin</Label>\n                       <div className=\"flex items-center gap-2\">\n                           <Textarea\n                               id={`obs-${item.id}`}\n                                placeholder=\"Aadir observacin...\"\n                                value={observationInputs[item.id] || ''}\n                                onChange={(e) => setObservationInputs(prev => ({ ...prev, [item.id]: e.target.value }))}\n                                rows={2}\n                                disabled={item.councilCompleted}\n                            />\n                            {observationInputs[item.id] !== (item.lessActiveObservation || '') && (\n                                <Button size=\"icon\" variant=\"outline\" onClick={() => handleSaveObservation(item.id)}>\n                                    <Save className=\"h-4 w-4\" />\n                                </Button>\n                            )}\n                       </div>\n                     </div>\n                   </CardContent>\n                 </Card>\n               ))}\n            </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n      \n      <Card>\n        <CardHeader>\n          <div className=\"flex items-start gap-3\">\n             <CalendarClock className=\"h-8 w-8 text-primary\" />\n            <div>\n              <CardTitle>Bautismos en los Prximos 7 Das</CardTitle>\n              <CardDescription>\n                Futuros miembros con bautismos programados para esta semana.\n              </CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n         {loading ? <Skeleton className=\"h-24 w-full\" /> : (\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Nombre del Futuro Miembro</TableHead>\n                <TableHead>Fecha Programada</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {upcomingBaptisms.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={2} className=\"h-24 text-center\">\n                    No hay bautismos programados para los prximos 7 das.\n                  </TableCell>\n                </TableRow>\n              ) : (\n                upcomingBaptisms.map((item) => (\n                  <TableRow key={item.id}>\n                    <TableCell className=\"font-medium\">{item.name}</TableCell>\n                    <TableCell>\n                       {item.baptismDate ? format(item.baptismDate.toDate(), 'd LLLL yyyy', { locale: es }) : 'N/A'}\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n         )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-start gap-3\">\n             <Calendar className=\"h-8 w-8 text-blue-600\" />\n            <div>\n              <CardTitle>Actividades Registradas</CardTitle>\n              <CardDescription>\n                Actividades prximas que requieren atencin del consejo (prximas 14 das).\n              </CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {loading ? <Skeleton className=\"h-24 w-full\" /> : upcomingActivities.length === 0 ? (\n            <p className=\"text-sm text-center text-muted-foreground h-24 flex items-center justify-center\">\n              No hay actividades prximas registradas.\n            </p>\n          ) : (\n            <div className=\"space-y-4\">\n              {upcomingActivities.map((activity) => (\n                <div key={activity.id} className=\"p-4 border rounded-lg space-y-2\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-semibold text-lg\">{activity.title}</h4>\n                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground mt-1\">\n                        <CalendarClock className=\"h-4 w-4\" />\n                        <span>{format(activity.date.toDate(), 'd LLLL yyyy', { locale: es })}</span>\n                        {activity.time && <span> {activity.time}</span>}\n                      </div>\n                      {activity.location && (\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                           {activity.location}\n                        </p>\n                      )}\n                    </div>\n                    <Badge variant=\"outline\" className=\"text-blue-600 border-blue-600\">\n                      Prxima\n                    </Badge>\n                  </div>\n                  {activity.description && (\n                    <p className=\"text-sm text-gray-700 mt-2\">{activity.description}</p>\n                  )}\n                  {activity.context && (\n                    <div className=\"text-xs text-muted-foreground bg-muted/50 p-2 rounded\">\n                      <strong>Contexto:</strong> {activity.context}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-start gap-3\">\n             <AlertTriangle className=\"h-8 w-8 text-destructive\" />\n            <div>\n              <CardTitle>Necesidades Urgentes de Ministracin</CardTitle>\n              <CardDescription>\n                Familias que requieren atencin inmediata segn lo reportado.\n              </CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n           {loading ? <Skeleton className=\"h-24 w-full\" /> : urgentNeeds.length === 0 ? (\n             <p className=\"text-sm text-center text-muted-foreground h-24 flex items-center justify-center\">\n                No hay necesidades urgentes reportadas.\n             </p>\n           ) : (\n            <Accordion type=\"single\" collapsible className=\"w-full\">\n                {urgentNeeds.map((item, index) => (\n                     <AccordionItem value={`item-${index}`} key={`${item.companionshipId}-${item.name}`}>\n                        <AccordionTrigger>\n                           <div className='flex items-center justify-between w-full pr-4'>\n                                <div>\n                                    <span className='font-semibold'>{item.name}</span>\n                                    <p className='text-sm text-muted-foreground font-normal'>Asignados a: {item.companions.join(' y ')}</p>\n                                </div>\n                                <Badge variant=\"destructive\">Urgente</Badge>\n                           </div>\n                        </AccordionTrigger>\n                        <AccordionContent>\n                           <div className=\"p-4 bg-muted/50 rounded-md space-y-4\">\n                             <p className=\"text-sm\">\n                                <span className=\"font-semibold\">Observacin:</span> {item.observation}\n                            </p>\n                            <Button size=\"sm\" onClick={() => handleResolveUrgentNeed(item.companionshipId, item.name)}>\n                                <CheckCircle className=\"mr-2 h-4 w-4\" />\n                                Marcar como Resuelto\n                            </Button>\n                           </div>\n                        </AccordionContent>\n                    </AccordionItem>\n                ))}\n            </Accordion>\n           )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-start gap-3\">\n             <UserMinus className=\"h-8 w-8 text-orange-500\" />\n            <div>\n              <CardTitle>Miembros Menos Activos</CardTitle>\n              <CardDescription>\n                Miembros que requieren seguimiento y apoyo del consejo de barrio.\n              </CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {loading ? <Skeleton className=\"h-24 w-full\" /> : lessActiveMembers.length === 0 ? (\n             <p className=\"text-sm text-center text-muted-foreground h-24 flex items-center justify-center\">\n               No hay miembros menos activos registrados.\n            </p>\n          ) : (\n            <>\n            {/* Desktop Table */}\n            <div className=\"hidden md:block\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Nombre</TableHead>\n                    <TableHead>Estado</TableHead>\n                    <TableHead>Inactivo Desde</TableHead>\n                    <TableHead className=\"text-right\">Accin</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {lessActiveMembers.map((member) => (\n                    <TableRow key={member.id} className={member.councilCompleted ? 'bg-green-500/10' : ''}>\n                      <TableCell className=\"font-medium\">{member.firstName} {member.lastName}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\" className=\"text-orange-600 border-orange-600\">\n                          Menos Activo\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {member.inactiveSince ? format(member.inactiveSince.toDate(), 'd LLLL yyyy', { locale: es }) : 'N/A'}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        {member.councilCompleted ? (\n                          <Badge variant=\"default\">Completado</Badge>\n                        ) : (\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => handleMarkLessActiveMemberCompleted(member.id)}>\n                            <UserCheck className=\"mr-2 h-4 w-4\" />\n                            Marcar Completado\n                          </Button>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n\n            {/* Mobile Cards */}\n            <div className=\"md:hidden space-y-4\">\n               {lessActiveMembers.map((member) => (\n                 <Card key={member.id} className={member.councilCompleted ? 'bg-green-500/10' : ''}>\n                   <CardContent className=\"pt-4 space-y-4\">\n                     <div className=\"flex justify-between items-start\">\n                       <div>\n                         <p className=\"font-bold\">{member.firstName} {member.lastName}</p>\n                         <p className=\"text-sm text-muted-foreground\">\n                           Inactivo desde: {member.inactiveSince ? format(member.inactiveSince.toDate(), 'd LLL yyyy', { locale: es }) : 'N/A'}\n                         </p>\n                         <Badge variant=\"outline\" className=\"text-orange-600 border-orange-600 mt-2\">\n                           Menos Activo\n                         </Badge>\n                       </div>\n                       {member.councilCompleted ? (\n                          <Badge variant=\"default\">Completado</Badge>\n                        ) : (\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => handleMarkLessActiveMemberCompleted(member.id)}>\n                            <UserCheck className=\"mr-2 h-4 w-4\" />\n                            Completar\n                          </Button>\n                        )}\n                     </div>\n                   </CardContent>\n                 </Card>\n               ))}\n            </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\family-search\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\family-search\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\future-members\\FutureMemberForm.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":369,"column":25,"nodeType":"JSXOpeningElement","endLine":373,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { CalendarIcon, User, X, Upload, Loader2 } from 'lucide-react';\nimport { addDoc, doc, Timestamp, updateDoc } from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage';\n\nimport { futureMembersCollection, storage } from '@/lib/collections';\nimport logger from '@/lib/logger';\nimport { Button } from '@/components/ui/button';\nimport { Calendar } from '@/components/ui/calendar';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport React from 'react';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport type { FutureMember } from '@/lib/types';\nimport { useAuth } from '@/contexts/auth-context';\n\nconst futureMemberSchema = z.object({\n  name: z.string().min(2, { message: 'El nombre es requerido.' }),\n  baptismDate: z.date({\n    required_error: 'La fecha de bautismo es requerida.',\n  }),\n  isBaptized: z.boolean().default(false),\n});\n\ntype FormValues = z.infer<typeof futureMemberSchema>;\n\ninterface FutureMemberFormProps {\n  futureMember?: FutureMember;\n}\n\nconst MAX_FILE_SIZE = 20 * 1024 * 1024; // 20MB\n\nexport function FutureMemberForm({ futureMember }: FutureMemberFormProps) {\n  const router = useRouter();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const baptismPhotosInputRef = useRef<HTMLInputElement>(null);\n  const isEditMode = !!futureMember;\n\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [baptismPhotos, setBaptismPhotos] = useState<(string | File)[]>([]);\n\n  const form = useForm<FormValues>({\n    resolver: zodResolver(futureMemberSchema),\n    defaultValues: {\n      name: '',\n    },\n  });\n\n  useEffect(() => {\n    if (isEditMode && futureMember) {\n      form.reset({\n        name: futureMember.name,\n        baptismDate: futureMember.baptismDate.toDate(),\n        isBaptized: futureMember.isBaptized || false,\n      });\n      setPreviewUrl(futureMember.photoURL || null);\n      setBaptismPhotos(futureMember.baptismPhotos || []);\n    } else {\n      form.reset({ name: '', baptismDate: undefined, isBaptized: false });\n      setPreviewUrl(null);\n      setBaptismPhotos([]);\n    }\n    setSelectedFile(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    if (baptismPhotosInputRef.current) {\n        baptismPhotosInputRef.current.value = '';\n    }\n  }, [futureMember, isEditMode, form]);\n\n  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > MAX_FILE_SIZE) {\n      toast({\n        title: 'Archivo demasiado grande',\n        description: 'El tamao mximo de la imagen es de 20MB.',\n        variant: 'destructive',\n      });\n      if (fileInputRef.current) fileInputRef.current.value = '';\n      return;\n    }\n\n    setSelectedFile(file);\n    setPreviewUrl(URL.createObjectURL(file));\n  };\n\n  const removeImage = () => {\n    setSelectedFile(null);\n    setPreviewUrl(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const handleBaptismPhotosChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files) return;\n\n    const newFiles = Array.from(files).filter(file => {\n        if (file.size > MAX_FILE_SIZE) {\n            toast({\n                title: 'Archivo demasiado grande',\n                description: `El archivo ${file.name} supera los 20MB.`,\n                variant: 'destructive',\n            });\n            return false;\n        }\n        return true;\n    });\n\n    setBaptismPhotos(prev => [...prev, ...newFiles]);\n  };\n\n  const removeBaptismPhoto = (index: number) => {\n    setBaptismPhotos(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const onSubmit = async (values: FormValues) => {\n    if (!user) {\n      toast({ title: 'Error', description: 'Debes iniciar sesin para guardar.', variant: 'destructive' });\n      return;\n    }\n    setIsSubmitting(true);\n    let finalPhotoURL = futureMember?.photoURL || null;\n    let finalBaptismPhotos = futureMember?.baptismPhotos || [];\n\n    try {\n      if (selectedFile) {\n        const storageRef = ref(storage, `profile_pictures/future_members/${user.uid}/${Date.now()}_${selectedFile.name}`);\n        await uploadBytes(storageRef, selectedFile);\n        finalPhotoURL = await getDownloadURL(storageRef);\n\n        if (isEditMode && futureMember?.photoURL && futureMember.photoURL.startsWith('https://firebasestorage.googleapis.com')) {\n          const oldImageRef = ref(storage, futureMember.photoURL);\n          await deleteObject(oldImageRef).catch(err => logger.warn({ err, message: 'Old image could not be deleted.' }));\n        }\n      } else if (isEditMode && !previewUrl && futureMember?.photoURL) {\n        if (futureMember.photoURL.startsWith('https://firebasestorage.googleapis.com')) {\n          const oldImageRef = ref(storage, futureMember.photoURL);\n          await deleteObject(oldImageRef).catch(err => logger.warn({ err, message: 'Image to be removed could not be deleted' }));\n        }\n        finalPhotoURL = null;\n      }\n\n      const uploadedBaptismPhotoUrls = await Promise.all(\n        baptismPhotos.map(async photo => {\n          if (typeof photo === 'string') return photo;\n          const storageRef = ref(storage, `baptism_photos/future_members/${user.uid}/${Date.now()}_${photo.name}`);\n          await uploadBytes(storageRef, photo);\n          return getDownloadURL(storageRef);\n        })\n      );\n\n      finalBaptismPhotos = uploadedBaptismPhotoUrls;\n      \n      if(isEditMode && futureMember?.baptismPhotos){\n        const photosToDelete = futureMember.baptismPhotos.filter(p => !finalBaptismPhotos.includes(p));\n        await Promise.all(photosToDelete.map(async photoUrl => {\n            if (photoUrl.startsWith('https://firebasestorage.googleapis.com')) {\n                const oldImageRef = ref(storage, photoUrl);\n                await deleteObject(oldImageRef).catch(err => logger.warn({err, message: 'Old baptism photo could not be deleted.'}));\n            }\n        }));\n      }\n\n      const dataToSave = {\n        name: values.name,\n        baptismDate: Timestamp.fromDate(values.baptismDate),\n        photoURL: finalPhotoURL,\n        baptismPhotos: finalBaptismPhotos,\n        isBaptized: values.isBaptized,\n      };\n\n      if (isEditMode && futureMember) {\n        const docRef = doc(futureMembersCollection, futureMember.id);\n        await updateDoc(docRef, dataToSave);\n        toast({\n          title: 'Futuro Miembro Actualizado',\n          description: 'Los datos han sido actualizados exitosamente.',\n        });\n      } else {\n        await addDoc(futureMembersCollection, dataToSave);\n        toast({\n          title: 'Futuro Miembro Agregado',\n          description: 'La persona ha sido registrada exitosamente.',\n        });\n      }\n      router.push('/future-members');\n      router.refresh();\n    } catch (e) {\n      logger.error({ error: e, message: `Error ${isEditMode ? 'updating' : 'adding'} future member`, data: values });\n      toast({\n        title: 'Error',\n        description: 'Hubo un error al guardar los datos.',\n        variant: 'destructive',\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-8\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardHeader>\n            <CardTitle>{isEditMode ? 'Editar Futuro Miembro' : 'Agregar Futuro Miembro'}</CardTitle>\n            <CardDescription>\n              {isEditMode ? 'Actualiza los detalles de la persona.' : 'Ingresa los detalles y la fecha de bautismo programada.'}\n              <br />\n              <span className=\"text-sm text-muted-foreground\">Los campos marcados con <span className=\"text-red-600\">*</span> son obligatorios.</span>\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <FormItem className=\"flex flex-col items-center\">\n              <FormLabel>Foto de Perfil</FormLabel>\n              <FormControl>\n                <div className=\"relative\">\n                  <Avatar className=\"h-24 w-24\">\n                    <AvatarImage src={previewUrl ?? undefined} alt=\"Vista previa\" data-ai-hint=\"profile picture\" />\n                    <AvatarFallback>\n                      {isSubmitting ? <Loader2 className=\"animate-spin\" /> : <User className=\"h-10 w-10 text-muted-foreground\" />}\n                    </AvatarFallback>\n                  </Avatar>\n                  {previewUrl && !isSubmitting && (\n                    <Button\n                      type=\"button\"\n                      variant=\"destructive\"\n                      size=\"icon\"\n                      className=\"absolute top-0 right-0 h-6 w-6 rounded-full\"\n                      onClick={removeImage}\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n              </FormControl>\n              <Button type=\"button\" variant=\"outline\" size=\"sm\" className=\"mt-2\" onClick={() => fileInputRef.current?.click()} disabled={isSubmitting}>\n                <Upload className=\"mr-2 h-4 w-4\" />\n                {previewUrl ? 'Cambiar Imagen' : 'Subir Imagen'}\n              </Button>\n              <Input\n                type=\"file\"\n                className=\"hidden\"\n                ref={fileInputRef}\n                accept=\"image/*\"\n                onChange={handleImageChange}\n                disabled={isSubmitting}\n              />\n              <FormMessage />\n            </FormItem>\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Nombre Completo <span className=\"text-red-600\">*</span></FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Ej: Maria Gonzlez\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <FormField\n              control={form.control}\n              name=\"baptismDate\"\n              render={({ field }) => (\n                <FormItem className=\"flex flex-col\">\n                  <FormLabel>Fecha de Bautismo <span className=\"text-red-600\">*</span></FormLabel>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <FormControl>\n                        <Button\n                          variant={'outline'}\n                          className={cn(\n                            'w-full pl-3 text-left font-normal',\n                            !field.value && 'text-muted-foreground'\n                          )}\n                        >\n                          {field.value ? (\n                            format(field.value, 'd LLLL yyyy', { locale: es })\n                          ) : (\n                            <span>Selecciona una fecha</span>\n                          )}\n                          <CalendarIcon className=\"ml-auto h-4 w-4 opacity-50\" />\n                        </Button>\n                      </FormControl>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                      <Calendar\n                        mode=\"single\"\n                        selected={field.value}\n                        onSelect={field.onChange}\n                        disabled={(date) => date < new Date('1900-01-01')}\n                        initialFocus\n                        locale={es}\n                      />\n                    </PopoverContent>\n                  </Popover>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <FormField\n              control={form.control}\n              name=\"isBaptized\"\n              render={({ field }) => (\n                <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-4\">\n                  <div className=\"space-y-0.5\">\n                    <FormLabel className=\"text-base\">\n                      Ya est bautizado?\n                    </FormLabel>\n                  </div>\n                  <FormControl>\n                    <Switch\n                      checked={field.value}\n                      onCheckedChange={field.onChange}\n                    />\n                  </FormControl>\n                </FormItem>\n              )}\n            />\n             <FormItem className=\"flex flex-col items-center\">\n                <FormLabel>Fotos del Bautismo</FormLabel>\n                <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-2\">\n                    {baptismPhotos.map((photo, index) => (\n                        <div key={index} className=\"relative\">\n                        <img \n                            src={typeof photo === 'string' ? photo : URL.createObjectURL(photo)} \n                            alt={`Bautismo ${index + 1}`} \n                            className=\"w-full h-24 object-cover rounded-md\"\n                        />\n                        <Button\n                            type=\"button\"\n                            variant=\"destructive\"\n                            size=\"icon\"\n                            className=\"absolute top-1 right-1 h-5 w-5 rounded-full\"\n                            onClick={() => removeBaptismPhoto(index)}\n                            disabled={isSubmitting}\n                        >\n                            <X className=\"h-3 w-3\" />\n                        </Button>\n                        </div>\n                    ))}\n                </div>\n                <Button type=\"button\" variant=\"outline\" size=\"sm\" className=\"mt-2\" onClick={() => baptismPhotosInputRef.current?.click()} disabled={isSubmitting}>\n                    <Upload className=\"mr-2 h-4 w-4\" />\n                    Agregar Fotos\n                </Button>\n                <Input \n                    type=\"file\" \n                    className=\"hidden\" \n                    ref={baptismPhotosInputRef}\n                    accept=\"image/*\"\n                    multiple\n                    onChange={handleBaptismPhotosChange}\n                    disabled={isSubmitting}\n                />\n            </FormItem>\n          </CardContent>\n          <CardFooter className=\"flex justify-end gap-2\">\n            <Button variant=\"outline\" asChild>\n              <Link href=\"/future-members\">Cancelar</Link>\n            </Button>\n            <Button type=\"submit\" disabled={isSubmitting}>\n              {isSubmitting ? 'Guardando...' : 'Guardar'}\n            </Button>\n          </CardFooter>\n        </Card>\n      </form>\n    </Form>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\future-members\\[id]\\edit\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\future-members\\add\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\future-members\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\app\\(main)\\future-members\\page.tsx:54:5\n  52 |     if (authLoading || !user) return;\n  53 |\n> 54 |     loadData();\n     |     ^^^^^^^^ Avoid calling setState() directly within an effect\n  55 |   }, [authLoading, user, loadData]);\n  56 |\n  57 |","line":54,"column":5,"nodeType":null,"endLine":54,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useEffect, useState, useCallback } from 'react';\nimport Link from 'next/link';\nimport { getDocs, Timestamp } from 'firebase/firestore';\nimport { membersCollection } from '@/lib/collections';\nimport type { Member } from '@/lib/types';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport { Pencil } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useI18n } from '@/contexts/i18n-context';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { getFutureMembers } from '@/lib/dashboard-data';\n\nexport default function FutureMembersPage() {\n  const { user, loading: authLoading } = useAuth();\n  const [futureMembers, setFutureMembers] = useState<Member[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { t } = useI18n();\n\n  const loadData = useCallback(async () => {\n    setLoading(true);\n    try {\n      const data = await getFutureMembers();\n      setFutureMembers(data);\n    } catch (error) {\n      console.error(\"Failed to fetch future members:\", error);\n    }\n    setLoading(false);\n  }, []);\n\n  useEffect(() => {\n    if (authLoading || !user) return;\n\n    loadData();\n  }, [authLoading, user, loadData]);\n\n\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-start\">\n          <div>\n            <CardTitle>{t('futureMembers.title')}</CardTitle>\n            <CardDescription>\n              {t('futureMembers.description')}\n            </CardDescription>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>{t('futureMembers.name')}</TableHead>\n              <TableHead>{t('futureMembers.baptismDate')}</TableHead>\n              <TableHead className=\"text-right\">{t('futureMembers.actions')}</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {loading ? (\n              Array.from({ length: 3 }).map((_, i) => (\n                <TableRow key={i}>\n                   <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                        <Skeleton className=\"h-10 w-10 rounded-full\" />\n                        <Skeleton className=\"h-5 w-32\" />\n                    </div>\n                  </TableCell>\n                  <TableCell><Skeleton className=\"h-5 w-24\" /></TableCell>\n                  <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-8 inline-block\" /></TableCell>\n                </TableRow>\n              ))\n            ) : futureMembers.length === 0 ? (\n              <TableRow>\n                <TableCell colSpan={3} className=\"h-24 text-center\">\n                  {t('futureMembers.noData')}\n                </TableCell>\n              </TableRow>\n            ) : (\n              futureMembers.map((item) => (\n                <TableRow key={item.id}>\n                  <TableCell className=\"font-medium\">\n                     <div className=\"flex items-center gap-3\">\n                        <Avatar>\n                            <AvatarImage src={item.photoURL} data-ai-hint=\"profile picture\" />\n                            <AvatarFallback>{item.firstName.charAt(0)}</AvatarFallback>\n                        </Avatar>\n                        <span>{item.firstName} {item.lastName}</span>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    {item.baptismDate ? format(item.baptismDate.toDate(), 'd LLLL yyyy', { locale: es }) : 'No especificada'}\n                  </TableCell>\n                   <TableCell className=\"text-right\">\n                     <Button variant=\"ghost\" size=\"icon\" asChild>\n                       <Link href={`/members?edit=${item.id}`}>\n                         <Pencil className=\"h-4 w-4\" />\n                       </Link>\n                     </Button>\n                   </TableCell>\n                </TableRow>\n              ))\n            )}\n          </TableBody>\n        </Table>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\members\\[id]\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":183,"column":17,"nodeType":"JSXOpeningElement","endLine":187,"endColumn":19},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":319,"column":21,"nodeType":"JSXOpeningElement","endLine":324,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport { ArrowLeft, User, Phone, Calendar, MapPin, Users, FileText, Camera } from 'lucide-react';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Separator } from '@/components/ui/separator';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useI18n } from '@/contexts/i18n-context';\nimport type { Member } from '@/lib/types';\nimport { OrdinanceLabels } from '@/lib/types';\nimport { getMemberById } from '@/lib/members-data';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\n\nconst statusConfig = {\n  active: {\n    label: 'Activo',\n    variant: 'default' as const,\n    color: 'text-green-600'\n  },\n  less_active: {\n    label: 'Menos Activo',\n    variant: 'secondary' as const,\n    color: 'text-yellow-600'\n  },\n  inactive: {\n    label: 'Inactivo',\n    variant: 'destructive' as const,\n    color: 'text-red-600'\n  }\n};\n\nexport default function MemberProfilePage() {\n  const params = useParams();\n  const router = useRouter();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const { t } = useI18n();\n\n  const [member, setMember] = useState<Member | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const memberId = params.id as string;\n\n  useEffect(() => {\n    const fetchMember = async () => {\n      if (!memberId || !user) return;\n\n      setLoading(true);\n      setError(null);\n\n      try {\n        const memberData = await getMemberById(memberId);\n        if (memberData) {\n          setMember(memberData);\n        } else {\n          setError(t('memberProfile.notFound'));\n        }\n      } catch (err) {\n        console.error('Error fetching member:', err);\n        setError(t('memberProfile.error'));\n        toast({\n          title: 'Error',\n          description: t('memberProfile.error'),\n          variant: 'destructive'\n        });\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchMember();\n  }, [memberId, user, t, toast]);\n\n  const handleBackToMembers = () => {\n    router.push('/members');\n  };\n\n  const handleEditMember = () => {\n    router.push(`/members?edit=${memberId}`);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Skeleton className=\"h-10 w-10\" />\n          <div>\n            <Skeleton className=\"h-8 w-48\" />\n            <Skeleton className=\"h-4 w-32\" />\n          </div>\n        </div>\n\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <Skeleton className=\"h-6 w-32\" />\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Skeleton className=\"h-4 w-full\" />\n              <Skeleton className=\"h-4 w-3/4\" />\n              <Skeleton className=\"h-4 w-1/2\" />\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <Skeleton className=\"h-6 w-32\" />\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Skeleton className=\"h-4 w-full\" />\n              <Skeleton className=\"h-4 w-3/4\" />\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !member) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"outline\" size=\"sm\" onClick={handleBackToMembers}>\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n            {t('memberProfile.backToMembers')}\n          </Button>\n        </div>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <User className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-semibold\">{error || t('memberProfile.notFound')}</h3>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const statusInfo = statusConfig[member.status];\n\n  return (\n    <section className=\"page-section\">\n      {/* Header */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={handleBackToMembers}\n          className=\"w-full sm:w-auto sm:self-start\"\n        >\n          <ArrowLeft className=\"mr-2 h-4 w-4\" />\n          {t('memberProfile.backToMembers')}\n        </Button>\n        <div className=\"flex flex-col gap-1 text-left\">\n          <h1 className=\"text-balance text-fluid-title font-semibold tracking-tight\">{t('memberProfile.title')}</h1>\n          <p className=\"text-sm text-muted-foreground sm:text-base\">\n            {member.firstName} {member.lastName}\n          </p>\n        </div>\n      </div>\n\n      {/* Profile Photo and Basic Info */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-6\">\n            <div className=\"flex-shrink-0\">\n              {member.photoURL ? (\n                <img\n                  src={member.photoURL}\n                  alt={`${member.firstName} ${member.lastName}`}\n                  className=\"w-24 h-24 rounded-full object-cover border-4 border-background\"\n                />\n              ) : (\n                <div className=\"w-24 h-24 rounded-full bg-muted flex items-center justify-center border-4 border-background\">\n                  <User className=\"h-12 w-12 text-muted-foreground\" />\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex-1 space-y-2\">\n              <div>\n                <h2 className=\"text-xl font-semibold sm:text-2xl\">{member.firstName} {member.lastName}</h2>\n                <Badge variant={statusInfo.variant} className=\"mt-2\">\n                  {statusInfo.label}\n                </Badge>\n              </div>\n\n              {member.phoneNumber && (\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <Phone className=\"h-4 w-4\" />\n                  <span>{member.phoneNumber}</span>\n                </div>\n              )}\n\n              {member.birthDate && (\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <Calendar className=\"h-4 w-4\" />\n                  <span>\n                    {format(member.birthDate.toDate(), 'd MMMM yyyy', { locale: es })}\n                  </span>\n                </div>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Detailed Information */}\n      <div className=\"grid gap-4 md:grid-cols-2 md:gap-6\">\n        {/* Personal Information */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <User className=\"h-5 w-5\" />\n              {t('memberProfile.personalInfo')}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-muted-foreground\">\n                {t('memberProfile.firstName')}\n              </label>\n              <p className=\"text-sm\">{member.firstName}</p>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-muted-foreground\">\n                {t('memberProfile.lastName')}\n              </label>\n              <p className=\"text-sm\">{member.lastName}</p>\n            </div>\n\n            {member.birthDate && (\n              <div>\n                <label className=\"text-sm font-medium text-muted-foreground\">\n                  {t('memberProfile.birthDate')}\n                </label>\n                <p className=\"text-sm\">\n                  {format(member.birthDate.toDate(), 'd MMMM yyyy', { locale: es })}\n                </p>\n              </div>\n            )}\n\n            <div>\n              <label className=\"text-sm font-medium text-muted-foreground\">\n                {t('memberProfile.status')}\n              </label>\n              <div className=\"mt-1\">\n                <Badge variant={statusInfo.variant}>\n                  {statusInfo.label}\n                </Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Contact Information */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Phone className=\"h-5 w-5\" />\n              {t('memberProfile.contactInfo')}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-muted-foreground\">\n                {t('memberProfile.phoneNumber')}\n              </label>\n              <p className=\"text-sm\">\n                {member.phoneNumber || t('memberProfile.noPhone')}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Church Information */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <MapPin className=\"h-5 w-5\" />\n              {t('memberProfile.churchInfo')}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {member.baptismDate && (\n              <div>\n                <label className=\"text-sm font-medium text-muted-foreground\">\n                  {t('memberProfile.baptismDate')}\n                </label>\n                <p className=\"text-sm\">\n                  {format(member.baptismDate.toDate(), 'd MMMM yyyy', { locale: es })}\n                </p>\n              </div>\n            )}\n\n            {member.baptismPhotos && member.baptismPhotos.length > 0 && (\n              <div>\n                <label className=\"text-sm font-medium text-muted-foreground\">\n                  {t('memberProfile.baptismPhotos')}\n                </label>\n                <div className=\"grid grid-cols-2 gap-2 mt-2\">\n                  {member.baptismPhotos.map((photo, index) => (\n                    <img\n                      key={index}\n                      src={photo}\n                      alt={`Bautismo ${index + 1}`}\n                      className=\"w-full h-20 object-cover rounded border\"\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Ordinances */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              {t('memberProfile.ordinances')}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {member.ordinances && member.ordinances.length > 0 ? (\n              <div className=\"flex flex-wrap gap-2\">\n                {member.ordinances.map((ordinance) => (\n                  <Badge key={ordinance} variant=\"outline\">\n                    {OrdinanceLabels[ordinance]}\n                  </Badge>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground\">\n                {t('memberProfile.noOrdinances')}\n              </p>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Ministering */}\n        <Card className=\"md:col-span-2\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              {t('memberProfile.ministering')}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {member.ministeringTeachers && member.ministeringTeachers.length > 0 ? (\n              <div className=\"flex flex-wrap gap-2\">\n                {member.ministeringTeachers.map((teacher, index) => (\n                  <Badge key={index} variant=\"secondary\">\n                    {teacher}\n                  </Badge>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground\">\n                {t('memberProfile.noMinisteringTeachers')}\n              </p>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </section>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\members\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":398,"column":31,"nodeType":"JSXOpeningElement","endLine":402,"endColumn":33},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":547,"column":29,"nodeType":"JSXOpeningElement","endLine":551,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { Plus, Search, Filter, Edit, Trash2, Users, UserCheck, UserX, Eye, ChevronUp, RefreshCw, Clock, CheckCircle, AlertCircle } from 'lucide-react';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from '@/components/ui/alert-dialog';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/contexts/auth-context';\nimport { useMembersSync } from '@/hooks/use-members-sync';\nimport { SyncStatus } from '@/components/shared/sync-status';\nimport type { Member, MemberStatus } from '@/lib/types';\nimport { OrdinanceLabels } from '@/lib/types';\nimport { MemberForm } from '@/components/members/member-form';\nimport { deleteMember } from '@/lib/members-data';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { safeGetDate, safeFormatDate } from '@/lib/date-utils';\n\nconst statusConfig = {\n  active: {\n    label: 'Activo',\n    variant: 'default' as const,\n    icon: UserCheck,\n    color: 'text-green-600'\n  },\n  less_active: {\n    label: 'Menos Activo',\n    variant: 'secondary' as const,\n    icon: UserX,\n    color: 'text-yellow-600'\n  },\n  inactive: {\n    label: 'Inactivo',\n    variant: 'destructive' as const,\n    icon: UserX,\n    color: 'text-red-600'\n  }\n};\n\nexport default function MembersPage() {\n  const { toast } = useToast();\n  const router = useRouter();\n  const { members, loading, syncStatus, lastSyncTime, fetchMembers, clearCache } = useMembersSync({\n    enableInitialFetch: true, // Enable initial fetch for members page\n    enableRealtimeSync: true, // Enable real-time Firestore listener\n  });\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState<MemberStatus | 'all'>('all');\n  const [baptismFilter, setBaptismFilter] = useState<'all' | 'baptized' | 'not_baptized'>('all');\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [editingMember, setEditingMember] = useState<Member | null>(null);\n  const [showScrollTop, setShowScrollTop] = useState(false);\n\n\n\n\n\n  // Handle edit param from URL\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const editId = urlParams.get('edit');\n    if (editId && members.length > 0) {\n      const memberToEdit = members.find(m => m.id === editId);\n      if (memberToEdit) {\n        handleEditMember(memberToEdit);\n      }\n    }\n  }, [members]);\n\n  // Scroll to top button visibility\n  useEffect(() => {\n    const handleScroll = () => {\n      setShowScrollTop(window.scrollY > 300);\n    };\n    window.addEventListener('scroll', handleScroll);\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n  const handleDeleteMember = async (memberId: string) => {\n    try {\n      const response = await fetch(`/api/members/${memberId}`, {\n        method: 'DELETE',\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to delete member');\n      }\n\n      toast({\n        title: 'xito',\n        description: 'Miembro eliminado correctamente.'\n      });\n\n      // Clear cache and refresh immediately\n      clearCache();\n\n      // Force refresh to get updated data\n      await fetchMembers(true);\n    } catch (error) {\n      console.error('Error deleting member:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo eliminar el miembro.',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const handleEditMember = (member: Member) => {\n    setEditingMember(member);\n    setIsFormOpen(true);\n  };\n\n  const handleFormClose = () => {\n    setIsFormOpen(false);\n    setEditingMember(null);\n\n    // Clear cache and refresh immediately\n    clearCache();\n\n    // Force refresh to get updated data\n    fetchMembers(true);\n  };\n\n  const handleViewProfile = (memberId: string) => {\n    router.push(`/members/${memberId}`);\n  };\n\n\n\n  const filteredMembers = members.filter(member => {\n    const matchesSearch =\n      member.firstName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      member.lastName.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesStatus = statusFilter === 'all' || member.status === statusFilter;\n    const isBaptized = member.ordinances?.includes('baptism') ?? false;\n    \n    // Safely get baptism date\n    const baptismDate = safeGetDate(member.baptismDate);\n    const hasFutureBaptism = baptismDate && baptismDate > new Date();\n    \n    const matchesBaptism = baptismFilter === 'all' ||\n      (baptismFilter === 'baptized' && isBaptized) ||\n      (baptismFilter === 'not_baptized' && !isBaptized && hasFutureBaptism);\n    return matchesSearch && matchesStatus && matchesBaptism;\n  });\n\n  const memberCounts = {\n    active: members.filter(m => m.status === 'active').length,\n    less_active: members.filter(m => m.status === 'less_active').length,\n    inactive: members.filter(m => m.status === 'inactive').length,\n    total: members.length\n  };\n\n  return (\n    <section className=\"page-section\">\n      {/* Header */}\n      <div className=\"flex flex-col items-start gap-4 sm:flex-row sm:justify-between sm:gap-6\">\n        <div className=\"flex flex-col gap-2\">\n          <h1 className=\"text-balance text-fluid-title font-semibold tracking-tight\">Miembros</h1>\n          <p className=\"text-balance text-fluid-subtitle text-muted-foreground\">\n            Gestiona los miembros del qurum y su estado de actividad.\n          </p>\n          {/* Sync Status Indicator */}\n          <SyncStatus\n            syncStatus={syncStatus}\n            lastSyncTime={lastSyncTime}\n            className=\"mt-2\"\n          />\n        </div>\n        <div className=\"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center sm:justify-end\">\n          <Button\n            variant=\"outline\"\n            onClick={() => fetchMembers(true)}\n            disabled={loading || syncStatus === 'syncing'}\n            title=\"Actualizar lista de miembros\"\n            className=\"w-full sm:w-auto\"\n          >\n            <RefreshCw className={`mr-2 h-4 w-4 ${(loading || syncStatus === 'syncing') ? 'animate-spin' : ''}`} />\n            {syncStatus === 'syncing' ? 'Sincronizando...' : 'Actualizar'}\n          </Button>\n          <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"w-full sm:w-auto\">\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Agregar Miembro\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"w-full max-w-[90vw] overflow-y-auto sm:max-h-[90vh] sm:max-w-2xl\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingMember ? 'Editar Miembro' : 'Agregar Nuevo Miembro'}\n                </DialogTitle>\n                <DialogDescription>\n                  {editingMember\n                    ? 'Modifica la informacin del miembro.'\n                    : 'Completa la informacin del nuevo miembro.'}\n                </DialogDescription>\n              </DialogHeader>\n              <MemberForm\n                member={editingMember}\n                onClose={handleFormClose}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n\n      {/* Stats Cards */}\n      <div className=\"grid gap-3 sm:grid-cols-2 xl:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{memberCounts.total}</div>\n            <p className=\"text-xs text-muted-foreground\">miembros registrados</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Activos</CardTitle>\n            <UserCheck className=\"h-4 w-4 text-green-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">{memberCounts.active}</div>\n            <p className=\"text-xs text-muted-foreground\">miembros activos</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Menos Activos</CardTitle>\n            <UserX className=\"h-4 w-4 text-yellow-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-yellow-600\">{memberCounts.less_active}</div>\n            <p className=\"text-xs text-muted-foreground\">necesitan seguimiento</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Inactivos</CardTitle>\n            <UserX className=\"h-4 w-4 text-red-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">{memberCounts.inactive}</div>\n            <p className=\"text-xs text-muted-foreground\">miembros inactivos</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista de Miembros</CardTitle>\n          <CardDescription>\n            Busca y filtra los miembros por nombre o estado de actividad.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex flex-col gap-3 lg:flex-row lg:items-center lg:gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n              <Input\n                placeholder=\"Buscar por nombre...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            <Select value={statusFilter} onValueChange={(value: MemberStatus | 'all') => setStatusFilter(value)}>\n              <SelectTrigger className=\"w-full sm:w-[200px]\">\n                <Filter className=\"mr-2 h-4 w-4\" />\n                <SelectValue placeholder=\"Filtrar por estado\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">Todos los estados</SelectItem>\n                <SelectItem value=\"active\">Activos</SelectItem>\n                <SelectItem value=\"less_active\">Menos Activos</SelectItem>\n                <SelectItem value=\"inactive\">Inactivos</SelectItem>\n              </SelectContent>\n            </Select>\n            <Select value={baptismFilter} onValueChange={(value: 'all' | 'baptized' | 'not_baptized') => setBaptismFilter(value)}>\n              <SelectTrigger className=\"w-full sm:w-[200px]\">\n                <Filter className=\"mr-2 h-4 w-4\" />\n                <SelectValue placeholder=\"Filtrar por bautismo\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">Todos</SelectItem>\n                <SelectItem value=\"baptized\">Bautizados</SelectItem>\n                <SelectItem value=\"not_baptized\">No bautizados (futuro)</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Desktop Table */}\n          <div className=\"hidden md:block\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Nombre</TableHead>\n                  <TableHead>Telfono</TableHead>\n                  <TableHead>Fecha de Nacimiento</TableHead>\n                  <TableHead>Fecha de Bautismo</TableHead>\n                  <TableHead>Ordenanzas</TableHead>\n                  <TableHead>Ministrantes</TableHead>\n                  <TableHead>Estado</TableHead>\n                  <TableHead className=\"text-right\">Acciones</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {loading ? (\n                  Array.from({ length: 5 }).map((_, i) => (\n                    <TableRow key={i}>\n                      <TableCell><Skeleton className=\"h-5 w-40\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-5 w-28\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-5 w-28\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-5 w-36\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-6 w-20 rounded-full\" /></TableCell>\n                      <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-24\" /></TableCell>\n                    </TableRow>\n                  ))\n                ) : filteredMembers.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={8} className=\"h-24 text-center\">\n                      {searchTerm || statusFilter !== 'all'\n                        ? 'No se encontraron miembros con los filtros aplicados.'\n                        : syncStatus === 'syncing'\n                          ? 'Cargando miembros...'\n                          : 'No hay miembros registrados. Agrega el primer miembro.'}\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  filteredMembers.map((member) => {\n                    console.log(' Rendering member:', {\n                      id: member.id,\n                      name: `${member.firstName} ${member.lastName}`,\n                      status: member.status,\n                      statusType: typeof member.status,\n                      statusInfo: statusConfig[member.status]\n                    });\n                    const statusInfo = statusConfig[member.status];\n                    const StatusIcon = statusInfo.icon;\n\n                    return (\n                      <TableRow key={member.id}>\n                        <TableCell className=\"font-medium\">\n                          <div className=\"flex items-center gap-3\">\n                            {member.photoURL ? (\n                              <img\n                                src={member.photoURL}\n                                alt={`${member.firstName} ${member.lastName}`}\n                                className=\"w-8 h-8 rounded-full object-cover\"\n                              />\n                            ) : (\n                              <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n                                <Users className=\"h-4 w-4 text-muted-foreground\" />\n                              </div>\n                            )}\n                            <span>{member.firstName} {member.lastName}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell>{member.phoneNumber || 'No especificado'}</TableCell>\n                        <TableCell>\n                          {safeFormatDate(member.birthDate, 'd MMM yyyy', { locale: es })}\n                        </TableCell>\n                        <TableCell>\n                          {(() => {\n                            const isBaptized = member.ordinances?.includes('baptism') ?? false;\n                            const baptismDate = safeGetDate(member.baptismDate);\n                            if (isBaptized && baptismDate) {\n                              return safeFormatDate(member.baptismDate, 'd MMM yyyy', { locale: es });\n                            } else if (!isBaptized && baptismDate) {\n                              return `Programado: ${safeFormatDate(member.baptismDate, 'd MMM yyyy', { locale: es })}`;\n                            } else {\n                              return 'No especificada';\n                            }\n                          })()}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex flex-wrap gap-1\">\n                            {member.ordinances && member.ordinances.length > 0 ? (\n                              member.ordinances.map((ordinance) => (\n                                <Badge key={ordinance} variant=\"outline\" className=\"text-xs\">\n                                  {OrdinanceLabels[ordinance]}\n                                </Badge>\n                              ))\n                            ) : (\n                              <span className=\"text-muted-foreground text-sm\">Ninguna</span>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex flex-wrap gap-1\">\n                            {member.ministeringTeachers && member.ministeringTeachers.length > 0 ? (\n                              member.ministeringTeachers.map((teacher, index) => (\n                                <Badge key={index} variant=\"secondary\" className=\"text-xs\">\n                                  {teacher}\n                                </Badge>\n                              ))\n                            ) : (\n                              <span className=\"text-muted-foreground text-sm\">Sin asignar</span>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={statusInfo.variant} className=\"gap-1\">\n                            <StatusIcon className=\"h-3 w-3\" />\n                            {statusInfo.label}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex justify-end gap-2\">\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleViewProfile(member.id)}\n                              title=\"Ver perfil\"\n                            >\n                              <Eye className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleEditMember(member)}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <AlertDialog>\n                              <AlertDialogTrigger asChild>\n                                <Button variant=\"outline\" size=\"sm\">\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                              </AlertDialogTrigger>\n                              <AlertDialogContent>\n                                <AlertDialogHeader>\n                                  <AlertDialogTitle>Eliminar miembro?</AlertDialogTitle>\n                                  <AlertDialogDescription>\n                                    Esta accin no se puede deshacer. Se eliminar permanentemente\n                                    a {member.firstName} {member.lastName} de la base de datos.\n                                  </AlertDialogDescription>\n                                </AlertDialogHeader>\n                                <AlertDialogFooter>\n                                  <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                                  <AlertDialogAction\n                                    onClick={() => handleDeleteMember(member.id)}\n                                    className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                                  >\n                                    Eliminar\n                                  </AlertDialogAction>\n                                </AlertDialogFooter>\n                              </AlertDialogContent>\n                            </AlertDialog>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })\n                )}\n              </TableBody>\n            </Table>\n          </div>\n\n          {/* Mobile Cards */}\n          <div className=\"space-y-4 md:hidden\">\n            {loading ? (\n              Array.from({ length: 3 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-32 w-full\" />\n              ))\n            ) : filteredMembers.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Users className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n                <p className=\"text-muted-foreground\">\n                  {searchTerm || statusFilter !== 'all'\n                    ? 'No se encontraron miembros con los filtros aplicados.'\n                    : syncStatus === 'syncing'\n                      ? 'Cargando miembros...'\n                      : 'No hay miembros registrados. Agrega el primer miembro.'}\n                </p>\n              </div>\n            ) : (\n              filteredMembers.map((member) => {\n                console.log(' Rendering mobile member:', {\n                  id: member.id,\n                  name: `${member.firstName} ${member.lastName}`,\n                  status: member.status,\n                  statusType: typeof member.status,\n                  statusInfo: statusConfig[member.status]\n                });\n                const statusInfo = statusConfig[member.status];\n                const StatusIcon = statusInfo.icon;\n\n                return (\n                  <Card key={member.id}>\n                    <CardContent className=\"pt-4\">\n                      <div className=\"flex items-start justify-between mb-3\">\n                        <div className=\"flex items-center gap-3\">\n                          {member.photoURL ? (\n                            <img\n                              src={member.photoURL}\n                              alt={`${member.firstName} ${member.lastName}`}\n                              className=\"w-10 h-10 rounded-full object-cover\"\n                            />\n                          ) : (\n                            <div className=\"w-10 h-10 rounded-full bg-muted flex items-center justify-center\">\n                              <Users className=\"h-5 w-5 text-muted-foreground\" />\n                            </div>\n                          )}\n                          <div>\n                            <h3 className=\"font-semibold\">{member.firstName} {member.lastName}</h3>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {member.phoneNumber || 'Sin telfono'}\n                            </p>\n                          </div>\n                        </div>\n                        <Badge variant={statusInfo.variant} className=\"gap-1\">\n                          <StatusIcon className=\"h-3 w-3\" />\n                          {statusInfo.label}\n                        </Badge>\n                      </div>\n\n                      {safeGetDate(member.birthDate) && (\n                        <p className=\"text-sm text-muted-foreground mb-3\">\n                          Nacimiento: {safeFormatDate(member.birthDate, 'd MMM yyyy', { locale: es })}\n                        </p>\n                      )}\n\n                      {(() => {\n                        const isBaptized = member.ordinances?.includes('baptism') ?? false;\n                        const baptismDate = safeGetDate(member.baptismDate);\n                        if (baptismDate) {\n                          return (\n                            <p className=\"text-sm text-muted-foreground mb-3\">\n                              Bautismo: {isBaptized ? safeFormatDate(member.baptismDate, 'd MMM yyyy', { locale: es }) : `Programado: ${safeFormatDate(member.baptismDate, 'd MMM yyyy', { locale: es })}`}\n                            </p>\n                          );\n                        }\n                        return null;\n                      })()}\n\n                      {/* Ordenanzas en mvil */}\n                      {member.ordinances && member.ordinances.length > 0 && (\n                        <div className=\"mb-3\">\n                          <p className=\"text-sm font-medium mb-2\">Ordenanzas:</p>\n                          <div className=\"flex flex-wrap gap-1\">\n                            {member.ordinances.map((ordinance) => (\n                              <Badge key={ordinance} variant=\"outline\" className=\"text-xs\">\n                                {OrdinanceLabels[ordinance]}\n                              </Badge>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n\n                      {/* Ministrantes en mvil */}\n                      <div className=\"mb-3\">\n                        <p className=\"text-sm font-medium mb-2\">Ministrantes:</p>\n                        <div className=\"flex flex-wrap gap-1\">\n                          {member.ministeringTeachers && member.ministeringTeachers.length > 0 ? (\n                            member.ministeringTeachers.map((teacher, index) => (\n                              <Badge key={index} variant=\"secondary\" className=\"text-xs\">\n                                {teacher}\n                              </Badge>\n                            ))\n                          ) : (\n                            <span className=\"text-muted-foreground text-sm\">Sin asignar</span>\n                          )}\n                        </div>\n                      </div>\n\n                      <div className=\"flex flex-wrap justify-end gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleViewProfile(member.id)}\n                          className=\"w-full sm:w-auto\"\n                        >\n                          <Eye className=\"mr-2 h-4 w-4\" />\n                          Ver Perfil\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleEditMember(member)}\n                          className=\"w-full sm:w-auto\"\n                        >\n                          <Edit className=\"mr-2 h-4 w-4\" />\n                          Editar\n                        </Button>\n                        <AlertDialog>\n                          <AlertDialogTrigger asChild>\n                            <Button variant=\"outline\" size=\"sm\" className=\"w-full sm:w-auto\">\n                              <Trash2 className=\"mr-2 h-4 w-4\" />\n                              Eliminar\n                            </Button>\n                          </AlertDialogTrigger>\n                          <AlertDialogContent>\n                            <AlertDialogHeader>\n                              <AlertDialogTitle>Eliminar miembro?</AlertDialogTitle>\n                              <AlertDialogDescription>\n                                Esta accin no se puede deshacer. Se eliminar permanentemente\n                                a {member.firstName} {member.lastName} de la base de datos.\n                              </AlertDialogDescription>\n                            </AlertDialogHeader>\n                            <AlertDialogFooter>\n                              <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                              <AlertDialogAction\n                                onClick={() => handleDeleteMember(member.id)}\n                                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                              >\n                                Eliminar\n                              </AlertDialogAction>\n                            </AlertDialogFooter>\n                          </AlertDialogContent>\n                        </AlertDialog>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Scroll to Top Button */}\n      {showScrollTop && (\n        <Button\n          onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}\n          className=\"fixed bottom-4 right-4 z-50\"\n          size=\"icon\"\n        >\n          <ChevronUp className=\"h-4 w-4\" />\n        </Button>\n      )}\n    </section>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\ministering\\CompanionshipForm.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMembers'. Either include it or remove the dependency array.","line":92,"column":6,"nodeType":"ArrayExpression","endLine":92,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadMembers]","fix":{"range":[3631,3633],"text":"[loadMembers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { useFieldArray, useForm } from 'react-hook-form';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport { z } from 'zod';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { addDoc, updateDoc, doc, getDocs, query, orderBy, where } from 'firebase/firestore';\nimport { ministeringCollection, membersCollection } from '@/lib/collections';\nimport logger from '@/lib/logger';\nimport { updateMinisteringTeachersOnCompanionshipChange } from '@/lib/ministering-reverse-sync';\n\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Form, FormField, FormControl, FormItem, FormMessage } from '@/components/ui/form';\nimport { PlusCircle, Trash2, UserCheck, Edit3 } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport type { Companionship, Member } from '@/lib/types';\nimport { validateCompanionshipData } from '@/lib/ministering-validations';\n\nconst companionshipSchema = z.object({\n   companions: z.array(z.object({ value: z.string().min(1, 'El nombre es requerido.') })).min(2, { message: 'Se requieren al menos dos compaeros.' }),\n   families: z.array(z.object({ value: z.string().min(1, 'El nombre es requerido.') })).min(1, { message: 'Se requiere al menos una familia.' }),\n});\n\ntype FormValues = z.infer<typeof companionshipSchema>;\n\ninterface CompanionshipFormProps {\n    companionship?: Companionship;\n    onCancel?: () => void; // Add onCancel prop\n}\n\n\nexport function CompanionshipForm({ companionship, onCancel }: CompanionshipFormProps) {\n   const router = useRouter();\n   const { toast } = useToast();\n   const [isSubmitting, setIsSubmitting] = useState(false);\n\n   const isEditMode = !!companionship;\n\n   // New state for dual mode functionality\n   // En modo edicin, iniciar en modo manual para mostrar los valores existentes\n   const [companionEntryMode, setCompanionEntryMode] = useState<'manual' | 'automatic'>(isEditMode ? 'manual' : 'automatic');\n   const [familyEntryMode, setFamilyEntryMode] = useState<'manual' | 'automatic'>(isEditMode ? 'manual' : 'automatic');\n   const [members, setMembers] = useState<Member[]>([]);\n   const [loadingMembers, setLoadingMembers] = useState(false);\n\n  const defaultValues = isEditMode\n  ? {\n      companions: companionship.companions.map(c => ({ value: c })),\n      families: companionship.families.map(f => ({ value: f.name })),\n    }\n  : {\n      companions: [{ value: '' }, { value: '' }],\n      families: [{ value: '' }],\n    };\n\n\n  // Load members for automatic mode\n  const loadMembers = async () => {\n    setLoadingMembers(true);\n    try {\n      const snapshot = await getDocs(query(membersCollection, orderBy('firstName', 'asc')));\n      const membersList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Member));\n      setMembers(membersList);\n    } catch (error) {\n      console.error(\"Error loading members:\", error);\n      toast({\n        title: \"Error\",\n        description: \"No se pudieron cargar los miembros.\",\n        variant: \"destructive\",\n      });\n    }\n    setLoadingMembers(false);\n  };\n\n  useEffect(() => {\n    loadMembers();\n  }, []);\n\n  const form = useForm<FormValues>({\n    resolver: zodResolver(companionshipSchema),\n    defaultValues,\n  });\n\n  // Handle member selection for companions\n  const handleCompanionMemberSelect = (memberId: string, index: number) => {\n    const member = members.find(m => m.id === memberId);\n    if (member) {\n      form.setValue(`companions.${index}.value`, `${member.firstName} ${member.lastName}`);\n    }\n  };\n\n  // Handle member selection for families\n  const handleFamilyMemberSelect = (memberId: string, index: number) => {\n    const member = members.find(m => m.id === memberId);\n    if (member) {\n      // Use family name format (could be last name or full name based on your preference)\n      form.setValue(`families.${index}.value`, `Familia ${member.lastName}`);\n    }\n  };\n\n  // Handle entry mode changes\n  const handleCompanionModeChange = (mode: 'manual' | 'automatic') => {\n    setCompanionEntryMode(mode);\n    // En modo edicin, no limpiar los campos al cambiar de modo\n    if (mode === 'manual' && !isEditMode) {\n      // Clear companion fields when switching to manual (solo en modo creacin)\n      companionFields.forEach((_, index) => {\n        form.setValue(`companions.${index}.value`, '');\n      });\n    }\n  };\n\n  const handleFamilyModeChange = (mode: 'manual' | 'automatic') => {\n    setFamilyEntryMode(mode);\n    // En modo edicin, no limpiar los campos al cambiar de modo\n    if (mode === 'manual' && !isEditMode) {\n      // Clear family fields when switching to manual (solo en modo creacin)\n      familyFields.forEach((_, index) => {\n        form.setValue(`families.${index}.value`, '');\n      });\n    }\n  };\n\n  const {\n    fields: companionFields,\n    append: appendCompanion,\n    remove: removeCompanion,\n  } = useFieldArray({ control: form.control, name: 'companions' });\n  const {\n    fields: familyFields,\n    append: appendFamily,\n    remove: removeFamily,\n  } = useFieldArray({ control: form.control, name: 'families' });\n\n  // Funcin para sincronizar compaeros cuando se eliminan familias\n  const syncCompanionsWithFamilies = (familyCount: number) => {\n    const currentCompanionCount = companionFields.length;\n\n    // Si quedan muy pocas familias, reducir compaeros proporcionalmente\n    // Mantener siempre al menos 2 compaeros (requerimiento del schema)\n    let targetCompanionCount = Math.max(2, Math.min(currentCompanionCount, familyCount + 1));\n\n    // Si hay ms compaeros que el objetivo, eliminar los excedentes\n    if (currentCompanionCount > targetCompanionCount) {\n      const companionsToRemove = currentCompanionCount - targetCompanionCount;\n      for (let i = 0; i < companionsToRemove; i++) {\n        removeCompanion(currentCompanionCount - 1 - i);\n      }\n    }\n  };\n\n  // Modificar removeFamily para incluir sincronizacin\n  const handleRemoveFamily = (index: number) => {\n    if (familyFields.length <= 1) {\n      // No permitir eliminar la ltima familia\n      toast({\n        title: \"No se puede eliminar\",\n        description: \"Debe mantener al menos una familia en el compaerismo.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    removeFamily(index);\n\n    // Sincronizar compaeros despus de un breve delay para que el estado se actualice\n    setTimeout(() => {\n      const remainingFamilies = familyFields.length; // Ya se actualiz despus de removeFamily\n      syncCompanionsWithFamilies(remainingFamilies);\n    }, 100);\n  };\n\n  const onSubmit = async (values: FormValues) => {\n    setIsSubmitting(true);\n    try {\n        // Validar que no haya duplicados ni conflictos\n        const companionNames = values.companions.map(c => c.value);\n        const newFamilyNames = values.families.map(f => f.value);\n\n        const validationResult = await validateCompanionshipData(\n          companionNames,\n          newFamilyNames,\n          isEditMode ? companionship.id : undefined\n        );\n\n        if (!validationResult.valid) {\n          toast({\n            title: 'Error de Validacin',\n            description: validationResult.error || 'Hay conflictos en la asignacin',\n            variant: 'destructive',\n          });\n          setIsSubmitting(false);\n          return;\n        }\n\n        // Synchronize ministering assignments using reverse sync\n        if (isEditMode) {\n            const oldCompanions = companionship.companions;\n            const oldFamilies = companionship.families.map(f => f.name);\n            \n            console.log(' [FORM] Calling updateMinisteringTeachersOnCompanionshipChange with:', {\n              oldCompanions,\n              oldFamilies,\n              newCompanions: companionNames,\n              newFamilyNames\n            });\n            \n            await updateMinisteringTeachersOnCompanionshipChange(\n                oldCompanions,\n                companionNames,\n                oldFamilies,\n                newFamilyNames\n            );\n        } else {\n            // For new companionships, add ministering assignments\n            for (const familyName of newFamilyNames) {\n                const lastName = familyName.replace('Familia ', '');\n                const memberQuery = query(membersCollection, where('lastName', '==', lastName));\n                const memberSnap = await getDocs(memberQuery);\n                if (!memberSnap.empty) {\n                    const memberDoc = memberSnap.docs[0];\n                    const member = { id: memberDoc.id, ...memberDoc.data() } as Member;\n                    const currentTeachers = member.ministeringTeachers || [];\n                    const newTeachers = [...new Set([...currentTeachers, ...companionNames])];\n                    await updateDoc(doc(membersCollection, member.id), { ministeringTeachers: newTeachers });\n                }\n            }\n        }\n\n        if (isEditMode) {\n             const companionshipRef = doc(ministeringCollection, companionship.id);\n             \n             // Smartly update families: keep existing data, remove old, add new\n             const newFamilyNames = values.families.map(f => f.value);\n             const existingFamilies = companionship.families;\n             const updatedFamilies = newFamilyNames.map(name => {\n                 const existing = existingFamilies.find(f => f.name === name);\n                 return existing || { name, isUrgent: false, observation: '', visitedThisMonth: false };\n             });\n\n             await updateDoc(companionshipRef, {\n                companions: values.companions.map(c => c.value),\n                families: updatedFamilies,\n             });\n\n             toast({\n                title: \"Compaerismo Actualizado\",\n                description: \"Los cambios se han guardado correctamente.\",\n             });\n             // Instead of router.push, we call a refresh or passed-in handler if available\n             // For simplicity, we can let the parent page handle refresh logic.\n             if (onCancel) onCancel(); // Exit edit mode\n             router.refresh(); // Force a server-side refresh of the page\n        } else {\n            const familiesWithObjects = values.families.map(f => ({\n                name: f.value,\n                isUrgent: false,\n                observation: '',\n                visitedThisMonth: false,\n            }));\n\n            await addDoc(ministeringCollection, {\n                companions: values.companions.map(c => c.value),\n                families: familiesWithObjects,\n            });\n\n            toast({\n                title: \"Compaerismo Agregado\",\n                description: \"La asignacin se ha guardado correctamente.\",\n            });\n            router.push('/ministering');\n        }\n    } catch (error) {\n      logger.error({ error, message: 'Error saving companionship' });\n      toast({\n        title: 'Error',\n        description: 'No se pudo guardar la asignacin.',\n        variant: 'destructive',\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)}>\n        <Card>\n          <CardHeader>\n            <CardTitle>{isEditMode ? 'Editar Compaerismo' : 'Agregar Nuevo Compaerismo'}</CardTitle>\n            <CardDescription>\n              {isEditMode ? 'Actualiza los compaeros y las familias asignadas.' : 'Define los compaeros y las familias que ministrarn.'}\n              <br />\n              <span className=\"text-sm text-muted-foreground\">Los campos marcados con * son obligatorios.</span>\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            {/* Companion Entry Mode Selection */}\n            <div className=\"space-y-4\">\n              <div>\n                <Label className=\"text-base font-medium\">Mtodo de Registro - Compaeros</Label>\n                <p className=\"text-sm text-muted-foreground\">Selecciona cmo deseas registrar los compaeros</p>\n              </div>\n              <RadioGroup\n                value={companionEntryMode}\n                onValueChange={(value) => handleCompanionModeChange(value as 'manual' | 'automatic')}\n                className=\"flex flex-col space-y-2\"\n              >\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"manual\" id=\"companion-manual\" />\n                  <Label htmlFor=\"companion-manual\" className=\"flex items-center gap-2 cursor-pointer\">\n                    <Edit3 className=\"h-4 w-4\" />\n                    Manual - Ingresar nombres manualmente\n                  </Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"automatic\" id=\"companion-automatic\" />\n                  <Label htmlFor=\"companion-automatic\" className=\"flex items-center gap-2 cursor-pointer\">\n                    <UserCheck className=\"h-4 w-4\" />\n                    Automtico - Seleccionar miembros existentes\n                  </Label>\n                </div>\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Compaeros *</Label>\n              {companionFields.map((field, index) => (\n                <FormField\n                  key={field.id}\n                  control={form.control}\n                  name={`companions.${index}.value`}\n                  render={({ field }) => (\n                    <FormItem>\n                      <div className=\"flex items-center gap-2\">\n                        {companionEntryMode === 'automatic' ? (\n                          <Select onValueChange={(value) => handleCompanionMemberSelect(value, index)} disabled={loadingMembers}>\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue placeholder={loadingMembers ? \"Cargando...\" : `Seleccionar compaero ${index + 1}`} />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {members.map((member) => (\n                                <SelectItem key={member.id} value={member.id}>\n                                  <div className=\"flex items-center gap-2\">\n                                    <Avatar className=\"h-6 w-6\">\n                                      <AvatarImage src={member.photoURL} />\n                                      <AvatarFallback className=\"text-xs\">\n                                        {member.firstName.charAt(0)}{member.lastName.charAt(0)}\n                                      </AvatarFallback>\n                                    </Avatar>\n                                    {member.firstName} {member.lastName}\n                                  </div>\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        ) : (\n                          <FormControl>\n                            <Input {...field} placeholder={`Compaero ${index + 1}`} />\n                          </FormControl>\n                        )}\n                        <Button type=\"button\" variant=\"outline\" size=\"icon\" onClick={() => removeCompanion(index)} disabled={companionFields.length <= 2}>\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              ))}\n              <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => appendCompanion({ value: '' })}>\n                <PlusCircle className=\"mr-2 h-4 w-4\" />\n                Agregar Compaero\n              </Button>\n            </div>\n\n            {/* Family Entry Mode Selection */}\n            <div className=\"space-y-4\">\n              <div>\n                <Label className=\"text-base font-medium\">Mtodo de Registro - Familias</Label>\n                <p className=\"text-sm text-muted-foreground\">Selecciona cmo deseas registrar las familias</p>\n              </div>\n              <RadioGroup\n                value={familyEntryMode}\n                onValueChange={(value) => handleFamilyModeChange(value as 'manual' | 'automatic')}\n                className=\"flex flex-col space-y-2\"\n              >\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"manual\" id=\"family-manual\" />\n                  <Label htmlFor=\"family-manual\" className=\"flex items-center gap-2 cursor-pointer\">\n                    <Edit3 className=\"h-4 w-4\" />\n                    Manual - Ingresar nombres manualmente\n                  </Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"automatic\" id=\"family-automatic\" />\n                  <Label htmlFor=\"family-automatic\" className=\"flex items-center gap-2 cursor-pointer\">\n                    <UserCheck className=\"h-4 w-4\" />\n                    Automtico - Seleccionar miembros existentes\n                  </Label>\n                </div>\n              </RadioGroup>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Familias Asignadas *</Label>\n              {familyFields.map((field, index) => (\n                 <FormField\n                  key={field.id}\n                  control={form.control}\n                  name={`families.${index}.value`}\n                  render={({ field }) => (\n                    <FormItem>\n                      <div className=\"flex items-center gap-2\">\n                        {familyEntryMode === 'automatic' ? (\n                          <Select onValueChange={(value) => handleFamilyMemberSelect(value, index)} disabled={loadingMembers}>\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue placeholder={loadingMembers ? \"Cargando...\" : `Seleccionar familia ${index + 1}`} />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {members.map((member) => (\n                                <SelectItem key={member.id} value={member.id}>\n                                  <div className=\"flex items-center gap-2\">\n                                    <Avatar className=\"h-6 w-6\">\n                                      <AvatarImage src={member.photoURL} />\n                                      <AvatarFallback className=\"text-xs\">\n                                        {member.firstName.charAt(0)}{member.lastName.charAt(0)}\n                                      </AvatarFallback>\n                                    </Avatar>\n                                    Familia {member.lastName}\n                                  </div>\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        ) : (\n                          <FormControl>\n                            <Input {...field} placeholder={`Familia ${index + 1}`} />\n                          </FormControl>\n                        )}\n                        <Button type=\"button\" variant=\"outline\" size=\"icon\" onClick={() => handleRemoveFamily(index)} disabled={familyFields.length <= 1}>\n                            <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              ))}\n              <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => appendFamily({ value: '' })}>\n                <PlusCircle className=\"mr-2 h-4 w-4\" />\n                Agregar Familia\n              </Button>\n            </div>\n          </CardContent>\n          <CardFooter className=\"flex justify-end gap-2\">\n              {isEditMode ? (\n                 <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\n                    Cancelar\n                 </Button>\n              ) : (\n                <Button variant=\"outline\" asChild>\n                    <Link href=\"/ministering\">Cancelar</Link>\n                </Button>\n              )}\n              <Button type=\"submit\" disabled={isSubmitting}>\n                {isSubmitting ? 'Guardando...' : 'Guardar Cambios'}\n              </Button>\n          </CardFooter>\n        </Card>\n      </form>\n    </Form>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\ministering\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCompanionship'. Either include it or remove the dependency array.","line":87,"column":6,"nodeType":"ArrayExpression","endLine":87,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [companionshipId, fetchCompanionship]","fix":{"range":[2734,2751],"text":"[companionshipId, fetchCompanionship]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useEffect, useState, useTransition } from 'react';\nimport { useRouter, useParams } from 'next/navigation';\nimport { doc, getDoc, updateDoc, deleteDoc, query, where, getDocs } from 'firebase/firestore';\nimport { ministeringCollection, membersCollection } from '@/lib/collections';\nimport type { Companionship, Family, Member } from '@/lib/types';\nimport { useToast } from '@/hooks/use-toast';\nimport logger from '@/lib/logger';\nimport Link from 'next/link';\nimport { removeMinisteringTeachersFromFamilies } from '@/lib/ministering-reverse-sync';\n\nimport { Button } from '@/components/ui/button';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { ArrowLeft, Edit, Save, Trash2, AlertTriangle } from 'lucide-react';\nimport { CompanionshipForm } from '../CompanionshipForm';\n\nexport default function ManageCompanionshipPage() {\n  const router = useRouter();\n  const params = useParams();\n  const { id } = params;\n  const { toast } = useToast();\n\n  const [companionship, setCompanionship] = useState<Companionship | null>(null);\n  const [families, setFamilies] = useState<Family[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [isAlertOpen, setIsAlertOpen] = useState(false);\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [isPending, startTransition] = useTransition();\n\n\n  const companionshipId = Array.isArray(id) ? id[0] : id;\n\n  const fetchCompanionship = async () => {\n    if (!companionshipId) return;\n\n    setLoading(true);\n    const docRef = doc(ministeringCollection, companionshipId);\n    const docSnap = await getDoc(docRef);\n\n    if (docSnap.exists()) {\n      const data = { id: docSnap.id, ...docSnap.data() } as Companionship;\n      setCompanionship(data);\n      setFamilies(data.families);\n    } else {\n      toast({ title: \"Error\", description: \"Compaerismo no encontrado.\", variant: \"destructive\" });\n      router.push('/ministering');\n    }\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    fetchCompanionship();\n  }, [companionshipId]);\n\n  const handleFamilyChange = (index: number, field: keyof Family, value: any) => {\n    const updatedFamilies = [...families];\n    (updatedFamilies[index] as any)[field] = value;\n    setFamilies(updatedFamilies);\n  };\n  const handleSaveChanges = async () => {\n    if (!companionshipId) return;\n    setIsSaving(true);\n    try {\n      const docRef = doc(ministeringCollection, companionshipId);\n      await updateDoc(docRef, { families });\n      toast({ title: \"xito\", description: \"Cambios guardados correctamente.\" });\n    } catch (error) {\n      logger.error({ error, message: 'Error saving companionship changes' });\n      toast({ title: \"Error\", description: \"No se pudieron guardar los cambios.\", variant: \"destructive\" });\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!companionshipId || !companionship) return;\n    try {\n      const companionNames = companionship.companions || [];\n      const familyNames = companionship.families.map(f => f.name);\n\n      await removeMinisteringTeachersFromFamilies(companionNames, familyNames);\n\n      await deleteDoc(doc(ministeringCollection, companionshipId));\n\n      toast({\n        title: 'Compaerismo Eliminado',\n        description: 'La asignacin y los maestros ministrantes han sido eliminados exitosamente.',\n      });\n      router.push('/ministering');\n    } catch (error) {\n      logger.error({ error, message: 'Error deleting companionship' });\n      toast({\n        title: 'Error',\n        description: 'No se pudo eliminar el compaerismo.',\n        variant: 'destructive',\n      });\n    }\n  };\n  \n  const handleCancelEdit = () => {\n    setIsEditMode(false);\n    startTransition(async () => {\n        await fetchCompanionship(); // Refetch data to discard any changes\n    });\n  };\n\n  if (loading || isPending) {\n    return (\n        <div className=\"space-y-4\">\n            <Skeleton className=\"h-10 w-1/4\" />\n            <Skeleton className=\"h-64 w-full\" />\n            <Skeleton className=\"h-10 w-1/3 self-end\" />\n        </div>\n    );\n  }\n\n  if (!companionship) {\n    return null; // Or a not found message\n  }\n\n  if (isEditMode) {\n    return <CompanionshipForm companionship={companionship} onCancel={handleCancelEdit} />;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Button variant=\"outline\" asChild>\n        <Link href=\"/ministering\">\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n            Volver a la Lista\n        </Link>\n      </Button>\n      <Card>\n        <CardHeader>\n          <div className=\"flex justify-between items-start\">\n            <div>\n              <CardTitle>Gestionar Compaerismo</CardTitle>\n              <CardDescription>{companionship.companions.join(' y ')}</CardDescription>\n            </div>\n             <div className=\"flex gap-2\">\n                <Button variant=\"outline\" onClick={() => setIsEditMode(true)}>\n                    <Edit className=\"mr-2 h-4 w-4\" />\n                    Editar\n                </Button>\n                <AlertDialog open={isAlertOpen} onOpenChange={setIsAlertOpen}>\n                    <AlertDialogTrigger asChild>\n                        <Button variant=\"destructive\">\n                            <Trash2 className=\"mr-2 h-4 w-4\" />\n                            Eliminar\n                        </Button>\n                    </AlertDialogTrigger>\n                    <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Ests seguro?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                        Esta accin eliminar permanentemente este compaerismo.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                        <AlertDialogAction onClick={handleDelete} className=\"bg-destructive hover:bg-destructive/90\">\n                        Eliminar\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                    </AlertDialogContent>\n                </AlertDialog>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <Table>\n                <TableHeader>\n                <TableRow>\n                    <TableHead>Familia</TableHead>\n                    <TableHead>Visitado</TableHead>\n                    <TableHead>Urgente</TableHead>\n                    <TableHead className=\"w-[40%]\">Observacin</TableHead>\n                </TableRow>\n                </TableHeader>\n                <TableBody>\n                {families.map((family, index) => (\n                    <TableRow key={index}>\n                    <TableCell className=\"font-medium\">{family.name}</TableCell>\n                    <TableCell>\n                        <Checkbox\n                        checked={family.visitedThisMonth}\n                        onCheckedChange={(checked) => handleFamilyChange(index, 'visitedThisMonth', !!checked)}\n                        />\n                    </TableCell>\n                    <TableCell>\n                         <Switch\n                            checked={family.isUrgent}\n                            onCheckedChange={(checked) => handleFamilyChange(index, 'isUrgent', checked)}\n                            aria-label=\"Marcar como urgente\"\n                         />\n                    </TableCell>\n                    <TableCell>\n                        <Textarea\n                        value={family.observation}\n                        onChange={(e) => handleFamilyChange(index, 'observation', e.target.value)}\n                        placeholder=\"Aadir nota...\"\n                        rows={1}\n                        />\n                    </TableCell>\n                    </TableRow>\n                ))}\n                </TableBody>\n            </Table>\n          </div>\n        </CardContent>\n        <CardFooter className=\"flex justify-end\">\n            <Button onClick={handleSaveChanges} disabled={isSaving}>\n                <Save className=\"mr-2 h-4 w-4\" />\n                {isSaving ? 'Guardando...' : 'Guardar Cambios'}\n            </Button>\n        </CardFooter>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\ministering\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\ministering\\add\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\ministering\\migrate\\page.tsx","messages":[{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/ministering/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":90,"column":15,"nodeType":"JSXOpeningElement","endLine":90,"endColumn":80}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Loader2, CheckCircle, AlertCircle } from 'lucide-react';\nimport { migrateExistingMinisteringAssignments } from '@/lib/migrate-ministering';\n\nexport default function MigrateMinisteringPage() {\n  const [isRunning, setIsRunning] = useState(false);\n  const [result, setResult] = useState<any>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleMigration = async () => {\n    setIsRunning(true);\n    setResult(null);\n    setError(null);\n\n    try {\n      const migrationResult = await migrateExistingMinisteringAssignments();\n      setResult(migrationResult);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Error desconocido');\n    } finally {\n      setIsRunning(false);\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-2xl\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Migracin de Maestros Ministrantes</CardTitle>\n          <CardDescription>\n            Esta herramienta sincronizar todos los maestros ministrantes asignados a los miembros\n            y crear automticamente los compaerismos correspondientes en la pgina de ministracin.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <Alert>\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertTitle>Importante</AlertTitle>\n            <AlertDescription>\n              Esta operacin revisar todos los miembros que tienen maestros ministrantes asignados\n              y crear o actualizar los compaerismos correspondientes. Es seguro ejecutarla mltiples veces.\n            </AlertDescription>\n          </Alert>\n\n          <Button \n            onClick={handleMigration} \n            disabled={isRunning}\n            className=\"w-full\"\n          >\n            {isRunning ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                Ejecutando migracin...\n              </>\n            ) : (\n              'Ejecutar Migracin'\n            )}\n          </Button>\n\n          {result && (\n            <Alert className=\"border-green-500 bg-green-50\">\n              <CheckCircle className=\"h-4 w-4 text-green-600\" />\n              <AlertTitle className=\"text-green-800\">Migracin Completada</AlertTitle>\n              <AlertDescription className=\"text-green-700\">\n                <div className=\"mt-2 space-y-1\">\n                  <p>Total de miembros: {result.totalMembers}</p>\n                  <p>Miembros con maestros: {result.processedMembers}</p>\n                  <p>Sincronizados exitosamente: {result.syncedMembers}</p>\n                </div>\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {error && (\n            <Alert variant=\"destructive\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertTitle>Error</AlertTitle>\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n\n          <div className=\"pt-4 border-t\">\n            <p className=\"text-sm text-muted-foreground\">\n              Despus de ejecutar la migracin, ve a la pgina de{' '}\n              <a href=\"/ministering\" className=\"text-blue-600 hover:underline\">\n                Ministracin\n              </a>{' '}\n              para ver los compaerismos creados.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\ministering\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\ministering\\urgent\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\ministering\\urgent\\urgentClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\missionary-work\\FriendshipForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\missionary-work\\NewConvertsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\missionary-work\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\missionary-work\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":948,"column":25,"nodeType":"JSXOpeningElement","endLine":948,"endColumn":112},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":989,"column":25,"nodeType":"JSXOpeningElement","endLine":989,"endColumn":119}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\ndeclare global {\n  interface Window {\n    SpeechRecognition: any;\n    webkitSpeechRecognition: any;\n  }\n}\n\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport {\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n} from '@/components/ui/tabs';\nimport type {\n  MissionaryAssignment,\n  Investigator,\n  NewConvertFriendship,\n  Convert,\n  Member,\n  MissionaryImage,\n  Annotation,\n} from '@/lib/types';\nimport { membersCollection } from '@/lib/collections';\nimport { getMembersForSelector } from '@/lib/members-data';\nimport {\n  useEffect,\n  useState,\n  useTransition,\n  useRef,\n  useCallback,\n} from 'react';\nimport { useRouter } from 'next/navigation';\nimport { getDocs, query, orderBy, where, Timestamp } from 'firebase/firestore';\nimport { ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage';\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from '@/components/ui/accordion';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from '@/components/ui/alert-dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  HandHeart,\n  PlusCircle,\n  Link as LinkIcon,\n  UserPlus,\n  Trash2,\n  Pencil,\n  Mic,\n} from 'lucide-react';\nimport {\n  addDoc,\n  deleteDoc,\n  doc,\n  serverTimestamp,\n  updateDoc,\n} from 'firebase/firestore';\nimport {\n  missionaryAssignmentsCollection,\n  investigatorsCollection,\n  newConvertFriendsCollection,\n  convertsCollection,\n  missionaryImagesCollection,\n  annotationsCollection,\n  storage,\n} from '@/lib/collections';\nimport { z } from 'zod';\nimport logger from '@/lib/logger';\nimport { useAuth } from '@/contexts/auth-context';\nimport { subHours, subMonths } from 'date-fns';\nimport { FriendshipForm } from './FriendshipForm';\nimport { analyzeImage } from '@/ai/flows/analyze-image-flow';\nimport { VoiceAnnotations } from '@/components/shared/voice-annotations';\nimport { AnnotationManager } from '@/components/shared/annotation-manager';\n\n\nconst faqData = [\n  {\n    question: 'Cul es el rol del Qurum de lderes en la obra misional?',\n    answer:\n      'El Qurum de lderes, bajo la direccin del obispo, lidera la obra misional en el barrio. Su responsabilidad principal es coordinar los esfuerzos de los miembros para encontrar, ensear y bautizar a personas interesadas. Esto incluye trabajar de cerca con los misioneros de tiempo completo, organizar actividades misionales y asegurarse de que los nuevos conversos sean integrados y apoyados.',\n  },\n  {\n    question: 'Cmo trabajamos con los misioneros de tiempo completo?',\n    answer:\n      'La colaboracin es clave. La presidencia del qurum debe reunirse regularmente con los misioneros en las reuniones de correlacin misional para coordinar planes. Los miembros del qurum pueden ayudar a los misioneros proveyendo referencias, participando en las lecciones, ofreciendo transporte y abriendo sus hogares para actividades.',\n  },\n  {\n    question:\n      'Qu significa \"asignar amigos\" a un nuevo converso y por qu es importante?',\n    answer:\n      'Asignar amigos (a menudo llamados \"compaeros ministrantes\" o simplemente amigos del qurum) es crucial para la retencin de nuevos miembros. Un nuevo converso necesita apoyo, amistad y gua. Asignar a uno o dos hermanos del qurum para que se hagan amigos del nuevo miembro, lo visiten, lo inviten a actividades y respondan sus preguntas, le ayuda a sentirse parte de la comunidad y a fortalecer su testimonio.',\n  },\n  {\n    question: 'Qu tipo de asignaciones misionales puede tener el qurum?',\n    answer:\n      'Las asignaciones pueden ser variadas: acompaar a los misioneros a dar una leccin, invitar a un amigo a una actividad de la Iglesia, compartir un mensaje del Evangelio en redes sociales, ayudar a un investigador con una mudanza como acto de servicio, u organizar una noche de hogar abierta a amigos de la Iglesia.',\n  },\n];\n\n// --- Client-side Data Fetching Functions ---\n\nasync function getMissionaryAssignments(): Promise<MissionaryAssignment[]> {\n  const q = query(\n    missionaryAssignmentsCollection,\n    orderBy('createdAt', 'desc')\n  );\n  const snapshot = await getDocs(q);\n  return snapshot.docs.map(\n    (doc) => ({ id: doc.id, ...doc.data() } as MissionaryAssignment)\n  );\n}\n\nasync function getInvestigators(): Promise<Investigator[]> {\n  const q = query(investigatorsCollection, orderBy('createdAt', 'desc'));\n  const snapshot = await getDocs(q);\n  const allInvestigators = snapshot.docs.map(\n    (doc) => ({ id: doc.id, ...doc.data() } as Investigator)\n  );\n\n  const twentyFourHoursAgo = subHours(new Date(), 24);\n\n  // Filter out baptized investigators linked more than 24 hours ago\n  return allInvestigators.filter(inv => {\n    if (inv.status === 'baptized') {\n        // If linkedAt exists and is older than 24 hours, filter it out. Otherwise, keep it.\n        return inv.linkedAt ? inv.linkedAt.toDate() > twentyFourHoursAgo : true;\n    }\n    // Always keep active investigators\n    return true;\n  });\n}\n\n\nasync function getNewConvertFriendships(): Promise<NewConvertFriendship[]> {\n    const q = query(newConvertFriendsCollection, orderBy('assignedAt', 'desc'));\n    const snapshot = await getDocs(q);\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as NewConvertFriendship));\n}\n\n\nasync function getNewConvertsWithoutFriends(): Promise<Convert[]> {\n  const twentyFourMonthsAgo = subMonths(new Date(), 24);\n  const twentyFourMonthsAgoTimestamp = Timestamp.fromDate(twentyFourMonthsAgo);\n\n  // Obtener conversos de la coleccin c_conversos\n  const convertsSnapshot = await getDocs(query(convertsCollection, orderBy('baptismDate', 'desc')));\n  const convertsFromCollection = convertsSnapshot.docs\n    .map(doc => ({ id: doc.id, ...doc.data() } as Convert))\n    .filter(convert =>\n        convert.baptismDate &&\n        convert.baptismDate.toDate &&\n        convert.baptismDate.toDate() > twentyFourMonthsAgo\n    );\n\n  // Obtener miembros bautizados hace 2 aos\n  const membersSnapshot = await getDocs(query(membersCollection, orderBy('baptismDate', 'desc')));\n  const membersAsConverts = membersSnapshot.docs\n    .map(doc => {\n      const memberData = doc.data() as Member;\n      if (memberData.baptismDate && memberData.baptismDate.toDate) {\n        const baptismDate = memberData.baptismDate.toDate();\n        if (baptismDate > twentyFourMonthsAgo) {\n          return {\n            id: `member_${doc.id}`,\n            name: `${memberData.firstName} ${memberData.lastName}`,\n            baptismDate: memberData.baptismDate,\n            photoURL: memberData.photoURL,\n            councilCompleted: memberData.councilCompleted || false,\n            councilCompletedAt: memberData.councilCompletedAt || null,\n            observation: 'Bautizado como miembro',\n            missionaryReference: 'Registro de miembros'\n          } as Convert;\n        }\n      }\n      return null;\n    })\n    .filter(Boolean) as Convert[];\n\n  // Combinar y ordenar por fecha de bautismo (ms reciente primero)\n  const allConverts = [...convertsFromCollection, ...membersAsConverts]\n    .sort((a, b) => b.baptismDate.toDate().getTime() - a.baptismDate.toDate().getTime());\n\n  // Eliminar duplicados basados en nombre y fecha de bautismo\n  const uniqueConverts = allConverts.filter((convert, index, self) =>\n    index === self.findIndex(c =>\n      c.name === convert.name &&\n      c.baptismDate.toDate().getTime() === convert.baptismDate.toDate().getTime()\n    )\n  );\n\n  return uniqueConverts;\n}\n\nasync function getMissionaryImages(): Promise<MissionaryImage[]> {\n  if (!missionaryImagesCollection) {\n    console.warn('missionaryImagesCollection is not available');\n    return [];\n  }\n  const q = query(missionaryImagesCollection, orderBy('createdAt', 'desc'));\n  const snapshot = await getDocs(q);\n  return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as MissionaryImage));\n}\n\n// --- Components ---\n\nfunction AssignmentsTab({\n  assignments,\n  loading,\n  onRefresh,\n  user,\n}: {\n  assignments: MissionaryAssignment[];\n  loading: boolean;\n  onRefresh: () => void;\n  user: any;\n}) {\n  const handleAddAssignment = async (description: string) => {\n    if (!user) return;\n\n    await addDoc(missionaryAssignmentsCollection, {\n      description,\n      isCompleted: false,\n      createdAt: serverTimestamp(),\n      userId: user.uid,\n    });\n    onRefresh();\n  };\n\n  const handleToggleAssignment = async (id: string, status: boolean) => {\n    const itemRef = doc(missionaryAssignmentsCollection, id);\n    await updateDoc(itemRef, { isCompleted: !status });\n    onRefresh();\n  };\n\n  const handleDeleteAssignment = async (id: string) => {\n    await deleteDoc(doc(missionaryAssignmentsCollection, id));\n    onRefresh();\n  };\n\n  return (\n    <Card>\n      <CardContent className=\"pt-6\">\n        <AnnotationManager\n          title=\"Asignaciones Misionales\"\n          description=\"Tareas y responsabilidades para apoyar la obra en el barrio.\"\n          buttonText=\"Asignacin\"\n          dialogTitle=\"Nueva Asignacin\"\n          placeholder=\"Ej: Acompaar a los misioneros...\"\n          items={assignments.map(assignment => ({\n            id: assignment.id,\n            description: assignment.description,\n            isCompleted: assignment.isCompleted,\n            createdAt: assignment.createdAt,\n            userId: assignment.userId\n          }))}\n          loading={loading}\n          showCheckbox={true}\n          onAdd={handleAddAssignment}\n          onToggle={handleToggleAssignment}\n          onDelete={handleDeleteAssignment}\n          emptyMessage=\"No hay asignaciones.\"\n          currentUserId={user?.uid}\n        />\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction InvestigatorsTab({\n  investigators,\n  newConverts,\n  loading,\n  onRefresh,\n}: {\n  investigators: Investigator[];\n  newConverts: Convert[];\n  loading: boolean;\n  onRefresh: () => void;\n}) {\n  const { toast } = useToast();\n  const [isAddOpen, setAddOpen] = useState(false);\n  const [isLinkOpen, setLinkOpen] = useState(false);\n  const [isPending, startTransition] = useTransition();\n\n  const [selectedInvestigator, setSelectedInvestigator] =\n    useState<Investigator | null>(null);\n\n  // States for Add form\n  const [name, setName] = useState('');\n  const [missionaries, setMissionaries] = useState('');\n  const [addErrors, setAddErrors] = useState<{\n    name?: string[];\n    missionaries?: string[];\n  }>({});\n\n  const recognitionNameRef = useRef<any>(null);\n  const [isRecordingName, setIsRecordingName] = useState(false);\n  const recognitionMissionariesRef = useRef<any>(null);\n  const [isRecordingMissionaries, setIsRecordingMissionaries] = useState(false);\n\n  const startRecordingName = () => {\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      toast({ title: 'Error', description: 'Reconocimiento de voz no soportado en este navegador.', variant: 'destructive' });\n      return;\n    }\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    const recognition = new SpeechRecognition();\n    recognition.continuous = false;\n    recognition.interimResults = false;\n    recognition.lang = 'es-ES';\n    recognition.onstart = () => setIsRecordingName(true);\n    recognition.onresult = (event: any) => {\n      const transcript = event.results[0][0].transcript;\n      setName(prev => prev + ' ' + transcript);\n    };\n    recognition.onend = () => setIsRecordingName(false);\n    recognition.onerror = (event: any) => {\n      console.error('Error en reconocimiento de voz', event.error);\n      setIsRecordingName(false);\n      toast({ title: 'Error', description: 'Error en el reconocimiento de voz.', variant: 'destructive' });\n    };\n    recognitionNameRef.current = recognition;\n    recognition.start();\n  };\n\n  const stopRecordingName = () => {\n    if (recognitionNameRef.current) {\n      recognitionNameRef.current.stop();\n    }\n  };\n\n  const toggleRecordingName = () => {\n    if (isRecordingName) {\n      stopRecordingName();\n    } else {\n      startRecordingName();\n    }\n  };\n\n  const startRecordingMissionaries = () => {\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      toast({ title: 'Error', description: 'Reconocimiento de voz no soportado en este navegador.', variant: 'destructive' });\n      return;\n    }\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    const recognition = new SpeechRecognition();\n    recognition.continuous = false;\n    recognition.interimResults = false;\n    recognition.lang = 'es-ES';\n    recognition.onstart = () => setIsRecordingMissionaries(true);\n    recognition.onresult = (event: any) => {\n      const transcript = event.results[0][0].transcript;\n      setMissionaries(prev => prev + ' ' + transcript);\n    };\n    recognition.onend = () => setIsRecordingMissionaries(false);\n    recognition.onerror = (event: any) => {\n      console.error('Error en reconocimiento de voz', event.error);\n      setIsRecordingMissionaries(false);\n      toast({ title: 'Error', description: 'Error en el reconocimiento de voz.', variant: 'destructive' });\n    };\n    recognitionMissionariesRef.current = recognition;\n    recognition.start();\n  };\n\n  const stopRecordingMissionaries = () => {\n    if (recognitionMissionariesRef.current) {\n      recognitionMissionariesRef.current.stop();\n    }\n  };\n\n  const toggleRecordingMissionaries = () => {\n    if (isRecordingMissionaries) {\n      stopRecordingMissionaries();\n    } else {\n      startRecordingMissionaries();\n    }\n  };\n\n  const handleAddOpenChange = (open: boolean) => {\n    setAddOpen(open);\n    if (open) {\n      startRecordingName();\n    } else if (isRecordingName) {\n      stopRecordingName();\n    }\n  };\n\n  // State for Link form\n  const [selectedConvertId, setSelectedConvertId] = useState('');\n  const [linkErrors, setLinkErrors] = useState<{ convertId?: string[] }>({});\n\n  const investigatorSchema = z.object({\n    name: z.string().min(2, 'El nombre es requerido.'),\n    missionaries: z\n      .string()\n      .min(5, 'El nombre de los misioneros es requerido.'),\n  });\n\n  const linkInvestigatorSchema = z.object({\n    convertId: z.string().min(1, 'Debe seleccionar un converso.'),\n  });\n\n  const handleAddSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    setAddErrors({});\n    const validated = investigatorSchema.safeParse({ name, missionaries });\n    if (!validated.success) {\n      setAddErrors(validated.error.flatten().fieldErrors);\n      return;\n    }\n\n    startTransition(async () => {\n      try {\n        await addDoc(investigatorsCollection, {\n          name: validated.data.name,\n          assignedMissionaries: validated.data.missionaries,\n          status: 'active',\n          createdAt: serverTimestamp(),\n        });\n        toast({ title: 'xito', description: 'Investigador agregado.' });\n        setAddOpen(false);\n        setName('');\n        setMissionaries('');\n        onRefresh();\n      } catch (error) {\n        logger.error({ error, message: 'Error adding investigator' });\n        toast({\n          title: 'Error',\n          description: 'No se pudo agregar el investigador.',\n          variant: 'destructive',\n        });\n      }\n    });\n  };\n\n  const handleLinkSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    setLinkErrors({});\n    if (!selectedInvestigator) return;\n\n    const validated = linkInvestigatorSchema.safeParse({\n      convertId: selectedConvertId,\n    });\n    if (!validated.success) {\n      setLinkErrors(validated.error.flatten().fieldErrors);\n      return;\n    }\n\n    startTransition(async () => {\n      try {\n        const investigatorRef = doc(\n          investigatorsCollection,\n          selectedInvestigator.id\n        );\n        await updateDoc(investigatorRef, {\n          status: 'baptized',\n          convertId: validated.data.convertId,\n          linkedAt: serverTimestamp(),\n        });\n\n        const convertRef = doc(convertsCollection, validated.data.convertId);\n        await updateDoc(convertRef, {\n            missionaryReference: selectedInvestigator.assignedMissionaries,\n        });\n\n        toast({\n          title: 'xito',\n          description: 'Investigador vinculado a converso.',\n        });\n        setLinkOpen(false);\n        setSelectedInvestigator(null);\n        setSelectedConvertId('');\n        onRefresh();\n      } catch (error) {\n        logger.error({\n          error,\n          message: 'Error linking investigator to convert',\n        });\n        toast({\n          title: 'Error',\n          description: 'No se pudo vincular al investigador.',\n          variant: 'destructive',\n        });\n      }\n    });\n  };\n\n  const handleDelete = (investigator: Investigator) => {\n    startTransition(async () => {\n        try {\n            await deleteDoc(doc(investigatorsCollection, investigator.id));\n            toast({ title: 'xito', description: 'Investigador eliminado.' });\n            onRefresh();\n        } catch (error) {\n            logger.error({ error, message: 'Error deleting investigator' });\n            toast({\n                title: 'Error',\n                description: 'No se pudo eliminar al investigador.',\n                variant: 'destructive',\n            });\n        }\n    });\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-start\">\n          <div>\n            <CardTitle>Investigadores</CardTitle>\n            <CardDescription>\n              Personas que estn aprendiendo sobre el evangelio.\n            </CardDescription>\n          </div>\n          <Dialog open={isAddOpen} onOpenChange={handleAddOpenChange}>\n            <DialogTrigger asChild>\n              <Button size=\"sm\">\n                <PlusCircle className=\"mr-2\" />\n                Investigador\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <form onSubmit={handleAddSubmit}>\n                <DialogHeader>\n                  <DialogTitle>Agregar Investigador</DialogTitle>\n                </DialogHeader>\n                <div className=\"py-4 space-y-4\">\n                  <div>\n                    <Label htmlFor=\"name\">Nombre</Label>\n                    <div className=\"flex items-center gap-2\">\n                      <Input\n                        id=\"name\"\n                        name=\"name\"\n                        value={name}\n                        onChange={(e) => setName(e.target.value)}\n                        placeholder=\"Ej: Familia Prez\"\n                      />\n                      <Button type=\"button\" variant=\"outline\" size=\"icon\" onClick={toggleRecordingName}>\n                        <Mic className={`h-4 w-4 ${isRecordingName ? 'text-red-500' : ''}`} />\n                      </Button>\n                    </div>\n                    {addErrors?.name && (\n                      <p className=\"text-sm text-destructive mt-1\">\n                        {addErrors.name[0]}\n                      </p>\n                    )}\n                  </div>\n                  <div>\n                    <Label htmlFor=\"missionaries\">Misioneros Asignados</Label>\n                    <div className=\"flex items-center gap-2\">\n                      <Input\n                        id=\"missionaries\"\n                        name=\"missionaries\"\n                        value={missionaries}\n                        onChange={(e) => setMissionaries(e.target.value)}\n                        placeholder=\"Ej: Elder Smith y Elder Jones\"\n                      />\n                      <Button type=\"button\" variant=\"outline\" size=\"icon\" onClick={toggleRecordingMissionaries}>\n                        <Mic className={`h-4 w-4 ${isRecordingMissionaries ? 'text-red-500' : ''}`} />\n                      </Button>\n                    </div>\n                    {addErrors?.missionaries && (\n                      <p className=\"text-sm text-destructive mt-1\">\n                        {addErrors.missionaries[0]}\n                      </p>\n                    )}\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button type=\"submit\" disabled={isPending}>\n                    {isPending ? 'Guardando...' : 'Guardar'}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {loading ? (\n          <Skeleton className=\"h-40 w-full\" />\n        ) : investigators.length === 0 ? (\n          <p className=\"text-sm text-center py-4 text-muted-foreground\">\n            No hay investigadores activos.\n          </p>\n        ) : (\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Nombre</TableHead>\n                <TableHead>Misioneros</TableHead>\n                <TableHead>Estado</TableHead>\n                <TableHead className=\"text-right\">Accin</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {investigators.map((item) => (\n                <TableRow key={item.id}>\n                  <TableCell className=\"font-medium\">{item.name}</TableCell>\n                  <TableCell>{item.assignedMissionaries}</TableCell>\n                  <TableCell>\n                    {item.status === 'baptized' ? (\n                      <Badge variant=\"default\">Bautizado</Badge>\n                    ) : (\n                      <Badge variant=\"secondary\">Activo</Badge>\n                    )}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <div className='flex justify-end items-center gap-2'>\n                    {item.status === 'active' && (\n                      <Dialog\n                        open={\n                          isLinkOpen && selectedInvestigator?.id === item.id\n                        }\n                        onOpenChange={(isOpen) => {\n                          if (!isOpen) {\n                            setSelectedInvestigator(null);\n                            setSelectedConvertId('');\n                            setLinkErrors({});\n                          }\n                          setLinkOpen(isOpen);\n                        }}\n                      >\n                        <DialogTrigger asChild>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setSelectedInvestigator(item);\n                              setLinkOpen(true);\n                            }}\n                          >\n                            <LinkIcon className=\"mr-2 h-4 w-4\" />\n                            Vincular\n                          </Button>\n                        </DialogTrigger>\n                        <DialogContent>\n                          <form onSubmit={handleLinkSubmit}>\n                            <DialogHeader>\n                              <DialogTitle>\n                                Vincular a Nuevo Converso\n                              </DialogTitle>\n                            </DialogHeader>\n                            <div className=\"py-4 space-y-4\">\n                              <p>\n                                Selecciona el registro del nuevo converso que\n                                corresponde a <strong>{item.name}</strong>.\n                              </p>\n                              <Label htmlFor=\"convertId\">Nuevo Converso</Label>\n                              <Select\n                                name=\"convertId\"\n                                onValueChange={setSelectedConvertId}\n                              >\n                                <SelectTrigger>\n                                  <SelectValue placeholder=\"Selecciona un converso...\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  {newConverts.map((c) => (\n                                    <SelectItem key={c.id} value={c.id}>\n                                      {c.name}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                              {linkErrors?.convertId && (\n                                <p className=\"text-sm text-destructive mt-1\">\n                                  {linkErrors.convertId[0]}\n                                </p>\n                              )}\n                            </div>\n                            <DialogFooter>\n                              <Button type=\"submit\" disabled={isPending}>\n                                {isPending ? 'Vinculando...' : 'Vincular'}\n                              </Button>\n                            </DialogFooter>\n                          </form>\n                        </DialogContent>\n                      </Dialog>\n                    )}\n                     <AlertDialog>\n                        <AlertDialogTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\">\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent>\n                            <AlertDialogHeader>\n                            <AlertDialogTitle>Ests seguro?</AlertDialogTitle>\n                            <AlertDialogDescription>\n                                Esta accin eliminar permanentemente el registro del investigador <strong>{item.name}</strong>.\n                            </AlertDialogDescription>\n                            </AlertDialogHeader>\n                            <AlertDialogFooter>\n                            <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                            <AlertDialogAction\n                                onClick={() => handleDelete(item)}\n                                className=\"bg-destructive hover:bg-destructive/90\"\n                            >\n                                Eliminar\n                            </AlertDialogAction>\n                            </AlertDialogFooter>\n                        </AlertDialogContent>\n                    </AlertDialog>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction ImagesTab({\n  images,\n  loading,\n  onRefresh,\n}: {\n  images: MissionaryImage[];\n  loading: boolean;\n  onRefresh: () => void;\n}) {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [isPending, startTransition] = useTransition();\n  const [uploadedFiles, setUploadedFiles] = useState<{ file: File; url: string; description: string; isGenerating: boolean }[]>([]);\n\n  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files) return;\n\n    for (const file of Array.from(files)) {\n      if (!file.type.startsWith('image/')) continue;\n\n      // Upload to Firebase Storage\n      const storageRef = ref(storage, `missionary-images/${Date.now()}-${file.name}`);\n      const uploadTask = uploadBytesResumable(storageRef, file);\n\n      uploadTask.on('state_changed',\n        (snapshot) => {\n          // Progress\n        },\n        (error) => {\n          console.error('Upload error:', error);\n          toast({ title: 'Error', description: 'Error al subir la imagen.', variant: 'destructive' });\n        },\n        async () => {\n          const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);\n\n          // Convert to base64 for AI\n          const reader = new FileReader();\n          reader.onload = async (e) => {\n            const base64 = e.target?.result as string;\n            setUploadedFiles(prev => [...prev, { file, url: downloadURL, description: '', isGenerating: true }]);\n\n            try {\n              const result = await analyzeImage({ imageData: base64 });\n              setUploadedFiles(prev =>\n                prev.map(item =>\n                  item.url === downloadURL\n                    ? { ...item, description: result.description, isGenerating: false }\n                    : item\n                )\n              );\n            } catch (error: any) {\n              console.error('AI analysis error:', error);\n              const errorMessage = error.message?.includes('API key') || error.message?.includes('GEMINI_API_KEY')\n                ? 'API key de IA no configurada. Configure GEMINI_API_KEY en su archivo .env.local'\n                : 'Error al generar descripcin automtica';\n              setUploadedFiles(prev =>\n                prev.map(item =>\n                  item.url === downloadURL\n                    ? { ...item, description: errorMessage, isGenerating: false }\n                    : item\n                )\n              );\n            }\n          };\n          reader.readAsDataURL(file);\n        }\n      );\n    }\n  };\n\n  const handleSave = async (item: { file: File; url: string; description: string; isGenerating: boolean }) => {\n    if (item.isGenerating) return;\n    if (!missionaryImagesCollection) {\n      toast({ title: 'Error', description: 'Coleccin no disponible.', variant: 'destructive' });\n      return;\n    }\n\n    startTransition(async () => {\n      try {\n        await addDoc(missionaryImagesCollection, {\n          imageUrl: item.url,\n          description: item.description,\n          createdAt: serverTimestamp(),\n          createdBy: user?.uid || 'unknown',\n        });\n        toast({ title: 'xito', description: 'Imagen guardada.' });\n        setUploadedFiles(prev => prev.filter(i => i.url !== item.url));\n        onRefresh();\n      } catch (error) {\n        logger.error({ error, message: 'Error saving missionary image' });\n        toast({ title: 'Error', description: 'No se pudo guardar la imagen.', variant: 'destructive' });\n      }\n    });\n  };\n\n  const handleDeletePending = (url: string) => {\n    setUploadedFiles(prev => prev.filter(i => i.url !== url));\n  };\n\n  const handleEdit = async (id: string, newDescription: string) => {\n    if (!missionaryImagesCollection) {\n      toast({ title: 'Error', description: 'Coleccin no disponible.', variant: 'destructive' });\n      return;\n    }\n    startTransition(async () => {\n      try {\n        const itemRef = doc(missionaryImagesCollection, id);\n        await updateDoc(itemRef, { description: newDescription });\n        toast({ title: 'xito', description: 'Descripcin actualizada.' });\n        onRefresh();\n      } catch (error) {\n        logger.error({ error, message: 'Error updating image description' });\n        toast({ title: 'Error', description: 'No se pudo actualizar la descripcin.', variant: 'destructive' });\n      }\n    });\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!missionaryImagesCollection) {\n      toast({ title: 'Error', description: 'Coleccin no disponible.', variant: 'destructive' });\n      return;\n    }\n    startTransition(async () => {\n      try {\n        await deleteDoc(doc(missionaryImagesCollection, id));\n        toast({ title: 'xito', description: 'Imagen eliminada.' });\n        onRefresh();\n      } catch (error) {\n        logger.error({ error, message: 'Error deleting missionary image' });\n        toast({ title: 'Error', description: 'No se pudo eliminar la imagen.', variant: 'destructive' });\n      }\n    });\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-start\">\n          <div>\n            <CardTitle>Imgenes Misionales</CardTitle>\n            <CardDescription>\n              Sube imgenes y la IA generar descripciones automticamente.\n            </CardDescription>\n          </div>\n          <div>\n            <Input\n              type=\"file\"\n              accept=\"image/*\"\n              multiple\n              onChange={handleFileSelect}\n              className=\"hidden\"\n              id=\"image-upload\"\n            />\n            <Label htmlFor=\"image-upload\">\n              <Button size=\"sm\" asChild>\n                <span>\n                  <PlusCircle className=\"mr-2\" />\n                  Subir Imgenes\n                </span>\n              </Button>\n            </Label>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {loading ? (\n          <Skeleton className=\"h-24 w-full\" />\n        ) : (\n          <div className=\"space-y-6\">\n            {/* Pending uploads */}\n            {uploadedFiles.length > 0 && (\n              <div>\n                <h3 className=\"text-lg font-semibold mb-4\">Imgenes Pendientes</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {uploadedFiles.map((item) => (\n                    <Card key={item.url}>\n                      <CardContent className=\"p-4\">\n                        <img src={item.url} alt=\"Uploaded\" className=\"w-full h-32 object-cover rounded mb-2\" />\n                        <Textarea\n                          value={item.description}\n                          onChange={(e) => setUploadedFiles(prev =>\n                            prev.map(i => i.url === item.url ? { ...i, description: e.target.value } : i)\n                          )}\n                          placeholder={item.isGenerating ? \"Generando descripcin...\" : \"Descripcin\"}\n                          disabled={item.isGenerating}\n                          className=\"mb-2\"\n                        />\n                        <div className=\"flex gap-2\">\n                          <Button\n                            size=\"sm\"\n                            onClick={() => handleSave(item)}\n                            disabled={item.isGenerating || isPending}\n                          >\n                            Guardar\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"destructive\"\n                            onClick={() => handleDeletePending(item.url)}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Saved images */}\n            {images.length > 0 && (\n              <div>\n                <h3 className=\"text-lg font-semibold mb-4\">Imgenes Guardadas</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {images.map((item) => (\n                    <Card key={item.id}>\n                      <CardContent className=\"p-4\">\n                        <img src={item.imageUrl} alt=\"Missionary\" className=\"w-full h-32 object-cover rounded mb-2\" />\n                        <Textarea\n                          value={item.description}\n                          onChange={(e) => handleEdit(item.id, e.target.value)}\n                          className=\"mb-2\"\n                        />\n                        <Button\n                          size=\"sm\"\n                          variant=\"destructive\"\n                          onClick={() => handleDelete(item.id)}\n                          disabled={isPending}\n                        >\n                          <Trash2 className=\"h-4 w-4 mr-2\" />\n                          Eliminar\n                        </Button>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {uploadedFiles.length === 0 && images.length === 0 && (\n              <p className=\"text-sm text-center py-4 text-muted-foreground\">\n                No hay imgenes. Sube algunas para comenzar.\n              </p>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction NewConvertsTab({\n  friendships,\n  newConverts,\n  members,\n  loading,\n  onRefresh,\n}: {\n  friendships: NewConvertFriendship[];\n  newConverts: Convert[];\n  members: Member[];\n  loading: boolean;\n  onRefresh: () => void;\n}) {\n  const router = useRouter();\n  const { toast } = useToast();\n  const [isFormOpen, setFormOpen] = useState(false);\n  const [isPending, startTransition] = useTransition();\n\n  const [selectedConvert, setSelectedConvert] = useState<Convert | null>(null);\n  const [selectedFriendship, setSelectedFriendship] = useState<NewConvertFriendship | null>(null);\n\n\n  const handleOpenForm = (item: Convert | NewConvertFriendship) => {\n    if ('convertName' in item) { // It's a Friendship object\n      setSelectedFriendship(item);\n      setSelectedConvert(null);\n    } else { // It's a Convert object\n      setSelectedConvert(item);\n      setSelectedFriendship(null);\n    }\n    setFormOpen(true);\n  };\n\n  const handleEditMember = (item: Convert | NewConvertFriendship) => {\n    let memberId = '';\n    if ('convertName' in item) {\n      // It's a Friendship, find the convert\n      const convert = newConverts.find(c => c.id === item.convertId);\n      memberId = convert?.memberId || '';\n    } else {\n      // It's a Convert\n      memberId = item.memberId || '';\n    }\n    if (memberId) {\n      router.push(`/members/${memberId}`);\n    }\n  };\n  \n  const handleCloseForm = () => {\n    setFormOpen(false);\n    setSelectedConvert(null);\n    setSelectedFriendship(null);\n  };\n\n  const handleFormSubmit = () => {\n    handleCloseForm();\n    onRefresh();\n  };\n\n\n  const getMemberName = (memberId: string) => {\n    const m = members.find((mm) => mm.id === memberId);\n    return m ? `${m.firstName} ${m.lastName}`.trim() : memberId;\n  };\n\n  return (\n    <>\n    <Card>\n      <CardHeader>\n        <CardTitle>Nuevos Conversos</CardTitle>\n        <CardDescription>\n          Lista de nuevos conversos y sus amigos asignados del qurum.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        {loading ? (\n          <Skeleton className=\"h-40 w-full\" />\n        ) : newConverts.length === 0 ? (\n          <p className=\"text-sm text-center py-4 text-muted-foreground\">\n            No hay nuevos conversos.\n          </p>\n        ) : (\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Nuevo Converso</TableHead>\n                <TableHead>Amigo(s) del Qurum</TableHead>\n                <TableHead className=\"text-right\">Accin</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {newConverts.map((item) => {\n                const friendship = friendships.find(f => f.convertId === item.id);\n                return (\n                  <TableRow key={item.id}>\n                    <TableCell className=\"font-medium\">{item.name}</TableCell>\n                    <TableCell>\n                      {friendship ? friendship.friends.map(getMemberName).join(', ') : <span className=\"text-muted-foreground italic\">Pendiente</span>}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex justify-end gap-2\">\n                        {friendship ? (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleOpenForm(friendship)}\n                          >\n                            <UserPlus className=\"mr-2 h-4 w-4\" />\n                            Editar Amigos\n                          </Button>\n                        ) : (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleOpenForm(item)}\n                          >\n                            <UserPlus className=\"mr-2 h-4 w-4\" />\n                            Asignar Amigo\n                          </Button>\n                        )}\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                );\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n\n    <FriendshipForm\n        isOpen={isFormOpen}\n        onOpenChange={handleCloseForm}\n        onFormSubmit={handleFormSubmit}\n        convert={selectedConvert}\n        friendship={selectedFriendship}\n    />\n    </>\n  );\n}\n\nexport default function MissionaryWorkPage() {\n  const [assignments, setAssignments] = useState<MissionaryAssignment[]>([]);\n  const [investigators, setInvestigators] = useState<Investigator[]>([]);\n  const [friendships, setFriendships] = useState<NewConvertFriendship[]>([]);\n  const [newConvertsWithoutFriends, setNewConvertsWithoutFriends] = useState<\n    Convert[]\n  >([]);\n  const [members, setMembers] = useState<Member[]>([]);\n  const [missionaryImages, setMissionaryImages] = useState<MissionaryImage[]>([]);\n  const [annotations, setAnnotations] = useState<Annotation[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [loadingAnnotations, setLoadingAnnotations] = useState(true);\n  const { user, loading: authLoading } = useAuth();\n  const { toast } = useToast();\n\n  const fetchData = useCallback(async () => {\n    setLoading(true);\n    try {\n      const [\n        assignmentsData,\n        investigatorsData,\n        friendshipsData,\n        newConvertsData,\n        membersData,\n        imagesData,\n      ] = await Promise.all([\n        getMissionaryAssignments(),\n        getInvestigators(),\n        getNewConvertFriendships(),\n        getNewConvertsWithoutFriends(),\n        getMembersForSelector(true),\n        getMissionaryImages(),\n      ]);\n      setAssignments(assignmentsData);\n      setInvestigators(investigatorsData);\n      setFriendships(friendshipsData);\n      setNewConvertsWithoutFriends(newConvertsData);\n      setMembers(membersData);\n      setMissionaryImages(imagesData);\n    } catch (error) {\n      console.error('Failed to fetch missionary work data:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const fetchAnnotations = useCallback(async () => {\n    setLoadingAnnotations(true);\n    try {\n      const q = query(\n        annotationsCollection,\n        where('source', '==', 'missionary-work'),\n        where('isResolved', '==', false),\n        orderBy('createdAt', 'desc')\n      );\n      const snapshot = await getDocs(q);\n      const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Annotation));\n      setAnnotations(data);\n    } catch (error) {\n      console.error('Error fetching missionary-work annotations:', error);\n      setAnnotations([]);\n    } finally {\n      setLoadingAnnotations(false);\n    }\n  }, []);\n\n  const handleDeleteAnnotation = async (id: string) => {\n    try {\n      await deleteDoc(doc(annotationsCollection, id));\n      toast({ title: 'xito', description: 'Anotacin eliminada.' });\n      fetchAnnotations();\n    } catch (error) {\n      console.error('Error deleting annotation:', error);\n      toast({ title: 'Error', description: 'No se pudo eliminar la anotacin.', variant: 'destructive' });\n    }\n  };\n\n  useEffect(() => {\n    if (authLoading || !user) return; // Wait for authentication\n    fetchData();\n    fetchAnnotations();\n  }, [authLoading, user, fetchData, fetchAnnotations]);\n\n  const availableNewConverts = newConvertsWithoutFriends.filter(\n    (c) => !investigators.some((i) => i.convertId === c.id)\n  );\n\n  return (\n    <section className=\"page-section\">\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center\">\n        <HandHeart className=\"h-8 w-8 text-primary\" />\n        <div className=\"flex flex-col gap-1\">\n          <h1 className=\"text-balance text-fluid-title font-semibold\">Obra Misional</h1>\n          <p className=\"text-balance text-fluid-subtitle text-muted-foreground\">\n            Coordina y da seguimiento a los esfuerzos misionales del qurum.\n          </p>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"assignments\">\n        <TabsList className=\"grid w-full grid-cols-1 sm:grid-cols-4 h-auto sm:h-10\">\n          <TabsTrigger value=\"assignments\">Asignaciones</TabsTrigger>\n          <TabsTrigger value=\"investigators\">Investigadores</TabsTrigger>\n          <TabsTrigger value=\"images\">Imgenes</TabsTrigger>\n          <TabsTrigger value=\"new_converts\">Nuevos Conversos</TabsTrigger>\n        </TabsList>\n        <TabsContent value=\"assignments\">\n          <AssignmentsTab\n            assignments={assignments}\n            loading={loading}\n            onRefresh={fetchData}\n            user={user}\n          />\n        </TabsContent>\n        <TabsContent value=\"investigators\">\n          <InvestigatorsTab\n            investigators={investigators}\n            newConverts={availableNewConverts}\n            loading={loading}\n            onRefresh={fetchData}\n          />\n        </TabsContent>\n        <TabsContent value=\"images\">\n          <ImagesTab\n            images={missionaryImages}\n            loading={loading}\n            onRefresh={fetchData}\n          />\n        </TabsContent>\n        <TabsContent value=\"new_converts\">\n          <NewConvertsTab\n            friendships={friendships}\n            newConverts={newConvertsWithoutFriends}\n            members={members}\n            loading={loading}\n            onRefresh={fetchData}\n          />\n        </TabsContent>\n      </Tabs>\n\n      <VoiceAnnotations\n        title=\"Anotaciones de Obra Misional\"\n        description=\"Notas y recordatorios sobre los esfuerzos misionales del qurum con reconocimiento de voz.\"\n        source=\"missionary-work\"\n        annotations={annotations}\n        isLoading={loadingAnnotations}\n        onAnnotationAdded={fetchAnnotations}\n        onAnnotationToggled={fetchAnnotations}\n        onDeleteAnnotation={handleDeleteAnnotation}\n        currentUserId={user?.uid}\n      />\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Preguntas Frecuentes</CardTitle>\n          <CardDescription>\n            Respuestas a dudas comunes sobre el rol del qurum en la obra\n            misional.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            {faqData.map((faq, index) => (\n              <AccordionItem value={`item-${index}`} key={index}>\n                <AccordionTrigger className=\"text-xl\">{faq.question}</AccordionTrigger>\n                <AccordionContent>\n                  <p className=\"text-muted-foreground leading-relaxed text-lg\">\n                    {faq.answer}\n                  </p>\n                </AccordionContent>\n              </AccordionItem>\n            ))}\n          </Accordion>\n        </CardContent>\n      </Card>\n    </section>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\observations\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1547,"column":31,"nodeType":"JSXOpeningElement","endLine":1555,"endColumn":33},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1697,"column":29,"nodeType":"JSXOpeningElement","endLine":1705,"endColumn":31},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1911,"column":31,"nodeType":"JSXOpeningElement","endLine":1919,"endColumn":33},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":2061,"column":29,"nodeType":"JSXOpeningElement","endLine":2069,"endColumn":31},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":2275,"column":31,"nodeType":"JSXOpeningElement","endLine":2283,"endColumn":33},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":2425,"column":29,"nodeType":"JSXOpeningElement","endLine":2433,"endColumn":31},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":2635,"column":31,"nodeType":"JSXOpeningElement","endLine":2643,"endColumn":33},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":2759,"column":29,"nodeType":"JSXOpeningElement","endLine":2767,"endColumn":31},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":2935,"column":29,"nodeType":"JSXOpeningElement","endLine":2943,"endColumn":31},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":3057,"column":27,"nodeType":"JSXOpeningElement","endLine":3065,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\n\n\nimport { useState, useEffect, useRef, useMemo, useCallback } from 'react';\n\nimport type { ChangeEvent } from 'react';\n\nimport { Users, AlertTriangle, UserX, UserCheck, Eye, ChevronUp, HeartPulse, Plus, Trash2, Loader2, Check, ChevronsUpDown, X, Pencil } from 'lucide-react';\n\nimport {\n\n  Card,\n\n  CardContent,\n\n  CardDescription,\n\n  CardHeader,\n\n  CardTitle,\n\n} from '@/components/ui/card';\n\nimport {\n\n  Table,\n\n  TableBody,\n\n  TableCell,\n\n  TableHead,\n\n  TableHeader,\n\n  TableRow,\n\n} from '@/components/ui/table';\n\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\n\nimport { Button } from '@/components/ui/button';\n\nimport { Badge } from '@/components/ui/badge';\n\nimport { Skeleton } from '@/components/ui/skeleton';\n\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\n\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\n\nimport { Input } from '@/components/ui/input';\n\nimport { Textarea } from '@/components/ui/textarea';\n\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\n\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem } from '@/components/ui/command';\n\nimport { cn } from '@/lib/utils';\n\nimport { useForm } from 'react-hook-form';\n\nimport { zodResolver } from '@hookform/resolvers/zod';\n\nimport { z } from 'zod';\n\nimport { useToast } from '@/hooks/use-toast';\n\nimport { useAuth } from '@/contexts/auth-context';\n\nimport type { Member, Companionship, Family, HealthConcern } from '@/lib/types';\n\nimport { OrdinanceLabels } from '@/lib/types';\n\nimport { getMembersByStatus } from '@/lib/members-data';\n\nimport { fetchHealthConcerns, createHealthConcern, deleteHealthConcern, updateHealthConcern } from '@/lib/health-concerns';\n\nimport { format } from 'date-fns';\n\nimport { es } from 'date-fns/locale';\n\nimport { useRouter } from 'next/navigation';\n\nimport { getDocs, query, orderBy } from 'firebase/firestore';\n\nimport { ministeringCollection } from '@/lib/collections';\n\n\n\nconst statusConfig = {\n\n  active: {\n\n    label: 'Activo',\n\n    variant: 'default' as const,\n\n    icon: UserCheck,\n\n    color: 'text-green-600'\n\n  },\n\n  less_active: {\n\n    label: 'Menos Activo',\n\n    variant: 'secondary' as const,\n\n    icon: UserX,\n\n    color: 'text-yellow-600'\n\n  },\n\n  inactive: {\n\n    label: 'Inactivo',\n\n    variant: 'destructive' as const,\n\n    icon: UserX,\n\n    color: 'text-red-600'\n\n  }\n\n};\n\nconst HEALTH_PHOTO_MAX_SIZE = 5 * 1024 * 1024;\n\nconst healthConcernSchema = z.object({\n  firstName: z.string().min(2, { message: 'El nombre es obligatorio.' }),\n  lastName: z.string().min(2, { message: 'El apellido es obligatorio.' }),\n  address: z.string().min(5, { message: 'La direccin es obligatoria.' }),\n  observation: z.string().min(5, { message: 'La observacin es obligatoria.' }),\n  helperIds: z.array(z.string()).min(1, { message: 'Selecciona al menos un miembro de apoyo.' }),\n});\n\ntype HealthConcernFormValues = z.infer<typeof healthConcernSchema>;\nconst DEFAULT_HEALTH_FORM_VALUES: HealthConcernFormValues = {\n  firstName: '',\n  lastName: '',\n  address: '',\n  observation: '',\n  helperIds: [],\n};\n\nconst getInitials = (first: string, last: string) => `${(first?.[0] ?? '').toUpperCase()}${(last?.[0] ?? '').toUpperCase()}`.trim() || 'PS';\n\n\n\n\nexport default function ObservationsPage() {\n\n  const { user, loading: authLoading } = useAuth();\n\n  const { toast } = useToast();\n\n  const router = useRouter();\n\n  const [members, setMembers] = useState<Member[]>([]);\n\n  const [companionships, setCompanionships] = useState<Companionship[]>([]);\n\n  const [loading, setLoading] = useState(true);\n\n  const [showScrollTop, setShowScrollTop] = useState(false);\n\n\n\n  const [healthConcerns, setHealthConcerns] = useState<HealthConcern[]>([]);\n\n  const [healthLoading, setHealthLoading] = useState(true);\n\n  const [healthDialogOpen, setHealthDialogOpen] = useState(false);\n\n  const [savingHealthConcern, setSavingHealthConcern] = useState(false);\n\n  const [deletingHealthConcernId, setDeletingHealthConcernId] = useState<string | null>(null);\n\n  const [photoPreview, setPhotoPreview] = useState<string | null>(null);\n\n  const [photoFile, setPhotoFile] = useState<File | null>(null);\n\n  const [helperPickerOpen, setHelperPickerOpen] = useState(false);\n\n  const [editingHealthConcern, setEditingHealthConcern] = useState<HealthConcern | null>(null);\n\n  const [removeExistingPhoto, setRemoveExistingPhoto] = useState(false);\n\n\n\n  const healthConcernsRef = useRef<HTMLDivElement>(null);\n\n  const withoutEndowmentRef = useRef<HTMLDivElement>(null);\n  const withoutElderOrdinationRef = useRef<HTMLDivElement>(null);\n\n  const withoutHigherPriesthoodRef = useRef<HTMLDivElement>(null);\n\n  const withoutMinisteringRef = useRef<HTMLDivElement>(null);\n\n  const inactiveRef = useRef<HTMLDivElement>(null);\n\n  const familyFocusCompanionshipsRef = useRef<HTMLDivElement>(null);\n\n  const problematicCompanionshipsRef = useRef<HTMLDivElement>(null);\n\n  const photoInputRef = useRef<HTMLInputElement>(null);\n\n  const healthForm = useForm<HealthConcernFormValues>({\n\n    resolver: zodResolver(healthConcernSchema),\n\n    defaultValues: DEFAULT_HEALTH_FORM_VALUES,\n\n  });\n\n  const watchFirstName = healthForm.watch('firstName');\n\n  const watchLastName = healthForm.watch('lastName');\n\n  const isEditingHealthConcern = Boolean(editingHealthConcern);\n\n\n\n  const membersById = useMemo(() => {\n\n    const map = new Map<string, Member>();\n\n    members.forEach(member => {\n\n      map.set(member.id, member);\n\n    });\n\n    return map;\n\n  }, [members]);\n\n\n\n  const fetchMembers = useCallback(async () => {\n\n    if (authLoading || !user) return;\n\n\n\n    setLoading(true);\n\n    try {\n\n      const allMembers = await getMembersByStatus();\n\n      setMembers(allMembers);\n\n    } catch (error) {\n\n      console.error('Error fetching members:', error);\n\n      toast({\n\n        title: 'Error',\n\n        description: 'No se pudieron cargar los miembros.',\n\n        variant: 'destructive'\n\n      });\n\n    } finally {\n\n      setLoading(false);\n\n    }\n\n  }, [authLoading, user, toast]);\n\n\n\n  const fetchCompanionships = useCallback(async () => {\n\n    try {\n\n      const q = query(ministeringCollection, orderBy('companions'));\n\n      const snapshot = await getDocs(q);\n\n      const comps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Companionship));\n\n      setCompanionships(comps);\n\n    } catch (error) {\n\n      console.error('Error fetching companionships:', error);\n\n      toast({\n\n        title: 'Error',\n\n        description: 'No se pudieron cargar las compaeras.',\n\n        variant: 'destructive'\n\n      });\n\n    }\n\n  }, [toast]);\n  const loadHealthConcerns = useCallback(async () => {\n\n    if (authLoading || !user) {\n\n      return;\n\n    }\n\n\n\n    setHealthLoading(true);\n\n\n\n    try {\n\n      const healthData = await fetchHealthConcerns();\n\n      setHealthConcerns(healthData);\n\n    } catch (error) {\n\n      console.error('Error fetching health concerns:', error);\n\n      toast({\n\n        title: 'Error',\n\n        description: 'No se pudieron cargar los registros de salud.',\n\n        variant: 'destructive'\n\n      });\n\n    } finally {\n\n      setHealthLoading(false);\n\n    }\n\n\n\n  }, [authLoading, user, toast]);\n\n\n\n\n\n\n\n\n\n\n  useEffect(() => {\n\n\n\n    fetchMembers();\n\n\n\n    fetchCompanionships();\n\n\n\n    loadHealthConcerns();\n\n\n\n  }, [fetchMembers, fetchCompanionships, loadHealthConcerns]);\n\n\n\n\n  useEffect(() => {\n\n    const handleScroll = () => {\n\n      setShowScrollTop(window.scrollY > 300);\n\n    };\n\n    window.addEventListener('scroll', handleScroll);\n\n    return () => window.removeEventListener('scroll', handleScroll);\n\n  }, []);\n\n\n\n  const handleViewProfile = (memberId: string) => {\n\n    router.push(`/members/${memberId}`);\n\n  };\n\n\n\n  const resetHealthForm = () => {\n\n    healthForm.reset(DEFAULT_HEALTH_FORM_VALUES);\n\n    if (photoPreview && photoPreview.startsWith('blob:')) {\n\n      URL.revokeObjectURL(photoPreview);\n\n    }\n\n    setPhotoPreview(null);\n\n    setPhotoFile(null);\n\n    setHelperPickerOpen(false);\n\n    setEditingHealthConcern(null);\n\n    setRemoveExistingPhoto(false);\n\n    if (photoInputRef.current) {\n\n      photoInputRef.current.value = '';\n\n    }\n\n  };\n\n\n\n  const handleOpenHealthDialog = (concern?: HealthConcern) => {\n\n    if (photoPreview && photoPreview.startsWith('blob:')) {\n\n      URL.revokeObjectURL(photoPreview);\n\n    }\n\n    if (concern) {\n\n      setEditingHealthConcern(concern);\n\n      healthForm.reset({\n\n        firstName: concern.firstName ?? '',\n\n        lastName: concern.lastName ?? '',\n\n        address: concern.address ?? '',\n\n        observation: concern.observation ?? '',\n\n        helperIds: Array.isArray(concern.helperIds) ? concern.helperIds : [],\n\n      });\n\n      setPhotoPreview(concern.photoURL ?? null);\n\n      setPhotoFile(null);\n\n      setRemoveExistingPhoto(false);\n\n      setHelperPickerOpen(false);\n\n      if (photoInputRef.current) {\n\n        photoInputRef.current.value = '';\n\n      }\n\n    } else {\n\n      resetHealthForm();\n\n    }\n\n    setHealthDialogOpen(true);\n\n  };\n\n\n\n  const handlePhotoChange = (event: ChangeEvent<HTMLInputElement>) => {\n\n    const file = event.target.files?.[0];\n\n    if (!file) {\n\n      return;\n\n    }\n\n\n\n    if (file.size > HEALTH_PHOTO_MAX_SIZE) {\n\n      toast({\n\n        title: 'Imagen demasiado grande',\n\n        description: 'El tamao mximo permitido es de 5MB.',\n\n        variant: 'destructive'\n\n      });\n\n      if (photoInputRef.current) {\n\n        photoInputRef.current.value = '';\n\n      }\n\n      return;\n\n    }\n\n\n\n    if (photoPreview && photoPreview.startsWith('blob:')) {\n\n      URL.revokeObjectURL(photoPreview);\n\n    }\n\n\n\n    const previewUrl = URL.createObjectURL(file);\n\n    setPhotoPreview(previewUrl);\n\n    setPhotoFile(file);\n\n    setRemoveExistingPhoto(false);\n\n  };\n\n\n\n  const handleRemovePhoto = () => {\n\n    if (photoFile) {\n\n      if (photoPreview && photoPreview.startsWith('blob:')) {\n\n        URL.revokeObjectURL(photoPreview);\n\n      }\n\n      setPhotoFile(null);\n\n      if (editingHealthConcern?.photoURL) {\n\n        setPhotoPreview(editingHealthConcern.photoURL);\n\n        setRemoveExistingPhoto(false);\n\n      } else {\n\n        setPhotoPreview(null);\n\n      }\n\n    } else {\n\n      if (photoPreview && photoPreview.startsWith('blob:')) {\n\n        URL.revokeObjectURL(photoPreview);\n\n      }\n\n      setPhotoPreview(null);\n\n      setRemoveExistingPhoto(Boolean(editingHealthConcern?.photoURL));\n\n    }\n\n    setPhotoFile(null);\n\n    if (photoInputRef.current) {\n\n      photoInputRef.current.value = '';\n\n    }\n\n  };\n\n\n\n  const toggleHelper = (memberId: string) => {\n\n    const currentHelpers = healthForm.getValues('helperIds');\n\n    const updatedHelpers = currentHelpers.includes(memberId)\n\n      ? currentHelpers.filter(id => id !== memberId)\n\n      : [...currentHelpers, memberId];\n\n    healthForm.setValue('helperIds', updatedHelpers, { shouldValidate: true });\n\n  };\n\n\n\n  const handleHealthSubmit = async (values: HealthConcernFormValues) => {\n\n    if (!user) {\n\n      toast({\n\n        title: 'Error',\n\n        description: 'Debes iniciar sesin para guardar.',\n\n        variant: 'destructive'\n\n      });\n\n      return;\n\n    }\n\n\n\n    setSavingHealthConcern(true);\n\n\n\n    try {\n\n      const helperNames = values.helperIds.map((id) => {\n\n        const helper = membersById.get(id);\n\n        if (helper) {\n\n          return `${helper.firstName} ${helper.lastName}`;\n\n        }\n\n        return 'Miembro sin registro';\n\n      });\n\n\n\n      if (editingHealthConcern) {\n\n        const updatedConcern = await updateHealthConcern({\n\n          concern: editingHealthConcern,\n\n          firstName: values.firstName.trim(),\n\n          lastName: values.lastName.trim(),\n\n          address: values.address.trim(),\n\n          observation: values.observation.trim(),\n\n          helperIds: values.helperIds,\n\n          helperNames,\n\n          performedBy: user.uid,\n\n          photoFile,\n\n          removePhoto: removeExistingPhoto && !photoFile,\n\n        });\n\n\n\n        setHealthConcerns((prev) => prev.map((item) => (item.id === updatedConcern.id ? updatedConcern : item)));\n\n\n\n        toast({\n\n          title: 'Registro actualizado',\n\n          description: 'La informacin de salud se actualiz correctamente.',\n\n        });\n\n      } else {\n\n        const newConcern = await createHealthConcern({\n\n          firstName: values.firstName.trim(),\n\n          lastName: values.lastName.trim(),\n\n          address: values.address.trim(),\n\n          observation: values.observation.trim(),\n\n          helperIds: values.helperIds,\n\n          helperNames,\n\n          createdBy: user.uid,\n\n          photoFile,\n\n        });\n\n\n\n        setHealthConcerns((prev) => [newConcern, ...prev]);\n\n\n\n        toast({\n\n          title: 'Registro creado',\n\n          description: 'Se agreg el registro de salud correctamente.',\n\n        });\n\n      }\n\n\n\n      setHealthDialogOpen(false);\n\n      resetHealthForm();\n\n    } catch (error) {\n\n      console.error('Error saving health concern:', error);\n\n      toast({\n\n        title: 'Error',\n\n        description: 'No se pudo guardar el registro. Intntalo de nuevo.',\n\n        variant: 'destructive'\n\n      });\n\n    } finally {\n\n      setSavingHealthConcern(false);\n\n    }\n\n  };\n\n\n\n  const handleDeleteHealthConcern = async (concern: HealthConcern) => {\n\n    const confirmed = window.confirm(`Eliminar el registro de ${concern.firstName} ${concern.lastName}?`);\n\n    if (!confirmed) {\n\n      return;\n\n    }\n\n\n\n    setDeletingHealthConcernId(concern.id);\n\n\n\n    try {\n\n      await deleteHealthConcern(concern.id, concern.photoPath);\n\n      setHealthConcerns((prev) => prev.filter((item) => item.id !== concern.id));\n\n      if (editingHealthConcern?.id === concern.id) {\n\n        resetHealthForm();\n\n        setHealthDialogOpen(false);\n\n      }\n\n      toast({\n\n        title: 'Registro eliminado',\n\n        description: 'Se elimin el registro de salud correctamente.',\n\n      });\n\n    } catch (error) {\n\n      console.error('Error deleting health concern:', error);\n\n      toast({\n\n        title: 'Error',\n\n        description: 'No se pudo eliminar el registro. Intntalo de nuevo.',\n\n        variant: 'destructive'\n\n      });\n\n    } finally {\n\n      setDeletingHealthConcernId(null);\n\n    }\n\n  };\n\n\n\n  // Filtrar miembros por criterios\n\n  const membersWithoutEndowment = members.filter(member =>\n\n    !member.ordinances || !member.ordinances.includes('endowment')\n\n  );\n\n\n\n  const membersWithoutElderOrdination = members.filter(member =>\n\n    !member.ordinances || !member.ordinances.includes('elder_ordination')\n\n  );\n\n\n\n  const membersWithoutHigherPriesthood = members.filter(member =>\n\n    !member.ordinances || (!member.ordinances.includes('elder_ordination') && !member.ordinances.includes('high_priest_ordination'))\n\n  );\n\n\n\n  const membersWithoutMinistering = members.filter(member =>\n\n    !member.ministeringTeachers || member.ministeringTeachers.length === 0\n\n  );\n\n\n\n  const inactiveMembers = members.filter(member => member.status === 'inactive');\n\n\n\n  // Filter companionships where companions are less active or inactive\n\n  const problematicCompanionships = companionships.filter(companionship => {\n\n    return companionship.companions.some(companionName => {\n\n      const member = members.find(m =>\n\n        `${m.firstName} ${m.lastName}`.toLowerCase() === companionName.toLowerCase()\n\n      );\n\n      return member && (member.status === 'less_active' || member.status === 'inactive');\n\n    });\n\n  });\n\n\n\n  const membersByFullName = useMemo(() => {\n\n    const map = new Map<string, Member>();\n\n    members.forEach(member => {\n\n      map.set(`${member.firstName} ${member.lastName}`.toLowerCase(), member);\n\n    });\n\n    return map;\n\n  }, [members]);\n\n\n\n  const membersByLastName = useMemo(() => {\n\n    const map = new Map<string, Member[]>();\n\n    members.forEach(member => {\n\n      const key = member.lastName.toLowerCase();\n\n      const existing = map.get(key) ?? [];\n\n      existing.push(member);\n\n      map.set(key, existing);\n\n    });\n\n    return map;\n\n  }, [members]);\n\n\n\n  const resolveFamilyMembers = useCallback((familyName: string): Member[] => {\n\n    const normalized = familyName.trim().toLowerCase();\n\n    if (normalized.startsWith('familia ')) {\n\n      const lastName = normalized.replace('familia ', '').trim();\n\n      return membersByLastName.get(lastName) ?? [];\n\n    }\n\n\n\n    const directMatch = membersByFullName.get(normalized);\n\n    if (directMatch) {\n\n      return [directMatch];\n\n    }\n\n\n\n    return membersByLastName.get(normalized) ?? [];\n\n  }, [membersByFullName, membersByLastName]);\n\n\n\n  type FlaggedFamily = {\n\n    family: Family;\n\n    members: Member[];\n\n  };\n\n\n\n  type FamilyFocusCompanionship = Companionship & {\n\n    flaggedFamilies: FlaggedFamily[];\n\n  };\n\n\n\n  const familyFocusCompanionships: FamilyFocusCompanionship[] = useMemo(() => {\n\n    return companionships.map((companionship) => {\n\n      const flaggedFamilies = companionship.families\n\n        .map<FlaggedFamily | null>((family) => {\n\n          const relatedMembers = resolveFamilyMembers(family.name);\n\n          const flaggedMembers = relatedMembers.filter(member =>\n\n            member.status === 'inactive' || member.status === 'less_active'\n\n          );\n\n          return flaggedMembers.length > 0 ? { family, members: flaggedMembers } : null;\n\n        })\n\n        .filter((entry): entry is FlaggedFamily => entry !== null);\n\n\n\n      if (flaggedFamilies.length === 0) {\n\n        return null;\n\n      }\n\n\n\n      return { ...companionship, flaggedFamilies };\n\n    }).filter((entry): entry is FamilyFocusCompanionship => entry !== null);\n\n  }, [companionships, resolveFamilyMembers]);\n\n\n\n  const observationCounts = {\n\n    withoutEndowment: membersWithoutEndowment.length,\n\n    withoutElderOrdination: membersWithoutElderOrdination.length,\n\n    withoutHigherPriesthood: membersWithoutHigherPriesthood.length,\n\n    withoutMinistering: membersWithoutMinistering.length,\n\n    inactive: inactiveMembers.length,\n\n    familyFocusCompanionships: familyFocusCompanionships.length,\n\n    problematicCompanionships: problematicCompanionships.length,\n\n    healthConcerns: healthConcerns.length\n\n  };\n\n\n\n  return (\n\n    <section className=\"page-section\">\n\n      {/* Header */}\n\n      <div className=\"flex flex-col gap-2\">\n\n        <h1 className=\"text-balance text-fluid-title font-semibold tracking-tight\">Observaciones</h1>\n\n        <p className=\"text-balance text-fluid-subtitle text-muted-foreground\">\n\n          Seguimiento de miembros que requieren atencin especial.\n\n        </p>\n\n      </div>\n\n\n\n      {/* Stats Cards */}\n\n      <div className=\"grid gap-3 md:grid-cols-2 xl:grid-cols-4\">\n\n        <Card className=\"cursor-pointer\" onClick={() => withoutEndowmentRef.current?.scrollIntoView({ behavior: 'smooth' })}>\n\n           <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n\n             <CardTitle className=\"text-sm font-medium\">Sin Investidura</CardTitle>\n\n             <AlertTriangle className=\"h-4 w-4 text-orange-600\" />\n\n           </CardHeader>\n\n           <CardContent>\n\n             <div className=\"text-2xl font-bold text-orange-600\">{observationCounts.withoutEndowment}</div>\n\n             <p className=\"text-xs text-muted-foreground\">miembros sin ordenanza de investidura</p>\n\n           </CardContent>\n\n         </Card>\n\n        <Card className=\"cursor-pointer\" onClick={() => withoutElderOrdinationRef.current?.scrollIntoView({ behavior: 'smooth' })}>\n\n           <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n\n             <CardTitle className=\"text-sm font-medium\">Sin Ordenanza de Elderes</CardTitle>\n\n             <UserCheck className=\"h-4 w-4 text-purple-600\" />\n\n           </CardHeader>\n\n           <CardContent>\n\n             <div className=\"text-2xl font-bold text-purple-600\">{observationCounts.withoutElderOrdination}</div>\n\n             <p className=\"text-xs text-muted-foreground\">miembros sin ordenanza de lder</p>\n\n           </CardContent>\n\n         </Card>\n\n        <Card className=\"cursor-pointer\" onClick={() => withoutHigherPriesthoodRef.current?.scrollIntoView({ behavior: 'smooth' })}>\n\n           <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n\n             <CardTitle className=\"text-sm font-medium\">Sin Sacerdocio Mayor</CardTitle>\n\n             <UserCheck className=\"h-4 w-4 text-indigo-600\" />\n\n           </CardHeader>\n\n           <CardContent>\n\n             <div className=\"text-2xl font-bold text-indigo-600\">{observationCounts.withoutHigherPriesthood}</div>\n\n             <p className=\"text-xs text-muted-foreground\">miembros sin sacerdocio mayor</p>\n\n           </CardContent>\n\n         </Card>\n\n        <Card className=\"cursor-pointer\" onClick={() => withoutMinisteringRef.current?.scrollIntoView({ behavior: 'smooth' })}>\n\n           <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n\n             <CardTitle className=\"text-sm font-medium\">Sin Ministrantes</CardTitle>\n\n             <UserX className=\"h-4 w-4 text-blue-600\" />\n\n           </CardHeader>\n\n           <CardContent>\n\n             <div className=\"text-2xl font-bold text-blue-600\">{observationCounts.withoutMinistering}</div>\n\n             <p className=\"text-xs text-muted-foreground\">miembros sin maestros ministrantes</p>\n\n           </CardContent>\n\n         </Card>\n\n        <Card className=\"cursor-pointer\" onClick={() => inactiveRef.current?.scrollIntoView({ behavior: 'smooth' })}>\n\n           <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n\n             <CardTitle className=\"text-sm font-medium\">Inactivos</CardTitle>\n\n             <UserX className=\"h-4 w-4 text-red-600\" />\n\n           </CardHeader>\n\n           <CardContent>\n\n             <div className=\"text-2xl font-bold text-red-600\">{observationCounts.inactive}</div>\n\n             <p className=\"text-xs text-muted-foreground\">miembros inactivos</p>\n\n           </CardContent>\n\n         </Card>\n\n        <Card className=\"cursor-pointer\" onClick={() => familyFocusCompanionshipsRef.current?.scrollIntoView({ behavior: 'smooth' })}>\n\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n\n            <CardTitle className=\"text-sm font-medium\">Familias en seguimiento</CardTitle>\n\n            <Users className=\"h-4 w-4 text-sky-600\" />\n\n          </CardHeader>\n\n          <CardContent>\n\n            <div className=\"text-2xl font-bold text-sky-600\">{observationCounts.familyFocusCompanionships}</div>\n\n            <p className=\"text-xs text-muted-foreground\">compaerismos con familias menos activas o inactivas</p>\n\n          </CardContent>\n\n        </Card>\n\n\n\n        <Card className=\"cursor-pointer\" onClick={() => problematicCompanionshipsRef.current?.scrollIntoView({ behavior: 'smooth' })}>\n\n           <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n\n             <CardTitle className=\"text-sm font-medium\">Compaeras Problemticas</CardTitle>\n\n             <Users className=\"h-4 w-4 text-orange-600\" />\n\n           </CardHeader>\n\n           <CardContent>\n\n             <div className=\"text-2xl font-bold text-orange-600\">{observationCounts.problematicCompanionships}</div>\n\n             <p className=\"text-xs text-muted-foreground\">compaeras con compaeros inactivos</p>\n\n           </CardContent>\n\n         </Card>\n\n        <Card className=\"cursor-pointer\" onClick={() => healthConcernsRef.current?.scrollIntoView({ behavior: 'smooth' })}>\n\n           <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n\n             <CardTitle className=\"text-sm font-medium\">Apoyo de Salud</CardTitle>\n\n             <HeartPulse className=\"h-4 w-4 text-rose-600\" />\n\n           </CardHeader>\n\n           <CardContent>\n\n             <div className=\"text-2xl font-bold text-rose-600\">{observationCounts.healthConcerns}</div>\n\n             <p className=\"text-xs text-muted-foreground\">personas con seguimiento de salud</p>\n\n           </CardContent>\n\n        </Card>\n\n      </div>\n\n\n\n      {/* Seccin Salud */}\n      <Card ref={healthConcernsRef}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <HeartPulse className=\"h-5 w-5 text-rose-600\" />\n            Personas con Necesidades de Salud\n          </CardTitle>\n          <CardDescription>\n            Registra y coordina el apoyo para quienes enfrentan desafos de salud dentro del barrio.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex flex-wrap items-center justify-between gap-3\">\n            <p className=\"max-w-3xl text-sm text-muted-foreground\">\n              Agrega manualmente a los hermanos o amigos que requieren visitas, ayuda especfica o seguimiento por motivos de salud.\n            </p>\n            <Button onClick={() => handleOpenHealthDialog()} disabled={savingHealthConcern} size=\"sm\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Agregar persona\n            </Button>\n          </div>\n          <div className=\"hidden md:block\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Persona</TableHead>\n                  <TableHead>Direccin</TableHead>\n                  <TableHead>Observacin</TableHead>\n                  <TableHead>Miembros de apoyo</TableHead>\n                  <TableHead className=\"text-right\">Acciones</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {healthLoading ? (\n                  Array.from({ length: 3 }).map((_, index) => (\n                    <TableRow key={index}>\n                      <TableCell><Skeleton className=\"h-5 w-48\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-5 w-40\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-5 w-64\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-6 w-36\" /></TableCell>\n                      <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-24\" /></TableCell>\n                    </TableRow>\n                  ))\n                ) : healthConcerns.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={5} className=\"h-24 text-center\">\n                      No hay personas registradas con seguimiento de salud.\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  healthConcerns.map((concern) => {\n                    const helperIds = Array.isArray(concern.helperIds) ? concern.helperIds : [];\n                    const helpers = helperIds.length > 0\n                      ? helperIds.map((helperId, index) => {\n                          const helper = membersById.get(helperId);\n                          const helperName = helper\n                            ? `${helper.firstName} ${helper.lastName}`\n                            : (concern.helperNames?.[index] ?? 'Miembro sin registro');\n                          return (\n                            <Badge key={`${concern.id}-${helperId}-${index}`} variant=\"outline\" className=\"text-xs font-normal\">\n                              {helperName}\n                            </Badge>\n                          );\n                        })\n                      : [];\n\n                    const createdAtLabel = concern.createdAt\n                      ? format(concern.createdAt.toDate(), 'd MMM yyyy', { locale: es })\n                      : 'Fecha no disponible';\n\n                    return (\n                      <TableRow key={concern.id}>\n                        <TableCell>\n                          <div className=\"flex items-center gap-3\">\n                            <Avatar className=\"h-9 w-9\">\n                              <AvatarImage\n                                src={concern.photoURL || undefined}\n                                alt={`${concern.firstName} ${concern.lastName}`}\n                              />\n                              <AvatarFallback>{getInitials(concern.firstName, concern.lastName)}</AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <p className=\"font-medium\">{concern.firstName} {concern.lastName}</p>\n                              <p className=\"text-xs text-muted-foreground\">Registrado el {createdAtLabel}</p>\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"max-w-[220px]\">\n                          <p className=\"text-sm text-muted-foreground break-words\">{concern.address}</p>\n                        </TableCell>\n                        <TableCell className=\"max-w-[260px]\">\n                          <p className=\"text-sm text-muted-foreground break-words\">{concern.observation}</p>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex flex-wrap gap-2\">\n                            {helpers.length > 0 ? helpers : <span className=\"text-sm text-muted-foreground\">Sin asignar</span>}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex justify-end gap-2\">\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleOpenHealthDialog(concern)}\n                              disabled={savingHealthConcern}\n                              title=\"Editar registro\"\n                            >\n                              <Pencil className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleDeleteHealthConcern(concern)}\n                              disabled={deletingHealthConcernId === concern.id}\n                              title=\"Eliminar registro\"\n                            >\n                              {deletingHealthConcernId === concern.id ? (\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              ) : (\n                                <Trash2 className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })\n                )}\n              </TableBody>\n            </Table>\n          </div>\n          <div className=\"md:hidden space-y-4\">\n            {healthLoading ? (\n              Array.from({ length: 2 }).map((_, index) => (\n                <Skeleton key={index} className=\"h-36 w-full\" />\n              ))\n            ) : healthConcerns.length === 0 ? (\n              <div className=\"py-12 text-center\">\n                <HeartPulse className=\"mx-auto mb-4 h-12 w-12 text-muted-foreground\" />\n                <p className=\"text-muted-foreground\">\n                  No hay personas registradas con seguimiento de salud.\n                </p>\n              </div>\n            ) : (\n              healthConcerns.map((concern) => {\n                const helperIds = Array.isArray(concern.helperIds) ? concern.helperIds : [];\n                const helpers = helperIds.length > 0\n                  ? helperIds.map((helperId, index) => {\n                      const helper = membersById.get(helperId);\n                      const helperName = helper\n                        ? `${helper.firstName} ${helper.lastName}`\n                        : (concern.helperNames?.[index] ?? 'Miembro sin registro');\n                      return (\n                        <Badge key={`${concern.id}-${helperId}-${index}`} variant=\"outline\" className=\"text-xs font-normal\">\n                          {helperName}\n                        </Badge>\n                      );\n                    })\n                  : [];\n\n                const createdAtLabel = concern.createdAt\n                  ? format(concern.createdAt.toDate(), 'd MMM yyyy', { locale: es })\n                  : 'Fecha no disponible';\n\n                return (\n                  <Card key={concern.id}>\n                    <CardContent className=\"space-y-4 pt-4\">\n                      <div className=\"flex items-start gap-3\">\n                        <Avatar className=\"h-12 w-12\">\n                          <AvatarImage\n                            src={concern.photoURL || undefined}\n                            alt={`${concern.firstName} ${concern.lastName}`}\n                          />\n                          <AvatarFallback>{getInitials(concern.firstName, concern.lastName)}</AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <h3 className=\"font-semibold\">{concern.firstName} {concern.lastName}</h3>\n                          <p className=\"text-sm text-muted-foreground\">{concern.address}</p>\n                          <p className=\"text-xs text-muted-foreground mt-1\">Registrado el {createdAtLabel}</p>\n                        </div>\n                      </div>\n                      <div>\n                        <p className=\"text-xs uppercase text-muted-foreground\">Observacin</p>\n                        <p className=\"mt-1 text-sm text-muted-foreground\">{concern.observation}</p>\n                      </div>\n                      <div>\n                        <p className=\"text-xs uppercase text-muted-foreground\">Miembros de apoyo</p>\n                        <div className=\"mt-1 flex flex-wrap gap-2\">\n                          {helpers.length > 0 ? helpers : <span className=\"text-sm text-muted-foreground\">Sin asignar</span>}\n                        </div>\n                      </div>\n                      <div className=\"flex justify-end gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleOpenHealthDialog(concern)}\n                          disabled={savingHealthConcern}\n                          title=\"Editar registro\"\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleDeleteHealthConcern(concern)}\n                          disabled={deletingHealthConcernId === concern.id}\n                          title=\"Eliminar registro\"\n                        >\n                          {deletingHealthConcernId === concern.id ? (\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          ) : (\n                            <Trash2 className=\"h-4 w-4\" />\n                          )}\n                        </Button>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Seccin Sin Investidura */}\n\n      <Card ref={withoutEndowmentRef}>\n\n        <CardHeader>\n\n          <CardTitle className=\"flex items-center gap-2\">\n\n            <AlertTriangle className=\"h-5 w-5 text-orange-600\" />\n\n            Miembros Sin Ordenanza de Investidura\n\n          </CardTitle>\n\n          <CardDescription>\n\n            Miembros que no han recibido la ordenanza del templo de investidura.\n\n          </CardDescription>\n\n        </CardHeader>\n\n        <CardContent>\n\n          <div className=\"hidden md:block\">\n\n            <Table>\n\n              <TableHeader>\n\n                <TableRow>\n\n                  <TableHead>Nombre</TableHead>\n\n                  <TableHead>Telfono</TableHead>\n\n                  <TableHead>Estado</TableHead>\n\n                  <TableHead>Ordenanzas Recibidas</TableHead>\n\n                  <TableHead className=\"text-right\">Acciones</TableHead>\n\n                </TableRow>\n\n              </TableHeader>\n\n              <TableBody>\n\n                {loading ? (\n\n                  Array.from({ length: 3 }).map((_, i) => (\n\n                    <TableRow key={i}>\n\n                      <TableCell><Skeleton className=\"h-5 w-40\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-6 w-20 rounded-full\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-36\" /></TableCell>\n\n                      <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-24\" /></TableCell>\n\n                    </TableRow>\n\n                  ))\n\n                ) : membersWithoutEndowment.length === 0 ? (\n\n                  <TableRow>\n\n                    <TableCell colSpan={5} className=\"h-24 text-center\">\n\n                      Todos los miembros han recibido la investidura.\n\n                    </TableCell>\n\n                  </TableRow>\n\n                ) : (\n\n                  membersWithoutEndowment.map((member) => {\n\n                    const statusInfo = statusConfig[member.status];\n\n                    const StatusIcon = statusInfo.icon;\n\n\n\n                    return (\n\n                      <TableRow key={member.id}>\n\n                        <TableCell className=\"font-medium\">\n\n                          <div className=\"flex items-center gap-3\">\n\n                            {member.photoURL ? (\n\n                              <img\n\n                                src={member.photoURL}\n\n                                alt={`${member.firstName} ${member.lastName}`}\n\n                                className=\"w-8 h-8 rounded-full object-cover\"\n\n                              />\n\n                            ) : (\n\n                              <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n\n                                <Users className=\"h-4 w-4 text-muted-foreground\" />\n\n                              </div>\n\n                            )}\n\n                            <span>{member.firstName} {member.lastName}</span>\n\n                          </div>\n\n                        </TableCell>\n\n                        <TableCell>{member.phoneNumber || 'No especificado'}</TableCell>\n\n                        <TableCell>\n\n                          <Badge variant={statusInfo.variant} className=\"gap-1\">\n\n                            <StatusIcon className=\"h-3 w-3\" />\n\n                            {statusInfo.label}\n\n                          </Badge>\n\n                        </TableCell>\n\n                        <TableCell>\n\n                          <div className=\"flex flex-wrap gap-1\">\n\n                            {member.ordinances && member.ordinances.length > 0 ? (\n\n                              member.ordinances.map((ordinance) => (\n\n                                <Badge key={ordinance} variant=\"outline\" className=\"text-xs\">\n\n                                  {OrdinanceLabels[ordinance]}\n\n                                </Badge>\n\n                              ))\n\n                            ) : (\n\n                              <span className=\"text-muted-foreground text-sm\">Ninguna</span>\n\n                            )}\n\n                          </div>\n\n                        </TableCell>\n\n                        <TableCell className=\"text-right\">\n\n                          <Button\n\n                            variant=\"outline\"\n\n                            size=\"sm\"\n\n                            onClick={() => handleViewProfile(member.id)}\n\n                            title=\"Ver perfil\"\n\n                          >\n\n                            <Eye className=\"h-4 w-4\" />\n\n                          </Button>\n\n                        </TableCell>\n\n                      </TableRow>\n\n                    );\n\n                  })\n\n                )}\n\n              </TableBody>\n\n            </Table>\n\n          </div>\n\n\n\n          {/* Mobile Cards */}\n\n          <div className=\"md:hidden space-y-4\">\n\n            {loading ? (\n\n              Array.from({ length: 2 }).map((_, i) => (\n\n                <Skeleton key={i} className=\"h-32 w-full\" />\n\n              ))\n\n            ) : membersWithoutEndowment.length === 0 ? (\n\n              <div className=\"text-center py-12\">\n\n                <AlertTriangle className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n\n                <p className=\"text-muted-foreground\">\n\n                  Todos los miembros han recibido la investidura.\n\n                </p>\n\n              </div>\n\n            ) : (\n\n              membersWithoutEndowment.map((member) => {\n\n                const statusInfo = statusConfig[member.status];\n\n                const StatusIcon = statusInfo.icon;\n\n\n\n                return (\n\n                  <Card key={member.id}>\n\n                    <CardContent className=\"pt-4\">\n\n                      <div className=\"flex items-start justify-between mb-3\">\n\n                        <div className=\"flex items-center gap-3\">\n\n                          {member.photoURL ? (\n\n                            <img\n\n                              src={member.photoURL}\n\n                              alt={`${member.firstName} ${member.lastName}`}\n\n                              className=\"w-10 h-10 rounded-full object-cover\"\n\n                            />\n\n                          ) : (\n\n                            <div className=\"w-10 h-10 rounded-full bg-muted flex items-center justify-center\">\n\n                              <Users className=\"h-5 w-5 text-muted-foreground\" />\n\n                            </div>\n\n                          )}\n\n                          <div>\n\n                            <h3 className=\"font-semibold\">{member.firstName} {member.lastName}</h3>\n\n                            <p className=\"text-sm text-muted-foreground\">\n\n                              {member.phoneNumber || 'Sin telfono'}\n\n                            </p>\n\n                          </div>\n\n                        </div>\n\n                        <Badge variant={statusInfo.variant} className=\"gap-1\">\n\n                          <StatusIcon className=\"h-3 w-3\" />\n\n                          {statusInfo.label}\n\n                        </Badge>\n\n                      </div>\n\n\n\n                      <div className=\"mb-3\">\n\n                        <p className=\"text-sm font-medium mb-2\">Ordenanzas:</p>\n\n                        <div className=\"flex flex-wrap gap-1\">\n\n                          {member.ordinances && member.ordinances.length > 0 ? (\n\n                            member.ordinances.map((ordinance) => (\n\n                              <Badge key={ordinance} variant=\"outline\" className=\"text-xs\">\n\n                                {OrdinanceLabels[ordinance]}\n\n                              </Badge>\n\n                            ))\n\n                          ) : (\n\n                            <span className=\"text-muted-foreground text-sm\">Ninguna</span>\n\n                          )}\n\n                        </div>\n\n                      </div>\n\n\n\n                      <div className=\"flex justify-end\">\n\n                        <Button\n\n                          variant=\"outline\"\n\n                          size=\"sm\"\n\n                          onClick={() => handleViewProfile(member.id)}\n\n                        >\n\n                          <Eye className=\"mr-2 h-4 w-4\" />\n\n                          Ver Perfil\n\n                        </Button>\n\n                      </div>\n\n                    </CardContent>\n\n                  </Card>\n\n                );\n\n              })\n\n            )}\n\n          </div>\n\n        </CardContent>\n\n      </Card>\n\n\n\n      {/* Seccin Sin Ordenanza de Elderes */}\n\n      <Card ref={withoutElderOrdinationRef}>\n\n        <CardHeader>\n\n          <CardTitle className=\"flex items-center gap-2\">\n\n            <UserCheck className=\"h-5 w-5 text-purple-600\" />\n\n            Miembros Sin Ordenanza de Elderes\n\n          </CardTitle>\n\n          <CardDescription>\n\n            Miembros que no han recibido la ordenanza de lder (sacerdocio mayor).\n\n          </CardDescription>\n\n        </CardHeader>\n\n        <CardContent>\n\n          <div className=\"hidden md:block\">\n\n            <Table>\n\n              <TableHeader>\n\n                <TableRow>\n\n                  <TableHead>Nombre</TableHead>\n\n                  <TableHead>Telfono</TableHead>\n\n                  <TableHead>Estado</TableHead>\n\n                  <TableHead>Ordenanzas Recibidas</TableHead>\n\n                  <TableHead className=\"text-right\">Acciones</TableHead>\n\n                </TableRow>\n\n              </TableHeader>\n\n              <TableBody>\n\n                {loading ? (\n\n                  Array.from({ length: 3 }).map((_, i) => (\n\n                    <TableRow key={i}>\n\n                      <TableCell><Skeleton className=\"h-5 w-40\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-6 w-20 rounded-full\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-36\" /></TableCell>\n\n                      <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-24\" /></TableCell>\n\n                    </TableRow>\n\n                  ))\n\n                ) : membersWithoutElderOrdination.length === 0 ? (\n\n                  <TableRow>\n\n                    <TableCell colSpan={5} className=\"h-24 text-center\">\n\n                      Todos los miembros han recibido la ordenanza de lder.\n\n                    </TableCell>\n\n                  </TableRow>\n\n                ) : (\n\n                  membersWithoutElderOrdination.map((member) => {\n\n                    const statusInfo = statusConfig[member.status];\n\n                    const StatusIcon = statusInfo.icon;\n\n\n\n                    return (\n\n                      <TableRow key={member.id}>\n\n                        <TableCell className=\"font-medium\">\n\n                          <div className=\"flex items-center gap-3\">\n\n                            {member.photoURL ? (\n\n                              <img\n\n                                src={member.photoURL}\n\n                                alt={`${member.firstName} ${member.lastName}`}\n\n                                className=\"w-8 h-8 rounded-full object-cover\"\n\n                              />\n\n                            ) : (\n\n                              <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n\n                                <Users className=\"h-4 w-4 text-muted-foreground\" />\n\n                              </div>\n\n                            )}\n\n                            <span>{member.firstName} {member.lastName}</span>\n\n                          </div>\n\n                        </TableCell>\n\n                        <TableCell>{member.phoneNumber || 'No especificado'}</TableCell>\n\n                        <TableCell>\n\n                          <Badge variant={statusInfo.variant} className=\"gap-1\">\n\n                            <StatusIcon className=\"h-3 w-3\" />\n\n                            {statusInfo.label}\n\n                          </Badge>\n\n                        </TableCell>\n\n                        <TableCell>\n\n                          <div className=\"flex flex-wrap gap-1\">\n\n                            {member.ordinances && member.ordinances.length > 0 ? (\n\n                              member.ordinances.map((ordinance) => (\n\n                                <Badge key={ordinance} variant=\"outline\" className=\"text-xs\">\n\n                                  {OrdinanceLabels[ordinance]}\n\n                                </Badge>\n\n                              ))\n\n                            ) : (\n\n                              <span className=\"text-muted-foreground text-sm\">Ninguna</span>\n\n                            )}\n\n                          </div>\n\n                        </TableCell>\n\n                        <TableCell className=\"text-right\">\n\n                          <Button\n\n                            variant=\"outline\"\n\n                            size=\"sm\"\n\n                            onClick={() => handleViewProfile(member.id)}\n\n                            title=\"Ver perfil\"\n\n                          >\n\n                            <Eye className=\"h-4 w-4\" />\n\n                          </Button>\n\n                        </TableCell>\n\n                      </TableRow>\n\n                    );\n\n                  })\n\n                )}\n\n              </TableBody>\n\n            </Table>\n\n          </div>\n\n\n\n          {/* Mobile Cards */}\n\n          <div className=\"md:hidden space-y-4\">\n\n            {loading ? (\n\n              Array.from({ length: 2 }).map((_, i) => (\n\n                <Skeleton key={i} className=\"h-32 w-full\" />\n\n              ))\n\n            ) : membersWithoutElderOrdination.length === 0 ? (\n\n              <div className=\"text-center py-12\">\n\n                <UserCheck className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n\n                <p className=\"text-muted-foreground\">\n\n                  Todos los miembros han recibido la ordenanza de lder.\n\n                </p>\n\n              </div>\n\n            ) : (\n\n              membersWithoutElderOrdination.map((member) => {\n\n                const statusInfo = statusConfig[member.status];\n\n                const StatusIcon = statusInfo.icon;\n\n\n\n                return (\n\n                  <Card key={member.id}>\n\n                    <CardContent className=\"pt-4\">\n\n                      <div className=\"flex items-start justify-between mb-3\">\n\n                        <div className=\"flex items-center gap-3\">\n\n                          {member.photoURL ? (\n\n                            <img\n\n                              src={member.photoURL}\n\n                              alt={`${member.firstName} ${member.lastName}`}\n\n                              className=\"w-10 h-10 rounded-full object-cover\"\n\n                            />\n\n                          ) : (\n\n                            <div className=\"w-10 h-10 rounded-full bg-muted flex items-center justify-center\">\n\n                              <Users className=\"h-5 w-5 text-muted-foreground\" />\n\n                            </div>\n\n                          )}\n\n                          <div>\n\n                            <h3 className=\"font-semibold\">{member.firstName} {member.lastName}</h3>\n\n                            <p className=\"text-sm text-muted-foreground\">\n\n                              {member.phoneNumber || 'Sin telfono'}\n\n                            </p>\n\n                          </div>\n\n                        </div>\n\n                        <Badge variant={statusInfo.variant} className=\"gap-1\">\n\n                          <StatusIcon className=\"h-3 w-3\" />\n\n                          {statusInfo.label}\n\n                        </Badge>\n\n                      </div>\n\n\n\n                      <div className=\"mb-3\">\n\n                        <p className=\"text-sm font-medium mb-2\">Ordenanzas:</p>\n\n                        <div className=\"flex flex-wrap gap-1\">\n\n                          {member.ordinances && member.ordinances.length > 0 ? (\n\n                            member.ordinances.map((ordinance) => (\n\n                              <Badge key={ordinance} variant=\"outline\" className=\"text-xs\">\n\n                                {OrdinanceLabels[ordinance]}\n\n                              </Badge>\n\n                            ))\n\n                          ) : (\n\n                            <span className=\"text-muted-foreground text-sm\">Ninguna</span>\n\n                          )}\n\n                        </div>\n\n                      </div>\n\n\n\n                      <div className=\"flex justify-end\">\n\n                        <Button\n\n                          variant=\"outline\"\n\n                          size=\"sm\"\n\n                          onClick={() => handleViewProfile(member.id)}\n\n                        >\n\n                          <Eye className=\"mr-2 h-4 w-4\" />\n\n                          Ver Perfil\n\n                        </Button>\n\n                      </div>\n\n                    </CardContent>\n\n                  </Card>\n\n                );\n\n              })\n\n            )}\n\n          </div>\n\n        </CardContent>\n\n      </Card>\n\n\n\n      {/* Seccin Sin Sacerdocio Mayor */}\n\n      <Card ref={withoutHigherPriesthoodRef}>\n\n        <CardHeader>\n\n          <CardTitle className=\"flex items-center gap-2\">\n\n            <UserCheck className=\"h-5 w-5 text-indigo-600\" />\n\n            Miembros Sin Sacerdocio Mayor\n\n          </CardTitle>\n\n          <CardDescription>\n\n            Miembros que no han recibido la ordenanza de lder ni de sumo sacerdote (sacerdocio mayor).\n\n          </CardDescription>\n\n        </CardHeader>\n\n        <CardContent>\n\n          <div className=\"hidden md:block\">\n\n            <Table>\n\n              <TableHeader>\n\n                <TableRow>\n\n                  <TableHead>Nombre</TableHead>\n\n                  <TableHead>Telfono</TableHead>\n\n                  <TableHead>Estado</TableHead>\n\n                  <TableHead>Ordenanzas Recibidas</TableHead>\n\n                  <TableHead className=\"text-right\">Acciones</TableHead>\n\n                </TableRow>\n\n              </TableHeader>\n\n              <TableBody>\n\n                {loading ? (\n\n                  Array.from({ length: 3 }).map((_, i) => (\n\n                    <TableRow key={i}>\n\n                      <TableCell><Skeleton className=\"h-5 w-40\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-6 w-20 rounded-full\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-36\" /></TableCell>\n\n                      <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-24\" /></TableCell>\n\n                    </TableRow>\n\n                  ))\n\n                ) : membersWithoutHigherPriesthood.length === 0 ? (\n\n                  <TableRow>\n\n                    <TableCell colSpan={5} className=\"h-24 text-center\">\n\n                      Todos los miembros han recibido el sacerdocio mayor.\n\n                    </TableCell>\n\n                  </TableRow>\n\n                ) : (\n\n                  membersWithoutHigherPriesthood.map((member) => {\n\n                    const statusInfo = statusConfig[member.status];\n\n                    const StatusIcon = statusInfo.icon;\n\n\n\n                    return (\n\n                      <TableRow key={member.id}>\n\n                        <TableCell className=\"font-medium\">\n\n                          <div className=\"flex items-center gap-3\">\n\n                            {member.photoURL ? (\n\n                              <img\n\n                                src={member.photoURL}\n\n                                alt={`${member.firstName} ${member.lastName}`}\n\n                                className=\"w-8 h-8 rounded-full object-cover\"\n\n                              />\n\n                            ) : (\n\n                              <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n\n                                <Users className=\"h-4 w-4 text-muted-foreground\" />\n\n                              </div>\n\n                            )}\n\n                            <span>{member.firstName} {member.lastName}</span>\n\n                          </div>\n\n                        </TableCell>\n\n                        <TableCell>{member.phoneNumber || 'No especificado'}</TableCell>\n\n                        <TableCell>\n\n                          <Badge variant={statusInfo.variant} className=\"gap-1\">\n\n                            <StatusIcon className=\"h-3 w-3\" />\n\n                            {statusInfo.label}\n\n                          </Badge>\n\n                        </TableCell>\n\n                        <TableCell>\n\n                          <div className=\"flex flex-wrap gap-1\">\n\n                            {member.ordinances && member.ordinances.length > 0 ? (\n\n                              member.ordinances.map((ordinance) => (\n\n                                <Badge key={ordinance} variant=\"outline\" className=\"text-xs\">\n\n                                  {OrdinanceLabels[ordinance]}\n\n                                </Badge>\n\n                              ))\n\n                            ) : (\n\n                              <span className=\"text-muted-foreground text-sm\">Ninguna</span>\n\n                            )}\n\n                          </div>\n\n                        </TableCell>\n\n                        <TableCell className=\"text-right\">\n\n                          <Button\n\n                            variant=\"outline\"\n\n                            size=\"sm\"\n\n                            onClick={() => handleViewProfile(member.id)}\n\n                            title=\"Ver perfil\"\n\n                          >\n\n                            <Eye className=\"h-4 w-4\" />\n\n                          </Button>\n\n                        </TableCell>\n\n                      </TableRow>\n\n                    );\n\n                  })\n\n                )}\n\n              </TableBody>\n\n            </Table>\n\n          </div>\n\n\n\n          {/* Mobile Cards */}\n\n          <div className=\"md:hidden space-y-4\">\n\n            {loading ? (\n\n              Array.from({ length: 2 }).map((_, i) => (\n\n                <Skeleton key={i} className=\"h-32 w-full\" />\n\n              ))\n\n            ) : membersWithoutHigherPriesthood.length === 0 ? (\n\n              <div className=\"text-center py-12\">\n\n                <UserCheck className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n\n                <p className=\"text-muted-foreground\">\n\n                  Todos los miembros han recibido el sacerdocio mayor.\n\n                </p>\n\n              </div>\n\n            ) : (\n\n              membersWithoutHigherPriesthood.map((member) => {\n\n                const statusInfo = statusConfig[member.status];\n\n                const StatusIcon = statusInfo.icon;\n\n\n\n                return (\n\n                  <Card key={member.id}>\n\n                    <CardContent className=\"pt-4\">\n\n                      <div className=\"flex items-start justify-between mb-3\">\n\n                        <div className=\"flex items-center gap-3\">\n\n                          {member.photoURL ? (\n\n                            <img\n\n                              src={member.photoURL}\n\n                              alt={`${member.firstName} ${member.lastName}`}\n\n                              className=\"w-10 h-10 rounded-full object-cover\"\n\n                            />\n\n                          ) : (\n\n                            <div className=\"w-10 h-10 rounded-full bg-muted flex items-center justify-center\">\n\n                              <Users className=\"h-5 w-5 text-muted-foreground\" />\n\n                            </div>\n\n                          )}\n\n                          <div>\n\n                            <h3 className=\"font-semibold\">{member.firstName} {member.lastName}</h3>\n\n                            <p className=\"text-sm text-muted-foreground\">\n\n                              {member.phoneNumber || 'Sin telfono'}\n\n                            </p>\n\n                          </div>\n\n                        </div>\n\n                        <Badge variant={statusInfo.variant} className=\"gap-1\">\n\n                          <StatusIcon className=\"h-3 w-3\" />\n\n                          {statusInfo.label}\n\n                        </Badge>\n\n                      </div>\n\n\n\n                      <div className=\"mb-3\">\n\n                        <p className=\"text-sm font-medium mb-2\">Ordenanzas:</p>\n\n                        <div className=\"flex flex-wrap gap-1\">\n\n                          {member.ordinances && member.ordinances.length > 0 ? (\n\n                            member.ordinances.map((ordinance) => (\n\n                              <Badge key={ordinance} variant=\"outline\" className=\"text-xs\">\n\n                                {OrdinanceLabels[ordinance]}\n\n                              </Badge>\n\n                            ))\n\n                          ) : (\n\n                            <span className=\"text-muted-foreground text-sm\">Ninguna</span>\n\n                          )}\n\n                        </div>\n\n                      </div>\n\n\n\n                      <div className=\"flex justify-end\">\n\n                        <Button\n\n                          variant=\"outline\"\n\n                          size=\"sm\"\n\n                          onClick={() => handleViewProfile(member.id)}\n\n                        >\n\n                          <Eye className=\"mr-2 h-4 w-4\" />\n\n                          Ver Perfil\n\n                        </Button>\n\n                      </div>\n\n                    </CardContent>\n\n                  </Card>\n\n                );\n\n              })\n\n            )}\n\n          </div>\n\n        </CardContent>\n\n      </Card>\n\n\n\n      {/* Seccin Sin Maestros Ministrantes */}\n\n      <Card ref={withoutMinisteringRef}>\n\n        <CardHeader>\n\n          <CardTitle className=\"flex items-center gap-2\">\n\n            <UserX className=\"h-5 w-5 text-blue-600\" />\n\n            Miembros Sin Maestros Ministrantes\n\n          </CardTitle>\n\n          <CardDescription>\n\n            Miembros que no tienen asignados maestros ministrantes.\n\n          </CardDescription>\n\n        </CardHeader>\n\n        <CardContent>\n\n          <div className=\"hidden md:block\">\n\n            <Table>\n\n              <TableHeader>\n\n                <TableRow>\n\n                  <TableHead>Nombre</TableHead>\n\n                  <TableHead>Telfono</TableHead>\n\n                  <TableHead>Estado</TableHead>\n\n                  <TableHead className=\"text-right\">Acciones</TableHead>\n\n                </TableRow>\n\n              </TableHeader>\n\n              <TableBody>\n\n                {loading ? (\n\n                  Array.from({ length: 3 }).map((_, i) => (\n\n                    <TableRow key={i}>\n\n                      <TableCell><Skeleton className=\"h-5 w-40\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-6 w-20 rounded-full\" /></TableCell>\n\n                      <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-24\" /></TableCell>\n\n                    </TableRow>\n\n                  ))\n\n                ) : membersWithoutMinistering.length === 0 ? (\n\n                  <TableRow>\n\n                    <TableCell colSpan={4} className=\"h-24 text-center\">\n\n                      Todos los miembros tienen maestros ministrantes asignados.\n\n                    </TableCell>\n\n                  </TableRow>\n\n                ) : (\n\n                  membersWithoutMinistering.map((member) => {\n\n                    const statusInfo = statusConfig[member.status];\n\n                    const StatusIcon = statusInfo.icon;\n\n\n\n                    return (\n\n                      <TableRow key={member.id}>\n\n                        <TableCell className=\"font-medium\">\n\n                          <div className=\"flex items-center gap-3\">\n\n                            {member.photoURL ? (\n\n                              <img\n\n                                src={member.photoURL}\n\n                                alt={`${member.firstName} ${member.lastName}`}\n\n                                className=\"w-8 h-8 rounded-full object-cover\"\n\n                              />\n\n                            ) : (\n\n                              <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n\n                                <Users className=\"h-4 w-4 text-muted-foreground\" />\n\n                              </div>\n\n                            )}\n\n                            <span>{member.firstName} {member.lastName}</span>\n\n                          </div>\n\n                        </TableCell>\n\n                        <TableCell>{member.phoneNumber || 'No especificado'}</TableCell>\n\n                        <TableCell>\n\n                          <Badge variant={statusInfo.variant} className=\"gap-1\">\n\n                            <StatusIcon className=\"h-3 w-3\" />\n\n                            {statusInfo.label}\n\n                          </Badge>\n\n                        </TableCell>\n\n                        <TableCell className=\"text-right\">\n\n                          <Button\n\n                            variant=\"outline\"\n\n                            size=\"sm\"\n\n                            onClick={() => handleViewProfile(member.id)}\n\n                            title=\"Ver perfil\"\n\n                          >\n\n                            <Eye className=\"h-4 w-4\" />\n\n                          </Button>\n\n                        </TableCell>\n\n                      </TableRow>\n\n                    );\n\n                  })\n\n                )}\n\n              </TableBody>\n\n            </Table>\n\n          </div>\n\n\n\n          {/* Mobile Cards */}\n\n          <div className=\"md:hidden space-y-4\">\n\n            {loading ? (\n\n              Array.from({ length: 2 }).map((_, i) => (\n\n                <Skeleton key={i} className=\"h-32 w-full\" />\n\n              ))\n\n            ) : membersWithoutMinistering.length === 0 ? (\n\n              <div className=\"text-center py-12\">\n\n                <UserX className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n\n                <p className=\"text-muted-foreground\">\n\n                  Todos los miembros tienen maestros ministrantes asignados.\n\n                </p>\n\n              </div>\n\n            ) : (\n\n              membersWithoutMinistering.map((member) => {\n\n                const statusInfo = statusConfig[member.status];\n\n                const StatusIcon = statusInfo.icon;\n\n\n\n                return (\n\n                  <Card key={member.id}>\n\n                    <CardContent className=\"pt-4\">\n\n                      <div className=\"flex items-start justify-between mb-3\">\n\n                        <div className=\"flex items-center gap-3\">\n\n                          {member.photoURL ? (\n\n                            <img\n\n                              src={member.photoURL}\n\n                              alt={`${member.firstName} ${member.lastName}`}\n\n                              className=\"w-10 h-10 rounded-full object-cover\"\n\n                            />\n\n                          ) : (\n\n                            <div className=\"w-10 h-10 rounded-full bg-muted flex items-center justify-center\">\n\n                              <Users className=\"h-5 w-5 text-muted-foreground\" />\n\n                            </div>\n\n                          )}\n\n                          <div>\n\n                            <h3 className=\"font-semibold\">{member.firstName} {member.lastName}</h3>\n\n                            <p className=\"text-sm text-muted-foreground\">\n\n                              {member.phoneNumber || 'Sin telfono'}\n\n                            </p>\n\n                          </div>\n\n                        </div>\n\n                        <Badge variant={statusInfo.variant} className=\"gap-1\">\n\n                          <StatusIcon className=\"h-3 w-3\" />\n\n                          {statusInfo.label}\n\n                        </Badge>\n\n                      </div>\n\n\n\n                      <div className=\"flex justify-end\">\n\n                        <Button\n\n                          variant=\"outline\"\n\n                          size=\"sm\"\n\n                          onClick={() => handleViewProfile(member.id)}\n\n                        >\n\n                          <Eye className=\"mr-2 h-4 w-4\" />\n\n                          Ver Perfil\n\n                        </Button>\n\n                      </div>\n\n                    </CardContent>\n\n                  </Card>\n\n                );\n\n              })\n\n            )}\n\n          </div>\n\n        </CardContent>\n\n      </Card>\n\n\n\n      {/* Seccin Miembros Inactivos */}\n\n      <Card ref={inactiveRef}>\n\n        <CardHeader>\n\n          <CardTitle className=\"flex items-center gap-2\">\n\n            <UserX className=\"h-5 w-5 text-red-600\" />\n\n            Miembros Inactivos\n\n          </CardTitle>\n\n          <CardDescription>\n\n            Miembros marcados como inactivos que requieren seguimiento especial.\n\n          </CardDescription>\n\n        </CardHeader>\n\n        <CardContent>\n\n          <div className=\"hidden md:block\">\n\n            <Table>\n\n              <TableHeader>\n\n                <TableRow>\n\n                  <TableHead>Nombre</TableHead>\n\n                  <TableHead>Telfono</TableHead>\n\n                  <TableHead>Fecha de Nacimiento</TableHead>\n\n                  <TableHead>ltima Actividad</TableHead>\n\n                  <TableHead className=\"text-right\">Acciones</TableHead>\n\n                </TableRow>\n\n              </TableHeader>\n\n              <TableBody>\n\n                {loading ? (\n\n                  Array.from({ length: 3 }).map((_, i) => (\n\n                    <TableRow key={i}>\n\n                      <TableCell><Skeleton className=\"h-5 w-40\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-28\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n\n                      <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-24\" /></TableCell>\n\n                    </TableRow>\n\n                  ))\n\n                ) : inactiveMembers.length === 0 ? (\n\n                  <TableRow>\n\n                    <TableCell colSpan={5} className=\"h-24 text-center\">\n\n                      No hay miembros inactivos.\n\n                    </TableCell>\n\n                  </TableRow>\n\n                ) : (\n\n                  inactiveMembers.map((member) => (\n\n                    <TableRow key={member.id}>\n\n                      <TableCell className=\"font-medium\">\n\n                        <div className=\"flex items-center gap-3\">\n\n                          {member.photoURL ? (\n\n                            <img\n\n                              src={member.photoURL}\n\n                              alt={`${member.firstName} ${member.lastName}`}\n\n                              className=\"w-8 h-8 rounded-full object-cover\"\n\n                            />\n\n                          ) : (\n\n                            <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n\n                              <Users className=\"h-4 w-4 text-muted-foreground\" />\n\n                            </div>\n\n                          )}\n\n                          <span>{member.firstName} {member.lastName}</span>\n\n                        </div>\n\n                      </TableCell>\n\n                      <TableCell>{member.phoneNumber || 'No especificado'}</TableCell>\n\n                      <TableCell>\n\n                        {member.birthDate\n\n                          ? format(member.birthDate.toDate(), 'd MMM yyyy', { locale: es })\n\n                          : 'No especificada'}\n\n                      </TableCell>\n\n                      <TableCell>\n\n                        {member.lastActiveDate\n\n                          ? format(member.lastActiveDate.toDate(), 'd MMM yyyy', { locale: es })\n\n                          : 'Nunca'}\n\n                      </TableCell>\n\n                      <TableCell className=\"text-right\">\n\n                        <Button\n\n                          variant=\"outline\"\n\n                          size=\"sm\"\n\n                          onClick={() => handleViewProfile(member.id)}\n\n                          title=\"Ver perfil\"\n\n                        >\n\n                          <Eye className=\"h-4 w-4\" />\n\n                        </Button>\n\n                      </TableCell>\n\n                    </TableRow>\n\n                  ))\n\n                )}\n\n              </TableBody>\n\n            </Table>\n\n          </div>\n\n\n\n          {/* Mobile Cards */}\n\n          <div className=\"md:hidden space-y-4\">\n\n            {loading ? (\n\n              Array.from({ length: 2 }).map((_, i) => (\n\n                <Skeleton key={i} className=\"h-32 w-full\" />\n\n              ))\n\n            ) : inactiveMembers.length === 0 ? (\n\n              <div className=\"text-center py-12\">\n\n                <UserX className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n\n                <p className=\"text-muted-foreground\">\n\n                  No hay miembros inactivos.\n\n                </p>\n\n              </div>\n\n            ) : (\n\n              inactiveMembers.map((member) => (\n\n                <Card key={member.id}>\n\n                  <CardContent className=\"pt-4\">\n\n                    <div className=\"flex items-start justify-between mb-3\">\n\n                      <div className=\"flex items-center gap-3\">\n\n                        {member.photoURL ? (\n\n                          <img\n\n                            src={member.photoURL}\n\n                            alt={`${member.firstName} ${member.lastName}`}\n\n                            className=\"w-10 h-10 rounded-full object-cover\"\n\n                          />\n\n                        ) : (\n\n                          <div className=\"w-10 h-10 rounded-full bg-muted flex items-center justify-center\">\n\n                            <Users className=\"h-5 w-5 text-muted-foreground\" />\n\n                          </div>\n\n                        )}\n\n                        <div>\n\n                          <h3 className=\"font-semibold\">{member.firstName} {member.lastName}</h3>\n\n                          <p className=\"text-sm text-muted-foreground\">\n\n                            {member.phoneNumber || 'Sin telfono'}\n\n                          </p>\n\n                        </div>\n\n                      </div>\n\n                    </div>\n\n\n\n                    {member.birthDate && (\n\n                      <p className=\"text-sm text-muted-foreground mb-3\">\n\n                        Nacimiento: {format(member.birthDate.toDate(), 'd MMM yyyy', { locale: es })}\n\n                      </p>\n\n                    )}\n\n\n\n                    <p className=\"text-sm text-muted-foreground mb-3\">\n\n                      ltima actividad: {member.lastActiveDate\n\n                        ? format(member.lastActiveDate.toDate(), 'd MMM yyyy', { locale: es })\n\n                        : 'Nunca'}\n\n                    </p>\n\n\n\n                    <div className=\"flex justify-end\">\n\n                      <Button\n\n                        variant=\"outline\"\n\n                        size=\"sm\"\n\n                        onClick={() => handleViewProfile(member.id)}\n\n                      >\n\n                        <Eye className=\"mr-2 h-4 w-4\" />\n\n                        Ver Perfil\n\n                      </Button>\n\n                    </div>\n\n                  </CardContent>\n\n                </Card>\n\n              ))\n\n            )}\n\n          </div>\n\n        </CardContent>\n\n      </Card>\n\n\n\n      {/* Seccin Compaerismos con familias menos activas */}\n\n      <Card ref={familyFocusCompanionshipsRef}>\n\n        <CardHeader>\n\n          <CardTitle className=\"flex items-center gap-2\">\n\n            <Users className=\"h-5 w-5 text-sky-600\" />\n\n            Familias que necesitan visita\n\n          </CardTitle>\n\n          <CardDescription>Compaerismos con familias asignadas donde hay miembros menos activos o inactivos.</CardDescription>\n\n        </CardHeader>\n\n        <CardContent>\n\n          {/* Desktop Table */}\n\n          <div className=\"hidden md:block\">\n\n            <Table>\n\n              <TableHeader>\n\n                <TableRow>\n\n                  <TableHead>Compaerismo</TableHead>\n\n                  <TableHead>Familias y estado</TableHead>\n\n                  <TableHead className=\"text-right\">Acciones</TableHead>\n\n                </TableRow>\n\n              </TableHeader>\n\n              <TableBody>\n\n                {loading ? (\n\n                  Array.from({ length: 3 }).map((_, i) => (\n\n                    <TableRow key={i}>\n\n                      <TableCell><Skeleton className=\"h-5 w-40\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-52\" /></TableCell>\n\n                      <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-24\" /></TableCell>\n\n                    </TableRow>\n\n                  ))\n\n                ) : familyFocusCompanionships.length === 0 ? (\n\n                  <TableRow>\n\n                    <TableCell colSpan={3} className=\"h-24 text-center text-muted-foreground\">\n\n                      No hay familias menos activas asignadas actualmente.\n\n                    </TableCell>\n\n                  </TableRow>\n\n                ) : (\n\n                  familyFocusCompanionships.map((companionship) => (\n\n                    <TableRow key={companionship.id}>\n\n                      <TableCell className=\"font-medium\">\n\n                        {companionship.companions.map((c, i) => (\n\n                          <div key={i}>\n\n                            <span>{c}</span>\n\n                            {i < companionship.companions.length - 1 && <hr className=\"my-1\" />}\n\n                          </div>\n\n                        ))}\n\n                      </TableCell>\n\n                      <TableCell>\n\n                        {companionship.flaggedFamilies.map((flagged, index) => (\n\n                          <div key={flagged.family.name} className=\"space-y-1 py-1\">\n\n                            <p className=\"font-medium\">{flagged.family.name}</p>\n\n                            <div className=\"flex flex-wrap gap-1\">\n\n                              {flagged.members.map((member) => {\n\n                                const statusInfo = statusConfig[member.status];\n\n                                const StatusIcon = statusInfo.icon;\n\n                                return (\n\n                                  <Badge key={member.id} variant={statusInfo.variant} className=\"gap-1\">\n\n                                    <StatusIcon className=\"h-3 w-3\" />\n\n                                    {member.firstName} {member.lastName}\n\n                                  </Badge>\n\n                                );\n\n                              })}\n\n                            </div>\n\n                            {index < companionship.flaggedFamilies.length - 1 && <div className=\"my-2 h-px bg-muted\" />}\n\n                          </div>\n\n                        ))}\n\n                      </TableCell>\n\n                      <TableCell className=\"text-right\">\n\n                        <Button\n\n                          variant=\"outline\"\n\n                          size=\"sm\"\n\n                          onClick={() => router.push(`/ministering/${companionship.id}`)}\n\n                          title=\"Ver compaerismo\"\n\n                        >\n\n                          <Eye className=\"h-4 w-4\" />\n\n                        </Button>\n\n                      </TableCell>\n\n                    </TableRow>\n\n                  ))\n\n                )}\n\n              </TableBody>\n\n            </Table>\n\n          </div>\n\n\n\n          {/* Mobile Cards */}\n\n          <div className=\"md:hidden space-y-4\">\n\n            {loading ? (\n\n              Array.from({ length: 2 }).map((_, i) => <Skeleton key={i} className=\"h-32 w-full\" />)\n\n            ) : familyFocusCompanionships.length === 0 ? (\n\n              <div className=\"text-center py-12\">\n\n                <Users className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n\n                <p className=\"text-muted-foreground\">No hay familias menos activas asignadas actualmente.</p>\n\n              </div>\n\n            ) : (\n\n              familyFocusCompanionships.map((companionship) => (\n\n                <Card key={companionship.id}>\n\n                  <CardContent className=\"pt-4 space-y-4\">\n\n                    <div>\n\n                      <p className=\"text-sm font-medium mb-2\">Compaeros:</p>\n\n                      {companionship.companions.map((c, i) => (\n\n                        <div key={i}>\n\n                          <p>{c}</p>\n\n                          {i < companionship.companions.length - 1 && <hr className=\"my-1\" />}\n\n                        </div>\n\n                      ))}\n\n                    </div>\n\n                    <div>\n\n                      <p className=\"text-sm font-medium mb-2\">Familias por animar:</p>\n\n                      {companionship.flaggedFamilies.map((flagged) => (\n\n                        <div key={flagged.family.name} className=\"mb-3 last:mb-0\">\n\n                          <p className=\"font-semibold\">{flagged.family.name}</p>\n\n                          <div className=\"mt-1 flex flex-wrap gap-1\">\n\n                            {flagged.members.map((member) => {\n\n                              const statusInfo = statusConfig[member.status];\n\n                              const StatusIcon = statusInfo.icon;\n\n                              return (\n\n                                <Badge key={member.id} variant={statusInfo.variant} className=\"gap-1\">\n\n                                  <StatusIcon className=\"h-3 w-3\" />\n\n                                  {member.firstName}\n\n                                </Badge>\n\n                              );\n\n                            })}\n\n                          </div>\n\n                        </div>\n\n                      ))}\n\n                    </div>\n\n                    <div className=\"flex justify-end\">\n\n                      <Button\n\n                        variant=\"outline\"\n\n                        size=\"sm\"\n\n                        onClick={() => router.push(`/ministering/${companionship.id}`)}\n\n                      >\n\n                        <Eye className=\"mr-2 h-4 w-4\" />Ver ms\n\n                      </Button>\n\n                    </div>\n\n                  </CardContent>\n\n                </Card>\n\n              ))\n\n            )}\n\n          </div>\n\n        </CardContent>\n\n      </Card>\n\n\n\n      {/* Seccin Compaeras Problemticas */}\n\n      <Card ref={problematicCompanionshipsRef}>\n\n        <CardHeader>\n\n          <CardTitle className=\"flex items-center gap-2\">\n\n            <Users className=\"h-5 w-5 text-orange-600\" />\n\n            Compaeras con Compaeros Inactivos o Menos Activos\n\n          </CardTitle>\n\n          <CardDescription>\n\n            Compaeras de ministracin donde uno o ms compaeros estn marcados como inactivos o menos activos.\n\n          </CardDescription>\n\n        </CardHeader>\n\n        <CardContent>\n\n          <div className=\"hidden md:block\">\n\n            <Table>\n\n              <TableHeader>\n\n                <TableRow>\n\n                  <TableHead>Compaeros</TableHead>\n\n                  <TableHead>Familias Asignadas</TableHead>\n\n                  <TableHead>Estado de Compaeros</TableHead>\n\n                  <TableHead className=\"text-right\">Acciones</TableHead>\n\n                </TableRow>\n\n              </TableHeader>\n\n              <TableBody>\n\n                {loading ? (\n\n                  Array.from({ length: 3 }).map((_, i) => (\n\n                    <TableRow key={i}>\n\n                      <TableCell><Skeleton className=\"h-5 w-40\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-5 w-48\" /></TableCell>\n\n                      <TableCell><Skeleton className=\"h-6 w-20 rounded-full\" /></TableCell>\n\n                      <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-24\" /></TableCell>\n\n                    </TableRow>\n\n                  ))\n\n                ) : problematicCompanionships.length === 0 ? (\n\n                  <TableRow>\n\n                    <TableCell colSpan={4} className=\"h-24 text-center\">\n\n                      Todas las compaeras tienen compaeros activos.\n\n                    </TableCell>\n\n                  </TableRow>\n\n                ) : (\n\n                  problematicCompanionships.map((companionship) => {\n\n                    const inactiveCompanions = companionship.companions.filter(companionName => {\n\n                      const member = members.find(m =>\n\n                        `${m.firstName} ${m.lastName}`.toLowerCase() === companionName.toLowerCase()\n\n                      );\n\n                      return member && (member.status === 'less_active' || member.status === 'inactive');\n\n                    });\n\n\n\n                    return (\n\n                      <TableRow key={companionship.id}>\n\n                        <TableCell className=\"font-medium\">\n\n                          {companionship.companions.map((c, i) => (\n\n                            <div key={i}>\n\n                              <span>{c}</span>\n\n                              {i < companionship.companions.length - 1 && <hr className=\"my-1\" />}\n\n                            </div>\n\n                          ))}\n\n                        </TableCell>\n\n                        <TableCell>\n\n                          {companionship.families.map((f, i) => (\n\n                            <div key={i}>\n\n                              <span>{f.name}</span>\n\n                              {i < companionship.families.length - 1 && <hr className=\"my-1\" />}\n\n                            </div>\n\n                          ))}\n\n                        </TableCell>\n\n                        <TableCell>\n\n                          <div className=\"flex flex-wrap gap-1\">\n\n                            {inactiveCompanions.map((companionName, i) => {\n\n                              const member = members.find(m =>\n\n                                `${m.firstName} ${m.lastName}`.toLowerCase() === companionName.toLowerCase()\n\n                              );\n\n                              if (!member) return null;\n\n                              const statusInfo = statusConfig[member.status];\n\n                              const StatusIcon = statusInfo.icon;\n\n                              return (\n\n                                <Badge key={i} variant={statusInfo.variant} className=\"gap-1\">\n\n                                  <StatusIcon className=\"h-3 w-3\" />\n\n                                  {statusInfo.label}\n\n                                </Badge>\n\n                              );\n\n                            })}\n\n                          </div>\n\n                        </TableCell>\n\n                        <TableCell className=\"text-right\">\n\n                          <Button\n\n                            variant=\"outline\"\n\n                            size=\"sm\"\n\n                            onClick={() => router.push(`/ministering/${companionship.id}`)}\n\n                            title=\"Ver compaera\"\n\n                          >\n\n                            <Eye className=\"h-4 w-4\" />\n\n                          </Button>\n\n                        </TableCell>\n\n                      </TableRow>\n\n                    );\n\n                  })\n\n                )}\n\n              </TableBody>\n\n            </Table>\n\n          </div>\n\n\n\n          {/* Mobile Cards */}\n\n          <div className=\"md:hidden space-y-4\">\n\n            {loading ? (\n\n              Array.from({ length: 2 }).map((_, i) => (\n\n                <Skeleton key={i} className=\"h-32 w-full\" />\n\n              ))\n\n            ) : problematicCompanionships.length === 0 ? (\n\n              <div className=\"text-center py-12\">\n\n                <Users className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n\n                <p className=\"text-muted-foreground\">\n\n                  Todas las compaeras tienen compaeros activos.\n\n                </p>\n\n              </div>\n\n            ) : (\n\n              problematicCompanionships.map((companionship) => {\n\n                const inactiveCompanions = companionship.companions.filter(companionName => {\n\n                  const member = members.find(m =>\n\n                    `${m.firstName} ${m.lastName}`.toLowerCase() === companionName.toLowerCase()\n\n                  );\n\n                  return member && (member.status === 'less_active' || member.status === 'inactive');\n\n                });\n\n\n\n                return (\n\n                  <Card key={companionship.id}>\n\n                    <CardContent className=\"pt-4\">\n\n                      <div className=\"mb-3\">\n\n                        <p className=\"text-sm font-medium mb-2\">Compaeros:</p>\n\n                        {companionship.companions.map((c, i) => (\n\n                          <div key={i}>\n\n                            <p>{c}</p>\n\n                            {i < companionship.companions.length - 1 && <hr className=\"my-1\" />}\n\n                          </div>\n\n                        ))}\n\n                      </div>\n\n\n\n                      <div className=\"mb-3\">\n\n                        <p className=\"text-sm font-medium mb-2\">Familias:</p>\n\n                        {companionship.families.map((f, i) => (\n\n                          <div key={i}>\n\n                            <p>{f.name}</p>\n\n                            {i < companionship.families.length - 1 && <hr className=\"my-1\" />}\n\n                          </div>\n\n                        ))}\n\n                      </div>\n\n\n\n                      <div className=\"mb-3\">\n\n                        <p className=\"text-sm font-medium mb-2\">Estado de Compaeros:</p>\n\n                        <div className=\"flex flex-wrap gap-1\">\n\n                          {inactiveCompanions.map((companionName, i) => {\n\n                            const member = members.find(m =>\n\n                              `${m.firstName} ${m.lastName}`.toLowerCase() === companionName.toLowerCase()\n\n                            );\n\n                            if (!member) return null;\n\n                            const statusInfo = statusConfig[member.status];\n\n                            const StatusIcon = statusInfo.icon;\n\n                            return (\n\n                              <Badge key={i} variant={statusInfo.variant} className=\"gap-1\">\n\n                                <StatusIcon className=\"h-3 w-3\" />\n\n                                {statusInfo.label}\n\n                              </Badge>\n\n                            );\n\n                          })}\n\n                        </div>\n\n                      </div>\n\n\n\n                      <div className=\"flex justify-end\">\n\n                        <Button\n\n                          variant=\"outline\"\n\n                          size=\"sm\"\n\n                          onClick={() => router.push(`/ministering/${companionship.id}`)}\n\n                        >\n\n                          <Eye className=\"mr-2 h-4 w-4\" />\n\n                          Ver Compaera\n\n                        </Button>\n\n                      </div>\n\n                    </CardContent>\n\n                  </Card>\n\n                );\n\n              })\n\n            )}\n\n          </div>\n\n        </CardContent>\n\n      </Card>\n\n\n\n      <Dialog\n        open={healthDialogOpen}\n        onOpenChange={(open) => {\n          setHealthDialogOpen(open);\n          if (!open) {\n            resetHealthForm();\n          }\n        }}\n      >\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>\n              {isEditingHealthConcern ? 'Editar persona con necesidades de salud' : 'Agregar persona con necesidades de salud'}\n            </DialogTitle>\n            <DialogDescription>\n              {isEditingHealthConcern\n                ? 'Actualiza la informacin para mantener coordinado el apoyo de salud.'\n                : 'Completa la informacin para organizar las visitas y el apoyo necesario.'}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...healthForm}>\n            <form onSubmit={healthForm.handleSubmit(handleHealthSubmit)} className=\"space-y-6\">\n              <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center\">\n                <Avatar className=\"h-16 w-16\">\n                  <AvatarImage src={photoPreview || undefined} alt=\"Foto seleccionada\" />\n                  <AvatarFallback>{getInitials(watchFirstName, watchLastName)}</AvatarFallback>\n                </Avatar>\n                <div className=\"flex flex-wrap gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => photoInputRef.current?.click()}\n                    disabled={savingHealthConcern}\n                  >\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    {photoPreview ? 'Cambiar foto' : 'Subir foto'}\n                  </Button>\n                  {photoPreview && (\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      onClick={handleRemovePhoto}\n                      disabled={savingHealthConcern}\n                    >\n                      <X className=\"mr-2 h-4 w-4\" />\n                      Quitar\n                    </Button>\n                  )}\n                </div>\n              </div>\n              <input\n                ref={photoInputRef}\n                type=\"file\"\n                accept=\"image/*\"\n                className=\"hidden\"\n                onChange={handlePhotoChange}\n                aria-label=\"Seleccionar foto para preocupacin de salud\"\n              />\n              <div className=\"grid gap-4 md:grid-cols-2\">\n                <FormField\n                  control={healthForm.control}\n                  name=\"firstName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Nombre</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"Nombre\" disabled={savingHealthConcern} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={healthForm.control}\n                  name=\"lastName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Apellido</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"Apellido\" disabled={savingHealthConcern} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={healthForm.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem className=\"md:col-span-2\">\n                      <FormLabel>Direccin</FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"Direccin o punto de referencia\"\n                          disabled={savingHealthConcern}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={healthForm.control}\n                  name=\"observation\"\n                  render={({ field }) => (\n                    <FormItem className=\"md:col-span-2\">\n                      <FormLabel>Observacin</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          {...field}\n                          placeholder=\"Detalle la situacin de salud y acciones sugeridas.\"\n                          rows={4}\n                          disabled={savingHealthConcern}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={healthForm.control}\n                  name=\"helperIds\"\n                  render={({ field }) => (\n                    <FormItem className=\"md:col-span-2\">\n                      <FormLabel>Miembros que ayudarn</FormLabel>\n                      <FormControl>\n                        <div className=\"space-y-3\">\n                          <Popover open={helperPickerOpen} onOpenChange={setHelperPickerOpen}>\n                            <PopoverTrigger asChild>\n                              <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                className={cn('w-full justify-between', field.value.length === 0 && 'text-muted-foreground')}\n                                disabled={loading || savingHealthConcern}\n                              >\n                                {field.value.length > 0\n                                  ? `${field.value.length} miembro${field.value.length > 1 ? 's' : ''} seleccionados`\n                                  : 'Seleccionar miembros'}\n                                <ChevronsUpDown className=\"ml-2 h-4 w-4 opacity-50\" />\n                              </Button>\n                            </PopoverTrigger>\n                            <PopoverContent\n                              align=\"start\"\n                              sideOffset={8}\n                              className=\"w-[min(320px,90vw)] max-h-[min(60vh,420px)] overflow-y-auto p-0\"\n                            >\n                              {loading ? (\n                                <div className=\"px-3 py-6 text-sm text-muted-foreground\">Cargando miembros...</div>\n                              ) : members.length === 0 ? (\n                                <div className=\"px-3 py-6 text-sm text-muted-foreground\">No hay miembros disponibles.</div>\n                              ) : (\n                                <Command>\n                                  <CommandInput placeholder=\"Buscar miembro...\" />\n                                  <CommandEmpty>No se encontraron miembros.</CommandEmpty>\n                                  <CommandGroup>\n                                    {members.map((member) => {\n                                      const isSelected = field.value.includes(member.id);\n                                      const statusInfo = statusConfig[member.status];\n                                      return (\n                                        <CommandItem\n                                          key={member.id}\n                                          value={`${member.firstName} ${member.lastName}`}\n                                          onSelect={() => {\n                                            toggleHelper(member.id);\n                                            setHelperPickerOpen(true);\n                                          }}\n                                        >\n                                          <div className=\"flex items-center gap-2\">\n                                            <Check className={cn('h-4 w-4', isSelected ? 'opacity-100' : 'opacity-0')} />\n                                            <span className=\"flex-1\">{member.firstName} {member.lastName}</span>\n                                            <Badge variant={statusInfo.variant} className=\"text-[10px]\">\n                                              {statusInfo.label}\n                                            </Badge>\n                                          </div>\n                                        </CommandItem>\n                                      );\n                                    })}\n                                  </CommandGroup>\n                                </Command>\n                              )}\n                            </PopoverContent>\n                          </Popover>\n                          <div className=\"flex flex-wrap gap-2\">\n                            {field.value.length === 0 ? (\n                              <span className=\"text-sm text-muted-foreground\">\n                                Selecciona al menos un miembro que brindar apoyo.\n                              </span>\n                            ) : (\n                              field.value.map((helperId, index) => {\n                                const helper = membersById.get(helperId);\n                                const helperName = helper\n                                  ? `${helper.firstName} ${helper.lastName}`\n                                  : 'Miembro sin registro';\n                                return (\n                                  <Badge\n                                    key={`${helperId}-${index}`}\n                                    variant=\"secondary\"\n                                    className=\"flex items-center gap-1\"\n                                  >\n                                    {helperName}\n                                    <button\n                                      type=\"button\"\n                                      onClick={() => toggleHelper(helperId)}\n                                      className=\"rounded-full p-0.5 hover:bg-muted\"\n                                      aria-label={`Quitar ${helperName}`}\n                                    >\n                                      <X className=\"h-3 w-3\" />\n                                    </button>\n                                  </Badge>\n                                );\n                              })\n                            )}\n                          </div>\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <DialogFooter className=\"flex flex-col gap-2 sm:flex-row sm:justify-end\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setHealthDialogOpen(false);\n                    resetHealthForm();\n                  }}\n                  disabled={savingHealthConcern}\n                >\n                  Cancelar\n                </Button>\n                <Button type=\"submit\" disabled={savingHealthConcern}>\n                  {savingHealthConcern ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      {isEditingHealthConcern ? 'Actualizando...' : 'Guardando...'}\n                    </>\n                  ) : (\n                    isEditingHealthConcern ? 'Actualizar registro' : 'Guardar registro'\n                  )}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {showScrollTop && (\n\n        <Button\n\n          onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}\n\n          className=\"fixed bottom-4 right-4 z-50 rounded-full p-3 shadow-lg bg-primary hover:bg-primary/90\"\n\n          size=\"icon\"\n\n          title=\"Volver al inicio\"\n\n        >\n\n          <ChevronUp className=\"h-5 w-5\" />\n\n        </Button>\n\n      )}\n\n    </section>\n\n  );\n\n}\n\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\app\\(main)\\page.tsx:142:5\n  140 |\n  141 |   useEffect(() => {\n> 142 |     fetchAnnotations();\n      |     ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  143 |   }, [authLoading, user])\n  144 |\n  145 |   const handleDeleteAnnotation = async (id: string) => {","line":142,"column":5,"nodeType":null,"endLine":142,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAnnotations'. Either include it or remove the dependency array.","line":143,"column":6,"nodeType":"ArrayExpression","endLine":143,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [authLoading, fetchAnnotations, user]","fix":{"range":[4278,4297],"text":"[authLoading, fetchAnnotations, user]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport Link from 'next/link';\nimport {\n  BookUser,\n  FileText,\n  Gavel,\n  HeartHandshake,\n} from \"lucide-react\";\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { OverviewChart } from \"@/components/dashboard/overview-chart\";\nimport { StatCard } from \"@/components/dashboard/stat-card\";\nimport { useI18n } from \"@/contexts/i18n-context\";\nimport { getDashboardData, getActivityChartData, getMembersByStatus } from \"@/lib/dashboard-data\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useEffect, useState } from \"react\";\nimport { VoiceAnnotations } from \"@/components/shared/voice-annotations\";\nimport type { Annotation } from \"@/lib/types\";\nimport {\n  addDoc,\n  doc,\n  getDocs,\n  query,\n  serverTimestamp,\n  updateDoc,\n  where,\n  orderBy,\n  deleteDoc,\n} from 'firebase/firestore';\nimport { annotationsCollection } from \"@/lib/collections\";\nimport logger from \"@/lib/logger\";\nimport { useAuth } from \"@/contexts/auth-context\";\nimport { useToast } from \"@/hooks/use-toast\";\n\n\nfunction StatCardSkeleton() {\n  return (\n     <Card>\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n        <Skeleton className=\"h-4 w-[120px]\" />\n        <Skeleton className=\"h-4 w-4\" />\n      </CardHeader>\n      <CardContent>\n        <Skeleton className=\"h-7 w-[50px] mb-2\" />\n        <Skeleton className=\"h-3 w-[150px]\" />\n      </CardContent>\n    </Card>\n  )\n}\n\n// Moved from server actions to be called on the client\nasync function getAnnotations(source: 'dashboard'): Promise<Annotation[]> {\n    try {\n        const q = query(\n            annotationsCollection,\n            where('source', '==', source),\n            where('isResolved', '==', false),\n            orderBy('createdAt', 'desc')\n        );\n\n        const snapshot = await getDocs(q);\n        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Annotation));\n\n        return data;\n\n    } catch (error: any) {\n        let errorMessage = \"Error fetching annotations.\";\n        if (error.code === 'failed-precondition') {\n            errorMessage = \"Query failed. It's likely you're missing a composite index in Firestore. Please check the browser's console for a link to create it.\";\n        }\n        logger.error({ error, message: errorMessage, source });\n        console.error(errorMessage, error);\n        return [];\n    }\n}\n\n\nfunction DashboardPage() {\n  const { t } = useI18n();\n  const { user, loading: authLoading } = useAuth();\n  const { toast } = useToast();\n  const [data, setData] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [annotations, setAnnotations] = useState<Annotation[]>([]);\n  const [loadingAnnotations, setLoadingAnnotations] = useState(true);\n  const [chartData, setChartData] = useState<any[]>([]);\n  const [loadingChart, setLoadingChart] = useState(true);\n  const [membersData, setMembersData] = useState<any>(null);\n  const [loadingMembers, setLoadingMembers] = useState(true);\n\n  useEffect(() => {\n    if (authLoading || !user) return; // Wait for authentication\n\n    async function loadData() {\n      setLoading(true);\n      const dashboardData = await getDashboardData();\n      setData(dashboardData);\n      setLoading(false);\n    }\n    loadData();\n  }, [authLoading, user]);\n\n  useEffect(() => {\n    if (authLoading || !user) return; // Wait for authentication\n\n    async function loadChartData() {\n        setLoadingChart(true);\n        const data = await getActivityChartData();\n        setChartData(data);\n        setLoadingChart(false);\n    }\n    loadChartData();\n  }, [authLoading, user])\n\n  useEffect(() => {\n    if (authLoading || !user) return; // Wait for authentication\n\n    async function loadMembersData() {\n        setLoadingMembers(true);\n        const data = await getMembersByStatus();\n        setMembersData(data);\n        setLoadingMembers(false);\n    }\n    loadMembersData();\n  }, [authLoading, user])\n\n  const fetchAnnotations = async () => {\n    if (authLoading || !user) return; // Wait for authentication\n    setLoadingAnnotations(true);\n    const result = await getAnnotations('dashboard');\n    setAnnotations(result);\n    setLoadingAnnotations(false);\n  }\n\n  useEffect(() => {\n    fetchAnnotations();\n  }, [authLoading, user])\n\n  const handleDeleteAnnotation = async (id: string) => {\n    try {\n      await deleteDoc(doc(annotationsCollection, id));\n      toast({ title: 'Anotacin Eliminada', description: 'La anotacin ha sido eliminada permanentemente.' });\n      fetchAnnotations();\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error({ error: errorMessage, message: 'Error deleting annotation', id });\n      toast({ title: 'Error al Eliminar', description: `Failed to delete annotation: ${errorMessage}`, variant: 'destructive' });\n    }\n  }\n\n  const {\n    convertsCount,\n    futureMembersCount,\n    ministeringReportRate,\n    councilActionsCount,\n  } = data || { convertsCount: 0, futureMembersCount: 0, ministeringReportRate: 0, councilActionsCount: 0 };\n\n\n  return (\n    <div className=\"flex flex-1 flex-col gap-4 md:gap-8\">\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {loading ? <StatCardSkeleton/> : <Link href=\"/converts\">\n          <StatCard\n            title={t(\"Total Converts\")}\n            value={String(convertsCount)}\n            icon={<HeartHandshake className=\"h-4 w-4 text-muted-foreground\" />}\n            description={t(\"in the last 18 months\")}\n          />\n        </Link>}\n         {loading ? <StatCardSkeleton/> : <Link href=\"/future-members\">\n          <StatCard\n            title={t(\"Future Members\")}\n            value={String(futureMembersCount)}\n            icon={<BookUser className=\"h-4 w-4 text-muted-foreground\" />}\n            description={t(\"with baptism date set\")}\n          />\n        </Link>}\n         {loading ? <StatCardSkeleton/> : <Link href=\"/reports\">\n          <StatCard\n            title={t(\"Reports Submitted\")}\n            value={`${ministeringReportRate}%`}\n            icon={<FileText className=\"h-4 w-4 text-muted-foreground\" />}\n            description={t(\"of ministering visits completed\")}\n          />\n        </Link>}\n         {loading ? <StatCardSkeleton/> : <Link href=\"/council\">\n          <StatCard\n            title={t(\"Council Actions\")}\n            value={String(councilActionsCount)}\n            icon={<Gavel className=\"h-4 w-4 text-muted-foreground\" />}\n            description={t(\"Active action items\")}\n          />\n        </Link>}\n      </div>\n      <div className=\"grid gap-4 md:gap-8 lg:grid-cols-2\">\n        <Link href=\"/reports\">\n          <Card>\n            <CardHeader>\n              <CardTitle>{t(\"Activity Overview\")}</CardTitle>\n            </CardHeader>\n            <CardContent className=\"pl-2\">\n              <OverviewChart data={chartData} loading={loadingChart} />\n            </CardContent>\n          </Card>\n        </Link>\n\n        <Link href=\"/members\">\n          <Card>\n            <CardHeader>\n              <CardTitle>{t(\"Members by Status\")}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {loadingMembers ? (\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <div className=\"h-4 bg-gray-200 rounded w-20\"></div>\n                    <div className=\"h-4 bg-gray-200 rounded w-8\"></div>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n                    <div className=\"h-4 bg-gray-200 rounded w-8\"></div>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <div className=\"h-4 bg-gray-200 rounded w-16\"></div>\n                    <div className=\"h-4 bg-gray-200 rounded w-8\"></div>\n                  </div>\n                </div>\n              ) : membersData ? (\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm font-medium text-green-600\">{t(\"Active Members\")}</span>\n                    <span className=\"text-sm font-bold\">{membersData.active.length}</span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm font-medium text-yellow-600\">{t(\"Less Active Members\")}</span>\n                    <span className=\"text-sm font-bold\">{membersData.lessActive.length}</span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm font-medium text-red-600\">{t(\"Inactive Members\")}</span>\n                    <span className=\"text-sm font-bold\">{membersData.inactive.length}</span>\n                  </div>\n                  <hr className=\"my-2\" />\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm font-semibold\">{t(\"Total Members\")}</span>\n                    <span className=\"text-sm font-bold\">{membersData.total}</span>\n                  </div>\n                </div>\n              ) : (\n                <p className=\"text-sm text-muted-foreground\">{t(\"No member data available\")}</p>\n              )}\n            </CardContent>\n          </Card>\n        </Link>\n      </div>\n\n       <div className=\"grid gap-4\">\n          <VoiceAnnotations\n              title=\"Anotaciones del Qurum\"\n              description=\"Aade notas rpidas o recordatorios para el qurum. Marca las que necesiten seguimiento en el consejo.\"\n              source=\"dashboard\"\n              annotations={annotations}\n              isLoading={loadingAnnotations}\n              onAnnotationAdded={fetchAnnotations}\n              onAnnotationToggled={fetchAnnotations}\n              onDeleteAnnotation={handleDeleteAnnotation}\n              currentUserId={user?.uid}\n           />\n      </div>\n    </div>\n  );\n}\n\nexport default function DashboardContainer() {\n  return <DashboardPage />;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\profile\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\reports\\ActivityForm.backup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\reports\\ActivityForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\reports\\[id]\\edit\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\reports\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\reports\\add-baptism\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\reports\\add\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\reports\\edit-baptism\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":403,"column":23,"nodeType":"JSXOpeningElement","endLine":407,"endColumn":25},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":419,"column":21,"nodeType":"JSXOpeningElement","endLine":423,"endColumn":23},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":499,"column":23,"nodeType":"JSXOpeningElement","endLine":503,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { doc, getDoc, updateDoc, deleteDoc, Timestamp } from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage';\nimport { v4 as uuidv4 } from 'uuid';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/hooks/use-toast';\nimport { baptismsCollection, storage } from '@/lib/collections';\nimport { Baptism } from '@/lib/types';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { formatDateForInput } from '@/lib/utils/date';\nimport { Calendar } from '@/components/ui/calendar';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { CalendarIcon, Camera, Trash2, Upload } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport default function EditBaptismPage() {\n  const router = useRouter();\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [deleting, setDeleting] = useState(false);\n  const [baptism, setBaptism] = useState<Baptism | null>(null);\n  const [date, setDate] = useState<Date | undefined>(new Date());\n  const [photoFile, setPhotoFile] = useState<File | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [baptismPhotoFiles, setBaptismPhotoFiles] = useState<File[]>([]);\n  const [uploadingBaptismPhotos, setUploadingBaptismPhotos] = useState(false);\n\n  useEffect(() => {\n    const idParam = typeof window !== 'undefined' ? new URLSearchParams(window.location.search).get('id') : null;\n    if (!idParam) {\n      setLoading(false);\n      toast({ title: 'Error', description: 'ID de bautismo no proporcionado.', variant: 'destructive' });\n      router.push('/reports');\n      return;\n    }\n    const fetchBaptism = async () => {\n      try {\n        const docRef = doc(baptismsCollection, idParam);\n        const docSnap = await getDoc(docRef);\n        \n        if (docSnap.exists()) {\n          const data = { id: docSnap.id, ...docSnap.data() } as Baptism;\n          setBaptism(data);\n          setDate(data.date?.toDate());\n        } else {\n          toast({\n            title: 'Error',\n            description: 'No se encontr el registro de bautismo.',\n            variant: 'destructive',\n          });\n          router.push('/reports');\n        }\n      } catch (error) {\n        console.error('Error fetching baptism:', error);\n        toast({\n          title: 'Error',\n          description: 'No se pudo cargar el registro de bautismo.',\n          variant: 'destructive',\n        });\n        router.push('/reports');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchBaptism();\n  }, [router, toast]);\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const { name, value } = e.target;\n    setBaptism(prev => (prev ? { ...prev, [name]: value } : null));\n  };\n\n  const handleDateSelect = (selectedDate: Date | undefined) => {\n    if (selectedDate) {\n      setDate(selectedDate);\n      setBaptism(prev => (prev ? { ...prev, date: Timestamp.fromDate(selectedDate) } : null));\n    }\n  };\n\n  const handlePhotoChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files[0]) {\n      setPhotoFile(e.target.files[0]);\n    }\n  };\n\n  const handleBaptismPhotosChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) {\n      setBaptismPhotoFiles(Array.from(e.target.files));\n    }\n  };\n\n  const uploadPhoto = async (file: File, path: string): Promise<string> => {\n    const storageRef = ref(storage, `${path}/${uuidv4()}_${file.name}`);\n    await uploadBytes(storageRef, file);\n    return getDownloadURL(storageRef);\n  };\n\n  const handleUploadPhoto = async () => {\n    if (!photoFile || !baptism) return;\n    \n    try {\n      setUploading(true);\n      const photoURL = await uploadPhoto(photoFile, `baptisms/${baptism.id}/profile`);\n      \n      // Delete old photo if exists\n      if (baptism.photoURL) {\n        try {\n          const oldPhotoRef = ref(storage, baptism.photoURL);\n          await deleteObject(oldPhotoRef);\n        } catch (error) {\n          console.warn('Could not delete old photo:', error);\n        }\n      }\n      \n      setBaptism(prev => (prev ? { ...prev, photoURL } : null));\n      setPhotoFile(null);\n      \n      toast({\n        title: 'xito',\n        description: 'Foto de perfil actualizada correctamente.',\n      });\n    } catch (error) {\n      console.error('Error uploading photo:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo subir la foto de perfil.',\n        variant: 'destructive',\n      });\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleUploadBaptismPhotos = async () => {\n    if (baptismPhotoFiles.length === 0 || !baptism) return;\n    \n    try {\n      setUploadingBaptismPhotos(true);\n      const uploadPromises = baptismPhotoFiles.map(file => \n        uploadPhoto(file, `baptisms/${baptism.id}/baptism`)\n      );\n      \n      const newPhotoURLs = await Promise.all(uploadPromises);\n      const updatedBaptismPhotos = [...(baptism.baptismPhotos || []), ...newPhotoURLs];\n      \n      setBaptism(prev => (prev ? { ...prev, baptismPhotos: updatedBaptismPhotos } : null));\n      setBaptismPhotoFiles([]);\n      \n      toast({\n        title: 'xito',\n        description: 'Fotos del bautismo subidas correctamente.',\n      });\n    } catch (error) {\n      console.error('Error uploading baptism photos:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudieron subir las fotos del bautismo.',\n        variant: 'destructive',\n      });\n    } finally {\n      setUploadingBaptismPhotos(false);\n    }\n  };\n\n  const handleDeleteBaptismPhoto = async (photoUrl: string) => {\n    if (!baptism) return;\n    \n    try {\n      // Remove from storage\n      const photoRef = ref(storage, photoUrl);\n      await deleteObject(photoRef);\n      \n      // Update state\n      const updatedPhotos = baptism.baptismPhotos?.filter(photo => photo !== photoUrl) || [];\n      setBaptism(prev => (prev ? { ...prev, baptismPhotos: updatedPhotos } : null));\n      \n      toast({\n        title: 'xito',\n        description: 'Foto eliminada correctamente.',\n      });\n    } catch (error) {\n      console.error('Error deleting photo:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo eliminar la foto.',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!baptism) return;\n    \n    try {\n      setSaving(true);\n      const docRef = doc(baptismsCollection, baptism.id);\n      // Prepare updated photo fields\n      let nextPhotoURL = baptism.photoURL || '';\n      let nextBaptismPhotos: string[] = baptism.baptismPhotos || [];\n\n      // If there is a new profile photo selected, upload it first\n      let oldProfileToDelete: string | null = null;\n      if (photoFile) {\n        const uploaded = await uploadPhoto(photoFile, `baptisms/${baptism.id}/profile`);\n        oldProfileToDelete = baptism.photoURL || null;\n        nextPhotoURL = uploaded;\n      }\n\n      // If there are new baptism photos selected, upload and append\n      if (baptismPhotoFiles.length > 0) {\n        const uploadedList = await Promise.all(\n          baptismPhotoFiles.map(file => uploadPhoto(file, `baptisms/${baptism.id}/baptism`))\n        );\n        nextBaptismPhotos = [...nextBaptismPhotos, ...uploadedList];\n      }\n\n      await updateDoc(docRef, {\n        name: baptism.name,\n        date: baptism.date,\n        observation: baptism.observation || '',\n        photoURL: nextPhotoURL,\n        baptismPhotos: nextBaptismPhotos,\n      });\n\n      // After saving, delete old profile photo if replaced\n      if (oldProfileToDelete) {\n        try { await deleteObject(ref(storage, oldProfileToDelete)); } catch {}\n      }\n\n      // Clear transient selections\n      setPhotoFile(null);\n      setBaptismPhotoFiles([]);\n      \n      toast({\n        title: 'xito',\n        description: 'Registro de bautismo actualizado correctamente.',\n      });\n      \n      router.push('/reports');\n    } catch (error) {\n      console.error('Error updating baptism:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo actualizar el registro de bautismo.',\n        variant: 'destructive',\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!baptism) return;\n    \n    try {\n      setDeleting(true);\n      // Delete photos from storage first\n      const deletePromises: Promise<void>[] = [];\n      \n      if (baptism.photoURL) {\n        deletePromises.push(deleteObject(ref(storage, baptism.photoURL)));\n      }\n      \n      if (baptism.baptismPhotos) {\n        baptism.baptismPhotos.forEach(photoUrl => {\n          deletePromises.push(deleteObject(ref(storage, photoUrl)));\n        });\n      }\n      \n      await Promise.all(deletePromises);\n      \n      // Delete the document\n      await deleteDoc(doc(baptismsCollection, baptism.id));\n      \n      toast({\n        title: 'xito',\n        description: 'Registro de bautismo eliminado correctamente.',\n      });\n      \n      router.push('/reports');\n    } catch (error) {\n      console.error('Error deleting baptism:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudo eliminar el registro de bautismo.',\n        variant: 'destructive',\n      });\n    } finally {\n      setDeleting(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"container mx-auto p-6 max-w-4xl\">\n        <h1 className=\"text-2xl font-bold mb-6\">Cargando registro de bautismo...</h1>\n      </div>\n    );\n  }\n\n  if (!baptism) {\n    return (\n      <div className=\"container mx-auto p-6 max-w-4xl\">\n        <h1 className=\"text-2xl font-bold mb-6\">Registro no encontrado</h1>\n        <p>El registro de bautismo solicitado no pudo ser cargado.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 md:p-6 max-w-4xl\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-2xl font-bold\">Editar Bautismo</h1>\n        <Button \n          variant=\"outline\" \n          onClick={() => router.push('/reports')}\n        >\n          Volver a Reportes\n        </Button>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {/* Left Column */}\n          <div className=\"space-y-6\">\n            <div>\n              <Label htmlFor=\"name\">Nombre Completo</Label>\n              <Input\n                id=\"name\"\n                name=\"name\"\n                value={baptism.name || ''}\n                onChange={handleInputChange}\n                required\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <Label>Fecha de Bautismo</Label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\n                      \"w-full justify-start text-left font-normal mt-1\",\n                      !date && \"text-muted-foreground\"\n                    )}\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {date ? format(date, \"PPP\", { locale: es }) : <span>Seleccione una fecha</span>}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\">\n                  <Calendar\n                    mode=\"single\"\n                    selected={date}\n                    onSelect={handleDateSelect}\n                    initialFocus\n                    locale={es}\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            <div>\n              <Label>Origen</Label>\n              <div className=\"mt-1 p-2 border rounded-md bg-muted/50\">\n                {baptism.source}\n              </div>\n            </div>\n\n            <div>\n              <Label htmlFor=\"observation\">Observaciones</Label>\n              <Textarea\n                id=\"observation\"\n                name=\"observation\"\n                value={baptism.observation || ''}\n                onChange={handleInputChange}\n                rows={4}\n                className=\"mt-1\"\n              />\n            </div>\n          </div>\n\n          {/* Right Column - Photo Upload */}\n          <div className=\"space-y-6\">\n            <div>\n              <Label>Foto de Perfil</Label>\n              <div className=\"mt-1 flex items-center space-x-4\">\n                <div className=\"relative w-24 h-24 rounded-full overflow-hidden border-2 border-dashed border-muted-foreground/25 flex items-center justify-center\">\n                  {baptism.photoURL ? (\n                    <>\n                      <img \n                        src={baptism.photoURL} \n                        alt={`${baptism.name} foto`} \n                        className=\"w-full h-full object-cover\"\n                      />\n                      <button\n                        type=\"button\"\n                        onClick={() => setBaptism(prev => (prev ? { ...prev, photoURL: '' } : null))}\n                        className=\"absolute top-0 right-0 bg-destructive text-white rounded-full p-1 -m-2 hover:bg-destructive/90\"\n                        title=\"Eliminar foto de perfil\"\n                        aria-label=\"Eliminar foto de perfil\"\n                      >\n                        <Trash2 className=\"h-3 w-3\" />\n                      </button>\n                    </>\n                  ) : photoFile ? (\n                    <img \n                      src={URL.createObjectURL(photoFile)} \n                      alt=\"Vista previa\" \n                      className=\"w-full h-full object-cover\"\n                    />\n                  ) : (\n                    <Camera className=\"h-8 w-8 text-muted-foreground\" />\n                  )}\n                </div>\n                <div className=\"flex-1\">\n                  <Input\n                    id=\"photo\"\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={handlePhotoChange}\n                    className=\"hidden\"\n                  />\n                  <div className=\"space-y-2\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => document.getElementById('photo')?.click()}\n                      className=\"w-full\"\n                    >\n                      <Upload className=\"h-4 w-4 mr-2\" />\n                      {photoFile ? 'Cambiar foto' : 'Seleccionar foto'}\n                    </Button>\n                    {photoFile && (\n                      <Button\n                        type=\"button\"\n                        size=\"sm\"\n                        onClick={handleUploadPhoto}\n                        disabled={uploading}\n                        className=\"w-full\"\n                      >\n                        {uploading ? 'Subiendo...' : 'Guardar foto'}\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div>\n              <Label>Fotos del Bautismo</Label>\n              <div className=\"mt-2\">\n                <Input\n                  id=\"baptism-photos\"\n                  type=\"file\"\n                  accept=\"image/*\"\n                  multiple\n                  onChange={handleBaptismPhotosChange}\n                  className=\"hidden\"\n                />\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => document.getElementById('baptism-photos')?.click()}\n                  className=\"w-full mb-4\"\n                >\n                  <Upload className=\"h-4 w-4 mr-2\" />\n                  Seleccionar fotos del bautismo\n                </Button>\n\n                {baptismPhotoFiles.length > 0 && (\n                  <Button\n                    type=\"button\"\n                    onClick={handleUploadBaptismPhotos}\n                    disabled={uploadingBaptismPhotos}\n                    className=\"w-full mb-4\"\n                  >\n                    {uploadingBaptismPhotos ? 'Subiendo...' : `Subir ${baptismPhotoFiles.length} fotos`}\n                  </Button>\n                )}\n\n                <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-2\">\n                  {baptism.baptismPhotos?.map((photoUrl, index) => (\n                    <div key={index} className=\"relative group\">\n                      <img \n                        src={photoUrl} \n                        alt={`Bautismo ${index + 1}`} \n                        className=\"w-full h-32 object-cover rounded-md\"\n                      />\n                      <button\n                        type=\"button\"\n                        onClick={() => handleDeleteBaptismPhoto(photoUrl)}\n                        className=\"absolute top-1 right-1 bg-destructive text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity\"\n                        title=\"Eliminar foto de bautismo\"\n                        aria-label={`Eliminar foto de bautismo ${index + 1}`}\n                      >\n                        <Trash2 className=\"h-3 w-3\" />\n                      </button>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex justify-between pt-6 border-t\">\n          <Button\n            type=\"button\"\n            variant=\"destructive\"\n            onClick={handleDelete}\n            disabled={deleting}\n          >\n            {deleting ? 'Eliminando...' : 'Eliminar Registro'}\n          </Button>\n          \n          <div className=\"space-x-4\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => router.push('/reports')}\n              disabled={saving}\n            >\n              Cancelar\n            </Button>\n            <Button type=\"submit\" disabled={saving}>\n              {saving ? 'Guardando...' : 'Guardar Cambios'}\n            </Button>\n          </div>\n        </div>\n      </form>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\reports\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\service\\ServiceForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\service\\[id]\\edit\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\service\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\service\\add\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\service\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\app\\(main)\\service\\page.tsx:103:7\n  101 |   useEffect(() => {\n  102 |     if (!authLoading && user) {\n> 103 |       fetchServices();\n      |       ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  104 |     }\n  105 |   }, [authLoading, user]);\n  106 |   ","line":103,"column":7,"nodeType":null,"endLine":103,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchServices'. Either include it or remove the dependency array.","line":105,"column":6,"nodeType":"ArrayExpression","endLine":105,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [authLoading, fetchServices, user]","fix":{"range":[2994,3013],"text":"[authLoading, fetchServices, user]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useEffect, useState, useTransition, useRef } from 'react';\nimport Link from 'next/link';\nimport { getDocs, query, orderBy, Timestamp, addDoc, deleteDoc, doc } from 'firebase/firestore';\nimport { servicesCollection } from '@/lib/collections';\nimport type { Service } from '@/lib/types';\nimport { addDays, format, isAfter, isBefore } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { useToast } from '@/hooks/use-toast';\nimport { z } from 'zod';\nimport logger from '@/lib/logger';\nimport { useAuth } from '@/contexts/auth-context';\n\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Calendar } from '@/components/ui/calendar';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { CalendarIcon, PlusCircle, Trash2, Pencil, Image as ImageIcon } from 'lucide-react';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Textarea } from '@/components/ui/textarea';\nimport { cn } from '@/lib/utils';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { ServiceForm } from './ServiceForm';\nimport Image from 'next/image';\n\n\nasync function getServices(): Promise<Service[]> {\n  try {\n    const q = query(servicesCollection, orderBy('date', 'desc'));\n    const snapshot = await getDocs(q);\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as Service));\n  } catch (error) {\n    logger.error({ error, message: 'Error fetching services' });\n    throw error; // Re-throw to be handled by caller\n  }\n}\n\nexport default function ServicePage() {\n  const { user, loading: authLoading } = useAuth();\n  const [services, setServices] = useState<Service[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n  \n  const fetchServices = () => {\n    setLoading(true);\n    getServices()\n        .then(data => {\n            setServices(data);\n        })\n        .catch(err => {\n            logger.error({ error: err, message: \"Failed to fetch services\" });\n            toast({ title: \"Error\", description: \"No se pudieron cargar los servicios.\", variant: \"destructive\" });\n        })\n        .finally(() => {\n            setLoading(false);\n        });\n  };\n\n  useEffect(() => {\n    if (!authLoading && user) {\n      fetchServices();\n    }\n  }, [authLoading, user]);\n  \n  const handleDelete = async (serviceId: string) => {\n    try {\n      await deleteDoc(doc(servicesCollection, serviceId));\n      toast({\n        title: 'Servicio Eliminado',\n        description: 'El registro ha sido eliminado exitosamente.',\n      });\n      fetchServices(); // Refresh the list\n    } catch (error) {\n      logger.error({ error, message: 'Error deleting service', serviceId });\n      toast({\n        title: 'Error',\n        description: 'No se pudo eliminar el servicio.',\n        variant: 'destructive',\n      });\n    }\n  };\n\n\n  const upcomingServices = services.filter(service => {\n    const serviceDate = service.date.toDate();\n    const today = new Date();\n    const fourteenDaysFromNow = addDays(new Date(), 14);\n    today.setHours(0,0,0,0); // Start of today\n    \n    return isAfter(serviceDate, today) && isBefore(serviceDate, fourteenDaysFromNow);\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Prximos Servicios</CardTitle>\n          <CardDescription>\n            Proyectos de servicio planeados para los prximos 14 das.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {loading ? (\n            <Skeleton className=\"h-20 w-full\" />\n          ) : upcomingServices.length > 0 ? (\n            <ul className=\"space-y-3\">\n              {upcomingServices.map(service => (\n                <li key={service.id} className=\"p-3 bg-muted/50 rounded-md\">\n                  <div className=\"flex justify-between items-start\">\n                    <div className=\"flex-1\">\n                      <p className=\"font-semibold\">{service.title}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {format(service.date.toDate(), \"'El' d 'de' LLLL\", { locale: es })}\n                        {service.time ? ` a las ${service.time}` : ''} - {service.description}\n                      </p>\n                    </div>\n                    {service.imageUrls && service.imageUrls.length > 0 && (\n                      <div className=\"ml-3 flex items-center gap-1 text-xs text-muted-foreground\">\n                        <ImageIcon className=\"h-3 w-3\" />\n                        {service.imageUrls.length}\n                      </div>\n                    )}\n                  </div>\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <p className=\"text-center text-sm text-muted-foreground py-4\">\n              No hay servicios programados para los prximos 14 das.\n            </p>\n          )}\n        </CardContent>\n      </Card>\n    \n      <Card>\n        <CardHeader>\n          <div className=\"flex justify-between items-start\">\n            <div>\n              <CardTitle>Lista de Servicios</CardTitle>\n              <CardDescription>\n                Todos los proyectos de servicio, pasados y futuros.\n              </CardDescription>\n            </div>\n            <Button asChild>\n                <Link href=\"/service/add\">\n                    <PlusCircle className=\"mr-2 h-4 w-4\" />\n                    Servicio\n                </Link>\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Ttulo</TableHead>\n                <TableHead className=\"hidden md:table-cell\">Descripcin</TableHead>\n                <TableHead>Fecha</TableHead>\n                <TableHead className=\"text-center\">Imgenes</TableHead>\n                <TableHead className=\"text-right\">Acciones</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {loading ? (\n                Array.from({ length: 3 }).map((_, i) => (\n                  <TableRow key={i}>\n                    <TableCell><Skeleton className=\"h-5 w-32\" /></TableCell>\n                    <TableCell className=\"hidden md:table-cell\"><Skeleton className=\"h-5 w-48\" /></TableCell>\n                    <TableCell><Skeleton className=\"h-5 w-24\" /></TableCell>\n                    <TableCell className=\"text-center\"><Skeleton className=\"h-5 w-8 inline-block\" /></TableCell>\n                    <TableCell className=\"text-right\"><Skeleton className=\"h-8 w-8 inline-block\" /></TableCell>\n                  </TableRow>\n                ))\n              ) : services.length === 0 ? (\n                <TableRow>\n                  <TableCell colSpan={5} className=\"h-24 text-center\">\n                    No hay servicios registrados.\n                  </TableCell>\n                </TableRow>\n              ) : (\n                services.map((item) => (\n                  <TableRow key={item.id}>\n                    <TableCell className=\"font-medium\">{item.title}</TableCell>\n                    <TableCell className=\"hidden md:table-cell max-w-sm truncate\">{item.description}</TableCell>\n                    <TableCell>\n                      {format(item.date.toDate(), \"d MMM, yyyy\", { locale: es })}\n                      {item.time ? `, ${item.time}` : ''}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.imageUrls && item.imageUrls.length > 0 ? (\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button variant=\"ghost\" size=\"sm\" className=\"flex items-center gap-1\">\n                              <ImageIcon className=\"h-4 w-4\" />\n                              {item.imageUrls.length}\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent className=\"max-w-4xl\">\n                            <DialogHeader>\n                              <DialogTitle>Imgenes del Servicio: {item.title}</DialogTitle>\n                              <DialogDescription>\n                                Imgenes relacionadas con este proyecto de servicio.\n                              </DialogDescription>\n                            </DialogHeader>\n                            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 max-h-96 overflow-y-auto\">\n                              {item.imageUrls.map((url, index) => (\n                                <div key={index} className=\"relative\">\n                                  <Image\n                                    src={url}\n                                    alt={`Imagen ${index + 1} del servicio ${item.title}`}\n                                    width={200}\n                                    height={200}\n                                    className=\"w-full h-32 object-cover rounded-md\"\n                                  />\n                                </div>\n                              ))}\n                            </div>\n                          </DialogContent>\n                        </Dialog>\n                      ) : (\n                        <span className=\"text-muted-foreground text-sm\">Sin imgenes</span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                       <Button variant=\"ghost\" size=\"icon\" asChild>\n                         <Link href={`/service/${item.id}/edit`}><Pencil className=\"h-4 w-4\" /></Link>\n                       </Button>\n                       <AlertDialog>\n                        <AlertDialogTrigger asChild>\n                          <Button variant=\"ghost\" size=\"icon\">\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent>\n                          <AlertDialogHeader>\n                            <AlertDialogTitle>Ests seguro?</AlertDialogTitle>\n                            <AlertDialogDescription>\n                              Esta accin no se puede deshacer. Esto eliminar permanentemente el servicio: <strong>{item.title}</strong>.\n                            </AlertDialogDescription>\n                          </AlertDialogHeader>\n                          <AlertDialogFooter>\n                            <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                            <AlertDialogAction\n                              onClick={() => handleDelete(item.id)}\n                              className=\"bg-destructive hover:bg-destructive/90\"\n                            >\n                              Eliminar\n                            </AlertDialogAction>\n                          </AlertDialogFooter>\n                        </AlertDialogContent>\n                      </AlertDialog>\n                    </TableCell>\n                  </TableRow>\n                ))\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\(main)\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\api\\members\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\api\\members\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\api\\suggestions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\global-error.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Invalid character.","line":52,"column":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect } from 'react'\n\n// Dynamically import Sentry only if available\nlet Sentry: any = null;\nif (typeof window !== 'undefined') {\n  try {\n    Sentry = require('@sentry/nextjs');\n  } catch (error) {\n    // Sentry is optional\n  }\n}\n\n// Fallback translations for global error (when i18n context might not be available)\nconst translations = {\n  es: {\n    title: 'Algo sali mal',\n    description: 'Ha ocurrido un error inesperado. Nuestro equipo ha sido notificado.',\n    tryAgain: 'Intentar de nuevo',\n    goHome: 'Volver al inicio',\n    errorDetails: 'Detalles del error (desarrollo)'\n  },\n  en: {\n    title: 'Something went wrong',\n    description: 'An unexpected error occurred. Our team has been notified.',\n    tryAgain: 'Try again',\n    goHome: 'Go to home',\n    errorDetails: 'Error details (development)'\n  }\n}\n\n// Simple language detection fallback\nconst getLanguage = (): 'es' | 'en' => {\n  if (typeof window !== 'undefined') {\n    const stored = localStorage.getItem('language')\n    if (stored === 'en' || stored === 'es') return stored\n    return navigator.language.startsWith('es') ? 'es' : 'en'\n  }\n  return 'es' // Default to Spanish\n}\n\ninterface GlobalErrorProps {\n  error: Error & { digest?: string }\n  reset: () => void\n}\n\nexport default function GlobalError({ error, reset }: GlobalErrorProps) {\n  const lang = getLanguage()\n  const t = translations[lang]\n\n    useEffect(() => {\\n    // Log the error to Sentry with additional context\\n    if (Sentry?.captureException) {\\n      Sentry.captureException(error, {\\n        tags: {\\n          component: 'GlobalError',\\n          errorBoundary: true\\n        },\\n        extra: {\\n          digest: error.digest,\\n          timestamp: new Date().toISOString()\\n        }\\n      })\\n    }\\n  }, [error])\n\n  const handleGoHome = () => {\n    window.location.href = '/'\n  }\n\n  return (\n    <html lang={lang}>\n      <body>\n        <div className=\"flex min-h-screen flex-col items-center justify-center bg-gray-50 px-4\">\n          <div className=\"w-full max-w-md text-center\">\n            <div className=\"mb-8\">\n              <h1 className=\"text-6xl font-bold text-gray-900\" aria-label=\"Error 500\">\n                500\n              </h1>\n              <h2 className=\"mt-4 text-2xl font-semibold text-gray-700\">\n                {t.title}\n              </h2>\n              <p className=\"mt-2 text-gray-600\">\n                {t.description}\n              </p>\n            </div>\n            \n            <div className=\"space-y-4\">\n              <button\n                onClick={reset}\n                className=\"w-full rounded-lg bg-blue-600 px-4 py-2 text-white font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors\"\n                aria-label={t.tryAgain}\n              >\n                {t.tryAgain}\n              </button>\n              \n              <button\n                onClick={handleGoHome}\n                className=\"w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-gray-700 font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors\"\n                aria-label={t.goHome}\n              >\n                {t.goHome}\n              </button>\n            </div>\n            \n            {process.env.NODE_ENV === 'development' && (\n              <details className=\"mt-8 text-left\">\n                <summary className=\"cursor-pointer text-sm text-gray-500 hover:text-gray-700\">\n                  {t.errorDetails}\n                </summary>\n                <pre className=\"mt-2 overflow-auto rounded bg-gray-100 p-4 text-xs text-gray-800 max-h-64\">\n                  <code>\n                    {error.message}\n                    {error.stack && `\\n\\nStack trace:\\n${error.stack}`}\n                    {error.digest && `\\n\\nDigest: ${error.digest}`}\n                  </code>\n                </pre>\n              </details>\n            )}\n          </div>\n        </div>\n      </body>\n    </html>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\layout.tsx","messages":[{"ruleId":"@next/next/no-page-custom-font","severity":1,"message":"Custom fonts not added in `pages/_document.js` will only load for a single page. This is discouraged. See: https://nextjs.org/docs/messages/no-page-custom-font","line":25,"column":9,"nodeType":"JSXOpeningElement","endLine":28,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Metadata } from \"next\";\nimport \"./globals.css\";\nimport { Analytics } from '@vercel/analytics/react';\nimport { SpeedInsights } from '@vercel/speed-insights/next';\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { I18nProvider } from \"@/contexts/i18n-context\";\n\nexport const metadata: Metadata = {\n  title: \"QuorumFlow\",\n  description: \"Management tool for the Elders Quorum secretary.\",\n  manifest: \"/manifest.json\",\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"en\" suppressHydrationWarning>\n      <head>\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossOrigin=\"anonymous\" />\n        <link\n          href=\"https://fonts.googleapis.com/css2?family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap\"\n          rel=\"stylesheet\"\n        />\n      </head>\n      <body className=\"font-body antialiased\">\n        <ThemeProvider\n          attribute=\"class\"\n          defaultTheme=\"system\"\n          enableSystem\n          disableTransitionOnChange\n        >\n          <I18nProvider>\n            {children}\n            <Toaster />\n            <Analytics />\n            <SpeedInsights />\n          </I18nProvider>\n        </ThemeProvider>\n      </body>\n    </html>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\app\\no-permission\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\__tests__\\update-notification.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\auth-settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\changelog-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\client-offline-indicator.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\components\\client-offline-indicator.tsx:62:13\n  60 |         if (!isOnline) {\n  61 |             // User went offline\n> 62 |             setWasOffline(true);\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  63 |             setShowOnlineIndicator(false);\n  64 |             if (timeoutRef.current) {\n  65 |                 clearTimeout(timeoutRef.current);","line":62,"column":13,"nodeType":null,"endLine":62,"endColumn":26},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\components\\client-offline-indicator.tsx:102:9\n  100 |         if (hasShownInstallBannerBefore()) return;\n  101 |\n> 102 |         setShowInstalledIndicator(true);\n      |         ^^^^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  103 |         installTimeoutRef.current = setTimeout(() => {\n  104 |             setShowInstalledIndicator(false);\n  105 |             markInstallBannerShown();","line":102,"column":9,"nodeType":null,"endLine":102,"endColumn":34}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useOffline } from '@/hooks/use-offline';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport {\n    WifiOff,\n    Wifi,\n    Download,\n    RefreshCw,\n    CheckCircle,\n    Clock,\n    Smartphone,\n    X,\n    ChevronDown,\n    ChevronUp\n} from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useState, useEffect, useRef } from 'react';\n\nfunction ClientOfflineIndicator() {\n    const {\n        isOnline,\n        isInstalled,\n        syncInProgress,\n        queuedOperations,\n        forceSync,\n        installApp,\n        canInstall\n    } = useOffline();\n\n    const { toast } = useToast();\n    const [showOnlineIndicator, setShowOnlineIndicator] = useState(false);\n    const [wasOffline, setWasOffline] = useState(false);\n    const timeoutRef = useRef<NodeJS.Timeout>();\n    const [showInstalledIndicator, setShowInstalledIndicator] = useState(false);\n    const installTimeoutRef = useRef<NodeJS.Timeout>();\n    const [offlineMinimized, setOfflineMinimized] = useState(false);\n\n    // Helpers to ensure the installed banner shows only once\n    const hasShownInstallBannerBefore = () => {\n        try {\n            return localStorage.getItem('pwaToastShown') === 'true';\n        } catch {\n            return false;\n        }\n    };\n\n    const markInstallBannerShown = () => {\n        try {\n            localStorage.setItem('pwaToastShown', 'true');\n        } catch {\n            // ignore storage errors\n        }\n    };\n\n    // Effect to handle online/offline state changes\n    useEffect(() => {\n        if (!isOnline) {\n            // User went offline\n            setWasOffline(true);\n            setShowOnlineIndicator(false);\n            if (timeoutRef.current) {\n                clearTimeout(timeoutRef.current);\n            }\n            // Load minimized state from localStorage on first offline\n            try {\n                const saved = localStorage.getItem('offlineBannerMinimized');\n                if (saved === 'true') setOfflineMinimized(true);\n            } catch {}\n        } else if (wasOffline && isOnline) {\n            // User came back online after being offline\n            setShowOnlineIndicator(true);\n            \n            // Auto-hide after 5 seconds\n            timeoutRef.current = setTimeout(() => {\n                setShowOnlineIndicator(false);\n            }, 5000);\n        }\n\n        return () => {\n            if (timeoutRef.current) {\n                clearTimeout(timeoutRef.current);\n            }\n        };\n    }, [isOnline, wasOffline]);\n\n    const toggleOfflineMinimized = () => {\n        setOfflineMinimized(prev => {\n            const next = !prev;\n            try { localStorage.setItem('offlineBannerMinimized', next ? 'true' : 'false'); } catch {}\n            return next;\n        });\n    };\n\n    // Show install banner only once and auto-hide after 5s\n    useEffect(() => {\n        if (!isInstalled) return;\n        if (hasShownInstallBannerBefore()) return;\n\n        setShowInstalledIndicator(true);\n        installTimeoutRef.current = setTimeout(() => {\n            setShowInstalledIndicator(false);\n            markInstallBannerShown();\n        }, 5000);\n\n        return () => {\n            if (installTimeoutRef.current) clearTimeout(installTimeoutRef.current);\n        };\n    }, [isInstalled]);\n\n    // Manual close handler\n    const handleCloseOnlineIndicator = () => {\n        setShowOnlineIndicator(false);\n        if (timeoutRef.current) {\n            clearTimeout(timeoutRef.current);\n        }\n    };\n\n    const handleInstall = async () => {\n        try {\n            await installApp();\n            toast({\n                title: \"App Instalada\",\n                description: \"QuorumFlow se ha instalado correctamente en tu dispositivo.\",\n            });\n        } catch (error) {\n            console.error('Installation error:', error);\n            toast({\n                title: \"Error de Instalacin\",\n                description: \"No se pudo instalar la aplicacin.\",\n                variant: \"destructive\"\n            });\n        }\n    };\n\n    // Manual close for installed banner\n    const handleCloseInstalledIndicator = () => {\n        setShowInstalledIndicator(false);\n        if (installTimeoutRef.current) clearTimeout(installTimeoutRef.current);\n        markInstallBannerShown();\n    };\n\n    const handleSync = async () => {\n        try {\n            await forceSync();\n            toast({\n                title: \"Sincronizacin Completa\",\n                description: \"Todos los datos se han sincronizado correctamente.\",\n            });\n        } catch (error) {\n            console.error('Sync error:', error);\n            toast({\n                title: \"Error de Sincronizacin\",\n                description: \"No se pudo completar la sincronizacin.\",\n                variant: \"destructive\"\n            });\n        }\n    };\n\n    return (\n        <div className=\"fixed bottom-4 right-4 z-50 space-y-2\">\n            {/* Connection Status - Only show offline or online notification */}\n            {(!isOnline || showOnlineIndicator) && (\n                isOnline ? (\n                    <Card className={`w-80 transition-all duration-300 bg-green-50 border-green-200`}>\n                        <CardContent className=\"p-4\">\n                            <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center gap-2\">\n                                    <Wifi className=\"h-4 w-4 text-green-600\" />\n                                    <span className={`text-sm font-medium text-green-700`}>\n                                        En lnea\n                                    </span>\n                                </div>\n                                <div className=\"flex items-center gap-2\">\n                                    {queuedOperations > 0 && (\n                                        <Badge variant=\"secondary\" className=\"text-xs\">\n                                            <Clock className=\"h-3 w-3 mr-1\" />\n                                            {queuedOperations} pendiente{queuedOperations !== 1 ? 's' : ''}\n                                        </Badge>\n                                    )}\n                                    {queuedOperations > 0 && (\n                                        <Button\n                                            size=\"sm\"\n                                            variant=\"outline\"\n                                            onClick={handleSync}\n                                            disabled={syncInProgress}\n                                            className=\"h-8\"\n                                        >\n                                            {syncInProgress ? (\n                                                <RefreshCw className=\"h-3 w-3 animate-spin\" />\n                                            ) : (\n                                                <RefreshCw className=\"h-3 w-3\" />\n                                            )}\n                                        </Button>\n                                    )}\n                                    {showOnlineIndicator && (\n                                        <Button\n                                            size=\"sm\"\n                                            variant=\"ghost\"\n                                            onClick={handleCloseOnlineIndicator}\n                                            className=\"h-8 w-8 p-0\"\n                                        >\n                                            <X className=\"h-3 w-3\" />\n                                        </Button>\n                                    )}\n                                </div>\n                            </div>\n                            {showOnlineIndicator && (\n                                <p className=\"text-xs text-green-600 mt-2\">\n                                    Conexin restablecida. Los datos se estn sincronizando automticamente.\n                                </p>\n                            )}\n                        </CardContent>\n                    </Card>\n                ) : offlineMinimized ? (\n                    <Card className=\"w-80 bg-red-50 border-red-200\">\n                        <CardContent className=\"p-3\">\n                            <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center gap-2\">\n                                    <WifiOff className=\"h-4 w-4 text-red-600\" />\n                                    <span className=\"text-sm font-medium text-red-700\">Sin conexin</span>\n                                </div>\n                                <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={toggleOfflineMinimized}\n                                    className=\"h-8 w-8 p-0\"\n                                >\n                                    <ChevronUp className=\"h-3 w-3\" />\n                                </Button>\n                            </div>\n                        </CardContent>\n                    </Card>\n                ) : (\n                    <Card className=\"w-80 bg-red-50 border-red-200\">\n                        <CardContent className=\"p-4\">\n                            <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center gap-2\">\n                                    <WifiOff className=\"h-4 w-4 text-red-600\" />\n                                    <span className=\"text-sm font-medium text-red-700\">Sin conexin</span>\n                                </div>\n                                <div className=\"flex items-center gap-2\">\n                                    {queuedOperations > 0 && (\n                                        <Badge variant=\"secondary\" className=\"text-xs\">\n                                            <Clock className=\"h-3 w-3 mr-1\" />\n                                            {queuedOperations} pendiente{queuedOperations !== 1 ? 's' : ''}\n                                        </Badge>\n                                    )}\n                                    <Button\n                                        size=\"sm\"\n                                        variant=\"ghost\"\n                                        onClick={toggleOfflineMinimized}\n                                        className=\"h-8 w-8 p-0\"\n                                        title=\"Minimizar\"\n                                    >\n                                        <ChevronDown className=\"h-3 w-3\" />\n                                    </Button>\n                                </div>\n                            </div>\n                            <p className=\"text-xs text-red-600 mt-2\">\n                                Trabajando sin conexin. Los cambios se sincronizarn automticamente cuando vuelvas a estar en lnea.\n                            </p>\n                            {syncInProgress && (\n                                <p className=\"text-xs text-blue-600 mt-2 flex items-center gap-1\">\n                                    <RefreshCw className=\"h-3 w-3 animate-spin\" />\n                                    Sincronizando datos...\n                                </p>\n                            )}\n                        </CardContent>\n                    </Card>\n                )\n            )}\n\n{/* App Installed Confirmation - show once, auto-hide, manual close */}\n            {showInstalledIndicator && (\n                <Card className=\"w-80 bg-green-50 border-green-200\">\n                    <CardContent className=\"p-4\">\n                        <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-2 text-green-700\">\n                            <CheckCircle className=\"h-4 w-4\" />\n                            <span className=\"text-sm font-medium\">App Instalada</span>\n                            </div>\n                            <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={handleCloseInstalledIndicator}\n                                className=\"h-8 w-8 p-0\"\n                            >\n                                <X className=\"h-3 w-3\" />\n                            </Button>\n                        </div>\n                        <p className=\"text-xs text-green-600 mt-1\">\n                            QuorumFlow est instalado y funciona completamente offline.\n                        </p>\n                    </CardContent>\n                </Card>\n            )}\n        </div>\n    );\n}\n\nexport default ClientOfflineIndicator;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\dashboard\\ai-summary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\dashboard\\annotation-list.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":255,"column":100,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8326,8327],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8326,8327],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8326,8327],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8326,8327],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":255,"column":127,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8353,8354],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8353,8354],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8353,8354],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8353,8354],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client';\n\nimport { useState } from 'react';\nimport type { Annotation } from '@/lib/types';\nimport {\n  addDoc,\n  doc,\n  serverTimestamp,\n  updateDoc,\n} from 'firebase/firestore';\nimport { annotationsCollection } from '@/lib/collections';\n\nimport { Button } from '@/components/ui/button';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Textarea } from '@/components/ui/textarea';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Label } from '@/components/ui/label';\nimport { Skeleton } from '../ui/skeleton';\nimport { CheckCircle, NotebookPen, PlusCircle, Trash2, Pencil } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { EditAnnotationDialog } from './edit-annotation-dialog';\n\ninterface AnnotationListProps {\n  title: string;\n  description: string;\n  source: 'dashboard' | 'council';\n  annotations: Annotation[];\n  isLoading: boolean;\n  onAnnotationAdded: () => void;\n  onAnnotationToggled: () => void;\n  showCouncilView?: boolean;\n  onResolveAnnotation?: (id: string) => void;\n  onDeleteAnnotation?: (id: string) => void;\n}\n\nexport function AnnotationList({\n  title,\n  description,\n  source,\n  annotations,\n  isLoading,\n  onAnnotationAdded,\n  onAnnotationToggled,\n  showCouncilView = false,\n  onResolveAnnotation,\n  onDeleteAnnotation,\n}: AnnotationListProps) {\n  const [open, setOpen] = useState(false);\n  const [newAnnotation, setNewAnnotation] = useState('');\n  const [isAlertOpen, setIsAlertOpen] = useState(false);\n  const [selectedAnnotation, setSelectedAnnotation] = useState<Annotation | null>(null);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [annotationToEdit, setAnnotationToEdit] = useState<Annotation | null>(null);\n\n  const handleAddAnnotation = async () => {\n    if (newAnnotation.trim() === '') return;\n    try {\n      await addDoc(annotationsCollection, {\n        text: newAnnotation,\n        source,\n        isCouncilAction: false,\n        isResolved: false,\n        createdAt: serverTimestamp(),\n      });\n      setNewAnnotation('');\n      setOpen(false);\n      onAnnotationAdded();\n    } catch (error) {\n        console.error(\"Failed to add annotation: \", error);\n        // Optionally show a toast to the user\n    }\n  };\n\n  const handleToggleCouncilAction = async (\n    id: string,\n    currentStatus: boolean\n  ) => {\n    try {\n        const annotationRef = doc(annotationsCollection, id);\n        await updateDoc(annotationRef, { isCouncilAction: !currentStatus });\n        onAnnotationToggled();\n    } catch (error) {\n        console.error(\"Failed to toggle annotation: \", error);\n        // Optionally show a toast to the user\n    }\n  };\n\n  const handleDeleteTrigger = (annotation: Annotation) => {\n    setSelectedAnnotation(annotation);\n    setIsAlertOpen(true);\n  };\n  \n  const handleDeleteConfirm = () => {\n    if (selectedAnnotation && onDeleteAnnotation) {\n        onDeleteAnnotation(selectedAnnotation.id);\n    }\n    setIsAlertOpen(false);\n    setSelectedAnnotation(null)\n  }\n\n  const handleEditAnnotation = (annotation: Annotation) => {\n    setAnnotationToEdit(annotation);\n    setEditDialogOpen(true);\n  };\n\n  const handleAnnotationUpdated = () => {\n    onAnnotationAdded();\n    setEditDialogOpen(false);\n    setAnnotationToEdit(null);\n  };\n\n  return (\n    <>\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-start\">\n          <div className=\"flex items-start gap-3\">\n            <NotebookPen className=\"h-8 w-8 text-primary\" />\n            <div>\n              <CardTitle>{title}</CardTitle>\n              <CardDescription>{description}</CardDescription>\n            </div>\n          </div>\n          <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <PlusCircle className=\"mr-2 h-4 w-4\" />\n                Anotacin\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Nueva Anotacin</DialogTitle>\n                <DialogDescription>\n                  Escribe la nota que quieres registrar.\n                </DialogDescription>\n              </DialogHeader>\n              <Textarea\n                value={newAnnotation}\n                onChange={(e) => setNewAnnotation(e.target.value)}\n                placeholder=\"Ej: Contactar a la familia Prez para ofrecer ayuda con la mudanza...\"\n              />\n              <DialogFooter>\n                <Button\n                  onClick={handleAddAnnotation}\n                  disabled={!newAnnotation.trim()}\n                >\n                  Guardar Anotacin\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        {isLoading ? (\n          <div className=\"space-y-3\">\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n        ) : annotations.length === 0 ? (\n          <p className=\"text-center text-sm text-muted-foreground py-8\">\n            No hay anotaciones.\n          </p>\n        ) : (\n          <ul className=\"space-y-3\">\n            {annotations.map((item) => (\n              <li\n                key={item.id}\n                className=\"flex items-center justify-between rounded-md border p-3\"\n              >\n                <div className=\"flex items-start gap-3\">\n                  {!showCouncilView && (\n                     <Checkbox\n                        id={`council-${item.id}`}\n                        checked={item.isCouncilAction}\n                        onCheckedChange={() => handleToggleCouncilAction(item.id, item.isCouncilAction)}\n                        aria-label=\"Marcar para consejo\"\n                        />\n                  )}\n                  <div>\n                     <p className=\"text-sm font-medium\">{item.text}</p>\n                     <p className=\"text-xs text-muted-foreground\">\n                        {format(item.createdAt.toDate(), 'd LLL yyyy, h:mm a', { locale: es })}\n                        {showCouncilView && ` - Creado en: ${item.source === 'dashboard' ? 'Dashboard' : 'Consejo'}`}\n                     </p>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                      {showCouncilView && onResolveAnnotation && (\n                        <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => onResolveAnnotation(item.id)}\n                        >\n                            <CheckCircle className=\"mr-2 h-4 w-4\" />\n                            Resolver\n                        </Button>                    )}\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => handleEditAnnotation(item)}\n                      title=\"Editar anotacin\"\n                    >\n                      <Pencil className=\"h-4 w-4\" />\n                    </Button>\n                      {onDeleteAnnotation && (\n                           <Button variant=\"ghost\" size=\"icon\" onClick={() => handleDeleteTrigger(item)}>\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\n                           </Button>\n                      )}\n                </div>\n              </li>\n            ))}\n          </ul>\n        )}\n      </CardContent>\n    </Card>\n\n    <AlertDialog open={isAlertOpen} onOpenChange={setIsAlertOpen}>\n        <AlertDialogContent>\n        <AlertDialogHeader>\n            <AlertDialogTitle>Ests seguro?</AlertDialogTitle>\n            <AlertDialogDescription>\n            Esta accin no se puede deshacer. Esto eliminar permanentemente la anotacin: <strong>\"{selectedAnnotation?.text}\"</strong>.\n            </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n            <AlertDialogCancel onClick={() => setSelectedAnnotation(null)}>Cancelar</AlertDialogCancel>\n            <AlertDialogAction\n                onClick={handleDeleteConfirm}\n                className=\"bg-destructive hover:bg-destructive/90\"\n            >\n            Eliminar\n            </AlertDialogAction>\n        </AlertDialogFooter>\n        </AlertDialogContent>\n    </AlertDialog>\n    \n    <EditAnnotationDialog\n      annotation={annotationToEdit}\n      open={editDialogOpen}\n      onOpenChange={setEditDialogOpen}\n      onAnnotationUpdated={handleAnnotationUpdated}\n    />\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\dashboard\\dashboard-data.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\dashboard\\edit-annotation-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\dashboard\\overview-chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\dashboard\\quick-settings-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\dashboard\\stat-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\debug\\connection-test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\debug\\firebase-debug.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\error-boundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\family-search\\edit-family-search-annotation-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\family-search\\family-selector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\install-prompt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\language-switcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\main-layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\members\\MemberSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\members\\member-form.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAvailableMembers'. Either include it or remove the dependency array.","line":248,"column":6,"nodeType":"ArrayExpression","endLine":248,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [user, member, authLoading, loadAvailableMembers]","fix":{"range":[9235,9262],"text":"[user, member, authLoading, loadAvailableMembers]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'form'. Either include it or remove the dependency array.","line":313,"column":6,"nodeType":"ArrayExpression","endLine":313,"endColumn":75,"suggestions":[{"desc":"Update the dependencies array to be: [checkForDuplicates, form]","fix":{"range":[11447,11516],"text":"[checkForDuplicates, form]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":313,"column":7,"nodeType":"CallExpression","endLine":313,"endColumn":30},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":313,"column":32,"nodeType":"CallExpression","endLine":313,"endColumn":54},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":771,"column":50,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[28136,28187],"text":"\n              Ya existe un miembro con el nombre &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[28136,28187],"text":"\n              Ya existe un miembro con el nombre &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[28136,28187],"text":"\n              Ya existe un miembro con el nombre &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[28136,28187],"text":"\n              Ya existe un miembro con el nombre &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":771,"column":109,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[28245,28262],"text":"&quot;.\n              "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[28245,28262],"text":"&ldquo;.\n              "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[28245,28262],"text":"&#34;.\n              "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[28245,28262],"text":"&rdquo;.\n              "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1072,"column":21,"nodeType":"JSXOpeningElement","endLine":1076,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { useForm } from 'react-hook-form';\nimport * as z from 'zod';\nimport { Upload, X } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { Calendar } from '@/components/ui/calendar';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/contexts/auth-context';\nimport type { Member, MemberStatus, Ordinance } from '@/lib/types';\nimport { OrdinanceLabels } from '@/lib/types';\nimport { createMember, updateMember, uploadMemberPhoto, uploadBaptismPhotos, getMembersForSelector, searchMembersByName } from '@/lib/members-data';\nimport { syncMinisteringAssignments, getPreviousMinisteringTeachers } from '@/lib/ministering-sync';\nimport { Timestamp } from 'firebase/firestore';\nimport { ref, deleteObject } from 'firebase/storage';\nimport { storage } from '@/lib/firebase';\n\nconst memberFormSchema = z.object({\n  firstName: z.string().min(1, 'El nombre es requerido'),\n  lastName: z.string().min(1, 'El apellido es requerido'),\n  phoneNumber: z.string().optional(),\n  address: z.string().optional(),\n  birthDate: z.date().optional(),\n  baptismDate: z.date().optional(),\n  status: z.enum(['active', 'less_active', 'inactive'] as const),\n  photoURL: z.string().optional(),\n  baptismPhotos: z.array(z.string()).optional(),\n  ordinances: z.array(z.enum(['baptism', 'confirmation', 'elder_ordination', 'endowment', 'sealed_spouse', 'high_priest_ordination'] as const)).optional(),\n  ministeringTeachers: z.array(z.string()).optional(),\n});\n\ntype MemberFormValues = z.infer<typeof memberFormSchema>;\n\ninterface MemberFormProps {\n  member?: Member | null;\n  onClose: () => void;\n}\n\nexport function MemberForm({ member, onClose }: MemberFormProps) {\n  const { user, loading: authLoading } = useAuth();\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(false);\n  const [photoFile, setPhotoFile] = useState<File | null>(null);\n  const [photoPreview, setPhotoPreview] = useState<string | null>(null);\n  const [baptismPhotoFiles, setBaptismPhotoFiles] = useState<File[]>([]);\n  const [baptismPhotoPreviews, setBaptismPhotoPreviews] = useState<string[]>([]);\n  const [availableMembers, setAvailableMembers] = useState<Member[]>([]);\n  const [loadingMembers, setLoadingMembers] = useState(false);\n\n  // Estados para el dilogo de duplicados\n  const [showDuplicateDialog, setShowDuplicateDialog] = useState(false);\n  const [duplicateMembers, setDuplicateMembers] = useState<Member[]>([]);\n  const [checkingDuplicate, setCheckingDuplicate] = useState(false);\n  const [allowContinueWithDuplicate, setAllowContinueWithDuplicate] = useState(false);\n  const [duplicateDecisionMade, setDuplicateDecisionMade] = useState(false);\n  \n  // Estados locales para los inputs de fecha\n  const [birthDateInput, setBirthDateInput] = useState('');\n  const [baptismDateInput, setBaptismDateInput] = useState('');\n\n  const form = useForm<MemberFormValues>({\n    resolver: zodResolver(memberFormSchema),\n    defaultValues: {\n      firstName: '',\n      lastName: '',\n      phoneNumber: '',\n      status: 'active',\n      photoURL: undefined,\n      baptismDate: undefined,\n      ordinances: [],\n      ministeringTeachers: [],\n    },\n  });\n\n  // Cargar datos del miembro al formulario\n  useEffect(() => {\n    console.log(' Loading member data in form:', {\n      member,\n      hasMember: !!member,\n      memberId: member?.id\n    });\n\n    // Reset loading state when member changes\n    setLoading(false);\n\n    // Reset duplicate states when loading a member\n    setDuplicateMembers([]);\n    setShowDuplicateDialog(false);\n    setAllowContinueWithDuplicate(false);\n    setDuplicateDecisionMade(false);\n\n    if (member) {\n      // Convertir Timestamps a Date y preparar valores para el formulario\n      const birthDateValue = member.birthDate?.toDate ? member.birthDate.toDate() : \n                            member.birthDate instanceof Date ? member.birthDate : undefined;\n      const baptismDateValue = member.baptismDate?.toDate ? member.baptismDate.toDate() : \n                              member.baptismDate instanceof Date ? member.baptismDate : undefined;\n      \n      const valuesToSet = {\n        firstName: member.firstName || '',\n        lastName: member.lastName || '',\n        phoneNumber: member.phoneNumber || '',\n        birthDate: birthDateValue,\n        baptismDate: baptismDateValue,\n        status: member.status || 'active',\n        photoURL: (member.photoURL && member.photoURL.trim()) || undefined,\n        baptismPhotos: member.baptismPhotos || [],\n        ordinances: member.ordinances || [],\n        ministeringTeachers: member.ministeringTeachers || []\n      };\n\n      console.log(' Setting form values:', valuesToSet);\n      console.log(' Photo URL:', member.photoURL);\n      console.log(' Birth date:', { raw: member.birthDate, converted: birthDateValue });\n      console.log(' Baptism date:', { raw: member.baptismDate, converted: baptismDateValue });\n      console.log(' Status value:', { raw: member.status, final: valuesToSet.status });\n\n      // Reset form with new values and trigger validation\n      form.reset(valuesToSet);\n\n      // Set photo preview - treat empty strings as no photo\n      const photoUrl = member.photoURL && member.photoURL.trim() ? member.photoURL : null;\n      setPhotoPreview(photoUrl);\n      setPhotoFile(null); // Clear any selected file when loading existing member\n      \n      // Set baptism photos\n      setBaptismPhotoPreviews(member.baptismPhotos || []);\n      setBaptismPhotoFiles([]); // Clear any selected files when loading existing member\n      \n      // Actualizar los estados locales de los inputs de fecha\n      setBirthDateInput(formatDateForDisplay(birthDateValue));\n      setBaptismDateInput(formatDateForDisplay(baptismDateValue));\n      \n      console.log(' Member data loaded successfully');\n    } else {\n      console.log(' Resetting form for new member');\n\n      // Reset to empty form for new member\n      form.reset({\n        firstName: '',\n        lastName: '',\n        phoneNumber: '',\n        status: 'active',\n        photoURL: undefined,\n        birthDate: undefined,\n        baptismDate: undefined,\n        baptismPhotos: [],\n        ordinances: [],\n        ministeringTeachers: [],\n      });\n      setPhotoPreview(null);\n      setPhotoFile(null);\n      setBaptismPhotoPreviews([]);\n      setBaptismPhotoFiles([]);\n\n      // Limpiar los inputs de fecha\n      setBirthDateInput('');\n      setBaptismDateInput('');\n\n      // Reset duplicate states for new member\n      setDuplicateMembers([]);\n      setShowDuplicateDialog(false);\n      setAllowContinueWithDuplicate(false);\n      setDuplicateDecisionMade(false);\n    }\n  }, [member, form]);\n\n  // Cargar miembros disponibles para ministrantes\n  const loadAvailableMembers = async () => {\n    if (!user) {\n      console.log(' No user available for loading members');\n      return;\n    }\n    \n    setLoadingMembers(true);\n    try {\n      console.log(' Loading available members for ministering assignment...');\n      // Obtener todos los miembros (incluyendo inactivos) para maestros ministrantes\n      const members = await getMembersForSelector(true);\n      console.log(` Found ${members.length} available members`);\n      \n      // Filtrar el miembro actual si estamos editando\n      const filteredMembers = member \n        ? members.filter(m => m.id !== member.id)\n        : members;\n      \n      console.log(` After filtering: ${filteredMembers.length} members available`);\n      setAvailableMembers(filteredMembers);\n    } catch (error) {\n      console.error(' Error loading members for ministering:', error);\n      setAvailableMembers([]); // Set empty array as fallback\n      // Don't show toast for this error to avoid interrupting user flow\n      console.warn('Members for ministering will not be available due to loading error');\n    } finally {\n      setLoadingMembers(false);\n    }\n  };\n\n  // Cargar miembros disponibles cuando el componente se monta\n  useEffect(() => {\n    if (user && !authLoading) {\n      // Usar setTimeout para evitar bloquear el renderizado inicial\n      const timer = setTimeout(() => {\n        loadAvailableMembers();\n      }, 100);\n      return () => clearTimeout(timer);\n    }\n  }, [user, member, authLoading]);\n\n  // Funcin para verificar duplicados\n  const checkForDuplicates = useCallback(async (firstName: string, lastName: string) => {\n    // Solo verificar para nuevos miembros\n    if (member) return;\n\n    if (!firstName?.trim() || !lastName?.trim()) {\n      setDuplicateMembers([]);\n      setShowDuplicateDialog(false);\n      setAllowContinueWithDuplicate(false);\n      setDuplicateDecisionMade(false);\n      return;\n    }\n\n    setCheckingDuplicate(true);\n    try {\n      const duplicates = await searchMembersByName(firstName, lastName);\n      setDuplicateMembers(duplicates);\n      if (duplicates.length > 0) {\n        setShowDuplicateDialog(true);\n        setAllowContinueWithDuplicate(false);\n        setDuplicateDecisionMade(false);\n      } else {\n        setShowDuplicateDialog(false);\n        setAllowContinueWithDuplicate(false);\n        setDuplicateDecisionMade(false);\n      }\n    } catch (error) {\n      console.error('Error checking for duplicates:', error);\n      setDuplicateMembers([]);\n      setShowDuplicateDialog(false);\n      setAllowContinueWithDuplicate(false);\n      setDuplicateDecisionMade(false);\n    } finally {\n      setCheckingDuplicate(false);\n    }\n  }, [member]);\n  // Efecto para verificar duplicados automticamente al escribir\n  useEffect(() => {\n    const firstName = form.watch('firstName');\n    const lastName = form.watch('lastName');\n\n    if (!firstName?.trim() || !lastName?.trim()) {\n      setDuplicateMembers([]);\n      setShowDuplicateDialog(false);\n      setAllowContinueWithDuplicate(false);\n      setDuplicateDecisionMade(false);\n      return;\n    }\n\n    // Verificar inmediatamente si ambos campos tienen al menos 2 caracteres\n    if (firstName.trim().length >= 2 && lastName.trim().length >= 2) {\n      const timeoutId = setTimeout(() => {\n        checkForDuplicates(firstName, lastName);\n      }, 150); // Reducir debounce a 150ms para ser ms responsivo\n\n      return () => clearTimeout(timeoutId);\n    } else {\n      // Limpiar duplicados si no hay suficientes caracteres\n      setDuplicateMembers([]);\n      setShowDuplicateDialog(false);\n      setAllowContinueWithDuplicate(false);\n      setDuplicateDecisionMade(false);\n    }\n  }, [form.watch('firstName'), form.watch('lastName'), checkForDuplicates]);\n\n  // Funcin para parsear fecha desde string DD/MM/YYYY\n  const parseDate = (dateString: string): Date | undefined => {\n    if (!dateString.trim()) return undefined;\n\n    const dateRegex = /^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/;\n    const match = dateString.match(dateRegex);\n\n    if (!match) return undefined;\n\n    const [, dayStr, monthStr, yearStr] = match;\n    const day = parseInt(dayStr, 10);\n    const month = parseInt(monthStr, 10) - 1; // JS months are 0-indexed\n    const year = parseInt(yearStr, 10);\n    const currentYear = new Date().getFullYear();\n\n    // Validate ranges\n    if (day < 1 || day > 31 || month < 0 || month > 11 || year < 1900 || year > currentYear) {\n      return undefined;\n    }\n\n    const date = new Date(year, month, day);\n    \n    // Check if date is valid (handles invalid dates like Feb 30)\n    if (date.getDate() !== day || date.getMonth() !== month || date.getFullYear() !== year) {\n      return undefined;\n    }\n\n    return date;\n  };\n\n  // Funcin para formatear fecha para mostrar\n  const formatDateForDisplay = (date: Date | undefined): string => {\n    if (!date || isNaN(date.getTime())) {\n      return '';\n    }\n    try {\n      return format(date, 'dd/MM/yyyy');\n    } catch (error) {\n      return '';\n    }\n  };\n\n  const handlePhotoChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      // Validate file type\n      if (!file.type.startsWith('image/')) {\n        toast({\n          title: 'Error',\n          description: 'Por favor selecciona un archivo de imagen vlido.',\n          variant: 'destructive'\n        });\n        return;\n      }\n\n      // Validate file size (max 5MB)\n      if (file.size > 5 * 1024 * 1024) {\n        toast({\n          title: 'Error',\n          description: 'La imagen debe ser menor a 5MB.',\n          variant: 'destructive'\n        });\n        return;\n      }\n\n      setPhotoFile(file);\n      \n      // Create preview\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        setPhotoPreview(e.target?.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const removePhoto = () => {\n    setPhotoFile(null);\n    setPhotoPreview(null);\n    // Clear the photoURL field in the form to ensure proper update\n    form.setValue('photoURL', undefined);\n  };\n\n  const baptismPhotosInputRef = useRef<HTMLInputElement>(null);\n\n  const handleBaptismPhotosChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(event.target.files || []);\n    if (files.length > 0) {\n      // Validar que sean imgenes\n      const validFiles = files.filter(file => file.type.startsWith('image/'));\n      \n      if (validFiles.length !== files.length) {\n        toast({\n          title: 'Formato invlido',\n          description: 'Por favor selecciona solo archivos de imagen.',\n          variant: 'destructive'\n        });\n        return;\n      }\n\n      // Limitar a 10 fotos mximo\n      const totalFiles = [...baptismPhotoFiles, ...validFiles];\n      if (totalFiles.length > 10) {\n        toast({\n          title: 'Lmite excedido',\n          description: 'Puedes subir mximo 10 fotos de bautismo.',\n          variant: 'destructive'\n        });\n        return;\n      }\n\n      setBaptismPhotoFiles(prev => [...prev, ...validFiles]);\n\n      // Crear previews\n      validFiles.forEach(file => {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          const preview = e.target?.result as string;\n          setBaptismPhotoPreviews(prev => [...prev, preview]);\n        };\n        reader.readAsDataURL(file);\n      });\n    }\n  };\n\n  const removeBaptismPhoto = (index: number) => {\n    setBaptismPhotoFiles(prev => prev.filter((_, i) => i !== index));\n    setBaptismPhotoPreviews(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const onSubmit = async (values: MemberFormValues) => {\n    console.log(' Starting member submission:', {\n      isEditing: !!member,\n      memberId: member?.id,\n      values,\n      user: user?.uid\n    });\n\n    if (!user) {\n      console.error(' No user authenticated');\n      return;\n    }\n\n    // Verificar si hay duplicados sin resolver\n    if (duplicateMembers.length > 0 && !allowContinueWithDuplicate) {\n      setShowDuplicateDialog(true);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Handle photo URL\n      let photoURL = member?.photoURL; // Start with existing photo\n      if (photoFile) {\n        // Upload new photo\n        photoURL = await uploadMemberPhoto(photoFile, user.uid);\n      } else if (photoPreview === null && member?.photoURL) {\n        // Photo was removed - delete from storage\n        try {\n          if (member.photoURL.startsWith('https://firebasestorage.googleapis.com')) {\n            const photoRef = ref(storage, member.photoURL);\n            await deleteObject(photoRef);\n            console.log(' Old member photo deleted from storage');\n          }\n        } catch (error) {\n          console.warn(' Could not delete old member photo from storage:', error);\n          // Continue with the update even if deletion fails\n        }\n        photoURL = null as any;\n      }\n      // else keep existing photoURL\n\n      // Subir fotos de bautismo\n      let baptismPhotoURLs: string[] = [];\n      if (baptismPhotoFiles.length > 0) {\n        try {\n          const uploadedPhotos = await uploadBaptismPhotos(baptismPhotoFiles, user.uid);\n          baptismPhotoURLs = uploadedPhotos;\n          \n          // Mantener las fotos existentes que no fueron eliminadas\n          if (member?.baptismPhotos) {\n            const existingPhotos = member.baptismPhotos.filter(url => \n              baptismPhotoPreviews.includes(url)\n            );\n            baptismPhotoURLs = [...existingPhotos, ...uploadedPhotos];\n          }\n        } catch (error) {\n          console.error('Error uploading baptism photos:', error);\n          toast({\n            title: 'Advertencia',\n            description: 'No se pudieron subir algunas fotos de bautismo.',\n            variant: 'destructive'\n          });\n          // Mantener las fotos existentes en caso de error\n          baptismPhotoURLs = member?.baptismPhotos || [];\n        }\n      } else {\n        // Si no hay nuevas fotos, mantener las existentes\n        baptismPhotoURLs = member?.baptismPhotos || [];\n      }\n\n      // Eliminar fotos de bautismo que fueron removidas\n      if (member?.baptismPhotos) {\n        const photosToDelete = member.baptismPhotos.filter(url => \n          !baptismPhotoPreviews.includes(url)\n        );\n        \n        for (const photoUrl of photosToDelete) {\n          try {\n            if (photoUrl.startsWith('https://firebasestorage.googleapis.com')) {\n              const photoRef = ref(storage, photoUrl);\n              await deleteObject(photoRef);\n            }\n          } catch (error) {\n            console.warn('Could not delete baptism photo:', error);\n          }\n        }\n      }\n\n      // Verificar si es un bautismo de los ltimos 2 aos\n      const twoYearsAgo = new Date();\n      twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);\n      const isRecentBaptism = values.baptismDate &&\n        values.baptismDate >= twoYearsAgo;\n      \n      // Verificar si hay cambios en la fecha de bautismo\n      const previousBaptismDate = member?.baptismDate?.toDate ? member.baptismDate.toDate() :\n                                  member?.baptismDate instanceof Date ? member.baptismDate : null;\n      const previousBaptismYear = previousBaptismDate?.getFullYear();\n      const newBaptismYear = values.baptismDate?.getFullYear();\n      const baptismYearChanged = previousBaptismYear !== newBaptismYear;\n      const baptismDateRemoved = member?.baptismDate && !values.baptismDate;\n\n      // Preparar datos del miembro para actualizar (datos serializables)\n      console.log(' Preparing member data for update:', {\n        status: values.status,\n        statusType: typeof values.status,\n        allValues: values\n      });\n      const memberData = {\n        firstName: values.firstName.trim(),\n        lastName: values.lastName.trim(),\n        status: values.status,\n        // Manejar campos opcionales: usar el valor del formulario si est presente, sino undefined para limpiar\n        phoneNumber: values.phoneNumber?.trim() ? values.phoneNumber.trim() : undefined,\n        birthDate: values.birthDate ? values.birthDate.toISOString() : undefined,\n        baptismDate: values.baptismDate ? values.baptismDate.toISOString() : undefined,\n        photoURL: photoURL as any,\n        baptismPhotos: baptismPhotoURLs,\n        ordinances: values.ordinances || [],\n        ministeringTeachers: values.ministeringTeachers || [],\n      };\n\n      console.log(' Final member data to send:', memberData);\n      console.log(' Date conversions:', {\n        birthDate: {\n          original: values.birthDate,\n          isoString: values.birthDate ? values.birthDate.toISOString() : undefined\n        },\n        baptismDate: {\n          original: values.baptismDate,\n          isoString: values.baptismDate ? values.baptismDate.toISOString() : undefined\n        }\n      });\n\n      // Si es un bautismo reciente, crear registro en conversos y bautismos\n      let convertDocRef = null;\n      let updateDocDynamic = null;\n\n      if (isRecentBaptism && values.baptismDate) {\n        const convertData = {\n          name: `${values.firstName.trim()} ${values.lastName.trim()}`,\n          baptismDate: Timestamp.fromDate(values.baptismDate),\n          photoURL: photoURL || undefined,\n          councilCompleted: false,\n          observation: 'Registrado automticamente desde Miembros',\n          createdAt: Timestamp.now(),\n          createdBy: user.uid,\n          memberId: member?.id || '', // Se actualizar despus para nuevos miembros\n        };\n\n        const baptismData = {\n          name: `${values.firstName.trim()} ${values.lastName.trim()}`,\n          date: Timestamp.fromDate(values.baptismDate),\n          source: 'Automtico',\n          photoURL: photoURL || undefined,\n          baptismPhotos: baptismPhotoURLs,\n          createdAt: Timestamp.now(),\n        };\n\n        // Importar dinmicamente para evitar dependencias circulares\n        const { addDoc, collection, query, where, getDocs, deleteDoc, doc, updateDoc: updateDocImported } = await import('firebase/firestore');\n        const { firestore } = await import('@/lib/firebase');\n\n        updateDocDynamic = updateDocImported;\n\n        // Si es una actualizacin y la fecha de bautismo cambi, eliminar el registro anterior\n        if (member && (baptismYearChanged || baptismDateRemoved)) {\n          const baptismQuery = query(\n             collection(firestore, 'c_bautismos'),\n             where('name', '==', `${values.firstName.trim()} ${values.lastName.trim()}`),\n             where('source', '==', 'Automtico')\n           );\n          const existingBaptisms = await getDocs(baptismQuery);\n          existingBaptisms.forEach(async (baptismDoc) => {\n            await deleteDoc(doc(firestore, 'c_bautismos', baptismDoc.id));\n          });\n        }\n\n        // Crear nuevo registro si hay fecha de bautismo en los ltimos 2 aos\n        convertDocRef = await addDoc(collection(firestore, 'converts'), convertData);\n        await addDoc(collection(firestore, 'c_bautismos'), baptismData);\n      }\n\n      if (member) {\n        // Get previous ministering teachers before update\n        const previousTeachers = member.ministeringTeachers || [];\n        \n        // Update existing member via API\n        const response = await fetch(`/api/members/${member.id}`, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(memberData),\n        });\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));\n          console.error('API Error response:', {\n            status: response.status,\n            statusText: response.statusText,\n            errorData\n          });\n          throw new Error(`Failed to update member: ${errorData.details || errorData.error || response.statusText}`);\n        }\n\n        // Sync ministering assignments if teachers changed\n        const currentTeachers = values.ministeringTeachers || [];\n        if (JSON.stringify(previousTeachers.sort()) !== JSON.stringify(currentTeachers.sort())) {\n          try {\n            await syncMinisteringAssignments(\n              { ...member, ...memberData, id: member.id } as any,\n              previousTeachers\n            );\n            console.log(' Ministering assignments synced');\n          } catch (error) {\n            console.error(' Error syncing ministering assignments:', error);\n            // Don't fail the whole operation if sync fails\n          }\n        }\n\n        toast({\n          title: ' Miembro Actualizado',\n          description: `${values.firstName} ${values.lastName} ha sido actualizado correctamente.`\n        });\n        console.log(' Member updated successfully:', { memberId: member.id, updatedData: memberData });\n      } else {\n        // Create new member via API\n        const newMember = {\n          firstName: values.firstName.trim(),\n          lastName: values.lastName.trim(),\n          status: values.status,\n          phoneNumber: values.phoneNumber?.trim() || undefined,\n          birthDate: values.birthDate ? values.birthDate.toISOString() : undefined,\n          baptismDate: values.baptismDate ? values.baptismDate.toISOString() : undefined,\n          photoURL: photoURL as any,\n          baptismPhotos: baptismPhotoURLs,\n          ordinances: values.ordinances || [],\n          ministeringTeachers: values.ministeringTeachers || [],\n        };\n\n        const response = await fetch('/api/members', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(newMember),\n        });\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));\n          console.error('API Error response:', {\n            status: response.status,\n            statusText: response.statusText,\n            errorData\n          });\n          throw new Error(`Failed to create member: ${errorData.details || errorData.error || response.statusText}`);\n        }\n\n        const { id: newMemberId } = await response.json();\n\n        // Actualizar el registro de converso con el memberId si existe\n        if (convertDocRef && updateDocDynamic) {\n          await updateDocDynamic(convertDocRef, { memberId: newMemberId });\n        }\n\n        // Sync ministering assignments for new member if teachers assigned\n        const currentTeachers = values.ministeringTeachers || [];\n        if (currentTeachers.length > 0) {\n          try {\n            await syncMinisteringAssignments(\n              { ...newMember, id: newMemberId } as any,\n              []\n            );\n            console.log(' Ministering assignments synced for new member');\n          } catch (error) {\n            console.error(' Error syncing ministering assignments:', error);\n            // Don't fail the whole operation if sync fails\n          }\n        }\n\n        toast({\n          title: ' Miembro Creado',\n          description: `${values.firstName} ${values.lastName} ha sido agregado como nuevo miembro.`\n        });\n        console.log(' New member created successfully:', { memberId: newMemberId, memberData: newMember });\n      }\n\n      onClose();\n    } catch (error) {\n      console.error('Error saving member:', error);\n      \n      let errorMessage = member \n        ? 'No se pudo actualizar el miembro.' \n        : 'No se pudo crear el miembro.';\n      \n      if (error instanceof Error) {\n        errorMessage = error.message;\n      }\n      \n      toast({\n        title: 'Error',\n        description: errorMessage,\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <>\n      {/* Dilogo de duplicados */}\n      <AlertDialog open={showDuplicateDialog} onOpenChange={(open) => {\n        if (!open && !duplicateDecisionMade) {\n          // Si el usuario cierra el dilogo sin tomar una decisin, se considera como cancelar\n          setShowDuplicateDialog(false);\n          setAllowContinueWithDuplicate(false);\n          setDuplicateDecisionMade(false);\n        }\n      }}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Miembro Guardado Anteriormente</AlertDialogTitle>\n            <AlertDialogDescription>\n              Ya existe un miembro con el nombre \"{form.getValues('firstName')} {form.getValues('lastName')}\".\n              {duplicateMembers.length > 0 && (\n                <div className=\"mt-3\">\n                  <div className=\"text-sm font-medium mb-2\">Miembros encontrados:</div>\n                  <div className=\"space-y-2\">\n                    {duplicateMembers.map((dupMember) => (\n                      <div key={dupMember.id} className=\"flex items-center gap-3 p-2 bg-muted rounded-md\">\n                        <Avatar className=\"h-8 w-8\">\n                          <AvatarImage src={dupMember.photoURL} />\n                          <AvatarFallback className=\"text-xs\">\n                            {dupMember.firstName.charAt(0)}{dupMember.lastName.charAt(0)}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm font-medium\">{dupMember.firstName} {dupMember.lastName}</p>\n                          <p className=\"text-xs text-muted-foreground capitalize\">\n                            Estado: {dupMember.status === 'active' ? 'Activo' :\n                                   dupMember.status === 'less_active' ? 'Menos Activo' : 'Inactivo'}\n                          </p>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n              <div className=\"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md\">\n                <p className=\"text-sm text-blue-800\">\n                  Qu deseas hacer?\n                </p>\n              </div>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={() => {\n              setShowDuplicateDialog(false);\n              setAllowContinueWithDuplicate(false);\n              setDuplicateDecisionMade(true);\n              onClose(); // Cerrar el formulario\n            }}>\n              Cancelar y Salir\n            </AlertDialogCancel>\n            <AlertDialogAction onClick={() => {\n              setShowDuplicateDialog(false);\n              setAllowContinueWithDuplicate(true);\n              setDuplicateDecisionMade(true);\n            }}>\n              Continuar Llenando\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <Form key={member?.id || 'new'} {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n        {/* Photo Upload */}\n        <div className=\"space-y-4\">\n          <Label>Foto de Perfil (Opcional)</Label>\n          <div className=\"flex items-center gap-4\">\n            <Avatar className=\"w-20 h-20\">\n              <AvatarImage src={photoPreview || undefined} />\n              <AvatarFallback className=\"text-lg\">\n                {form.watch('firstName')?.[0]?.toUpperCase()}\n                {form.watch('lastName')?.[0]?.toUpperCase()}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex flex-col gap-2\">\n              <div className=\"flex gap-2\">\n                <Label htmlFor=\"photo-upload\" className=\"cursor-pointer\">\n                  <Button type=\"button\" variant=\"outline\" size=\"sm\" asChild>\n                    <span>\n                      <Upload className=\"mr-2 h-4 w-4\" />\n                      Subir Foto\n                    </span>\n                  </Button>\n                </Label>\n                <Input\n                  id=\"photo-upload\"\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handlePhotoChange}\n                  className=\"hidden\"\n                />\n                {photoPreview && (\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={removePhoto}\n                  >\n                    <X className=\"mr-2 h-4 w-4\" />\n                    Quitar\n                  </Button>\n                )}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Formatos: JPG, PNG, GIF. Mximo 5MB.\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Name Fields */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"firstName\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Nombre *</FormLabel>\n                <FormControl>\n                  <Input\n                    placeholder=\"Nombre\"\n                    {...field}\n                    onBlur={(e) => {\n                      field.onBlur();\n                      const firstName = e.target.value.trim();\n                      const lastName = form.getValues('lastName')?.trim() || '';\n                      checkForDuplicates(firstName, lastName);\n                    }}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n          <FormField\n            control={form.control}\n            name=\"lastName\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Apellido *</FormLabel>\n                <FormControl>\n                  <Input\n                    placeholder=\"Apellido\"\n                    {...field}\n                    onBlur={(e) => {\n                      field.onBlur();\n                      const lastName = e.target.value.trim();\n                      const firstName = form.getValues('firstName')?.trim() || '';\n                      checkForDuplicates(firstName, lastName);\n                    }}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        {/* Phone Number */}\n        <FormField\n          control={form.control}\n          name=\"phoneNumber\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Nmero de Telfono</FormLabel>\n              <FormControl>\n                <Input \n                  placeholder=\"Ej: +1 234 567 8900\" \n                  type=\"tel\"\n                  {...field} \n                />\n              </FormControl>\n              <FormDescription>\n                Opcional. Incluye el cdigo de pas si es necesario.\n              </FormDescription>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {/* Birth Date */}\n        <FormField\n          control={form.control}\n          name=\"birthDate\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Fecha de Nacimiento</FormLabel>\n              <FormControl>\n                <Input\n                  placeholder=\"DD/MM/YYYY\"\n                  value={birthDateInput}\n                  onChange={(e) => {\n                    const inputValue = e.target.value;\n                    setBirthDateInput(inputValue);\n                    \n                    // Only update the form field if we have a valid date\n                    const parsedDate = parseDate(inputValue);\n                    if (parsedDate || !inputValue.trim()) {\n                      field.onChange(parsedDate);\n                    }\n                  }}\n                  onBlur={(e) => {\n                    const inputValue = e.target.value;\n                    const parsedDate = parseDate(inputValue);\n                    \n                    if (parsedDate) {\n                      // Valid date: format it properly\n                      const formattedDate = formatDateForDisplay(parsedDate);\n                      setBirthDateInput(formattedDate);\n                      field.onChange(parsedDate);\n                    } else if (!inputValue.trim()) {\n                      // Empty input: clear everything\n                      setBirthDateInput('');\n                      field.onChange(undefined);\n                    } else {\n                      // Invalid date: keep the input but clear the form field\n                      field.onChange(undefined);\n                    }\n                    \n                    field.onBlur();\n                  }}\n                />\n              </FormControl>\n              <FormDescription>\n                Ingresa la fecha en formato DD/MM/YYYY (ejemplo: 15/03/1990)\n              </FormDescription>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {/* Baptism Date */}\n        <FormField\n          control={form.control}\n          name=\"baptismDate\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Fecha de Bautismo</FormLabel>\n              <FormControl>\n                <Input\n                  placeholder=\"DD/MM/YYYY\"\n                  value={baptismDateInput}\n                  onChange={(e) => {\n                    const inputValue = e.target.value;\n                    setBaptismDateInput(inputValue);\n                    \n                    // Only update the form field if we have a valid date\n                    const parsedDate = parseDate(inputValue);\n                    if (parsedDate || !inputValue.trim()) {\n                      field.onChange(parsedDate);\n                    }\n                  }}\n                  onBlur={(e) => {\n                    const inputValue = e.target.value;\n                    const parsedDate = parseDate(inputValue);\n                    \n                    if (parsedDate) {\n                      // Valid date: format it properly\n                      const formattedDate = formatDateForDisplay(parsedDate);\n                      setBaptismDateInput(formattedDate);\n                      field.onChange(parsedDate);\n                    } else if (!inputValue.trim()) {\n                      // Empty input: clear everything\n                      setBaptismDateInput('');\n                      field.onChange(undefined);\n                    } else {\n                      // Invalid date: keep the input but clear the form field\n                      field.onChange(undefined);\n                    }\n                    \n                    field.onBlur();\n                  }}\n                />\n              </FormControl>\n              <FormDescription>\n                Ingresa la fecha en formato DD/MM/YYYY (ejemplo: 15/03/2023)\n              </FormDescription>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {/* Baptism Photos */}\n        <div className=\"space-y-4\">\n          <Label>Fotos de Bautismo (Opcional)</Label>\n          <div className=\"space-y-3\">\n            <div className=\"flex gap-2\">\n              <Label htmlFor=\"baptism-photos-upload\" className=\"cursor-pointer\">\n                <Button type=\"button\" variant=\"outline\" size=\"sm\" asChild>\n                  <span>\n                    <Upload className=\"mr-2 h-4 w-4\" />\n                    Agregar Fotos\n                  </span>\n                </Button>\n              </Label>\n              <Input\n                id=\"baptism-photos-upload\"\n                ref={baptismPhotosInputRef}\n                type=\"file\"\n                accept=\"image/*\"\n                multiple\n                onChange={handleBaptismPhotosChange}\n                className=\"hidden\"\n              />\n            </div>\n            \n            {baptismPhotoPreviews.length > 0 && (\n              <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n                {baptismPhotoPreviews.map((preview, index) => (\n                  <div key={index} className=\"relative group\">\n                    <img\n                      src={preview}\n                      alt={`Foto de bautismo ${index + 1}`}\n                      className=\"w-full h-24 object-cover rounded-md border\"\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={() => removeBaptismPhoto(index)}\n                      className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity\"\n                      title=\"Eliminar foto de bautismo\"\n                      aria-label={`Eliminar foto de bautismo ${index + 1}`}\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </button>\n                  </div>\n                ))}\n              </div>\n            )}\n            \n            <p className=\"text-xs text-muted-foreground\">\n              Puedes subir hasta 10 fotos. Formatos: JPG, PNG, GIF. Mximo 5MB por foto.\n            </p>\n          </div>\n        </div>\n\n        {/* Ordenanzas */}\n        <FormField\n          control={form.control}\n          name=\"ordinances\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Ordenanzas Recibidas</FormLabel>\n              <FormDescription>\n                Selecciona las ordenanzas que ha recibido el miembro.\n              </FormDescription>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3\">\n                {(Object.entries(OrdinanceLabels) as [Ordinance, string][]).map(([ordinance, label]) => (\n                  <div key={ordinance} className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      checked={field.value?.includes(ordinance) || false}\n                      onCheckedChange={(checked) => {\n                        const currentOrdinances = field.value || [];\n                        if (checked) {\n                          field.onChange([...currentOrdinances, ordinance]);\n                        } else {\n                          field.onChange(currentOrdinances.filter(o => o !== ordinance));\n                        }\n                      }}\n                    />\n                    <Label className=\"text-sm font-normal cursor-pointer\" htmlFor={ordinance}>\n                      {label}\n                    </Label>\n                  </div>\n                ))}\n              </div>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {/* Maestros Ministrantes */}\n        <FormField\n          control={form.control}\n          name=\"ministeringTeachers\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Maestros Ministrantes</FormLabel>\n              <FormDescription>\n                Selecciona los miembros que ministran a esta persona/familia.\n              </FormDescription>\n              <div className=\"max-h-48 overflow-y-auto border rounded-md p-3\">\n                {loadingMembers ? (\n                  <div className=\"text-sm text-muted-foreground text-center py-4\">\n                    Cargando miembros disponibles...\n                  </div>\n                ) : availableMembers.length === 0 ? (\n                  <div className=\"text-sm text-muted-foreground text-center py-4\">\n                    No hay miembros disponibles para asignar.\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {availableMembers.map((availableMember) => {\n                      const memberName = `${availableMember.firstName} ${availableMember.lastName}`;\n                      const isSelected = field.value?.includes(memberName) || false;\n                      \n                      return (\n                        <div key={availableMember.id} className=\"flex items-center space-x-3\">\n                          <Checkbox\n                            checked={isSelected}\n                            onCheckedChange={(checked) => {\n                              const currentTeachers = field.value || [];\n                              if (checked) {\n                                field.onChange([...currentTeachers, memberName]);\n                              } else {\n                                field.onChange(currentTeachers.filter(name => name !== memberName));\n                              }\n                            }}\n                          />\n                          <div className=\"flex items-center space-x-2 flex-1\">\n                            <Avatar className=\"h-8 w-8\">\n                              <AvatarImage src={availableMember.photoURL} />\n                              <AvatarFallback className=\"text-xs\">\n                                {availableMember.firstName.charAt(0)}{availableMember.lastName.charAt(0)}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <Label className=\"text-sm font-normal cursor-pointer\">\n                                {memberName}\n                              </Label>\n                              {availableMember.status && (\n                                <p className=\"text-xs text-muted-foreground capitalize\">\n                                  {availableMember.status === 'active' ? 'Activo' : \n                                   availableMember.status === 'less_active' ? 'Menos Activo' : 'Inactivo'}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </div>\n              {field.value && field.value.length > 0 && (\n                <p className=\"text-sm text-muted-foreground\">\n                  {field.value.length} ministrante(s) seleccionado(s)\n                </p>\n              )}\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {/* Status */}\n        <FormField\n          control={form.control}\n          name=\"status\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Estado de Actividad *</FormLabel>\n              <Select onValueChange={field.onChange} value={field.value}>\n                <FormControl>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Selecciona el estado\" />\n                  </SelectTrigger>\n                </FormControl>\n                <SelectContent>\n                  <SelectItem value=\"active\">Activo</SelectItem>\n                  <SelectItem value=\"less_active\">Menos Activo</SelectItem>\n                  <SelectItem value=\"inactive\">Inactivo</SelectItem>\n                </SelectContent>\n              </Select>\n              <FormDescription>\n                El estado determina cmo aparece el miembro en los reportes y seguimientos.\n              </FormDescription>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {/* Form Actions */}\n        <div className=\"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 space-y-2 space-y-reverse sm:space-y-0\">\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={onClose}\n            disabled={loading}\n          >\n            Cancelar\n          </Button>\n          <Button type=\"submit\" disabled={loading}>\n            {loading ? (\n              <>\n                <div className=\"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-background border-t-current\" />\n                {member ? 'Actualizando...' : 'Creando...'}\n              </>\n            ) : (\n              `${member ? 'Actualizar' : 'Crear'} Miembro`\n            )}\n          </Button>\n        </div>\n      </form>\n    </Form>\n    </>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\members\\member-selector.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMembers'. Either include it or remove the dependency array.","line":105,"column":6,"nodeType":"ArrayExpression","endLine":105,"endColumn":44,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMembers, includeInactive, statusFilter, value]","fix":{"range":[2833,2871],"text":"[fetchMembers, includeInactive, statusFilter, value]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\components\\members\\member-selector.tsx:262:7\n  260 |   useEffect(() => {\n  261 |     if (!memberId) {\n> 262 |       setMember(null);\n      |       ^^^^^^^^^ Avoid calling setState() directly within an effect\n  263 |       return;\n  264 |     }\n  265 |","line":262,"column":7,"nodeType":null,"endLine":262,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Check, ChevronsUpDown, Users, Search } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from '@/components/ui/command';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Badge } from '@/components/ui/badge';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useToast } from '@/hooks/use-toast';\nimport type { Member, MemberStatus } from '@/lib/types';\nimport { getMembersForSelector } from '@/lib/members-data';\n\ninterface MemberSelectorProps {\n  value?: string; // Member ID\n  onValueChange: (memberId: string | undefined, member: Member | null) => void;\n  placeholder?: string;\n  includeInactive?: boolean;\n  statusFilter?: MemberStatus[];\n  disabled?: boolean;\n  className?: string;\n  showStatus?: boolean;\n  allowClear?: boolean;\n}\n\nconst statusConfig = {\n  active: {\n    label: 'Activo',\n    variant: 'default' as const,\n    color: 'text-green-600'\n  },\n  less_active: {\n    label: 'Menos Activo',\n    variant: 'secondary' as const,\n    color: 'text-yellow-600'\n  },\n  inactive: {\n    label: 'Inactivo',\n    variant: 'destructive' as const,\n    color: 'text-red-600'\n  }\n};\n\nexport function MemberSelector({\n  value,\n  onValueChange,\n  placeholder = 'Seleccionar miembro...',\n  includeInactive = false,\n  statusFilter,\n  disabled = false,\n  className,\n  showStatus = true,\n  allowClear = true,\n}: MemberSelectorProps) {\n  const { toast } = useToast();\n  const [open, setOpen] = useState(false);\n  const [members, setMembers] = useState<Member[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedMember, setSelectedMember] = useState<Member | null>(null);\n\n  const fetchMembers = async () => {\n    setLoading(true);\n    try {\n      const allMembers = await getMembersForSelector(includeInactive);\n      \n      // Apply status filter if provided\n      const filteredMembers = statusFilter \n        ? allMembers.filter(member => statusFilter.includes(member.status))\n        : allMembers;\n      \n      setMembers(filteredMembers);\n      \n      // Find and set selected member if value is provided\n      if (value) {\n        const member = filteredMembers.find(m => m.id === value);\n        setSelectedMember(member || null);\n      }\n    } catch (error) {\n      console.error('Error fetching members:', error);\n      toast({\n        title: 'Error',\n        description: 'No se pudieron cargar los miembros.',\n        variant: 'destructive'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchMembers();\n  }, [includeInactive, statusFilter, value]);\n\n  const handleSelect = (memberId: string) => {\n    const member = members.find(m => m.id === memberId);\n    if (member) {\n      setSelectedMember(member);\n      onValueChange(memberId, member);\n    }\n    setOpen(false);\n  };\n\n  const handleClear = () => {\n    setSelectedMember(null);\n    onValueChange(undefined, null);\n  };\n\n  const getDisplayName = (member: Member) => {\n    return `${member.firstName} ${member.lastName}`;\n  };\n\n  const getInitials = (member: Member) => {\n    return `${member.firstName[0]?.toUpperCase() || ''}${member.lastName[0]?.toUpperCase() || ''}`;\n  };\n\n  if (loading) {\n    return (\n      <div className={cn('flex items-center space-x-2', className)}>\n        <Skeleton className=\"h-10 w-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className={cn('flex items-center gap-2', className)}>\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            role=\"combobox\"\n            aria-expanded={open}\n            className=\"flex-1 justify-between\"\n            disabled={disabled}\n          >\n            {selectedMember ? (\n              <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n                <Avatar className=\"h-6 w-6\">\n                  <AvatarImage src={selectedMember.photoURL || undefined} />\n                  <AvatarFallback className=\"text-xs\">\n                    {getInitials(selectedMember)}\n                  </AvatarFallback>\n                </Avatar>\n                <span className=\"truncate\">{getDisplayName(selectedMember)}</span>\n                {showStatus && (\n                  <Badge \n                    variant={statusConfig[selectedMember.status].variant}\n                    className=\"ml-auto text-xs\"\n                  >\n                    {statusConfig[selectedMember.status].label}\n                  </Badge>\n                )}\n              </div>\n            ) : (\n              <div className=\"flex items-center gap-2 text-muted-foreground\">\n                <Users className=\"h-4 w-4\" />\n                <span>{placeholder}</span>\n              </div>\n            )}\n            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-full p-0\" align=\"start\">\n          <Command>\n            <CommandInput \n              placeholder=\"Buscar miembro...\" \n              className=\"h-9\"\n            />\n            <CommandList>\n              <CommandEmpty>\n                <div className=\"flex flex-col items-center gap-2 py-6\">\n                  <Search className=\"h-8 w-8 text-muted-foreground\" />\n                  <p className=\"text-sm text-muted-foreground\">\n                    No se encontraron miembros.\n                  </p>\n                </div>\n              </CommandEmpty>\n              <CommandGroup>\n                {members.map((member) => {\n                  const statusInfo = statusConfig[member.status];\n                  \n                  return (\n                    <CommandItem\n                      key={member.id}\n                      value={`${member.firstName} ${member.lastName} ${member.id}`}\n                      onSelect={() => handleSelect(member.id)}\n                      className=\"flex items-center gap-2 p-2\"\n                    >\n                      <Avatar className=\"h-8 w-8\">\n                        <AvatarImage src={member.photoURL || undefined} />\n                        <AvatarFallback className=\"text-xs\">\n                          {getInitials(member)}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-medium truncate\">\n                          {getDisplayName(member)}\n                        </p>\n                        {member.phoneNumber && (\n                          <p className=\"text-xs text-muted-foreground truncate\">\n                            {member.phoneNumber}\n                          </p>\n                        )}\n                      </div>\n                      {showStatus && (\n                        <Badge \n                          variant={statusInfo.variant}\n                          className=\"text-xs\"\n                        >\n                          {statusInfo.label}\n                        </Badge>\n                      )}\n                      <Check\n                        className={cn(\n                          'ml-2 h-4 w-4',\n                          value === member.id ? 'opacity-100' : 'opacity-0'\n                        )}\n                      />\n                    </CommandItem>\n                  );\n                })}\n              </CommandGroup>\n            </CommandList>\n          </Command>\n        </PopoverContent>\n      </Popover>\n      \n      {allowClear && selectedMember && (\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={handleClear}\n          disabled={disabled}\n          className=\"px-2\"\n        >\n          \n        </Button>\n      )}\n    </div>\n  );\n}\n\n// Hook to get member data by ID\nexport function useMemberData(memberId?: string) {\n  const [member, setMember] = useState<Member | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (!memberId) {\n      setMember(null);\n      return;\n    }\n\n    setLoading(true);\n    getMembersForSelector(true)\n      .then(members => {\n        const foundMember = members.find(m => m.id === memberId);\n        setMember(foundMember || null);\n      })\n      .catch(error => {\n        console.error('Error fetching member data:', error);\n        setMember(null);\n      })\n      .finally(() => {\n        setLoading(false);\n      });\n  }, [memberId]);\n\n  return { member, loading };\n}\n\n// Utility function to auto-fill form fields from member data\nexport function fillFormFromMember(\n  member: Member | null,\n  setValue: (name: string, value: any) => void,\n  fieldMappings: Record<string, keyof Member> = {\n    firstName: 'firstName',\n    lastName: 'lastName',\n    phoneNumber: 'phoneNumber',\n    photoURL: 'photoURL'\n  }\n) {\n  if (!member) {\n    // Clear fields if no member selected\n    Object.keys(fieldMappings).forEach(fieldName => {\n      setValue(fieldName, '');\n    });\n    return;\n  }\n\n  // Fill fields with member data\n  Object.entries(fieldMappings).forEach(([fieldName, memberProperty]) => {\n    const value = member[memberProperty];\n    if (value !== null && value !== undefined) {\n      setValue(fieldName, value);\n    }\n  });\n}\n\n// Component for displaying member info in read-only mode\ninterface MemberDisplayProps {\n  member: Member;\n  showStatus?: boolean;\n  showPhone?: boolean;\n  className?: string;\n}\n\nexport function MemberDisplay({ \n  member, \n  showStatus = true, \n  showPhone = false,\n  className \n}: MemberDisplayProps) {\n  const statusInfo = statusConfig[member.status];\n  \n  return (\n    <div className={cn('flex items-center gap-3', className)}>\n      <Avatar className=\"h-10 w-10\">\n        <AvatarImage src={member.photoURL || undefined} />\n        <AvatarFallback>\n          {member.firstName[0]?.toUpperCase()}\n          {member.lastName[0]?.toUpperCase()}\n        </AvatarFallback>\n      </Avatar>\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"font-medium truncate\">\n          {member.firstName} {member.lastName}\n        </p>\n        {showPhone && member.phoneNumber && (\n          <p className=\"text-sm text-muted-foreground truncate\">\n            {member.phoneNumber}\n          </p>\n        )}\n      </div>\n      {showStatus && (\n        <Badge variant={statusInfo.variant}>\n          {statusInfo.label}\n        </Badge>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\notification-bell.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\components\\notification-bell.tsx:51:5\n  49 |\n  50 |   useEffect(() => {\n> 51 |     fetchNotifications();\n     |     ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  52 |   }, [user]);\n  53 |\n  54 |   const handleMarkAsRead = async () => {","line":51,"column":5,"nodeType":null,"endLine":51,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNotifications'. Either include it or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNotifications, user]","fix":{"range":[1729,1735],"text":"[fetchNotifications, user]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { Bell, Mail, ExternalLink } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/auth-context\";\nimport { useRouter } from \"next/navigation\";\nimport { doc, setDoc, getDocs, collection, query, where, orderBy, writeBatch } from \"firebase/firestore\";\nimport { pushSubscriptionsCollection, notificationsCollection } from \"@/lib/collections\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport type { AppNotification } from \"@/lib/types\";\nimport { formatRelative } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\nimport { Skeleton } from \"./ui/skeleton\";\n\nexport function NotificationBell() {\n  const { user } = useAuth();\n  const router = useRouter();\n  const [notifications, setNotifications] = useState<AppNotification[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [hasUnread, setHasUnread] = useState(false);\n\n  const fetchNotifications = async () => {\n    if (!user) return;\n    setLoading(true);\n    try {\n      const q = query(\n        notificationsCollection,\n        where(\"userId\", \"==\", user.uid),\n        orderBy(\"createdAt\", \"desc\")\n      );\n      const snapshot = await getDocs(q);\n      const userNotifications = snapshot.docs.map(\n        (doc) => ({ id: doc.id, ...doc.data() } as AppNotification)\n      );\n      setNotifications(userNotifications);\n      setHasUnread(userNotifications.some(n => !n.isRead));\n    } catch (error) {\n      console.error(\"Error fetching notifications:\", error);\n    }\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    fetchNotifications();\n  }, [user]);\n\n  const handleMarkAsRead = async () => {\n    if (!user || !hasUnread) return;\n\n    const unreadNotifications = notifications.filter(n => !n.isRead);\n    if (unreadNotifications.length === 0) return;\n\n    try {\n      const batch = writeBatch(doc(notificationsCollection).firestore);\n      unreadNotifications.forEach(n => {\n        const docRef = doc(notificationsCollection, n.id);\n        batch.update(docRef, { isRead: true });\n      });\n      await batch.commit();\n      setHasUnread(false);\n      // Optimistically update UI\n      setNotifications(prev => prev.map(n => ({...n, isRead: true})));\n    } catch (error) {\n        console.error(\"Error marking notifications as read:\", error);\n    }\n  };\n\n  // Generate navigation URL based on notification context\n  const getNavigationUrl = (notification: AppNotification): string | null => {\n    // If explicit actionUrl is provided, use it\n    if (notification.actionUrl) {\n      return notification.actionUrl;\n    }\n\n    // Generate URL based on contextType and contextId\n    if (!notification.contextType) {\n      return null;\n    }\n\n    switch (notification.contextType) {\n      case 'convert':\n        return notification.contextId ? `/converts/${notification.contextId}` : null;\n      case 'activity':\n        return '/reports';\n      case 'service':\n        return notification.contextId ? `/services/${notification.contextId}` : null;\n      case 'member':\n        return notification.contextId ? `/members/${notification.contextId}` : null;\n      case 'council':\n        return `/council`;\n      case 'baptism':\n        return notification.contextId ? `/baptisms/${notification.contextId}` : null;\n      case 'birthday':\n        return `/birthdays`;\n      case 'investigator':\n        return notification.contextId ? `/investigators/${notification.contextId}` : null;\n      case 'urgent_family':\n        return '/ministering/urgent';\n      case 'missionary_assignment':\n        return '/missionary-work';\n      default:\n        return null;\n    }\n  };\n\n  const handleNotificationClick = async (notification: AppNotification) => {\n    const url = getNavigationUrl(notification);\n    \n    if (url) {\n      // Mark notification as read when clicked\n      if (!notification.isRead) {\n        try {\n          const docRef = doc(notificationsCollection, notification.id);\n          await setDoc(docRef, { ...notification, isRead: true }, { merge: true });\n          \n          // Update local state\n          setNotifications(prev => \n            prev.map(n => n.id === notification.id ? {...n, isRead: true} : n)\n          );\n          \n          // Update unread status\n          const stillHasUnread = notifications.some(n => n.id !== notification.id && !n.isRead);\n          setHasUnread(stillHasUnread);\n        } catch (error) {\n          console.error(\"Error marking notification as read:\", error);\n        }\n      }\n\n      // Navigate based on action type\n      if (notification.actionType === 'external' && url.startsWith('http')) {\n        window.open(url, '_blank');\n      } else {\n        router.push(url);\n      }\n    }\n  };\n\n\n  return (\n    <Popover onOpenChange={(isOpen) => { if (isOpen) fetchNotifications(); else handleMarkAsRead(); }}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          aria-label=\"Toggle notifications\"\n          className=\"relative\"\n        >\n          <Bell className=\"h-5 w-5\" />\n          {hasUnread && <span className=\"absolute top-1 right-1 flex h-2.5 w-2.5\">\n            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75\"></span>\n            <span className=\"relative inline-flex rounded-full h-2.5 w-2.5 bg-primary\"></span>\n          </span>}\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-80\" align=\"end\">\n        <div className=\"flex justify-between items-center mb-2\">\n          <h4 className=\"font-medium text-sm\">Notificaciones</h4>\n        </div>\n        <div className=\"space-y-2\">\n            {loading ? (\n                <>\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                </>\n            ) : notifications.length > 0 ? (\n                notifications.map((notif) => {\n                    const url = getNavigationUrl(notif);\n                    const isClickable = !!url;\n                    \n                    return (\n                        <div \n                            key={notif.id} \n                            className={`text-sm p-2 rounded-md transition-colors ${\n                                isClickable \n                                    ? 'hover:bg-muted cursor-pointer border border-transparent hover:border-border' \n                                    : 'hover:bg-muted/50'\n                            } ${!notif.isRead ? 'bg-primary/5 border-primary/20' : ''}`}\n                            onClick={() => isClickable && handleNotificationClick(notif)}\n                        >\n                            <div className=\"flex justify-between items-start\">\n                                <div className=\"flex-1\">\n                                    <p className={`font-semibold ${!notif.isRead ? 'text-primary' : ''}`}>\n                                        {notif.title}\n                                    </p>\n                                    <p className=\"text-muted-foreground text-xs\">{notif.body}</p>\n                                    <p className=\"text-muted-foreground text-xs mt-1\">\n                                        {formatRelative(notif.createdAt.toDate(), new Date(), { locale: es })}\n                                    </p>\n                                </div>\n                                {isClickable && (\n                                    <div className=\"ml-2 flex-shrink-0\">\n                                        {notif.actionType === 'external' ? (\n                                            <ExternalLink className=\"h-3 w-3 text-muted-foreground\" />\n                                        ) : (\n                                            <div className=\"h-3 w-3 rounded-full bg-primary/20\" />\n                                        )}\n                                    </div>\n                                )}\n                            </div>\n                            {!notif.isRead && (\n                                <div className=\"absolute top-2 right-2 h-2 w-2 bg-primary rounded-full\" />\n                            )}\n                        </div>\n                    );\n                })\n            ) : (\n                <div className=\"flex flex-col items-center justify-center text-center text-muted-foreground p-4\">\n                    <Mail className=\"h-8 w-8 mb-2\" />\n                    <p className=\"text-sm\">No tienes notificaciones</p>\n                </div>\n            )}\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\offline-indicator.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\components\\offline-indicator.tsx:17:9\n  15 |\n  16 |     useEffect(() => {\n> 17 |         setIsClient(true);\n     |         ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  18 |     }, []);\n  19 |\n  20 |     if (!isClient) {","line":17,"column":9,"nodeType":null,"endLine":17,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport dynamic from 'next/dynamic';\nimport { useState, useEffect } from 'react';\n\n// Dynamically import the client component with no SSR\nconst ClientOfflineIndicator = dynamic(\n    () => import('./client-offline-indicator'),\n    { ssr: false }\n);\n\n// Simple wrapper component that only renders on the client side\nexport default function OfflineIndicator() {\n    const [isClient, setIsClient] = useState(false);\n\n    useEffect(() => {\n        setIsClient(true);\n    }, []);\n\n    if (!isClient) {\n        return null;\n    }\n\n    return <ClientOfflineIndicator />;\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\placeholder-page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\push-notification-manager.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkSubscription'. Either include it or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [checkSubscription, user]","fix":{"range":[1639,1645],"text":"[checkSubscription, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '@/contexts/auth-context';\nimport { doc, setDoc } from 'firebase/firestore';\nimport { pushSubscriptionsCollection } from '@/lib/collections';\nimport { useToast } from '@/hooks/use-toast';\nimport { Button } from '@/components/ui/button';\nimport { Bell, BellOff } from 'lucide-react';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nconst VAPID_PUBLIC_KEY = process.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY;\n\nfunction urlBase64ToUint8Array(base64String: string) {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding)\n    .replace(/\\-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\n\nexport function PushNotificationManager() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [isSubscribed, setIsSubscribed] = useState(false);\n  const [isSupported, setIsSupported] = useState(false);\n  const [showPermissionDialog, setShowPermissionDialog] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    // Verificar si las notificaciones push son soportadas\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\n      setIsSupported(true);\n      checkSubscription();\n    }\n  }, [user]);\n\n  const checkSubscription = async () => {\n    if (!user) return;\n\n    try {\n      const registration = await navigator.serviceWorker.ready;\n      const subscription = await registration.pushManager.getSubscription();\n      setIsSubscribed(!!subscription);\n    } catch (error) {\n      console.error('Error checking push subscription:', error);\n    }\n  };\n\n  const subscribeToPush = async () => {\n    if (!user || !VAPID_PUBLIC_KEY) {\n      toast({\n        title: \"Error\",\n        description: \"No se puede activar las notificaciones en este momento.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const registration = await navigator.serviceWorker.ready;\n      \n      // Solicitar permiso\n      const permission = await Notification.requestPermission();\n      \n      if (permission !== 'granted') {\n        toast({\n          title: \"Permiso Denegado\",\n          description: \"No se otorg permiso para enviar notificaciones.\",\n          variant: \"destructive\"\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Suscribirse a push\n      const subscription = await registration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n      });\n\n      // Guardar la suscripcin en Firestore\n      await setDoc(doc(pushSubscriptionsCollection, user.uid), {\n        userId: user.uid,\n        subscription: JSON.parse(JSON.stringify(subscription)),\n        createdAt: new Date(),\n        userAgent: navigator.userAgent\n      });\n\n      setIsSubscribed(true);\n      toast({\n        title: \"Notificaciones Activadas\",\n        description: \"Recibirs notificaciones push en este dispositivo.\",\n      });\n\n      // Enviar notificacin de prueba\n      if (Notification.permission === 'granted') {\n        new Notification('Notificaciones Activadas!', {\n          body: 'Ahora recibirs recordatorios importantes de la aplicacin.',\n          icon: '/logo.svg',\n          badge: '/logo.svg'\n        });\n      }\n    } catch (error) {\n      console.error('Error subscribing to push:', error);\n      toast({\n        title: \"Error\",\n        description: \"No se pudo activar las notificaciones. Intenta de nuevo.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n      setShowPermissionDialog(false);\n    }\n  };\n\n  const unsubscribeFromPush = async () => {\n    if (!user) return;\n\n    setIsLoading(true);\n    try {\n      const registration = await navigator.serviceWorker.ready;\n      const subscription = await registration.pushManager.getSubscription();\n      \n      if (subscription) {\n        await subscription.unsubscribe();\n      }\n\n      // Eliminar de Firestore\n      await setDoc(doc(pushSubscriptionsCollection, user.uid), {\n        userId: user.uid,\n        subscription: null,\n        unsubscribedAt: new Date()\n      });\n\n      setIsSubscribed(false);\n      toast({\n        title: \"Notificaciones Desactivadas\",\n        description: \"Ya no recibirs notificaciones push en este dispositivo.\",\n      });\n    } catch (error) {\n      console.error('Error unsubscribing from push:', error);\n      toast({\n        title: \"Error\",\n        description: \"No se pudo desactivar las notificaciones.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (!isSupported || !user) {\n    return null;\n  }\n\n  return (\n    <>\n      <Button\n        variant={isSubscribed ? \"outline\" : \"default\"}\n        size=\"sm\"\n        onClick={() => {\n          if (isSubscribed) {\n            unsubscribeFromPush();\n          } else {\n            setShowPermissionDialog(true);\n          }\n        }}\n        disabled={isLoading}\n      >\n        {isSubscribed ? (\n          <>\n            <BellOff className=\"mr-2 h-4 w-4\" />\n            Desactivar Notificaciones\n          </>\n        ) : (\n          <>\n            <Bell className=\"mr-2 h-4 w-4\" />\n            Activar Notificaciones\n          </>\n        )}\n      </Button>\n\n      <AlertDialog open={showPermissionDialog} onOpenChange={setShowPermissionDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Activar Notificaciones Push</AlertDialogTitle>\n            <AlertDialogDescription>\n              Deseas recibir notificaciones push en este dispositivo? Te enviaremos recordatorios importantes sobre:\n              <ul className=\"list-disc list-inside mt-2 space-y-1\">\n                <li>Cumpleaos de miembros</li>\n                <li>Servicios prximos</li>\n                <li>Necesidades urgentes de ministracin</li>\n                <li>Actividades del qurum</li>\n                <li>Asignaciones de la obra misional</li>\n              </ul>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancelar</AlertDialogCancel>\n            <AlertDialogAction onClick={subscribeToPush}>\n              Activar Notificaciones\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\role-management.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\service-worker-registration.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\shared\\annotation-manager.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":383,"column":68,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[14993,15062],"text":"\n                            Esta accin eliminar permanentemente: &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[14993,15062],"text":"\n                            Esta accin eliminar permanentemente: &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[14993,15062],"text":"\n                            Esta accin eliminar permanentemente: &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[14993,15062],"text":"\n                            Esta accin eliminar permanentemente: &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":383,"column":94,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[15087,15114],"text":"&quot;.\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[15087,15114],"text":"&ldquo;.\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[15087,15114],"text":"&#34;.\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[15087,15114],"text":"&rdquo;.\n                        "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport {\n    Dialog,\n    DialogContent,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from '@/components/ui/alert-dialog';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { useToast } from '@/hooks/use-toast';\nimport { PlusCircle, Trash2, Mic, MicOff, CheckCircle } from 'lucide-react';\n\ndeclare global {\n    interface Window {\n        SpeechRecognition: any;\n        webkitSpeechRecognition: any;\n    }\n}\n\ninterface AnnotationItem {\n    id: string;\n    description: string;\n    isCompleted?: boolean;\n    isCouncilAction?: boolean;\n    createdAt?: any;\n    userId?: string;\n}\n\ninterface AnnotationManagerProps {\n    title: string;\n    description: string;\n    buttonText: string;\n    dialogTitle: string;\n    placeholder: string;\n    items: AnnotationItem[];\n    loading: boolean;\n    showCheckbox?: boolean;\n    showResolveButton?: boolean;\n    onAdd: (description: string) => Promise<void>;\n    onToggle?: (id: string, status: boolean) => Promise<void>;\n    onDelete: (id: string) => Promise<void>;\n    onResolve?: (id: string) => Promise<void>;\n    emptyMessage?: string;\n    currentUserId?: string;\n}\n\nexport function AnnotationManager({\n    title,\n    description,\n    buttonText,\n    dialogTitle,\n    placeholder,\n    items,\n    loading,\n    showCheckbox = false,\n    showResolveButton = false,\n    onAdd,\n    onToggle,\n    onDelete,\n    onResolve,\n    emptyMessage = 'No hay elementos.',\n    currentUserId,\n}: AnnotationManagerProps) {\n    const { toast } = useToast();\n    const [isDialogOpen, setDialogOpen] = useState(false);\n    const [inputValue, setInputValue] = useState('');\n    const [errors, setErrors] = useState<{ description?: string[] }>({});\n    const [isPending, setIsPending] = useState(false);\n    const [deleteItem, setDeleteItem] = useState<AnnotationItem | null>(null);\n\n    // Voice recognition states\n    const [isRecording, setIsRecording] = useState(false);\n    const recognitionRef = useRef<any>(null);\n\n    const startRecording = () => {\n        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n            toast({\n                title: 'Error',\n                description: 'Reconocimiento de voz no soportado en este navegador.',\n                variant: 'destructive',\n            });\n            return;\n        }\n\n        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n        const recognition = new SpeechRecognition();\n        recognition.continuous = false;\n        recognition.interimResults = false;\n        recognition.lang = 'es-ES';\n\n        recognition.onstart = () => setIsRecording(true);\n        recognition.onresult = (event: any) => {\n            const transcript = event.results[0][0].transcript;\n            setInputValue(prev => prev + (prev ? ' ' : '') + transcript);\n        };\n        recognition.onend = () => setIsRecording(false);\n        recognition.onerror = (event: any) => {\n            console.error('Error en reconocimiento de voz', event.error);\n            setIsRecording(false);\n\n            // Don't show error toast for \"aborted\" errors as they are normal behavior\n            if (event.error !== 'aborted') {\n                toast({\n                    title: 'Error',\n                    description: 'Error en el reconocimiento de voz.',\n                    variant: 'destructive',\n                });\n            }\n        };\n\n        recognitionRef.current = recognition;\n        recognition.start();\n    };\n\n    const stopRecording = () => {\n        if (recognitionRef.current && isRecording) {\n            try {\n                recognitionRef.current.stop();\n            } catch (error) {\n                // Ignore errors when stopping recognition that may already be stopped\n                console.warn('Error stopping recognition:', error);\n            }\n        }\n    };\n\n    const toggleRecording = () => {\n        if (isRecording) {\n            stopRecording();\n        } else {\n            startRecording();\n        }\n    };\n\n    const handleDialogOpenChange = (open: boolean) => {\n        setDialogOpen(open);\n        if (open) {\n            // Auto-start recording when dialog opens\n            setTimeout(() => {\n                startRecording();\n            }, 300);\n        } else {\n            if (isRecording) {\n                stopRecording();\n            }\n            // Reset form when closing\n            setInputValue('');\n            setErrors({});\n        }\n    };\n\n    // Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            if (recognitionRef.current && isRecording) {\n                try {\n                    recognitionRef.current.stop();\n                } catch (error) {\n                    // Ignore cleanup errors\n                    console.warn('Error stopping recognition on cleanup:', error);\n                }\n            }\n        };\n    }, [isRecording]);\n\n    const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n        event.preventDefault();\n        setErrors({});\n\n        if (!inputValue.trim() || inputValue.trim().length < 5) {\n            setErrors({ description: ['La descripcin es requerida (mnimo 5 caracteres).'] });\n            return;\n        }\n\n        setIsPending(true);\n        try {\n            await onAdd(inputValue.trim());\n            toast({ title: 'xito', description: `${buttonText} agregado.` });\n            setDialogOpen(false);\n            setInputValue('');\n        } catch (error: any) {\n            console.error('Error adding item:', error);\n            toast({\n                title: 'Error',\n                description: `No se pudo agregar el ${buttonText.toLowerCase()}.`,\n                variant: 'destructive',\n            });\n        } finally {\n            setIsPending(false);\n        }\n    };\n\n    const handleToggle = async (id: string, status: boolean) => {\n        if (!onToggle) return;\n\n        setIsPending(true);\n        try {\n            await onToggle(id, status);\n        } catch (error) {\n            console.error('Error toggling item:', error);\n            toast({\n                title: 'Error',\n                description: 'No se pudo actualizar el elemento.',\n                variant: 'destructive',\n            });\n        } finally {\n            setIsPending(false);\n        }\n    };\n\n    const handleDelete = async () => {\n        if (!deleteItem) return;\n\n        setIsPending(true);\n        try {\n            await onDelete(deleteItem.id);\n            toast({ title: 'xito', description: 'Elemento eliminado.' });\n            setDeleteItem(null);\n        } catch (error) {\n            console.error('Error deleting item:', error);\n            toast({\n                title: 'Error',\n                description: 'No se pudo eliminar el elemento.',\n                variant: 'destructive',\n            });\n        } finally {\n            setIsPending(false);\n        }\n    };\n\n    return (\n        <>\n            <section>\n                <div className=\"flex justify-between items-center mb-4\">\n                    <div>\n                        <h2 className=\"text-xl font-semibold\">{title}</h2>\n                        <p className=\"text-sm text-muted-foreground\">{description}</p>\n                    </div>\n                    <Dialog open={isDialogOpen} onOpenChange={handleDialogOpenChange}>\n                        <DialogTrigger asChild>\n                            <Button size=\"sm\">\n                                <PlusCircle className=\"mr-2 h-4 w-4\" />\n                                {buttonText}\n                            </Button>\n                        </DialogTrigger>\n                        <DialogContent>\n                            <form onSubmit={handleSubmit}>\n                                <DialogHeader>\n                                    <DialogTitle>{dialogTitle}</DialogTitle>\n                                </DialogHeader>\n                                <div className=\"py-4\">\n                                    <Label htmlFor=\"description\">Descripcin</Label>\n                                    <div className=\"flex items-center gap-2 mt-1\">\n                                        <Input\n                                            id=\"description\"\n                                            name=\"description\"\n                                            value={inputValue}\n                                            onChange={(e) => setInputValue(e.target.value)}\n                                            placeholder={placeholder}\n                                        />\n                                        <Button\n                                            type=\"button\"\n                                            variant={isRecording ? \"destructive\" : \"outline\"}\n                                            size=\"icon\"\n                                            onClick={toggleRecording}\n                                            title={isRecording ? \"Detener grabacin\" : \"Iniciar grabacin\"}\n                                        >\n                                            {isRecording ? (\n                                                <MicOff className=\"h-4 w-4\" />\n                                            ) : (\n                                                <Mic className=\"h-4 w-4\" />\n                                            )}\n                                        </Button>\n                                    </div>\n                                    {isRecording && (\n                                        <div className=\"flex items-center gap-2 text-sm text-red-600 mt-2\">\n                                            <div className=\"w-2 h-2 bg-red-600 rounded-full animate-pulse\"></div>\n                                            Escuchando...\n                                        </div>\n                                    )}\n                                    {errors?.description && (\n                                        <p className=\"text-sm text-destructive mt-1\">\n                                            {errors.description[0]}\n                                        </p>\n                                    )}\n                                </div>\n                                <DialogFooter>\n                                    <Button type=\"submit\" disabled={isPending}>\n                                        {isPending ? 'Guardando...' : 'Guardar'}\n                                    </Button>\n                                </DialogFooter>\n                            </form>\n                        </DialogContent>\n                    </Dialog>\n                </div>\n\n                {loading ? (\n                    <div className=\"space-y-2\">\n                        <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                        <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                        <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                    </div>\n                ) : items.length === 0 ? (\n                    <p className=\"text-sm text-center py-4 text-muted-foreground\">\n                        {emptyMessage}\n                    </p>\n                ) : (\n                    <ul className=\"space-y-2\">\n                        {items.map((item) => (\n                            <li\n                                key={item.id}\n                                className=\"flex items-center justify-between gap-3 p-3 border rounded-md\"\n                            >\n                                <div className=\"flex items-center gap-3 flex-1\">\n                                    {showCheckbox && onToggle && (\n                                        <Checkbox\n                                            id={item.id}\n                                            checked={item.isCompleted || false}\n                                            onCheckedChange={() => handleToggle(item.id, item.isCompleted || false)}\n                                            disabled={isPending}\n                                        />\n                                    )}\n                                    <Label\n                                        htmlFor={item.id}\n                                        className={`flex-1 ${item.isCompleted\n                                            ? 'line-through text-muted-foreground'\n                                            : ''\n                                            }`}\n                                    >\n                                        {item.description}\n                                    </Label>\n                                </div>\n                                <div className=\"flex items-center gap-1\">\n                                    {showResolveButton && onResolve && (\n                                        <Button\n                                            variant=\"outline\"\n                                            size=\"sm\"\n                                            onClick={() => onResolve(item.id)}\n                                            disabled={isPending}\n                                            title=\"Marcar como resuelta\"\n                                        >\n                                            <CheckCircle className=\"mr-2 h-4 w-4\" />\n                                            Resuelta\n                                        </Button>\n                                    )}\n                                    {currentUserId && (item.userId === currentUserId || !item.userId) && (\n                                        <Button\n                                            variant=\"ghost\"\n                                            size=\"icon\"\n                                            onClick={() => setDeleteItem(item)}\n                                            disabled={isPending}\n                                        >\n                                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                                        </Button>\n                                    )}\n                                </div>\n                            </li>\n                        ))}\n                    </ul>\n                )}\n            </section>\n\n            <AlertDialog open={!!deleteItem} onOpenChange={() => setDeleteItem(null)}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Ests seguro?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Esta accin eliminar permanentemente: \"{deleteItem?.description}\".\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                        <AlertDialogAction\n                            onClick={handleDelete}\n                            className=\"bg-destructive hover:bg-destructive/90\"\n                            disabled={isPending}\n                        >\n                            {isPending ? 'Eliminando...' : 'Eliminar'}\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </>\n    );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\shared\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\shared\\sync-status.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\shared\\voice-annotations.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":416,"column":102,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[13349,13350],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[13349,13350],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[13349,13350],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[13349,13350],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":416,"column":129,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[13376,13377],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[13376,13377],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[13376,13377],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[13376,13377],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport type { Annotation } from '@/lib/types';\nimport {\n  addDoc,\n  doc,\n  serverTimestamp,\n  updateDoc,\n} from 'firebase/firestore';\nimport { annotationsCollection } from '@/lib/collections';\n\nimport { Button } from '@/components/ui/button';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Textarea } from '@/components/ui/textarea';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Skeleton } from '../ui/skeleton';\nimport { CheckCircle, NotebookPen, PlusCircle, Trash2, Pencil, Mic, MicOff } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { EditAnnotationDialog } from '../dashboard/edit-annotation-dialog';\nimport { useToast } from '@/hooks/use-toast';\n\ndeclare global {\n  interface Window {\n    SpeechRecognition: any;\n    webkitSpeechRecognition: any;\n  }\n}\n\ninterface VoiceAnnotationsProps {\n  title: string;\n  description: string;\n  source: 'dashboard' | 'council' | 'family-search' | 'missionary-work';\n  annotations: Annotation[];\n  isLoading: boolean;\n  onAnnotationAdded: () => void;\n  onAnnotationToggled: () => void;\n  showCouncilView?: boolean;\n  onResolveAnnotation?: (id: string) => void;\n  onDeleteAnnotation?: (id: string) => void;\n  currentUserId?: string;\n}\n\nexport function VoiceAnnotations({\n  title,\n  description,\n  source,\n  annotations,\n  isLoading,\n  onAnnotationAdded,\n  onAnnotationToggled,\n  showCouncilView = false,\n  onResolveAnnotation,\n  onDeleteAnnotation,\n  currentUserId,\n}: VoiceAnnotationsProps) {\n  const { toast } = useToast();\n  const [open, setOpen] = useState(false);\n  const [newAnnotation, setNewAnnotation] = useState('');\n  const [isAlertOpen, setIsAlertOpen] = useState(false);\n  const [selectedAnnotation, setSelectedAnnotation] = useState<Annotation | null>(null);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [annotationToEdit, setAnnotationToEdit] = useState<Annotation | null>(null);\n  \n  // Voice recognition states\n  const [isRecording, setIsRecording] = useState(false);\n  const recognitionRef = useRef<any>(null);\n\n  const startRecording = () => {\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      toast({ \n        title: 'Error', \n        description: 'Reconocimiento de voz no soportado en este navegador.', \n        variant: 'destructive' \n      });\n      return;\n    }\n\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    const recognition = new SpeechRecognition();\n    \n    recognition.continuous = false;\n    recognition.interimResults = false;\n    recognition.lang = 'es-ES';\n    \n    recognition.onstart = () => {\n      setIsRecording(true);\n    };\n    \n    recognition.onresult = (event: any) => {\n      const transcript = event.results[0][0].transcript;\n      setNewAnnotation(prev => prev + (prev ? ' ' : '') + transcript);\n    };\n    \n    recognition.onend = () => {\n      setIsRecording(false);\n    };\n    \n    recognition.onerror = (event: any) => {\n      console.error('Error en reconocimiento de voz', event.error);\n      setIsRecording(false);\n\n      // Don't show error toast for \"aborted\" errors as they are normal behavior\n      if (event.error !== 'aborted') {\n        toast({\n          title: 'Error',\n          description: 'Error en el reconocimiento de voz.',\n          variant: 'destructive'\n        });\n      }\n    };\n    \n    recognitionRef.current = recognition;\n    recognition.start();\n  };\n\n  const stopRecording = () => {\n    if (recognitionRef.current && isRecording) {\n      try {\n        recognitionRef.current.stop();\n      } catch (error) {\n        // Ignore errors when stopping recognition that may already be stopped\n        console.warn('Error stopping recognition:', error);\n      }\n    }\n  };\n\n  const toggleRecording = () => {\n    if (isRecording) {\n      stopRecording();\n    } else {\n      startRecording();\n    }\n  };\n\n  // Auto-start recording when dialog opens\n  const handleDialogOpenChange = (isOpen: boolean) => {\n    setOpen(isOpen);\n    if (isOpen) {\n      // Small delay to ensure dialog is fully rendered\n      setTimeout(() => {\n        startRecording();\n      }, 300);\n    } else {\n      if (isRecording) {\n        stopRecording();\n      }\n      // Clear annotation when closing without saving\n      if (newAnnotation.trim() === '') {\n        setNewAnnotation('');\n      }\n    }\n  };\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (recognitionRef.current && isRecording) {\n        try {\n          recognitionRef.current.stop();\n        } catch (error) {\n          // Ignore cleanup errors\n          console.warn('Error stopping recognition on cleanup:', error);\n        }\n      }\n    };\n  }, [isRecording]);\n\n  const handleAddAnnotation = async () => {\n    if (newAnnotation.trim() === '') return;\n    if (!currentUserId) return;\n\n    try {\n      await addDoc(annotationsCollection, {\n        text: newAnnotation.trim(),\n        source,\n        isCouncilAction: false,\n        isResolved: false,\n        createdAt: serverTimestamp(),\n        userId: currentUserId,\n      });\n      \n      setNewAnnotation('');\n      setOpen(false);\n      onAnnotationAdded();\n      \n      toast({ \n        title: 'xito', \n        description: 'Anotacin guardada correctamente.' \n      });\n    } catch (error) {\n      console.error(\"Failed to add annotation: \", error);\n      toast({ \n        title: 'Error', \n        description: 'No se pudo guardar la anotacin.', \n        variant: 'destructive' \n      });\n    }\n  };\n\n  const handleToggleCouncilAction = async (\n    id: string,\n    currentStatus: boolean\n  ) => {\n    try {\n      const annotationRef = doc(annotationsCollection, id);\n      await updateDoc(annotationRef, { isCouncilAction: !currentStatus });\n      onAnnotationToggled();\n    } catch (error) {\n      console.error(\"Failed to toggle annotation: \", error);\n      toast({ \n        title: 'Error', \n        description: 'No se pudo actualizar la anotacin.', \n        variant: 'destructive' \n      });\n    }\n  };\n\n  const handleDeleteTrigger = (annotation: Annotation) => {\n    setSelectedAnnotation(annotation);\n    setIsAlertOpen(true);\n  };\n  \n  const handleDeleteConfirm = () => {\n    if (selectedAnnotation && onDeleteAnnotation) {\n      onDeleteAnnotation(selectedAnnotation.id);\n    }\n    setIsAlertOpen(false);\n    setSelectedAnnotation(null);\n  };\n\n  const handleEditAnnotation = (annotation: Annotation) => {\n    setAnnotationToEdit(annotation);\n    setEditDialogOpen(true);\n  };\n\n  const handleAnnotationUpdated = () => {\n    onAnnotationAdded();\n    setEditDialogOpen(false);\n    setAnnotationToEdit(null);\n  };\n\n  return (\n    <>\n      <Card>\n        <CardHeader>\n          <div className=\"flex justify-between items-start\">\n            <div className=\"flex items-start gap-3\">\n              <NotebookPen className=\"h-8 w-8 text-primary\" />\n              <div>\n                <CardTitle>{title}</CardTitle>\n                <CardDescription>{description}</CardDescription>\n              </div>\n            </div>\n            <Dialog open={open} onOpenChange={handleDialogOpenChange}>\n              <DialogTrigger asChild>\n                <Button>\n                  <PlusCircle className=\"mr-2 h-4 w-4\" />\n                  Anotacin\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Nueva Anotacin</DialogTitle>\n                  <DialogDescription>\n                    Habla o escribe la nota que quieres registrar. El reconocimiento de voz se inicia automticamente.\n                  </DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <Textarea\n                      value={newAnnotation}\n                      onChange={(e) => setNewAnnotation(e.target.value)}\n                      placeholder=\"Ej: Contactar a la familia Prez para ofrecer ayuda con la mudanza...\"\n                      rows={4}\n                    />\n                    <Button\n                      type=\"button\"\n                      variant={isRecording ? \"destructive\" : \"outline\"}\n                      size=\"icon\"\n                      onClick={toggleRecording}\n                      title={isRecording ? \"Detener grabacin\" : \"Iniciar grabacin\"}\n                    >\n                      {isRecording ? (\n                        <MicOff className=\"h-4 w-4\" />\n                      ) : (\n                        <Mic className=\"h-4 w-4\" />\n                      )}\n                    </Button>\n                  </div>\n                  {isRecording && (\n                    <div className=\"flex items-center gap-2 text-sm text-red-600\">\n                      <div className=\"w-2 h-2 bg-red-600 rounded-full animate-pulse\"></div>\n                      Escuchando...\n                    </div>\n                  )}\n                </div>\n                <DialogFooter>\n                  <Button\n                    onClick={handleAddAnnotation}\n                    disabled={!newAnnotation.trim()}\n                  >\n                    Guardar Anotacin\n                  </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              <Skeleton className=\"h-10 w-full\" />\n              <Skeleton className=\"h-10 w-full\" />\n              <Skeleton className=\"h-10 w-full\" />\n            </div>\n          ) : annotations.length === 0 ? (\n            <p className=\"text-center text-sm text-muted-foreground py-8\">\n              No hay anotaciones.\n            </p>\n          ) : (\n            <ul className=\"space-y-3\">\n              {annotations.map((item) => (\n                <li\n                  key={item.id}\n                  className=\"flex items-center justify-between rounded-md border p-3\"\n                >\n                  <div className=\"flex items-start gap-3\">\n                    {!showCouncilView && (\n                      <Checkbox\n                        id={`council-${item.id}`}\n                        checked={item.isCouncilAction}\n                        onCheckedChange={() => handleToggleCouncilAction(item.id, item.isCouncilAction)}\n                        aria-label=\"Marcar para consejo\"\n                      />\n                    )}\n                    <div>\n                      <p className=\"text-sm font-medium\">{item.text}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {format(item.createdAt.toDate(), 'd LLL yyyy, h:mm a', { locale: es })}\n                        {showCouncilView && ` - Creado en: ${item.source === 'dashboard' ? 'Dashboard' : \n                          item.source === 'council' ? 'Consejo' : \n                          item.source === 'family-search' ? 'FamilySearch' : 'Obra Misional'}`}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    {showCouncilView && onResolveAnnotation && (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => onResolveAnnotation(item.id)}\n                      >\n                        <CheckCircle className=\"mr-2 h-4 w-4\" />\n                        Resolver\n                      </Button>\n                    )}\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => handleEditAnnotation(item)}\n                      title=\"Editar anotacin\"\n                    >\n                      <Pencil className=\"h-4 w-4\" />\n                    </Button>\n                    {onDeleteAnnotation && currentUserId && (item.userId === currentUserId || !item.userId) && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handleDeleteTrigger(item)}\n                        title=\"Eliminar anotacin\"\n                      >\n                        <Trash2 className=\"h-4 w-4 text-destructive\" />\n                      </Button>\n                    )}\n                  </div>\n                </li>\n              ))}\n            </ul>\n          )}\n        </CardContent>\n      </Card>\n\n      <AlertDialog open={isAlertOpen} onOpenChange={setIsAlertOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Ests seguro?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Esta accin no se puede deshacer. Esto eliminar permanentemente la anotacin: <strong>\"{selectedAnnotation?.text}\"</strong>.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={() => setSelectedAnnotation(null)}>\n              Cancelar\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteConfirm}\n              className=\"bg-destructive hover:bg-destructive/90\"\n            >\n              Eliminar\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n      \n      <EditAnnotationDialog\n        annotation={annotationToEdit}\n        open={editDialogOpen}\n        onOpenChange={setEditDialogOpen}\n        onAnnotationUpdated={handleAnnotationUpdated}\n      />\n    </>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\theme-toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\sidebar.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Personal\\QuorumFlow\\src\\components\\ui\\sidebar.tsx:657:26\n  655 |   // Random width between 50 to 90%.\n  656 |   const width = React.useMemo(() => {\n> 657 |     return `${Math.floor(Math.random() * 40) + 50}%`\n      |                          ^^^^^^^^^^^^^ Cannot call impure function\n  658 |   }, [])\n  659 |\n  660 |   return (","line":657,"column":26,"nodeType":null,"endLine":657,"endColumn":39}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Sheet, SheetContent, SheetTitle, SheetDescription } from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={{\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties}\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetTitle className=\"sr-only\">Navigation Menu</SheetTitle>\n            <SheetDescription className=\"sr-only\">\n              The main navigation for the application.\n            </SheetDescription>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden md:block text-sidebar-foreground\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\components\\update-notification.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\contexts\\auth-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\contexts\\i18n-context.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\contexts\\i18n-context.tsx:29:7\n  27 |     const savedLang = localStorage.getItem(\"language\") as Language | null;\n  28 |     if (savedLang) {\n> 29 |       setLanguageState(savedLang);\n     |       ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  30 |     } else {\n  31 |       const browserLang = navigator.language.split('-')[0];\n  32 |       if (browserLang === 'en') {","line":29,"column":7,"nodeType":null,"endLine":29,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n\"use client\";\n\nimport { createContext, useContext, useState, ReactNode, useCallback, useEffect } from \"react\";\nimport enTranslations from '@/locales/en.json';\nimport esTranslations from '@/locales/es.json';\n\nconst translations: Record<string, Record<string, string>> = {\n  en: enTranslations,\n  es: esTranslations,\n};\n\ntype Language = \"en\" | \"es\";\n\ninterface I18nContextType {\n  language: Language;\n  setLanguage: (language: Language) => void;\n  t: (key: string) => string;\n}\n\nconst I18nContext = createContext<I18nContextType | undefined>(undefined);\n\nexport const I18nProvider = ({ children }: { children: ReactNode }) => {\n  const [language, setLanguageState] = useState<Language>(\"es\");\n\n  useEffect(() => {\n    const savedLang = localStorage.getItem(\"language\") as Language | null;\n    if (savedLang) {\n      setLanguageState(savedLang);\n    } else {\n      const browserLang = navigator.language.split('-')[0];\n      if (browserLang === 'en') {\n        setLanguageState('en');\n      } else {\n        setLanguageState('es'); // Default to Spanish\n      }\n    }\n  }, []);\n\n  const setLanguage = (lang: Language) => {\n    setLanguageState(lang);\n    localStorage.setItem(\"language\", lang);\n  };\n\n  const t = useCallback((key: string): string => {\n    const langKey = language as keyof typeof translations;\n    return translations[langKey]?.[key] || key;\n  }, [language]);\n\n\n  return (\n    <I18nContext.Provider value={{ language, setLanguage, t }}>\n      {children}\n    </I18nContext.Provider>\n  );\n};\n\nexport const useI18n = () => {\n  const context = useContext(I18nContext);\n  if (context === undefined) {\n    throw new Error(\"useI18n must be used within an I18nProvider\");\n  }\n  return context;\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\firebaseConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\hooks\\use-members-sync.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\hooks\\use-members.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\hooks\\use-offline.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\hooks\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\hooks\\useDateField.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\hooks\\usePWAInstallToast.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Personal\\QuorumFlow\\src\\hooks\\usePWAInstallToast.ts:72:7\n  70 |       \n  71 |       // Mark as installed to prevent duplicate toasts\n> 72 |       setIsInstalled(true);\n     |       ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  73 |       markToastAsShown();\n  74 |       \n  75 |       // Auto-dismiss after 5 seconds as a fallback","line":72,"column":7,"nodeType":null,"endLine":72,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback } from 'react';\nimport { useToast } from './use-toast';\nimport { Button } from '@/components/ui/button';\n\n// Check if running as PWA\nconst isRunningAsPWA = (): boolean => {\n  if (typeof window === 'undefined') return false;\n  \n  // Type assertion for navigator with standalone property\n  type NavigatorWithStandalone = Navigator & {\n    standalone?: boolean | 'true' | 1;\n  };\n  \n  const nav = window.navigator as NavigatorWithStandalone;\n  \n  return (\n    window.matchMedia('(display-mode: standalone)').matches ||\n    nav.standalone === true ||\n    nav.standalone === 'true' ||\n    nav.standalone === 1 ||\n    document.referrer.includes('android-app://')\n  );\n};\n\n// Check if we've shown the toast before\nconst hasShownToastBefore = (): boolean => {\n  if (typeof window === 'undefined') return false;\n  try {\n    return localStorage.getItem('pwaToastShown') === 'true';\n  } catch (e) {\n    console.warn('Could not access localStorage:', e);\n    return false;\n  }\n};\n\n// Save that we've shown the toast\nconst markToastAsShown = (): void => {\n  if (typeof window === 'undefined') return;\n  try {\n    localStorage.setItem('pwaToastShown', 'true');\n  } catch (e) {\n    console.warn('Could not save to localStorage:', e);\n  }\n};\n\nexport function usePWAInstallToast() {\n  const { toast } = useToast();\n  const [hasShownToast, setHasShownToast] = useState(false);\n  const [isInstalled, setIsInstalled] = useState(false);\n\n  const dismissToast = useCallback(() => {\n    setHasShownToast(true);\n    markToastAsShown();\n  }, []);\n\n  useEffect(() => {\n    // Only run on client-side\n    if (typeof window === 'undefined') return;\n\n    // Check if we should show the toast\n    if (isRunningAsPWA() && !hasShownToastBefore() && !isInstalled) {\n      const toastId = 'pwa-install-toast';\n      \n      // Show the toast with a simple message\n      const { dismiss } = toast({\n        title: 'App Instalada',\n        description: 'QuorumFlow est instalado y funciona completamente offline.',\n        duration: 5000, // Auto-dismiss after 5 seconds\n      });\n      \n      // Mark as installed to prevent duplicate toasts\n      setIsInstalled(true);\n      markToastAsShown();\n      \n      // Auto-dismiss after 5 seconds as a fallback\n      const timer = setTimeout(() => {\n        dismiss();\n        dismissToast();\n      }, 5000);\n      \n      return () => {\n        clearTimeout(timer);\n        dismiss();\n      };\n    }\n  }, [toast, isInstalled, dismissToast]);\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\collections-server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\collections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\cookie-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\dashboard-data.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\date-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\firebase-admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\health-concerns.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\member-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\members-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\migrate-ministering.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\ministering-reverse-sync-refactored.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\ministering-reverse-sync.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\ministering-sync.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\ministering-validations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\notification-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\offline-firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\roles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\sentry-replay-lazy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\lib\\utils\\date.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\test-support\\testing-library-react.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\types\\testing.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\src\\types\\uuid.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Personal\\QuorumFlow\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]